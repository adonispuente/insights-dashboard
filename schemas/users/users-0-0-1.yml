---
"$schema": http://json-schema.org/schema#
type: object
definitions:
  identifier:
    type: string
    pattern: "^[a-z][a-z-_]{0,30}[a-z]$"

  openshift_dedicated_access:
    type: object
    properties:
      service:
        "$ref": "common-0-0-1.json#/definitions/identifier"
        const: openshift_dedicated

  quay_repo_access:
    type: object
    properties:
      service:
        "$ref": "common-0-0-1.json#/definitions/identifier"
        const: quay

  github_repo_access:
    type: object
    properties:
      service:
        "$ref": "common-0-0-1.json#/definitions/identifier"
        const: github
      access_type:
        type: string
        enum:
        - github-repo-read
        - github-repo-write
      repo_name:
        type: string
        pattern: "^[A-Za-z0-9-_]+$"
    required:
    - repo_name
    - access_type

properties:
  "$schema":
    type: string
  teams:
    type: array
    items:
      type: object
      properties:
        name:
          "$ref": "common-0-0-1.json#/definitions/identifier"
          description: Unique name to use when identifying this group of people in
            various systems
        members:
          type: array
          items:
            type: string
            pattern: "[a-z]{1,8}"
            description: LDAP login name for the team member
        roles:
          type: array
          items:
            "$ref": "common-0-0-1.json#/definitions/identifier"
            description: Unique name of the role to which we want to imbue this team.
      required:
      - name
      - members
      additionalProperties: false
  roles:
    type: array
    items:
      type: object
      properties:
        name:
          "$ref": "common-0-0-1.json#/definitions/identifier"
          description: Unique name to use when referring to this role.
        permissions:
          type: array
          items:
            allOf:
            - anyOf:
              - "$ref": "#/definitions/openshift_dedicated_access"
              - "$ref": "#/definitions/quay_repo_access"
            - type: object
              required:
              - service
      required:
      - name
      additionalProperties: false
required:
- teams
additionalProperties: false
