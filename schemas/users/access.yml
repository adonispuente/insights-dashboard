---
"$schema": metaschema.json
version: 0.0.1
type: object
definitions:

  openshift_dedicated_access:
    type: object
    properties:
      service:
        "$ref": "common.json#/definitions/identifier"
        const: openshift_dedicated

  quay_repo_access:
    type: object
    properties:
      service:
        "$ref": "common.json#/definitions/identifier"
        const: quay

  github_org:
    type: object
    properties:
      service:
        "$ref": "common.json#/definitions/identifier"
        const: github_org
      org:
        type: string
        # TODO: pattern?
    required:
    - org

  github_org_team:
    type: object
    properties:
      service:
        "$ref": "common.json#/definitions/identifier"
        const: github_org_team
      org:
        type: string
        # TODO: pattern?
      team:
        type: string
        # TODO: pattern?
    required:
    - org
    - team

  github_repo_access:
    type: object
    properties:
      service:
        "$ref": "common.json#/definitions/identifier"
        const: github
      access_type:
        type: string
        enum:
        - github-repo-read
        - github-repo-write
      repo_name:
        type: string
        pattern: "^[A-Za-z0-9-_]+$"
    required:
    - repo_name
    - access_type

properties:
  "$schema":
    type: string
  labels:
    "$ref": "common.json#/definitions/labels"
  teams:
    type: array
    items:
      type: object
      properties:
        name:
          "$ref": "common.json#/definitions/identifier"
          description: Unique name to use when identifying this group of people in
            various systems
        members:
          type: array
          items:
            "$ref": "common.json#/definitions/crossref"
        permissions:
          type: array
          items:
            "$ref": "common.json#/definitions/crossref"
      required:
      - name
      - members
      additionalProperties: false
  roles:
    type: array
    items:
      type: object
      properties:
        name:
          "$ref": "common.json#/definitions/identifier"
          description: Unique name to use when referring to this role.
        permissions:
          type: array
          items:
            allOf:
            - anyOf:
              - "$ref": "#/definitions/openshift_dedicated_access"
              - "$ref": "#/definitions/quay_repo_access"
            - type: object
              required:
              - service
      required:
      - name
      additionalProperties: false
required:
- teams
additionalProperties: false
