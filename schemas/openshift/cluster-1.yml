---
"$schema": /metaschema-1.json
version: '1.0'
type: object

additionalProperties: false
properties:
  "$schema":
    type: string
    enum:
    - /openshift/cluster-1.yml
  labels:
    "$ref": "/common-1.json#/definitions/labels"
  name:
    type: string
  consoleUrl:
    type: string
    format: uri
  kibanaUrl:
    type: string
    format: uri
  prometheusUrl:
    type: string
    format: uri
  alertmanagerUrl:
    type: string
    format: uri
  serverUrl:
    type: string
    format: uri
  elbFQDN:
    type: string
    format: uri
  auth:
    type: object
    properties:
      service:
        type: string
        enum:
        - github-org
        - github-org-team
      org:
        type: string
      team:
        type: string
    oneOf:
    - properties:
        service:
          type: string
          enum:
          - github-org
        org:
          type: string
      required:
      - service
      - org
    - properties:
        service:
          type: string
          enum:
          - github-org-team
        org:
          type: string
        team:
          type: string
      required:
      - service
      - org
      - team
  observabilityNamespace:
    "$ref": "/common-1.json#/definitions/crossref"
    "$schemaRef": "/openshift/namespace-1.yml"
  grafanaUrl:
    type: string
    format: uri
  ocm:
    "$ref": "/common-1.json#/definitions/crossref"
    "$schemaRef": "/openshift/openshift-cluster-manager-1.yml"
  managedGroups:
    type: array
    items:
      type: string
      enum:
      - dedicated-admins
      - dedicated-readers
      - hive-admins
      - hive-readers
      - hive-frontend
      - aws-account-operator-client
      - gcp-project-operator-client
      - observatorium-dev
  managedClusterRoles:
    type: boolean
  spec:
    type: object
    additionalProperties: false
    properties:
      id:
        type: string
      external_id:
        type: string
      provider:
        type: string
        enum:
        - aws
      region:
        type: string
        enum:
        - us-east-1
        - us-east-2
        - us-west-1
      channel:
        type: string
        enum:
        - stable
        - fast
      version:
        type: string
      initial_version:
        type: string
      multi_az:
        type: boolean
      nodes:
        type: integer
      instance_type:
        type: string
        enum:
        - m5.xlarge
        - m5.2xlarge
        - m5.4xlarge
        - r5.2xlarge
      private:
        type: boolean
      storage:
        type: integer
        enum:
        - 1
        - 100
        - 600
        - 1100
        - 1600
        - 2100
        - 2600
        - 3100
        - 3600
        - 4100
      load_balancers:
        type: integer
        enum:
        - 0
        - 4
      upgrade:
        type: string
        enum:
        - batch1
        - batch2
        - skip
      provision_shard_id:
        type: string
        # values are taken from the uhc-production namespace file
        # we only allow to choose a v4 shard
        # /data/services/ocm/namespaces/uhc-production.yml
        enum:
        - 7c2626e2-da06-11ea-8f62-8c1645a911be
        - de4b0632-dca7-11ea-b3b9-8c1645a911be
    required:
    - provider
    - region
    - version
    - initial_version
    - multi_az
    - nodes
    - instance_type
    - private
    - storage
    - load_balancers
    - upgrade
  network:
    type: object
    additionalProperties: false
    properties:
      vpc:
        type: string
      service:
        type: string
      pod:
        type: string
  peering:
    type: object
    additionalProperties: false
    properties:
      connections:
        type: array
        items:
          type: object
          properties:
            provider:
              type: string
              enum:
              - account-vpc
              - cluster-vpc-requester
              - cluster-vpc-accepter
            name:
              type: string
            vpc:
              "$ref": "/common-1.json#/definitions/crossref"
              "$schemaRef": "/aws/vpc-1.yml"
            cluster:
              "$ref": "/common-1.json#/definitions/crossref"
              "$schemaRef": "/openshift/cluster-1.yml"
            manageRoutes:
              type: boolean
            delete:
              type: boolean
          oneOf:
          - properties:
              provider:
                type: string
                enum:
                - account-vpc
              name:
                type: string
              vpc:
                "$ref": "/common-1.json#/definitions/crossref"
                "$schemaRef": "/aws/vpc-1.yml"
              manageRoutes:
                type: boolean
              delete:
                type: boolean
            required:
            - provider
            - name
            - vpc
          - properties:
              provider:
                type: string
                enum:
                - cluster-vpc-requester
              name:
                type: string
              cluster:
                "$ref": "/common-1.json#/definitions/crossref"
                "$schemaRef": "/openshift/cluster-1.yml"
              manageRoutes:
                type: boolean
              delete:
                type: boolean
            required:
            - provider
            - name
            - cluster
          - properties:
              provider:
                type: string
                enum:
                - cluster-vpc-accepter
              name:
                type: string
              cluster:
                "$ref": "/common-1.json#/definitions/crossref"
                "$schemaRef": "/openshift/cluster-1.yml"
              manageRoutes:
                type: boolean
              delete:
                type: boolean
            required:
            - provider
            - name
            - cluster
    required:
    - connections
  jumpHost:
    type: object
    additionalProperties: false
    properties:
      hostname:
        type: string
        format: uri
      knownHosts:
        type: string
      user:
        type: string
      port:
        type: integer
      identity:
        "$ref": "/common-1.json#/definitions/vaultSecret"
    required:
    - hostname
    - user
    - identity
  automationToken:
    "$ref": "/common-1.json#/definitions/vaultSecret"
  description:
    type: string
  internal:
    type: boolean
  disable:
    type: object
    additionalProperties: false
    properties:
      integrations:
        type: array
        items:
          type: string
          enum:
          - openshift-groups
          - openshift-namespaces
          - openshift-resources
          - openshift-rolebindings
          - openshift-users
          - openshift-vault-secrets
          - openshift-routes
      e2eTests:
        type: array
        items:
          type: string
          enum:
          - create-namespace
          - dedicated-admin-rolebindings
          - default-network-policies
          - default-project-labels
  awsInfrastructureAccess:
    type: array
    items:
      type: object
      properties:
        awsGroup:
          "$ref": "/common-1.json#/definitions/crossref"
          "$schemaRef": "/aws/group-1.yml"
        accessLevel:
          type: string
          enum:
          - read-only
          - network-mgmt
      required:
      - awsGroup
      - accessLevel
  prometheus:
    type: object
    additionalProperties: false
    properties:
      url:
        type: string
      auth:
        "$ref": "/common-1.json#/definitions/vaultSecret"
    required:
    - url
    - auth
required:
- "$schema"
- labels
- name
- consoleUrl
- kibanaUrl
- prometheusUrl
- serverUrl
- elbFQDN
- description
- internal
dependencies:
  jumpHost:
  - automationToken
  ocm:
  - spec
  - network
  awsInfrastructureAccess:
  - ocm
  peering:
  - ocm
