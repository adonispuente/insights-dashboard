# Vulnerability Alert Kafka Lag - CVE recalculation
Severity: Pagerduty

## Incident Response Plan
 [Incident Response Doc](https://docs.google.com/document/d/1AyEQnL4B11w7zXwum8Boty2IipMIxoFw1ri1UZB6xJE) for console.redhat.com

## Impact
CVE recalculation is either being slow or not working which means that systems registered within Vulnerabily application are being scanned for new vulnerabilities.

## Summary
This alert fire when Vulnerability component responsible for processing requests for CVE re-evaluation doesn't keep up with processing new messages and so Kafka lag increases too much. CVE re-evaluation happens when there's a new fix for CVE published into the Red Hat RPM repositories.

## Access required
Console access to the cluster+namespace pods are running in.

## Steps
1. Check Vulnerability grafana board "Kafka aconsumer lag" chart.
 - Topic `vulnerability.evaluator.recalc` lag means `vulnerability-engine-evaluator-recalc-service` components issues.
2. Log into the console / namespace and verify if all `vulnerability-engine-evaluator-recalc-service` pods are running and processing incoming messages.
3. Inspect given components pods logs and search for error logs.
4. If there are no errors in the logs observe the Kafka lag for a while to see it decreases at reasonable rate.
5. Check VMaaS webapp as it's external dependency of evaluator service and might be the root cause of the Kafka lag.
6. Check if any deployments or changes in the application happened closer to the time the error started.
7. Escalate the alert with all the information available to the engineering team that is responsible for the app.

## Escalations
https://visual-app-interface.devshift.net/services#/services/insights/vulnerability/app.yml
