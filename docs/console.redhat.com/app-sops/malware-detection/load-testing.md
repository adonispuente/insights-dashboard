## Malware Detection Load Testing

Load testing is performed via the malware-detection IQE suite of tests at: https://gitlab.cee.redhat.com/insights-qe/iqe-malware-detection-plugin/

### Test Setup

Information on setting up the test environment and getting authenticated is in the [IQE README](https://gitlab.cee.redhat.com/insights-qe/iqe-malware-detection-plugin/-/blob/master/README.md).

### Running the tests

After setting up the test environment, running the tests, say against stage are performed like so:

    $ export ENV_FOR_DYNACONF=stage_proxy
    $ iqe tests plugin malware_detection -m graphql_load

The number of concurrent clients and the number of requests each client sends can be controlled with the `NUM_CLIENTS` & `QUERIES_PER_PROCESS` environment variables.  For example to run 50 concurrent clients sending 100 requests each, run:

    $ export NUM_CLIENTS=50
    $ export QUERIES_PER_CLIENT=100
    $ iqe tests plugin malware_detection -m graphql_load

### Viewing the impact of the load tests

The impact of the load testing can be viewed on the malware-detection grafana dashboard for the environment you are testing against (eg for the stage datasource):
https://grafana.app-sre.devshift.net/d/FSmSIdH7z/malware-detection?orgId=1&refresh=5s&var-datasource=crcs02ue1-prometheus

### Further Information

Additional information may be found in the [Malware Detection Architecture document](https://docs.engineering.redhat.com/display/RHIN/Malware+Architecture+Document#MalwareArchitectureDocument-Reliability/LoadTesting).
