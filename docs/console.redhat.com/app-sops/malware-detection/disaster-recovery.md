## Malware Detection Disaster Recovery

### Impact

Information on how the Insights Malware Detection application is structured and works can be found in its [Architecture document](https://docs.engineering.redhat.com/display/RHIN/Malware+Architecture+Document).

The malware detection backend app is the component that is managed by AppSRE and is covered in this document.  The client application is part of [insights-core](https://github.com/RedHatInsights/insights-core) and the [frontend application](https://github.com/RedHatInsights/malware-detection-frontend) is stored in the Insights CDN.  Neither of those components are covered in this disaster recovery document, but neither can work correctly without the malware detection backend application.

The malware detection backend app receives output from [yara](https://virustotal.github.io/yara/) scans on customer systems and stores/displays the output for customers to verify if their systems are affected by malware or not. If the Malware Detection app is broken, customers can't send the yara output and can't (easily) determine if their systems are affected by malware.  

If the data from the malware detection backend is lost, then customers will lose the history of their malware scans, nor will they be able to upload any new scans until the data is restored.

### Recovery Steps

- If the malware-detection-prod project has been damaged/removed, the project can be redeployed using clowder.  It is a clowder managed application with dependencies on kafka and AWS for postgres RDS: https://visual-app-interface.devshift.net/namespaces#/services/insights/malware-detection/namespaces/malware-detection-prod.yml.
- If secrets have been lost and are causing volume mount errors preventing the pod from scheduling, reach out to the engineering team to reissue them.
- If the RDS database has been corrupted and resulting the following errors, follow the [app-interface instructions](https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/aws/sop/create-rds-instance-from-snapshot.md) to restore the database from a previous snapshot prior to the errors occurring.
- If the RDS database is out of space, login to AWS and increase the size of the [malware detection RDS database](https://us-east-1.console.aws.amazon.com/rds/home?region=us-east-1#database:id=malware-detection-prod;is-cluster=false).

### Escalations

See https://visual-app-interface.devshift.net/services#/services/insights/malware-detection/app.yml
