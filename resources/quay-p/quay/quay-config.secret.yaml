apiVersion: v1
kind: Secret
metadata:
  name: {{{ name }}}
  labels:
    version: {{{ version_label }}}
  {{%- if recycle %}}
  annotations:
    qontract.ignore_reconcile_time: "true"
    qontract.recycle: "true"
  {{%- endif %}}
data:
  config.yaml: >-
    {{% b64encode %}}
    {{%- if readonly %}}
    REGISTRY_STATE: readonly
    INSTANCE_SERVICE_KEY_KID_LOCATION: 'conf/stack/quay-readonly.kid'
    INSTANCE_SERVICE_KEY_LOCATION: 'conf/stack/quay-readonly.pem'
    {{%- endif %}}

    {{%- if account_recovery_mode  %}}

    ACCOUNT_RECOVERY_MODE: true
    FEATURE_PROXY_PROTOCOL: false
    FEATURE_APP_REGISTRY: false
    FEATURE_BILLING: false
    FEATURE_BITTORRENT: false
    FEATURE_DIRECT_LOGIN: true
    FEATURE_RESTRICTED_V1_PUSH: false
    FEATURE_BITBUCKET_BUILD: false
    FEATURE_GITLAB_BUILD: false
    FEATURE_GITHUB_BUILD: false
    FEATURE_BUILD_SUPPORT: false
    SERVER_HOSTNAME: recovery.quay.io


    {{%- else %}}

    FEATURE_PROXY_PROTOCOL: true
    FEATURE_APP_REGISTRY: true
    FEATURE_BILLING: true
    FEATURE_BITTORRENT: true
    FEATURE_DIRECT_LOGIN: false
    FEATURE_RESTRICTED_V1_PUSH: true
    FEATURE_BITBUCKET_BUILD: true
    FEATURE_GITHUB_BUILD: true
    FEATURE_GITLAB_BUILD: true
    SERVER_HOSTNAME: quay.io


    {{%- endif %}}

    APP_REGISTRY_PACKAGE_LIST_CACHE_WHITELIST:
    - community-operators
    - certified-operators
    - redhat-operators
    - redhat-marketplace

    APP_REGISTRY_SHOW_PACKAGE_CACHE_WHITELIST:
    - community-operators
    - certified-operators
    - redhat-operators
    - redhat-marketplace

    V3_UPGRADE_MODE: complete
    BACKFILL_TAGS: false

    SETUP_COMPLETE: true


    BRANDING:
      logo: https://quay.io/static/img/RH_QuayIO.svg
      footer_img: /static/img/RedHat.svg
      footer_url: https://redhat.com

    RHSSO_LOGIN_CONFIG:
      CLIENT_ID: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'RHSSO_LOGIN_CONFIG__CLIENT_ID', 3) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'RHSSO_LOGIN_CONFIG__CLIENT_SECRET', 3) }}}
      OIDC_SERVER: https://sso.redhat.com/auth/realms/redhat-external/
      SERVICE_NAME: Red Hat
      SERVICE_ICON: /static/img/RedHat.svg
      VERIFIED_EMAIL_CLAIM_NAME: email
      PREFERRED_USERNAME_CLAIM_NAME: preferred_username
      LOGIN_SCOPES: ['openid']

    FEATURE_BUILD_SUPPORT: {{{ enable_builders }}}
    FEATURE_EXTENDED_REPOSITORY_NAMES: false
    FEATURE_SUPER_USERS: false
    FEATURE_ADVERTISE_V2: true

    SECRET_KEY: "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-publish-config', 'SECRET_KEY', 1) }}}"
    DATABASE_SECRET_KEY: "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'DATABASE_SECRET_KEY', '{{ additional_config_vault_secret_version }}') }}}"

    {{%- if enable_redis_modelcache %}}

    DATA_MODEL_CACHE_CONFIG:
      engine: rediscluster
      redis_config:
        startup_nodes:
          - host: '{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-modelcache', 'db.endpoint') }}}'
            port: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-modelcache', 'db.port') }}}
        password: '{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-modelcache', 'db.auth_token') }}}'
        read_from_replicas: true
        skip_full_coverage_check: true
        ssl: true

    {{%- endif %}}

    SESSION_COOKIE_SECURE: true

    PREFERRED_URL_SCHEME: https

    REGISTRY_TITLE: Quay Container Registry
    REGISTRY_TITLE_SHORT: Quay

    AVATAR_KIND: gravatar

    GITHUB_LOGIN_CONFIG:
      GITHUB_ENDPOINT: https://github.com/
      API_ENDPOINT: https://api.github.com/
      CLIENT_ID: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'GITHUB_LOGIN_CONFIG__CLIENT_ID', 3) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'GITHUB_LOGIN_CONFIG__CLIENT_SECRET', 3) }}}

    GITHUB_TRIGGER_CONFIG:
      GITHUB_ENDPOINT: https://github.com/
      API_ENDPOINT: https://api.github.com/
      CLIENT_ID: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-trigger-config', 'GITHUB_TRIGGER_CONFIG__CLIENT_ID', 1) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-trigger-config', 'GITHUB_TRIGGER_CONFIG__CLIENT_SECRET', 1) }}}

    BITBUCKET_TRIGGER_CONFIG:
      CONSUMER_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-trigger-config', 'BITBUCKET_TRIGGER_CONFIG__CONSUMER_KEY', 1) }}}
      CONSUMER_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-trigger-config', 'BITBUCKET_TRIGGER_CONFIG__CONSUMER_SECRET', 1) }}}

    GITLAB_TRIGGER_CONFIG:
      GITLAB_ENDPOINT: https://gitlab.com
      CLIENT_ID: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-trigger-config', 'GITLAB_TRIGGER_CONFIG__CLIENT_ID', 1) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-trigger-config', 'GITLAB_TRIGGER_CONFIG__CLIENT_SECRET', 1) }}}

    GOOGLE_LOGIN_CONFIG:
      CLIENT_ID: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_ID', 3) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_SECRET', 3) }}}

    GOOGLE_LOGIN_CLIENT_ID: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_ID', 3) }}}
    GOOGLE_LOGIN_CLIENT_SECRET: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_SECRET', 3) }}}

    {{%- if standby %}}

    DB_URI: mysql+pymysql://{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.user', '{{ additional_config_vault_secret_version }}') }}}:{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.password', '{{ additional_config_vault_secret_version }}') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quayp04ue2/quay/quayio-production-57-py3-replica-rds', 'db.host') }}}/{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.name', '{{ additional_config_vault_secret_version }}') }}}

    {{%- else %}}

    {{%- if read_from_rds_replica %}}

    DB_URI: mysql+pymysql://{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.user', '{{ additional_config_vault_secret_version }}') }}}:{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.password', '{{ additional_config_vault_secret_version }}') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-replica-ue1-rds', 'db.host') }}}/{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.name', '{{ additional_config_vault_secret_version }}') }}}

    {{%- else %}}

    DB_URI: mysql+pymysql://{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.user', '{{ additional_config_vault_secret_version }}') }}}:{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.password', '{{ additional_config_vault_secret_version }}') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-py3-rds', 'db.host') }}}/{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.name', '{{ additional_config_vault_secret_version }}') }}}

    DB_READ_REPLICAS:
    - DB_URI: 'mysql+pymysql://{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.user', '{{ additional_config_vault_secret_version }}') }}}:{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.password', '{{ additional_config_vault_secret_version }}') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-py3-rds', 'db.host') }}}/{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'db.name', '{{ additional_config_vault_secret_version }}') }}}'
      DB_CONNECTION_ARGS:
        autorollback: true
        threadlocals: true
        max_connections: 20
        _driver_autocommit: true
        ssl:
          ca: conf/stack/rds-ssl-ca-cert.pem

    {{%- endif %}} # end-read_from_rds_replica

    {{%- endif %}} # end-standy

    DB_CONNECTION_ARGS:
      threadlocals: true
      autorollback: true
      max_connections: 20
      ssl:
        ca: conf/stack/rds-ssl-ca-cert.pem


    BILLING_TYPE: Stripe
    STRIPE_SECRET_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-billing-config', 'STRIPE_SECRET_KEY', 1) }}}
    STRIPE_PUBLISHABLE_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-billing-config', 'STRIPE_PUBLISHABLE_KEY', 1) }}}

    USE_CDN: false

    FEATURE_USER_METADATA: true

    MAIL_SERVER: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-smtp-config', 'MAIL_SERVER', 2) }}}
    MAIL_USE_TLS: true
    MAIL_PORT: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-smtp-config', 'MAIL_PORT', 2) }}}
    MAIL_USERNAME: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-smtp-config', 'MAIL_USERNAME', 2) }}}
    MAIL_PASSWORD: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-smtp-config', 'MAIL_PASSWORD', 2) }}}
    DEFAULT_MAIL_SENDER: support@quay.io
    MAIL_DEFAULT_SENDER: support@quay.io
    MAIL_FAIL_SILENTLY: false
    TESTING: false

    FEATURE_LIBRARY_SUPPORT: false

    # Feature Flag: Whether to display the support chat.
    FEATURE_SUPPORT_CHAT: true

    # Feature Flag: Whether GitHub login is supported.
    FEATURE_GITHUB_LOGIN: false


    FEATURE_GOOGLE_LOGIN: false

    EXCEPTION_LOG_TYPE: Sentry
    SENTRY_DSN: https://38f070566d7442728f3af6441e60faa4:12725a26f5674345975fce585aa84ab4@app.getsentry.com/52148

    # Disabled because too noisy:
    # SENTRY_PUBLIC_DSN: https://d2070735be8b473c9dc99dd6782624bd@app.getsentry.com/52150

    # CloudWatch AWS Keys
    CLOUDWATCH_AWS_ACCESS_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'CLOUDWATCH_AWS_ACCESS_KEY', '{{ additional_config_vault_secret_version }}') }}}
    CLOUDWATCH_AWS_SECRET_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'CLOUDWATCH_AWS_SECRET_KEY', '{{ additional_config_vault_secret_version }}') }}}
    CLOUDWATCH_NAMESPACE: Quay/Prod

    BUILDLOGS_REDIS:
      host: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-builders-elasticache', 'db.endpoint') }}}
      password: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-builders-elasticache', 'db.auth_token') }}}
      port: 6379
      ssl: true
    USER_EVENTS_REDIS:
      host: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-elasticache', 'db.endpoint') }}}
      port: 6379
      password: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-elasticache', 'db.auth_token') }}}
      ssl: true

    {{%- if standby %}}
    DISTRIBUTED_STORAGE_CONFIG:
      s3_us_east_1:
      - CloudFrontedS3Storage
      - storage_path: ""
        s3_access_key: {{{ vault('app-interface/quayio-prod-us-east-2/quay/quay-additional-config', 's3.cloudfront.aws_access_key_id', 1) }}}
        s3_secret_key: {{{ vault('app-interface/quayio-prod-us-east-2/quay/quay-additional-config', 's3.cloudfront.aws_secret_access_key', 1) }}}
        s3_bucket: quayio-production-s3-backup
        cloudfront_distribution_domain: cdn01.quay.io
        cloudfront_key_id: {{{ vault('app-interface/quayio-prod-us-east-2/quay/quay-additional-config', 's3.cloudfront.key_id', 1) }}}
        cloudfront_privatekey_filename: cloudfront-signing-key.pem
    {{%- else %}}
    DISTRIBUTED_STORAGE_CONFIG:
      s3_us_east_1:
      - CloudFrontedS3Storage
      - storage_path: ""
        s3_access_key: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 's3.cloudfront.aws_access_key_id', '{{ additional_config_vault_secret_version }}') }}}
        s3_secret_key: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 's3.cloudfront.aws_secret_access_key', '{{ additional_config_vault_secret_version }}') }}}
        s3_bucket: quayio-production-s3
        cloudfront_distribution_domain: cdn02.quay.io
        cloudfront_key_id: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 's3.cloudfront.key_id', '{{ additional_config_vault_secret_version }}') }}}
        cloudfront_privatekey_filename: cloudfront-signing-key.pem
    {{%- endif %}}

    # Userfiles
    USERFILES_LOCATION: s3_us_east_1
    USERFILES_PATH: userfiles/

    # Health check.
    HEALTH_CHECKER:
    - ProductionHealthCheck
    - access_key: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quay-db-monitor', 'aws_access_key_id') }}}
      secret_key: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quay-db-monitor', 'aws_secret_access_key') }}}

    # Build logs archive
    LOG_ARCHIVE_LOCATION: s3_us_east_1
    LOG_ARCHIVE_PATH: logarchive/

    # Action logs archive
    FEATURE_ACTION_LOG_ROTATION: false
    ACTION_LOG_ARCHIVE_LOCATION: s3_us_east_1
    ACTION_LOG_ARCHIVE_PATH: actionlogarchive/

    DISTRIBUTED_STORAGE_PREFERENCE:
    - s3_us_east_1

    BUILD_MANAGER:
    - ephemeral
    - ALLOWED_WORKER_COUNT: 60
      ORCHESTRATOR_PREFIX: buildman/production/
      ORCHESTRATOR:
        REDIS_HOST: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-builders-elasticache', 'db.endpoint') }}}
        REDIS_PASSWORD: {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-builders-elasticache', 'db.auth_token') }}}
        REDIS_SSL: true
        REDIS_SKIP_KEYSPACE_EVENT_SETUP: true

      EXECUTORS:
      - EXECUTOR: kubernetes
        NAME: openshift-dedicated
        MINIMUM_RETRY_THRESHOLD: 2
        BUILDER_VM_CONTAINER_IMAGE: quay.io/quay/quay-builder-qemu-fedoracoreos:34.20210611.3.0
        K8S_API_SERVER: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'k8s_api_server', 1) }}}
        QUAY_USERNAME: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'quay_username', 1) }}}
        QUAY_PASSWORD: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'quay_password', 1) }}}
        WORKER_TAG: prod-multistage
        VOLUME_SIZE: 32G
        BLOCK_DEVICE_SIZE: 58 # Not sure this makes sense here.
        SETUP_TIME: 100
        KUBERNETES_DISTRIBUTION: openshift
        CONTAINER_MEMORY_LIMITS: 5120Mi
        CONTAINER_CPU_LIMITS: 1000m
        CONTAINER_MEMORY_REQUEST: 3968Mi
        CONTAINER_CPU_REQUEST: 500m
        NODE_SELECTOR_LABEL_KEY: beta.kubernetes.io/instance-type
        NODE_SELECTOR_LABEL_VALUE: m5.metal
        SERVICE_ACCOUNT_NAME: quay-builder-sa
        SERVICE_ACCOUNT_TOKEN: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'k8s_service_account_token', 2) }}}
        BUILDER_NAMESPACE: builder-prod
        MAX_LIFETIME_S: 2700

      - EXECUTOR: ec2
        EC2_REGION: us-east-1
        COREOS_AMI: ami-09b4202f59cdad6b2
        AWS_ACCESS_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'ec2_aws_access_key', 1) }}}
        AWS_SECRET_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'ec2_aws_secret_key', 1) }}}
        EC2_INSTANCE_TYPE: t2.large
        EC2_VPC_SUBNET_ID: subnet-a39f0ed4
        EC2_SECURITY_GROUP_IDS:
        - sg-e6b81982
        EC2_KEY_NAME: Kenny's Mac
        QUAY_USERNAME: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'quay_username', 1) }}}
        QUAY_PASSWORD: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-builder-config', 'quay_password', 1) }}}
        WORKER_TAG: prod-multistage
        VOLUME_SIZE: 52G # Size in truncate notation for the BTRFS volume
        BLOCK_DEVICE_SIZE: 58
        SETUP_TIME: 180
        MAX_LIFETIME_S: 2700

    SIGNING_ENGINE: gpg2

    GPG2_PRIVATE_KEY_NAME: 799D33BC
    GPG2_PRIVATE_KEY_FILENAME: signing-private.gpg
    GPG2_PUBLIC_KEY_FILENAME: signing-public.gpg

    FEATURE_ACI_CONVERSION: true

    # Security scanner
    FEATURE_SECURITY_SCANNER: {{{ enable_clair }}}
    FEATURE_SECURITY_NOTIFICATIONS: {{{ enable_clair }}}

    SECURITY_SCANNER_ENDPOINT: https://api.clair.quay.io:6060
    SECURITY_SCANNER_INDEXING_INTERVAL: 30
    SECURITY_SCANNER_ENDPOINT_BATCH: https://worker.clair.quay.io:6060
    SECURITY_SCANNER_ENGINE_VERSION_TARGET: 3
    SECURITY_SCANNER_API_VERSION: v1
    SECURITY_SCANNER_API_TIMEOUT_SECONDS: 30
    SECURITY_SCANNER_API_BATCH_TIMEOUT_SECONDS: 480

    SECURITY_SCANNER_ISSUER_NAME: clair

    # BitTorrent pulls
    BITTORRENT_ANNOUNCE_URL: https://tracker.quay.io/announce
    BITTORRENT_FILENAME_PEPPER: d50462ba-15b2-46db-8f99-a3cfd75ea000

    PAGE_TOKEN_KEY: {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-publish-config', 'PAGE_TOKEN_KEY', 1) }}}

    STATIC_SITE_BUCKET: 'https://s3.amazonaws.com/prod-landing-s3.quay.io/'

    TUF_SERVER: https://apostille-prod.quay.io
    TUF_HOST: apostille-prod.quay.io
    FEATURE_SIGNING: true
    SIGNING_NAMESPACE_WHITELIST: ['coreos', 'quay', 'mstyne', 'mayorova']

    FEATURE_RECAPTCHA: true
    RECAPTCHA_SITE_KEY: "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-publish-config', 'RECAPTCHA_SITE_KEY', 1) }}}"
    RECAPTCHA_SECRET_KEY: "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-publish-config', 'RECAPTCHA_SECRET_KEY', 1) }}}"

    FEATURE_APP_SPECIFIC_TOKENS: false

    DEFAULT_NAMESPACE_MAXIMUM_BUILD_COUNT: 3
    BILLED_NAMESPACE_MAXIMUM_BUILD_COUNT: 30
    THREAT_NAMESPACE_MAXIMUM_BUILD_COUNT: 1
    TRUSTED_PROXY_CIDR:
    - {{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-production-alb', 'vpc_cidr_block') }}}
    - {{{ resource.namespace.cluster.network.pod }}}


    IP_DATA_API_KEY: "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-publish-config', 'IP_DATA_API_KEY', 1) }}}"

    GARBAGE_COLLECTION_FREQUENCY: 4604800

    V22_NAMESPACE_WHITELIST:
    - openshift-qe-optional-operators
    - openshift-cloud-functions
    - projectquay
    - rh-osbs
    - rh-osbs-stage
    - openshift-knative
    - kbrwn
    - eparis
    - jzelinskie
    - mkonline
    - ibazulic
    - ibazulic1
    - ohman
    - rhdevelopers
    - workspace7
    - prometheus
    - k8s
    - openshift
    - openshift-pipeline
    - openshift-release-dev
    - sdase
    - hendrikhalkow
    - josephschorr
    - kleesinc
    - external_storage
    - influxdb
    - operatorframework
    - operator-framework
    - joelanford
    - cnorman
    - altissia
    - gravitational
    - solarwinds
    - upskill
    - mercedesbenzio
    - jetstack
    - jetstack-james
    - rh-acs

    OCI_NAMESPACE_WHITELIST:
    - redhat
    - operatorframework
    - operator-framework
    - quay
    - coreos
    - outline

    OCI_NAMESPACE_PROPORTION: 1

    FEATURE_USER_LAST_ACCESSED: false
    FEATURE_AGGREGATED_LOG_COUNT_RETRIEVAL: false
    FEATURE_LOG_EXPORT: false
    ACTION_LOG_MAX_PAGE: 5

    V1_ONLY_DOMAIN: v1.quay.io

    DISKSPACE_HEALTH_THRESHOLD: 0.1

    CONTACT_INFO:
    - https://access.redhat.com/articles/quayio-help

    FEATURE_DISABLE_PULL_LOGS_FOR_FREE_NAMESPACES: false

    FEATURE_RATE_LIMITS: true

    NON_RATE_LIMITED_NAMESPACES:
    - openshift-release-dev
    - rh-osbs-stage
    - rh-osbs
    - redhat-dev
    - redhat-pending
    - redhat-prod


    LOGS_MODEL: 'transition_reads_both_writes_es'
    LOGS_MODEL_CONFIG: {
      producer: "{{{ log_producer }}}",
      elasticsearch_config: {
        'host': "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'elasticsearch.host', '{{ additional_config_vault_secret_version }}') }}}",
        'port': 9243,
        'access_key': "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'elasticsearch.access_key', '{{ additional_config_vault_secret_version }}') }}}",
        'secret_key': "{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-additional-config', 'elasticsearch.secret_key', '{{ additional_config_vault_secret_version }}') }}}",
        'use_ssl': true,
        'index_prefix': 'logentry_',
        'index_settings': {
          'number_of_shards': 2,
          'number_of_replicas': 1,
          'refresh_interval': '10s',
          'lifecycle': {
            'name': 'hot-warm-logentry-rotation'
          },
          'routing': {
            'allocation': {
              'require': {
                'data': 'hot'
              }
            }
          }
        }
      },
      kinesis_stream_config: {
      {{%- if standby %}}
        'stream_name': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp04ue2/quay/quayio-kinesis', 'stream_name') }}}",
        'aws_region': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp04ue2/quay/quayio-kinesis', 'aws_region') }}}",
        'aws_access_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp04ue2/quay/quayio-kinesis', 'aws_access_key_id') }}}",
        'aws_secret_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp04ue2/quay/quayio-kinesis', 'aws_secret_access_key') }}}"
      {{%- else %}}
        'stream_name': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-kinesis', 'stream_name') }}}",
        'aws_region': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-kinesis', 'aws_region') }}}",
        'aws_access_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-kinesis', 'aws_access_key_id') }}}",
        'aws_secret_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quayp05ue1/quay/quayio-kinesis', 'aws_secret_access_key') }}}"
      {{%- endif %}}
      }
    }

    FEATURE_GARBAGE_COLLECTION: false

    MAXIMUM_CNR_LAYER_SIZE: 2M

    APP_REGISTRY_RESULTS_LIMIT: 200

    FEATURE_NAMESPACE_GARBAGE_COLLECTION: false

    FEATURE_REPOSITORY_GARBAGE_COLLECTION: false

    {{%- endb64encode %}}
  cloudfront-signing-key.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'cloudfront-signing-key.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  docker_v2.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'docker_v2.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  extra_ca_clair.crt:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'extra_ca_clair.crt', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  k8s-admin-key.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'k8s-admin-key.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  k8s-admin.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'k8s-admin.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  k8s-ca.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'k8s-ca.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  quay-readonly.kid:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'quay-readonly.kid', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  quay-readonly.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'quay-readonly.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  rds-ssl-ca-cert.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'rds-ssl-ca-cert.pem', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  robots.txt:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'robots.txt', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  signing-private.gpg:
    {{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'signing-private.gpg_qb64', '{{ config_vault_secret_version }}') }}}
  signing-public.gpg:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'signing-public.gpg', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  ssl.cert:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'ssl.cert', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
  ssl.key:
    {{% b64encode %}}{{{ vault('app-interface/quayio-prod-us-east-1/quay/quay-config-secret', 'ssl.key', '{{ config_vault_secret_version }}') }}}{{%- endb64encode %}}
