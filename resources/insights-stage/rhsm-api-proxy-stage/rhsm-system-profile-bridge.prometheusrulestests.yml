$schema: /app-interface/prometheus-rule-test-1.yml

rule_files:
  - /insights-stage/rhsm-api-proxy-stage/rhsm-system-profile-bridge.prometheusrules.yml

evaluation_interval: 10m

tests:
  - interval: 30s
    input_series:
      - series: up{namespace="rhsm-api-proxy-stage", service="rhsm-system-profile-bridge"}
        values: '0+0x15 1+0x15'
    alert_rule_test:
      - eval_time: 15m
        alertname: rhsm-system-profile-bridge is down - stage
        exp_alerts:
          - exp_labels:
              severity: medium
              service: rhsm-system-profile-bridge
              env: stage
              namespace: rhsm-api-proxy
            exp_annotations:
              message: "rhsm-system-profile-bridge is down: Prometheus is unable to reach the metrics API."
              runbook: "https://gitlab.cee.redhat.com/rhsm/rhsm-system-profile-bridge/-/wikis/runbooks/rhsm-system-profile-bridge-is-down"
              dashboard: "https://grafana.stage.devshift.net/d/rhsm-system-profile-bridge-dashboard/rhsm-system-profile-bridge-dashboard?orgId=1&var-datasource=crcs02ue1-prometheus"
      - eval_time: 30m
        alertname: rhsm-system-profile-bridge is down - stage
        exp_alerts:
          # None: the alert has cleared
