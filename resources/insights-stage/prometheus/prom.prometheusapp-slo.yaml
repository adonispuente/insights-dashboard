$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: insights-slo-sli-rules
  labels:
    prometheus: app-sre
    role: alert-rules
spec:
  groups:
  #### apicast-tests ####
  - name: apicast-tests-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: apicast-tests

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: apicast-tests

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: apicast-tests

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: apicast-tests

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2500.0"}[5m]))
      labels:
        exported_service: apicast-tests

  #### approval ####
  - name: approval-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: approval

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: approval

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: approval

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: approval

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="3000.0"}[5m]))
      labels:
        exported_service: approval


  #### automation-hub ####
  - name: automation-hub-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: automation-hub

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: automation-hub

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: automation-hub

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: automation-hub

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="4000.0"}[5m]))
      labels:
        exported_service: automation-hub

  #### catalog ####
  - name: catalog-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: catalog

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: catalog

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: catalog

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: catalog

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="1500.0"}[5m]))
      labels:
        exported_service: catalog

  #### cloudigrade ####
  - name: cloudigrade-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: cloudigrade

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: cloudigrade

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: cloudigrade

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: cloudigrade

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: cloudigrade


  #### compliance ####
  - name: compliance-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: compliance

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: compliance

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: compliance

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: compliance

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: compliance

  #### cost-management ####
  - name: cost-management-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: cost-management

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: cost-management

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: cost-management

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: cost-management

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: cost-management

  #### drift ####
  - name: drift-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: drift

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: drift

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: drift

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: drift

    # Custom adjusted latency threshold by increments of 500 up to 4000
    # This is a special case where anything under 5 seconds is expected. Large runs will fail the
    # SLO. Approved and asked for by @sthirugn
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="4000.0"}[5m]))
      labels:
        service: drift

  #### entitlements ####
  - name: entitlements-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: entitlements

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: entitlements

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: entitlements

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: entitlements

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: entitlements

  #### historical-system-profiles ####
  - name: historical-system-profiles-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: historical-system-profiles

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: historical-system-profiles

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: historical-system-profiles

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: historical-system-profiles

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: historical-system-profiles

  #### ingress ####
  - name: ingress-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: ingress

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: ingress

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: ingress

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: ingress

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: ingress

  #### insights ####
  - name: insights-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: insights

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: insights

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: insights

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: insights

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: insights

  #### insights-results-aggregator ####
  - name: insights-results-aggregator-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: insights-results-aggregator

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: insights-results-aggregator

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: insights-results-aggregator

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: insights-results-aggregator

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: insights-results-aggregator

  #### inventory ####
  - name: inventory-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: inventory

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: inventory

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: inventory

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: inventory

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: inventory

  #### module-update-router ####
  - name: module-update-router-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: module-update-router

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: module-update-router

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: module-update-router

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: module-update-router

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: module-update-router

  #### patch ####
  - name: patch-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: patch

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: patch

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: patch

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: patch

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: patch

  #### policies ####
  - name: policies-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: policies

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: policies

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: policies

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: policies

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: policies

  #### rbac ####
  - name: rbac-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: rbac

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: rbac

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: rbac

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: rbac

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: rbac

  #### receptor-controller ####
  - name: receptor-controller-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: receptor-controller

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: receptor-controller

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: receptor-controller

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: receptor-controller

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: receptor-controller

  #### remediations ####
  - name: remediations-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: remediations

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: remediations

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: remediations

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: remediations

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: remediations

  #### rhsm-subscriptions ####
  - name: rhsm-subscriptions-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: rhsm-subscriptions

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: rhsm-subscriptions

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: rhsm-subscriptions

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: rhsm-subscriptions

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: rhsm-subscriptions

  #### sources ####
  - name: sources-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: sources

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: sources

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: sources

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: sources

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: sources

  #### system-baseline ####
  - name: system-baseline-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: system-baseline

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: system-baseline

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: system-baseline

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: system-baseline

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: system-baseline

  #### topological-inventory ####
  - name: topological-inventory-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: topological-inventory

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: topological-inventory

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: topological-inventory

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: topological-inventory

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: topological-inventory

  #### tower-analytics ####
  - name: tower-analytics-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: tower-analytics

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: tower-analytics

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: tower-analytics

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: tower-analytics

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: tower-analytics

  #### vulnerability ####
  - name: vulnerability-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: vulnerability

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: vulnerability

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: vulnerability

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: vulnerability

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        exported_service: vulnerability

  #### xavier ####
  - name: xavier-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"
      labels:
        exported_service: xavier

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"
      labels:
        exported_service: xavier

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"
      labels:
        exported_service: xavier

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"
      labels:
        exported_service: xavier

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="2000.0"}[5m]))
      labels:
        service: xavier

  #### yupana ####
  - name: yupana-sli
    rules:
    # Proportion of requests allowed to have 500 status in a given period
    - record: service:constant:sli:pcterror
      expr: "5"

    # Proportion of requests allowed to be over latency threshold in a given period
    - record: service:constant:sli:pctlatency
      expr: "10"

    # Proportion time that the SLI should be met for error SLI
    - record: service:constant:slo:pcterror
      expr: "90"

    # Proportion time that the SLI should be met for latency SLI
    - record: service:constant:slo:pctlatency
      expr: "90"

    # Custom adjusted latency threshold by increments of 500 up to 4000
    - record: service:latency:adjusted:rate5m
      expr: sum by(exported_service, environment) (rate(api_3scale_gateway_api_time_bucket{le="1500.0"}[5m]))
      labels:
        service: yupana
