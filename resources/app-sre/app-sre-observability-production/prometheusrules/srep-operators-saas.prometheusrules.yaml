apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: srep-operators-saas
spec:
  groups:
  - name: aws-account-operator
    rules:
    - alert: SaasNumberCommits
      annotations:
        message: "The number of commits between prod and upstream for {{ $labels.service }} has exceeded the threshold (5)."
      expr: |
        saas_upstream_commits{namespace="app-sre-observability-production", service="aws-account-operator"}
        -
        saas_commit_index{namespace="app-sre-observability-production", service="aws-account-operator"} > 10
      labels:
        service: srep
        severity: medium
  - alert: SaasProdTimestamp
    annotations:
      message: "The production commit for {{ $service }} is very old."
    expr: |
      time() - saas_commit_ts{namespace="app-sre-observability-production", service="aws-account-operator"} > 60*60*24*365.25/12
    labels:
      service: srep
      severity: medium
