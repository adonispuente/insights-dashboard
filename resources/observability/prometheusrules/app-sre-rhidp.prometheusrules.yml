---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: rhidp-alerts
spec:
  groups:
  - name: initial-access-token-alerts
    interval: 1m
    rules:
    - alert: IATProdExpireSoon
      labels:
        service: rhidp
        severity: high
        jiralert: ASIC
      expr: rhidp_sso_client_inital_access_token_expiration{integration="rhidp-sso-client", path="app-sre/creds/rhidp/auth.redhat.com"} - time() < 5 * 24 * 60 * 60
      for: 5m
      annotations:
        runbook: "https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/app-sre/sop/rhidp-iat.md"
        dashboard: "https://grafana.app-sre.devshift.net/goto/nM9JSL94z?orgId=1"
        message: "The initial access token for auth.redhat.com will expire in less than 5 days."
        link_url: ""
