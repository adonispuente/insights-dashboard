---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: fedramp-customer-interest
  labels:
    prometheus: app-sre
    role: alert-rules
spec:
  groups:
  - name: fedramp-customer-interest-stage
    rules:
      - alert: "[STAGE] FedRAMPCustomerInterestDown"
        annotations:
          message: "Service is down."
          description: "The service disappeared from Prometheus target discovery."
          runbook: "https://gitlab.cee.redhat.com/service/fedramp-customer-interest-service/-/blob/main/docs/architecture.md"
          summary: "The service disappeared from Prometheus target discovery."
        expr: absent(up{job="fedramp-customer-interest",namespace="fedramp-customer-interest-stage"} == 1)
        for: 5m
        labels:
          service: fedramp-customer-interest
          severity: info
          env: stage
      - alert: "[STAGE] FedRAMPCustomerInterestLowAvailability"
        annotations:
          message: "Service low availability."
          description: "The service has limited accessibility or operational capacity."
          runbook: "https://gitlab.cee.redhat.com/service/fedramp-customer-interest-service/-/blob/main/docs/architecture.md"
          summary: "Low service availability."
        expr: sum(rate(fci_http_server_requests_total{status_code!~"5.."}[5m]))/sum(rate(fci_http_server_requests_total[5m]))
        for: 5m
        labels:
          service: fedramp-customer-interest
          severity: info
          env: stage
      - alert: "[STAGE] FedRAMPCustomerInterestDownHighLatency"
        annotations:
          message: "Service high latency."
          description: "The service is experiencing significant delays or high latency."
          runbook: "https://gitlab.cee.redhat.com/service/fedramp-customer-interest-service/-/blob/main/docs/architecture.md"
          summary: "High service latency."
        expr: histogram_quantile(0.90,sum by (le) (rate(fci_http_server_request_duration_seconds_bucket[5m])))
        for: 5m
        labels:
          service: fedramp-customer-interest
          severity: info
          env: stage
      - alert: "[STAGE] FedRAMPCustomerInterestIncidentCreation"
        annotations:
          message: "ServiceNow incident creation issue."
          description: "The service is enable to create ServiceNow incidents."
          runbook: "https://gitlab.cee.redhat.com/service/fedramp-customer-interest-service/-/blob/main/docs/architecture.md"
          summary: "The service is enable to create ServiceNow incidents."
        expr: (sum(fci_successful_ops_total)/sum(fci_processed_ops_total))*100
        for: 5m
        labels:
          service: fedramp-customer-interest
          severity: info
          env: stage
