---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: rhose-fleet-manager-production
spec:
  groups:
  - name: rhose-fleet-manager-production
    rules:
    - alert: RhoseFleetManagerDown - production
      annotations:
        message: "No targets found for RHOSE Fleet Manager in namespace rhose-production. RHOSE Fleet Manager is down."
        dashboard: "https://grafana.stage.devshift.net/d/Aba1eG2kA/rhose-fleet-manager-slos?orgId=1"
        # This repository is private as we are still in our internal service preview. I would like to highlight that at this moment we do not expect any action from AppSRE regarding these alerts as our team will be acting to resolve these issues that may happen.
        runbook: "https://github.com/5733d9e2be6485d52ffa08870cabdee0/sandbox-sop/tree/main/sops/alerts/fleet-manager/rhose_fleet_manager_down.asciidoc"
      expr: |
        absent(up{job="rhose-fleet-manager",namespace="rhose-production"} == 1)
      for: 0m
      labels:
        service: rhose-fleet-manager
        severity: medium
    - alert: RhoseFleetManagerNon200Status - production
      annotations:
        message: "RHOSE fleet manager in namespace rhose-production is receiving status codes other than 2xx"
        # This repository is private as we are still in our internal service preview. I would like to highlight that at this moment we do not expect any action from AppSRE regarding these alerts as our team will be acting to resolve these issues that may happen.
        runbook: "https://github.com/5733d9e2be6485d52ffa08870cabdee0/sandbox-sop/tree/main/sops/alerts/fleet-manager/rhose_fleet_manager_non_200_status.asciidoc"
      expr: |
        sum(rate(haproxy_backend_http_responses_total{exported_namespace="rhose-production", route="rhose-fleet-manager", code=~"(0|4..|5..)"}[5m]))/sum(rate(haproxy_backend_http_responses_total{exported_namespace="rhose-production",route="rhose-fleet-manager"}[5m]))* 100 >= 10
      for: 0m
      labels:
        service: rhose-fleet-manager
        severity: medium


