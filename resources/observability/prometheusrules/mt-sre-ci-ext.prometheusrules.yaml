---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  creationTimestamp: null
  labels:
    prometheus: app-sre
    role: alert-rules
  name: mt-sre-ci-ext-alertrules
spec:
  groups:
    # Alerting for Jenkins ci-ext build failure
    - name: jenkins-jobs.rules
      rules:
        # managed-tenants-cli gh-build-tag
        - alert: JenkinsManagedTenantsCLIBuildTagFailed
          expr: default_jenkins_builds_last_build_result_ordinal{jenkins_job="mt-sre-managed-tenants-cli-gh-build-tag",job="jenkins_ext"} > 0
          labels:
            severity: medium
            service: addons
          annotations:
            runbook: "https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/tree/main/MT-SRE/"
            dashboard: "https://grafana.app-sre.devshift.net"
            message: "{{ $labels.jenkins_job }} Jenkins job latest build on managed-tenants-cli has failed."
            link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"
        # addon-metadata-operator gh-build-master
        - alert: JenkinsAMOBuildMasterFailed
          expr: default_jenkins_builds_last_build_result_ordinal{jenkins_job="mt-sre-addon-metadata-operator-gh-build-master",job="jenkins_ext"} > 0
          labels:
            severity: medium
            service: addons
          annotations:
            runbook: "https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/tree/main/MT-SRE/"
            dashboard: "https://grafana.app-sre.devshift.net"
            message: "{{ $labels.jenkins_job }} Jenkins job latest build on addon-metadata-operator has failed."
            link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"
        # addon-metadata-operator gh-build-tag
        - alert: JenkinsAMOBuildTagFailed
          expr: default_jenkins_builds_last_build_result_ordinal{jenkins_job="mt-sre-addon-metadata-operator-gh-build-tag",job="jenkins_ext"} > 0
          labels:
            severity: medium
            service: addons
          annotations:
            runbook: "https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/tree/main/MT-SRE/"
            dashboard: "https://grafana.app-sre.devshift.net"
            message: "{{ $labels.jenkins_job }} Jenkins job latest build on addon-metadata-operator has failed."
            link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"
        # ocm-addons gh-build-tag
        - alert: JenkinsOCMAddonsBuildTagFailed
          expr: default_jenkins_builds_last_build_result_ordinal{jenkins_job="mt-sre-ocm-addons-gh-build-tag",job="jenkins_ext"} > 0
          labels:
            severity: medium
            service: addons
          annotations:
            runbook: "https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/tree/main/MT-SRE/"
            dashboard: "https://grafana.app-sre.devshift.net"
            message: "{{ $labels.jenkins_job }} Jenkins job latest build on ocm-addons has failed."
            link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"
        # containers gh-build-master
        - alert: JenkinsContainersBuildMainFailed
          expr: default_jenkins_builds_last_build_result_ordinal{jenkins_job="mt-sre-containers-gh-build-master",job="jenkins_ext"} > 0
          labels:
            severity: medium
            service: addons
          annotations:
            runbook: "https://gitlab.cee.redhat.com/service/managed-tenants-sops/-/tree/main/MT-SRE/"
            dashboard: "https://grafana.app-sre.devshift.net"
            message: "{{ $labels.jenkins_job }} Jenkins job latest build on mtsre/containers has failed."
            link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"

