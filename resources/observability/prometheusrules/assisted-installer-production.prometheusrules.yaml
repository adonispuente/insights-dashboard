---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: assisted-installer
spec:
  groups:
    - name: assisted-installer_alerts
      rules:
        - alert: Assisted Installer - Cluster Installation Failed - Production
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/assisted-installer-general-overview/general-overview?orgId=1&var-datasource=app-sre-prod-04-prometheus"
            message: "An attempt to install Openshift {{ $labels.openshiftVersion }} on cluster {{ $labels.clusterId }} has failed"
            runbook: "https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/app-sre/sop/assisted-installer-cluster-installation-fails.md#assisted-installer-cluster-installation-errors"
            redhat_cloud_url: "https://cloud.redhat.com/openshift/assisted-installer/clusters/{{ $labels.clusterId }}"
            kibana_url: "https://kibana-openshift-logging.apps.app-sre-prod-04.i5h0.p1.openshiftapps.com/app/kibana#/discover?_g=(refreshInterval:(pause:!t,value:0),time:(from:now-24h,mode:quick,to:now))&_a=(columns:!(_source),interval:auto,query:'{{ $labels.clusterId }}',sort:!('@timestamp',desc))"
            logs_url: "http://logs-collector.usersys.redhat.com/#/"
          expr: sum(increase(service_assisted_installer_cluster_installation_seconds_count{result="error"}[10m])) by (clusterId, openshiftVersion) > 0
          labels:
            severity: medium
            service: assisted-installer
