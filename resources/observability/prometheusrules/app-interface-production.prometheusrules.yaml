---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: app-interface-alerts
spec:
  groups:
  - name: app-interface-ecr-image-pull-cronjob
    rules:
    - alert: ECRImagePullSecretsKubeJobFailed
      annotations:
        message: Job qontract-reconcile-aws-ecr-pull-secrets failed to complete in {{ $labels.namespace }}.
      expr: |
        sum(kube_job_status_failed{job_name=~"qontract-reconcile-aws-ecr-image-pull-secrets.*"}) by (namespace) 
        - sum(kube_job_status_failed{job_name=~"qontract-reconcile-aws-ecr-image-pull-secrets.*"} offset 5m) by (namespace) 
        > 0
      labels:
        service: app-interface
        severity: high
