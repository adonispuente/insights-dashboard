---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  creationTimestamp: null
  labels:
    prometheus: app-sre
    role: alert-rules
  name: ci-int-alertrules
spec:
  groups:
  # Alerting for Jenkins jobs
  - name: jenkins-jobs.rules
    rules:
    # Hive team jenkins job alerts
    - alert: JenkinsLastBuildFailed
      expr: "default_jenkins_builds_last_build_result_ordinal{jenkins_job=~'openshift-hive-gh-build-master',job='jenkins_int'} > 0"
      labels:
        severity: medium
        service: hive
      annotations:
        runbook: "https://gitlab.cee.redhat.com/service/app-interface/tree/master/docs/app-sre/"
        dashboard: "https://grafana.app-sre.devshift.net/d/hivemetrics/hive-metrics"
        message: "{{ $labels.jenkins_job }} Jenkins job latest build has failed."
        link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"
    # AppSRE jenkins job alerts
    - alert: JenkinsLastBuildFailed
      expr: "default_jenkins_builds_last_build_result_ordinal{jenkins_job='jenkins-slaves-cleanup',job='jenkins_int'} > 0"
      labels:
        severity: medium
        service: ci-int
      annotations:
        runbook: "https://gitlab.cee.redhat.com/dtsd/housekeeping/blob/master/docs/ci/ci-int/ci-int.md"
        dashboard: "https://grafana.app-sre.devshift.net"
        message: "{{ $labels.jenkins_job }} Jenkins job latest build has failed."
        link_url: "http://{{ $labels.instance }}/job/{{ $labels.jenkins_job }}"
