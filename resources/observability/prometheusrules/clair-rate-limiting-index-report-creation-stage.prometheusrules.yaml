---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  labels:
    prometheus: app-sre
    role: alert-rules
  name: clair-index-report-creation-rate-limiting-stage
spec:
  groups:
    - name: clair-index-report-creation-rate-limiting-stage.rules
      rules:
        - alert: ClairIndexReportCreationRateLimiting
          annotations:
            message: "Index Report creation requests are being rate-limited (current value: {{ $value | humanize }})"
            dashboard: "https://grafana.app-sre.devshift.net/d/I1JBFlRnz/clair-v4"
            runbook: "https://gitlab.cee.redhat.com/service/app-interface/tree/master/docs/clair/sops/rate-limiting-index-report-creation-errors.md"
          expr: |
            sum(rate(clair_http_concurrencylimited_total[15m])) > 0
          for: 15m
          labels:
            service: clair
            route: clair-indexer-stage
            namespace: clair-stage
            severity: medium
