apiVersion: v1
data:
  nginx.conf: |-
    worker_processes 1;
    daemon off;
    error_log /dev/stdout;
    events {
        worker_connections {{ worker_connections | default('1024') }};
    }

    http {
      server_names_hash_bucket_size {{Â server_names_hash_bucket_size | default('128') }};
      access_log /dev/stdout;
      server {
        listen 8080;
        server_name {{ prometheus_server_name }};
        location / {
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $http_host;
            proxy_pass http://prometheus-proxy.openshift-customer-monitoring.svc.cluster.local:3000;
            proxy_redirect off;
            proxy_read_timeout {{ proxy_read_timeout | default('900s') }};
            proxy_send_timeout {{ proxy_send_timeout | default('900s') }};
        }
      }
      server {
        listen 8080;
        server_name {{ alertmanager_server_name }};
        location / {
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header Host $http_host;
            proxy_pass http://alertmanager-proxy.openshift-customer-monitoring.svc.cluster.local:3000;
            proxy_redirect off;
            proxy_read_timeout {{ proxy_read_timeout | default('900s') }};
            proxy_send_timeout {{ proxy_send_timeout | default('900s') }};
        }
      }
    }
kind: ConfigMap
metadata:
  name: nginx-proxy
