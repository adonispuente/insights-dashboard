apiVersion: v1
data:
  appsre-overview.json: |-
    {
     "annotations": {
       "list": [
         {
           "builtIn": 1,
           "datasource": {
             "type": "grafana",
             "uid": "-- Grafana --"
           },
           "enable": true,
           "hide": true,
           "iconColor": "rgba(0, 211, 255, 1)",
           "name": "Annotations & Alerts",
           "target": {
             "limit": 100,
             "matchAny": false,
             "tags": [],
             "type": "dashboard"
           },
           "type": "dashboard"
         }
       ]
     },
     "editable": true,
     "fiscalYearStartMonth": 0,
     "graphTooltip": 0,
     "id": 93912,
     "links": [],
     "liveNow": false,
     "panels": [
       {
         "collapsed": false,
         "gridPos": {
           "h": 1,
           "w": 24,
           "x": 0,
           "y": 0
         },
         "id": 6,
         "panels": [],
         "title": "app-interface",
         "type": "row"
       },
       {
         "datasource": {
           "type": "prometheus",
           "uid": "P2C3F6ECC774D80E6"
         },
         "fieldConfig": {
           "defaults": {
             "color": {
               "mode": "palette-classic"
             },
             "custom": {
               "axisCenteredZero": false,
               "axisColorMode": "text",
               "axisLabel": "Merge requests",
               "axisPlacement": "auto",
               "barAlignment": 0,
               "drawStyle": "line",
               "fillOpacity": 0,
               "gradientMode": "none",
               "hideFrom": {
                 "legend": false,
                 "tooltip": false,
                 "viz": false
               },
               "lineInterpolation": "linear",
               "lineWidth": 1,
               "pointSize": 5,
               "scaleDistribution": {
                 "type": "linear"
               },
               "showPoints": "auto",
               "spanNulls": false,
               "stacking": {
                 "group": "A",
                 "mode": "none"
               },
               "thresholdsStyle": {
                 "mode": "off"
               }
             },
             "mappings": [],
             "thresholds": {
               "mode": "absolute",
               "steps": [
                 {
                   "color": "green",
                   "value": null
                 },
                 {
                   "color": "red",
                   "value": 80
                 }
               ]
             }
           },
           "overrides": [
             {
               "__systemRef": "hideSeriesFrom",
               "matcher": {
                 "id": "byNames",
                 "options": {
                   "mode": "exclude",
                   "names": [
                     "sum(increase(qontract_reconcile_merged_merge_requests_total{project_id=\"13582\"}[24h]))"
                   ],
                   "prefix": "All except:",
                   "readOnly": true
                 }
               },
               "properties": [
                 {
                   "id": "custom.hideFrom",
                   "value": {
                     "legend": false,
                     "tooltip": false,
                     "viz": true
                   }
                 }
               ]
             }
           ]
         },
         "gridPos": {
           "h": 8,
           "w": 12,
           "x": 0,
           "y": 1
         },
         "id": 2,
         "options": {
           "legend": {
             "calcs": [],
             "displayMode": "list",
             "placement": "bottom",
             "showLegend": true
           },
           "tooltip": {
             "mode": "single",
             "sort": "none"
           }
         },
         "targets": [
           {
             "datasource": {
               "type": "prometheus",
               "uid": "P2C3F6ECC774D80E6"
             },
             "editorMode": "code",
             "expr": "sum(increase(qontract_reconcile_merged_merge_requests_total{project_id=\"13582\"}[24h]))",
             "interval": "1d",
             "legendFormat": "__auto",
             "range": true,
             "refId": "merge requests"
           }
         ],
         "title": "app-interface merged MRs",
         "type": "timeseries"
       },
       {
         "datasource": {
           "type": "prometheus",
           "uid": "P2C3F6ECC774D80E6"
         },
         "fieldConfig": {
           "defaults": {
             "color": {
               "mode": "palette-classic"
             },
             "custom": {
               "axisCenteredZero": false,
               "axisColorMode": "text",
               "axisLabel": "Percentage",
               "axisPlacement": "auto",
               "barAlignment": 0,
               "drawStyle": "line",
               "fillOpacity": 0,
               "gradientMode": "none",
               "hideFrom": {
                 "legend": false,
                 "tooltip": false,
                 "viz": false
               },
               "lineInterpolation": "linear",
               "lineWidth": 1,
               "pointSize": 5,
               "scaleDistribution": {
                 "type": "linear"
               },
               "showPoints": "auto",
               "spanNulls": false,
               "stacking": {
                 "group": "A",
                 "mode": "none"
               },
               "thresholdsStyle": {
                 "mode": "off"
               }
             },
             "mappings": [],
             "thresholds": {
               "mode": "absolute",
               "steps": [
                 {
                   "color": "green",
                   "value": null
                 },
                 {
                   "color": "red",
                   "value": 80
                 }
               ]
             }
           },
           "overrides": []
         },
         "gridPos": {
           "h": 8,
           "w": 12,
           "x": 12,
           "y": 1
         },
         "id": 4,
         "options": {
           "legend": {
             "calcs": [],
             "displayMode": "list",
             "placement": "bottom",
             "showLegend": true
           },
           "tooltip": {
             "mode": "single",
             "sort": "none"
           }
         },
         "targets": [
           {
             "datasource": {
               "type": "prometheus",
               "uid": "P2C3F6ECC774D80E6"
             },
             "editorMode": "code",
             "expr": "sum(increase(qontract_reconcile_time_to_merge_merge_request_minutes_bucket{project_id=\"13582\", le=\"60.0\"}[24h])) / sum(increase(qontract_reconcile_time_to_merge_merge_request_minutes_bucket{project_id=\"13582\", le=\"+Inf\"}[24h])) * 100",
             "interval": "24h",
             "legendFormat": "All MRs",
             "range": true,
             "refId": "A"
           }
         ],
         "title": "Merge requests merged in <1 hour",
         "type": "timeseries"
       },
       {
         "collapsed": true,
         "gridPos": {
           "h": 1,
           "w": 24,
           "x": 0,
           "y": 9
         },
         "id": 8,
         "panels": [],
         "title": "Tenant SLOs",
         "type": "row"
       },
       {
         "datasource": {
           "type": "postgres",
           "uid": "PDF0D305A66BF6B52"
         },
         "fieldConfig": {
           "defaults": {
             "color": {
               "mode": "palette-classic"
             },
             "custom": {
               "hideFrom": {
                 "legend": false,
                 "tooltip": false,
                 "viz": false
               }
             },
             "mappings": [],
             "unit": "none"
           },
           "overrides": [
             {
               "matcher": {
                 "id": "byName",
                 "options": "missed"
               },
               "properties": [
                 {
                   "id": "color",
                   "value": {
                     "fixedColor": "dark-red",
                     "mode": "fixed"
                   }
                 }
               ]
             },
             {
               "matcher": {
                 "id": "byName",
                 "options": "achieved"
               },
               "properties": [
                 {
                   "id": "color",
                   "value": {
                     "fixedColor": "green",
                     "mode": "fixed"
                   }
                 }
               ]
             }
           ]
         },
         "gridPos": {
           "h": 8,
           "w": 12,
           "x": 0,
           "y": 10
         },
         "id": 10,
         "options": {
           "displayLabels": [
             "percent",
             "name"
           ],
           "legend": {
             "displayMode": "list",
             "placement": "bottom",
             "showLegend": true
           },
           "pieType": "pie",
           "reduceOptions": {
             "calcs": [
               "lastNotNull"
             ],
             "fields": "",
             "values": false
           },
           "tooltip": {
             "mode": "single",
             "sort": "none"
           }
         },
         "pluginVersion": "9.4.3",
         "targets": [
           {
             "datasource": {
               "type": "postgres",
               "uid": "PDF0D305A66BF6B52"
             },
             "editorMode": "code",
             "format": "table",
             "rawQuery": true,
             "rawSql": "SELECT sum(case when serviceslo.target > serviceslo.value then 1 else 0 end) as missed, sum(case when serviceslo.target <= serviceslo.value then 1 else 0 end) as achieved\nFROM cluster, namespace, service, serviceslo, slitype, slodoc\nWHERE serviceslo.slitype_id = slitype.id\n  AND serviceslo.slodoc_id = slodoc.id\n  AND serviceslo.service_id = service.id\n  AND serviceslo.namespace_id = namespace.id\n  AND namespace.cluster_id = cluster.id\n  AND serviceslo.token_id = (\n        SELECT distinct(token.id)\n        FROM token, latesttokens, serviceslo\n        WHERE token.id = latesttokens.token_id\n        AND token.data_type = 'SLODataType'\n        AND serviceslo.token_id = token.id\n  );",
             "refId": "A",
             "sql": {
               "columns": [
                 {
                   "parameters": [],
                   "type": "function"
                 }
               ],
               "groupBy": [
                 {
                   "property": {
                     "type": "string"
                   },
                   "type": "groupBy"
                 }
               ],
               "limit": 50
             }
           }
         ],
         "title": "Tenant SLO achievement for previous month",
         "type": "piechart"
       }
     ],
     "refresh": "",
     "revision": 1,
     "schemaVersion": 38,
     "style": "dark",
     "tags": [],
     "templating": {
       "list": []
     },
     "time": {
       "from": "now-7d",
       "to": "now"
     },
     "timepicker": {},
     "timezone": "",
     "title": "Draft-AppSRE Overview",
     "uid": "xNTPSl-Vk",
     "version": 9,
     "weekStart": ""
    }
kind: ConfigMap
metadata:
  name: grafana-dashboard-appsre-overview
  labels:
    grafana_dashboard: "true"
  annotations:
    grafana-folder: /grafana-dashboard-definitions/AppSRE
