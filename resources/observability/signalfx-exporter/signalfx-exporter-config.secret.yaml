apiVersion: v1
kind: Secret
metadata:
  name: signalfx-exporter-config
  annotations:
    qontract.recycle: "true"
data:
  config.yml:
    {{% b64encode %}}
    sfx:
      realm: {{{ vault('app-sre/creds/signalfx', 'realm') }}}
      token: {{{ vault('app-sre/creds/signalfx', 'token') }}}
    flows:
    - name: catchpoint-data
      query: |
        data('catchpoint.counterrequests').publish(prometheus_name="catchpoint_checks_total")
        data('catchpoint.counterfailedrequests').publish(prometheus_name="catchpoint_check_failures_total")
      prometheusMetricTemplates:
      - name: "{{ .SignalFxLabels.prometheus_name }}"
        type: counter
        labels:
          catchpoint_probe: '{{ .SignalFxLabels.cp_testname }}'
    {{% endb64encode %}}
