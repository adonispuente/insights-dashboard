apiVersion: v1
kind: Secret
metadata:
  name: prometheus-ams-subscription-labels-scrape-config
data:
  prometheus-ams-subscription-labels.yaml:
    {{% b64encode %}}
    - job_name: 'ams-subscription-labels'
      metrics_path: /labels
      honor_labels: true
      scrape_interval: 5m
      kubernetes_sd_configs:
        - role: service
          namespaces:
            names: [uhc-production]
          selectors:
            - role: service
              label: "app=uhc-acct-mngr,port=metrics"
      relabel_configs:
        - source_labels:
            - __meta_kubernetes_service_name
          target_label: job
          replacement: ${1}
        - source_labels:
            - __meta_kubernetes_namespace
          target_label: namespace
        - source_labels:
            - __meta_kubernetes_service_name
          target_label: service
    {{% endb64encode %}}
