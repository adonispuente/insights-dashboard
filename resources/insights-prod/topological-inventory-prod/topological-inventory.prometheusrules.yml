---
$schema: /openshift/prometheus-rule-1.yml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: insights-topological-inventory-prod
  labels:
    prometheus: app-sre
    role: alert-rules
spec:
  groups:
    - name: topology-services-up-prod
      rules:
        - alert: TopologyApiSvcAbsent
          expr: absent(up{job="topological-inventory-api",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-30m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-api"
            message: "[Prod] Topological Inventory: API: All pods have been down for two minutes"
        - alert: TopologyIngressApiSvcAbsent
          expr: absent(up{job="topological-inventory-ingress-api",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-30m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ingress-api"
            message: "[Prod] Topological Inventory: Ingress API: All pods have been down for two minutes"
        - alert: TopologyPersisterSvcAbsent
          expr: absent(up{job="topological-inventory-persister",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-persister"
            message: "[Prod] Topological Inventory: Persister: All pods have been down for two minutes"
        - alert: TopologyOrchestratorSvcAbsent
          expr: absent(up{job="topological-inventory-orchestrator",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-orchestrator"
            message: "[Prod] Topological Inventory: Orchestrator: All pods have been down for two minutes"
        - alert: TopologySourcesSyncSvcAbsent
          expr: absent(up{job="topological-inventory-sources-sync",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-sources-sync"
            message: "[Prod] Topological Inventory: Sources Sync: All pods have been down for two minutes"
        - alert: TopologyAnsibleTargetedRefreshSvcAbsent
          expr: absent(up{job="topological-ansible-tower-targeted-collector",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-30m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-api"
            message: "[Prod] Topological Inventory: Ansible Tower Targeted Collector: All pods have been down for two minutes"
        - alert: TopologyHostInventorySyncSvcAbsent
          expr: absent(up{job="topological-inventory-host-inventory-sync",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-host-inventory-sync"
            message: "[Prod] Topological Inventory: Host Inventory Sync: All pods have been down for two minutes"
        - alert: TopologyAmazonOperationsSvcAbsent
          expr: absent(up{job="topological-inventory-amazon-operations",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-30m&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All&refresh=30s"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-amazon-operations"
            message: "[Prod] Topological Inventory: Amazon Operations: All pods have been down for two minutes"
        - alert: TopologyAnsibleTowerOperationsSvcAbsent
          expr: absent(up{job="topological-inventory-ansible-tower-operations",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-30m&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All&refresh=30s"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ansible-tower-operations"
            message: "[Prod] Topological Inventory: Ansible Tower Operations: All pods have been down for two minutes"
        - alert: TopologyAnsibleTowerTargetedSvcAbsent
          expr: absent(up{job="topological-ansible-tower-targeted-collector",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-30m&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All&refresh=30s"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ansible-tower-operations"
            message: "[Prod] Topological Inventory: Ansible Tower Operations: All pods have been down for two minutes"
        - alert: TopologyAzureOperationsSvcAbsent
          expr: absent(up{job="topological-inventory-azure-operations",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-30m&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All&refresh=30s"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-azure-operations"
            message: "[Prod] Topological Inventory: Azure Operations: All pods have been down for two minutes"
        - alert: TopologyOpenshiftOperationsSvcAbsent
          expr: absent(up{job="topological-inventory-openshift-operations",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-30m&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All&refresh=30s"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-openshift-operations"
            message: "[Prod] Topological Inventory: OpenShift Operations: All pods have been down for two minutes"
        - alert: TopologySatelliteOperationsSvcAbsent
          expr: absent(up{job="topological-inventory-satellite-operations",namespace="topological-inventory-prod"}==1)
          for: 2m
          labels:
            severity: info # high
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-30m&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All&refresh=30s"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-satellite-operations"
            message: "[Prod] Topological Inventory: Satellite Operations: All pods have been down for two minutes"
    - name: topology-kafka-lag-prod
      rules:
        - alert: TopologyKafkaLagPersister
          expr: sum(kafka_consumergroup_group_lag{topic='platform.topological-inventory.persister', namespace='platform-mq-prod'}) by (group) > 500
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources # Slack channel for app_team defined in resources/observability/alertmanager/alertmanager-instance.secret.yaml
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-persister"
            message: "[Prod] Topo Persister: Kafka Lag is bigger than 500 for the last 10 minutes"
        - alert: TopologyKafkaLagPersisterOutputStream
          expr: sum(kafka_consumergroup_group_lag{topic='platform.topological-inventory.persister-output-stream', namespace='platform-mq-prod'}) by (group) > 200
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-host-inventory-sync"
            message: "[Prod] Topo Host Inventory Sync: Kafka Lag is bigger than 200 for the last 10 minutes"
        - alert: TopologyKafkaLagCollectorAnsibleTower
          expr: sum(kafka_consumergroup_group_lag{topic='platform.topological-inventory.collector-ansible-tower', namespace='platform-mq-prod'}) by (group) > 200
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-ansible-tower-targeted-collector"
            message: "[Prod] Topo Targeted Collector (Tower): Kafka Lag is bigger than 200 for the last 10 minutes"
        - alert: TopologyKafkaLagTaskOutputStream
          expr: sum(kafka_consumergroup_group_lag{topic='platform.topological-inventory.task-output-stream', namespace='platform-mq-prod'}) by (group) > 200
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-api"
            message: "[Prod] Catalog Task Minion: Kafka Lag (task-output-stream) is bigger than 200 for the last 10 minutes"
        - alert: TopologyKafkaLagOperations
          expr: sum(kafka_consumergroup_group_lag{topic=~'platform.topological-inventory.operations-.*', namespace='platform-mq-prod'}) by (group, topic) > 200
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-amazon-operations"
            message: "[Prod] Topological Operations: Kafka Lag is bigger than 200 for the last 10 minutes"
    - name: topology-restarts-prod
      rules:
        - alert: TopologyApiRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-api",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-1h&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-api"
            message: "[Prod] Topo API: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyIngressApiRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-ingress-api",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-1h&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ingress-api"
            message: "[Prod] Topo Ingress API: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyOrchestratorRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-orchestrator",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-orchestrator"
            message: "[Prod] Topo Orchestrator: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyPersisterRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-persister",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-persister"
            message: "[Prod] Topo Persister: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologySourcesSyncRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-sources-sync",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-sources-sync"
            message: "[Prod] Topo Sources Sync: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyHostInvSyncRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-host-inventory-sync",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-host-inventory-sync"
            message: "[Prod] Topo Host Inventory Sync: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyAmazonOperationsRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-amazon-operations",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-amazon-operations"
            message: "[Prod] Topo Amazon Operations: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyAnsibleTowerOperationsRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-ansible-tower-operations",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ansible-tower-operations"
            message: "[Prod] Topo Ansible Tower Operations: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyAzureOperationsRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-azure-operations",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-azure-operations"
            message: "[Prod] Topo Azure Operations: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyOpenShiftOperationsRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-openshift-operations",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-openshift-operations"
            message: "[Prod] Topo OpenShift Operations: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologySatelliteOperationsRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-inventory-satellite-operations",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-satellite-operations"
            message: "[Prod] Topo Satellite Operations: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyTowerTargetedCollectorRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container="topological-ansible-tower-targeted-collector",namespace="topological-inventory-prod"}[1h])) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-ansible-tower-targeted-collector"
            message: "[Prod] Topo Ansible Tower Targeted Collector: Restarted at least 5x/1h for the last 30 minutes"
        - alert: TopologyCollectorRestarts
          expr: sum(increase(kube_pod_container_status_restarts_total{container=~"collector-.*",namespace="topological-inventory-prod"}[1h])) by (container) > 5
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deploymentconfigs"
            message: "[Prod] Topological Collectors: Some collector restarted at least 5x/1h for the last 30 minutes"
    - name: topology-api-prod
      rules:
        - alert: TopologyApi5xxErrors
          expr: sum(rate(topological_inventory_api_http_requests_total{status=~"^[5].*",namespace="topological-inventory-prod"}[5m])) * 100 > 50
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-15m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-api"
            message: "[Prod] Topology API has been throwing 5xx errors more than 50% of the time for the last 10 minutes"
        - alert: TopologyApiRequestDuration
          expr: avg(rate(topological_inventory_api_http_duration_seconds_sum{controller!="status",namespace="topological-inventory-prod"}[5m]) / rate(topological_inventory_api_http_duration_seconds_count{controller!="status",namespace="topological-inventory-prod"}[5m]) > 0) > 500
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-15m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-api"
            message: "[Prod] Topology API's Average Request Duration > 500 ms for the last 10 minutes"
    - name: topology-ingress-prod
      rules:
        - alert: TopologyIngressApi5xxErrors
          expr: sum(rate(topological_inventory_ingress_api_http_requests_total{status=~"^[5].*",namespace="topological-inventory-prod"}[5m])) * 100 > 50
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-15m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ingress-api"
            message: "[Prod] Topology Ingress API has been throwing 5xx errors more than 50% of the time for the last 10 minutes"
        - alert: TopologyIngressApiRequestDuration
          expr: avg(rate(topological_inventory_ingress_api_http_duration_seconds_sum{controller!="status",namespace="topological-inventory-prod"}[5m]) / rate(topological_inventory_ingress_api_http_duration_seconds_count{controller!="status",namespace="topological-inventory-prod"}[5m]) > 0) > 500
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/qRvAZLAMk/topological-inventory-apis?orgId=1&from=now-15m&to=now&refresh=10s&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ingress-api"
            message: "[Prod] Topology Ingress API's Average Request Duration > 500 ms for the last 10 minutes"
    - name: topology-persister-prod
      rules:
        - alert: TopologyPersisterMessageDuration
          expr: avg(rate(topological_inventory_persister_message_process_seconds_sum{namespace="topological-inventory-prod"}[5m]) / rate(topological_inventory_persister_message_process_seconds_count{namespace="topological-inventory-prod"}[5m]) > 0) * 100 > 500
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-persister"
            message: "[Prod] Topology Persister's Average Payload Processing Duration > 500 ms for the last 10 minutes"
        - alert: TopologyPersisterErrors
          expr: sum(increase(topological_inventory_persister_messages_total{result='error',namespace="topological-inventory-prod"}[10m])) > 50
          for: 10m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-persister"
            message: "[Prod] Topology Persister: Average number of errors was > 50 per 10 mins for the last 10 minutes"
    - name: topology-orchestrator-prod
      rules:
        - alert: TopologyOrchestratorErrors
          expr: sum(increase(topological_inventory_orchestrator_errors_total{namespace="topological-inventory-prod"}[10m])) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/MnHGlz5Mk/topological-inventory-core?orgId=1&refresh=30s&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-orchestrator"
            message: "[Prod] Topology Orchestrator: Average number of errors was > 10 per 10 mins for the last 30 minutes"
    - name: topology-operations-prod
      rules:
        - alert: TopologyAmazonOperationsErrors
          expr: round(sum(increase(topological_inventory_amazon_operations_errors_total{namespace="topological-inventory-prod"}[10m])))+round(sum(increase(topological_inventory_amazon_operations_status_counter{status="error",namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-amazon-operations"
            message: "[Prod] Topology Amazon Operations: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyAzureOperationsErrors
          expr: round(sum(increase(topological_inventory_azure_operations_errors_total{namespace="topological-inventory-prod"}[10m])))+round(sum(increase(topological_inventory_azure_operations_status_counter{status="error",namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-azure-operations"
            message: "[Prod] Topology Azure Operations: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyAnsibleTowerOperationsErrors
          expr: round(sum(increase(topological_inventory_ansible_tower_operations_errors_total{namespace="topological-inventory-prod"}[10m])))+round(sum(increase(topological_inventory_ansible_tower_operations_status_counter{status="error",namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-ansible-tower-operations"
            message: "[Prod] Topology Ansible Tower Operations: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyOpenShiftOperationsErrors
          expr: round(sum(increase(topological_inventory_openshift_operations_errors_total{namespace="topological-inventory-prod"}[10m])))+round(sum(increase(topological_inventory_openshift_operations_status_counter{status="error",namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-openshift-operations"
            message: "[Prod] Topology OpenShift Operations: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologySatelliteOperationsErrors
          expr: round(sum(increase(topological_inventory_satellite_operations_errors_total{namespace="topological-inventory-prod"}[10m])))+round(sum(increase(topological_inventory_satellite_operations_status_counter{status="error",namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-satellite-operations"
            message: "[Prod] Topology Satellite Operations: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyAmazonCollectorErrors
          expr: round(sum(increase(topological_inventory_amazon_collector_errors_total{namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deploymentconfigs"
            message: "[Prod] Topology Amazon Collectors: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyAzureCollectorErrors
          expr: round(sum(increase(topological_inventory_azure_collector_errors_total{namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deploymentconfigs"
            message: "[Prod] Topology Azure Collectors: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyAnsibleTowerCollectorErrors
          expr: round(sum(increase(topological_inventory_ansible_tower_collector_errors_total{namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deploymentconfigs"
            message: "[Prod] Topology AnsibleTower Collectors: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyAnsibleTowerTargetedCollectorErrors
          expr: round(sum(increase(topological_inventory_ansible_tower_targeted_refresh_errors_total{namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-ansible-tower-targeted-collector"
            message: "[Prod] Topology Ansible Tower Targeted Collectors: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologySourcesSyncErrors
          expr: round(sum(increase(topological_inventory_sources_sync_errors_total{namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-sources-sync"
            message: "[Prod] Topology Sources Sync: Average number of errors was > 10 per 10 mins for the last 30 minutes"
        - alert: TopologyHostInventorySyncErrors
          expr: round(sum(increase(topological_inventory_host_inventory_sync_errors_total{namespace="topological-inventory-prod"}[10m]))) > 10
          for: 30m
          labels:
            severity: info
            service: insights
            env: prod
            app_team: topo-sources
          annotations:
            dashboard: "https://grafana.app-sre.devshift.net/d/aanIgg0Mz/topological-inventory-collectors-and-operations?orgId=1&from=now-1h&to=now&var-Datasource=crcp01ue1-prometheus&var-controller=All&var-action=All"
            link_url: "https://console-openshift-console.apps.crcp01ue1.o9m8.p1.openshiftapps.com/k8s/ns/topological-inventory-prod/deployments/topological-inventory-host-inventory-sync"
            message: "[Prod] Topology Host Inventory Sync: Average number of errors was > 10 per 10 mins for the last 30 minutes"
