apiVersion: v1
kind: Secret
metadata:
  name: {{{ name }}}
  labels:
    version: {{{ version_label }}}
  annotations:
    qontract.recycle: "true"
    qontract.ignore_reconcile_time: "true"
data:
  config.yaml: >-
    {{% b64encode %}}

    {{%- if readonly %}}
    REGISTRY_STATE: readonly
    INSTANCE_SERVICE_KEY_KID_LOCATION: 'conf/stack/quay-readonly.kid'
    INSTANCE_SERVICE_KEY_LOCATION: 'conf/stack/quay-readonly.pem'
    {{%- endif %}}

    {{%- if account_recovery_mode  %}}

    ACCOUNT_RECOVERY_MODE: true
    FEATURE_PROXY_PROTOCOL: false
    FEATURE_APP_REGISTRY: false
    FEATURE_BILLING: false
    FEATURE_BITBUCKET_BUILD: false
    FEATURE_DIRECT_LOGIN: true
    FEATURE_GITHUB_BUILD: false
    FEATURE_RESTRICTED_V1_PUSH: false
    FEATURE_GITLAB_BUILD: false
    SERVER_HOSTNAME: recovery.stage.quay.io

    {{%- else %}}

    FEATURE_PROXY_PROTOCOL: true
    FEATURE_APP_REGISTRY: false
    FEATURE_BILLING: true
    FEATURE_UI_V2: true
    BILLING_TYPE: Stripe
    STRIPE_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'STRIPE_SECRET_KEY', 4) }}}
    STRIPE_PUBLISHABLE_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'STRIPE_PUBLISHABLE_KEY', 4) }}}
    FEATURE_BITBUCKET_BUILD: true
    FEATURE_DIRECT_LOGIN: false
    FEATURE_GITHUB_BUILD: true
    FEATURE_RESTRICTED_V1_PUSH: true
    FEATURE_GITLAB_BUILD: true
    SERVER_HOSTNAME: stage.quay.io

    {{%- endif %}}
    APP_REGISTRY_PACKAGE_LIST_CACHE_WHITELIST:
    - vdinh
    APP_REGISTRY_SHOW_PACKAGE_CACHE_WHITELIST:
    - vdinh
    AUTHENTICATION_TYPE: Database
    ACTION_LOG_ARCHIVE_LOCATION: s3_us_east_1
    ACTION_LOG_ARCHIVE_PATH: actionlogarchive/
    ACTION_LOG_MAX_PAGE: 5
    ACTION_LOG_ROTATION_FREQUENCY: 60
    AVATAR_KIND: gravatar
    BACKFILL_TAGS: false
    BILLED_NAMESPACE_MAXIMUM_BUILD_COUNT: 3
    BITBUCKET_TRIGGER_CONFIG:
      CONSUMER_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/bitbucket-trigger-config', 'consumer_key', 2) }}}
      CONSUMER_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/bitbucket-trigger-config', 'consumer_secret', 2) }}}
    BRANDING:
      footer_img: /static/img/RedHat.svg
      footer_url: 'https://redhat.com'
      logo: 'https://stage.quay.io/static/img/RH_QuayIO.svg'
    BUILDLOGS_REDIS:
      host: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-builders-elasticache', 'db.endpoint') }}}
      port: 6379
      password: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-builders-elasticache', 'db.auth_token') }}}
      ssl: true
    BUILDMAN_HOSTNAME: "buildman.stage.quay.io:443"
    BUILD_MANAGER:
    - ephemeral
    - ALLOWED_WORKER_COUNT: 60
      ORCHESTRATOR_PREFIX: buildman/staging/
      ORCHESTRATOR:
        REDIS_HOST: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-builders-elasticache', 'db.endpoint') }}}
        REDIS_PASSWORD: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-builders-elasticache', 'db.auth_token') }}}
        REDIS_SSL: true
        REDIS_SKIP_KEYSPACE_EVENT_SETUP: true

      EXECUTORS:
      - EXECUTOR: ec2
        EC2_REGION: us-east-1
        COREOS_AMI: ami-04a183f7a13130882
        AWS_ACCESS_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-builder-config', 'ec2_aws_access_key', 1) }}}
        AWS_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-builder-config', 'ec2_aws_secret_key', 1) }}}
        EC2_INSTANCE_TYPE: t2.large
        EC2_VPC_SUBNET_ID: subnet-a39f0ed4
        EC2_SECURITY_GROUP_IDS:
        - sg-e6b81982
        EC2_KEY_NAME: "Kenny's Mac"
        WORKER_IMAGE: quay.io/projectquay/quay-builder
        WORKER_TAG: latest
        VOLUME_SIZE: 52G # Size in truncate notation for the BTRFS volume
        BLOCK_DEVICE_SIZE: 58
        SETUP_TIME: 180
        MAX_LIFETIME_S: 3600
      # - EXECUTOR: kubernetes
      #   NAME: openshift
      #   # MINIMUM_RETRY_THRESHOLD: 1
      #   CONTAINER_RUNTIME: docker
      #   BUILDER_VM_CONTAINER_IMAGE: quay.io/projectquay/quay-builder-qemu:stage
      #   K8S_API_SERVER: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-builder-config', 'k8s_api_server', 1) }}}
      #   QUAY_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-builder-config', 'quay_username', 1) }}}
      #   QUAY_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-builder-config', 'quay_password', 1) }}}
      #   WORKER_IMAGE: quay.io/projectquay/quay-builder
      #   WORKER_TAG: latest-ubi8
      #   VOLUME_SIZE: 32G
      #   BLOCK_DEVICE_SIZE: 58 # Not sure this makes sense here.
      #   SETUP_TIME: 45
      #   KUBERNETES_DISTRIBUTION: openshift
      #   CONTAINER_MEMORY_LIMITS: 5120Mi
      #   CONTAINER_CPU_LIMITS: 1000m
      #   CONTAINER_MEMORY_REQUEST: 3968Mi
      #   CONTAINER_CPU_REQUEST: 500m
      #   NODE_SELECTOR_LABEL_KEY: beta.kubernetes.io/instance-type
      #   NODE_SELECTOR_LABEL_VALUE: m5.metal
      #   SERVICE_ACCOUNT_NAME: quay-builder-sa
      #   SERVICE_ACCOUNT_TOKEN: {{{ vault('app-sre/integrations-output/openshift-serviceaccount-tokens/shared-resources/quayio-builder-builder-stage-quay-builder-sa', 'token') }}}
      #   BUILDER_NAMESPACE: builder-stage
      #   MAX_LIFETIME_S: 3600



    # CLOUDWATCH_AWS_ACCESS_KEY:
    # CLOUDWATCH_AWS_SECRET_KEY:
    # CLOUDWATCH_NAMESPACE: Quay/Stage
    CONTACT_INFO:
      - 'https://access.redhat.com/articles/quayio-help'

    DATABASE_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-additional-config', 'DATABASE_SECRET_KEY', 1) }}}

    {{%- if enable_redis_modelcache %}}
    DATA_MODEL_CACHE_CONFIG:
      engine: rediscluster
      redis_config:
        startup_nodes:
          - host: '{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-modelcache-elasticache', 'db.endpoint') }}}'
            port: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-modelcache-elasticache', 'db.port') }}}
        password: '{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-modelcache-elasticache', 'db.auth_token') }}}'
        read_from_replicas: true
        skip_full_coverage_check: true
        ssl: true

    {{%- endif %}}

    DB_CONNECTION_ARGS:
      autorollback: true
      threadlocals: true
      max_connections: 80
      timeout: 1

    {{%- if read_from_rds_replica %}}

    DB_URI: 'mysql+pymysql://{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.user') }}}:{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.password') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-replica-2-rds', 'db.host') }}}/{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.name') }}}'


    {{%- else %}}

    DB_URI: 'mysql+pymysql://{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.user') }}}:{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.password') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.host') }}}/{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.name') }}}'

    DB_READ_REPLICAS:
    - DB_URI: 'mysql+pymysql://{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.user') }}}:{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.password') }}}@{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.host') }}}/{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-57-py3-rds', 'db.name') }}}'
      DB_CONNECTION_ARGS:
        autorollback: true
        threadlocals: true
        max_connections: 80
        _driver_autocommit: true
        ssl:
          ca: conf/stack/rds-ssl-ca-cert.pem

    {{%- endif %}}

    DEFAULT_MAIL_SENDER: support@quay.io
    DEFAULT_NAMESPACE_MAXIMUM_BUILD_COUNT: 1
    DIFFS_QUEUE_NAME: imagediffstaging
    DISABLED_FOR_PULL_LOGS:
      - coreos
      - openshift-release-dev
      - openshift
      - openshiftio
      - redhat
    DEFAULT_TAG_EXPIRATION: 2w

    DISTRIBUTED_STORAGE_CONFIG:
      s3_us_east_1:
      {{%- if enable_cloudflare %}}

        - CloudFlareStorage
        - cloudflare_domain: cdn03.stage.quay.io
          cloudflare_privatekey_filename: cloudflare-private-key.pem
          s3_access_key: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-s3', 'aws_access_key_id') }}}
          s3_bucket: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-s3', 'bucket') }}}
          s3_secret_key: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-s3', 'aws_secret_access_key') }}}
          s3_region: {{{ region }}}
          storage_path: ''

      {{%- else %}}

        - CloudFrontedS3Storage
        - cloudfront_distribution_domain: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-additional-config', 'cloudfront_distribution_domain', 1) }}}
          cloudfront_key_id: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-additional-config', 'cloudfront_key_id', 1) }}}
          cloudfront_privatekey_filename: default-cloudfront-signing-key.pem
          s3_region: {{{ region }}}
          s3_access_key: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-s3', 'aws_access_key_id') }}}
          s3_bucket: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-s3', 'bucket') }}}
          s3_secret_key: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-s3', 'aws_secret_access_key') }}}
          storage_path: ''
          cloudfront_distribution_org_overrides:
              redhat-dev: cdn01.stage.quay.redhat.io
              redhat-pending: cdn01.stage.quay.redhat.io
              redhat-prod: cdn01.stage.quay.redhat.io
              twaugh: cdn01.stage.quay.redhat.io

      {{%- endif %}}

    DISTRIBUTED_STORAGE_PREFERENCE:
      - s3_us_east_1
    # EXCEPTION_LOG_TYPE: Sentry
    FEATURE_ACI_CONVERSION: true
    FEATURE_ACTION_LOG_ROTATION: true
    FEATURE_AGGREGATED_LOG_COUNT_RETRIEVAL: true
    FEATURE_APP_SPECIFIC_TOKENS: false
    FEATURE_DISABLE_PULL_LOGS_FOR_FREE_NAMESPACES: false
    FEATURE_GARBAGE_COLLECTION: true
    FEATURE_GITHUB_LOGIN: false
    FEATURE_GOOGLE_LOGIN: false
    FEATURE_LIBRARY_SUPPORT: false
    FEATURE_LOG_EXPORT: true
    FEATURE_MANIFEST_SIZE_BACKFILL: false
    FEATURE_NAMESPACE_GARBAGE_COLLECTION: true
    FEATURE_RATE_LIMITS: false
    FEATURE_RECAPTCHA: false
    FEATURE_REPOSITORY_GARBAGE_COLLECTION: true
    FEATURE_SECURITY_NOTIFICATIONS: false
    FEATURE_SECURITY_SCANNER: {{{ enable_clair }}}
    SECURITY_SCANNER_V4_BATCH_SIZE: 1000
    SECURITY_SCANNER_V4_REINDEX_THRESHOLD: 86400
    SECURITY_SCANNER_V4_ENDPOINT: https://clair.stage.quay.io
    SECURITY_SCANNER_V4_PSK: {{{ vault('app-interface/clair/stage/config', 'psk', 3) }}}
    SECURITY_SCANNER_V4_NAMESPACE_WHITELIST:
      - "clairv4testing"

    FEATURE_SIGNING: false
    FEATURE_SUPER_USERS: false
    FEATURE_SUPPORT_CHAT: true
    FEATURE_USER_LAST_ACCESSED: false
    FEATURE_USER_METADATA: false
    FEATURE_BUILD_SUPPORT: {{{ enable_builders }}}
    FEATURE_EXTENDED_REPOSITORY_NAMES: true

    GARBAGE_COLLECTION_FREQUENCY: 30
    GITHUB_LOGIN_CONFIG:
      API_ENDPOINT: 'https://api.github.com/'
      CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GITHUB_LOGIN_CONFIG__CLIENT_ID', 2) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GITHUB_LOGIN_CONFIG__CLIENT_SECRET', 2) }}}
      GITHUB_ENDPOINT: 'https://github.com/'
    GITHUB_TRIGGER_CONFIG:
      API_ENDPOINT: 'https://api.github.com/'
      CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GITHUB_TRIGGER_CONFIG__CLIENT_ID', 3) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GITHUB_TRIGGER_CONFIG__CLIENT_SECRET', 3) }}}
      GITHUB_ENDPOINT: 'https://github.com/'
    GITLAB_TRIGGER_CONFIG:
      CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GITLAB_TRIGGER_CONFIG__CLIENT_ID', 2) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GITLAB_TRIGGER_CONFIG__CLIENT_SECRET', 2) }}}
      GITLAB_ENDPOINT: 'https://gitlab.com'
    GOOGLE_LOGIN_CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_ID', 2) }}}
    GOOGLE_LOGIN_CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_SECRET', 2) }}}
    GOOGLE_LOGIN_CONFIG:
      CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_ID', 2) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'GOOGLE_LOGIN_CONFIG__CLIENT_SECRET', 2) }}}
    GPG2_PRIVATE_KEY_FILENAME: signing-private.gpg
    GPG2_PRIVATE_KEY_NAME: 4632047EEEB32221
    GPG2_PUBLIC_KEY_FILENAME: signing-public.gpg

    RHSSO_LOGIN_CONFIG:
      CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'RHSSO_LOGIN_CONFIG__CLIENT_ID', 2) }}}
      CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-login-config', 'RHSSO_LOGIN_CONFIG__CLIENT_SECRET', 2) }}}
      OIDC_SERVER: https://sso.stage.redhat.com/auth/realms/redhat-external/
      SERVICE_NAME: Red Hat
      SERVICE_ICON: /static/img/RedHat.svg
      VERIFIED_EMAIL_CLAIM_NAME: email
      PREFERRED_USERNAME_CLAIM_NAME: preferred_username
      LOGIN_SCOPES: ['openid']

    FEATURE_EXPORT_COMPLIANCE: true
    EXPORT_COMPLIANCE_ENDPOINT: {{{ vault('app-interface/quayio-stage/quayio-stage/export-compliance-config', 'endpoint', 3) }}}

    LOG_ARCHIVE_LOCATION: s3_us_east_1
    LOG_ARCHIVE_PATH: logarchive/

    LOGS_MODEL: 'transition_reads_both_writes_es'
    LOGS_MODEL_CONFIG: {
      producer: "{{{ log_producer }}}",
      elasticsearch_config: {
        'host': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/opensearch-dashboards/quayio-stage-elasticsearch', 'endpoint')  | replace("https://", "") }}}",
        'port': 443,
        'access_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/opensearch-dashboards/quayio-stage-elasticsearch', 'master_user_name') }}}",
        'secret_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/opensearch-dashboards/quayio-stage-elasticsearch', 'master_user_password') }}}",
        'use_ssl': true,
        'index_prefix': 'logentry_',
        'index_settings': {
          'number_of_shards': 3,
          'number_of_replicas': 1,
          'refresh_interval': '10s'
        },
      },
      kinesis_stream_config: {
        'stream_name': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-logentry-stream', 'stream_name') }}}",
        'aws_region': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-logentry-stream', 'aws_region') }}}",
        'aws_access_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-logentry-stream', 'aws_access_key_id') }}}",
        'aws_secret_key': "{{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-logentry-stream', 'aws_secret_access_key') }}}"
      }
    }


    MAIL_DEFAULT_SENDER: support@quay.io
    MAIL_FAIL_SILENTLY: false
    MAIL_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-smtp-config', 'MAIL_PASSWORD', 2) }}}
    MAIL_PORT: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-smtp-config', 'MAIL_PORT', 2) }}}
    MAIL_SERVER: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-smtp-config', 'MAIL_SERVER', 2) }}}
    MAIL_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-smtp-config', 'MAIL_USERNAME', 2) }}}
    MAIL_USE_TLS: true
    NOTIFICATION_QUEUE_NAME: notificationstaging
    OCI_NAMESPACE_PROPORTION: 1
    OCI_NAMESPACE_WHITELIST:
      - redhat
      - operatorframework
      - operator-framework
      - quay
      - coreos
      - outline
    PAGE_TOKEN_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-publish-config', 'PAGE_TOKEN_KEY', 1) }}}
    PREFERRED_URL_SCHEME: https
    RECAPTCHA_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-publish-config', 'RECAPTCHA_SECRET_KEY', 1) }}}
    RECAPTCHA_SITE_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-publish-config', 'RECAPTCHA_SITE_KEY', 1) }}}
    REGISTRY_TITLE: Quay Stage
    REGISTRY_TITLE_SHORT: Tom's Quay
    SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-publish-config', 'SECRET_KEY', 1) }}}
    SECURITY_SCANNER_API_BATCH_TIMEOUT_SECONDS: 480
    SECURITY_SCANNER_API_TIMEOUT_SECONDS: 30
    SECURITY_SCANNER_API_VERSION: v1
    SECURITY_SCANNER_ENDPOINT: 'https://api.clair.quay.io:6060'
    SECURITY_SCANNER_ENDPOINT_BATCH: 'https://worker.clair.quay.io:6060'
    SECURITY_SCANNER_ENGINE_VERSION_TARGET: 3
    SECURITY_SCANNER_INDEXING_INTERVAL: 30
    SECURITY_SCANNER_INDEXING_MIN_ID: 119492130
    SECURITY_SCANNER_ISSUER_NAME: clair
    SETUP_COMPLETE: true
    SIGNING_ENGINE: gpg2
    SIGNING_NAMESPACE_WHITELIST:
      - coreos
      - quay
      - mstyne
    STATIC_SITE_BUCKET: 'https://s3.amazonaws.com/staging-s3.quay.io/'
    TESTING: false
    THREAT_NAMESPACE_MAXIMUM_BUILD_COUNT: 1
    TRUSTED_PROXY_CIDR:
    - {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-alb', 'vpc_cidr_block') }}}
    - {{{ resource.namespace.cluster.network.pod }}}
    - 34.238.133.136/32 # registry.redhat.io
    - 54.91.156.163/32 # registry.redhat.io
    - 52.20.152.103/32 # registry.redhat.io
    - 172.125.169.76/32 # registry.redhat.io

    TUF_HOST: apostille.stage.quay.io
    TUF_SERVER: 'https://apostille.stage.quay.io'
    USERFILES_LOCATION: s3_us_east_1
    USERFILES_PATH: userfiles/
    USER_EVENTS_REDIS:
      host: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-elasticache', 'db.endpoint') }}}
      port: 6379
      password: {{{ vault('app-sre/integrations-output/terraform-resources/quays02ue1/quay/quayio-stage-elasticache', 'db.auth_token') }}}
      ssl: true
    SUPER_USERS:
      - quayadmin
    TAG_EXPIRATION_OPTIONS:
      - 0s
      - 1d
      - 1w
      - 2w
      - 4w
    TEAM_RESYNC_STALE_TIME: 60m
    USE_CDN: false
    V22_NAMESPACE_WHITELIST:
      - openshift-qe-optional-operators
      - openshift-cloud-functions
      - projectquay
      - rh-osbs
      - rh-osbs-stage
      - openshift-knative
      - kbrwn
      - eparis
      - jzelinskie
      - mkonline
      - ibazulic
      - ibazulic1
      - ohman
      - rhdevelopers
      - workspace7
      - prometheus
      - k8s
      - openshift
      - openshift-pipeline
      - openshift-release-dev
      - openshift-knative
      - sdase
      - hendrikhalkow
      - josephschorr
      - kleesinc
      - operatorframework
      - operator-framework
      - joelanford
      - cnorman
      - altissia
      - gravitational
      - solarwinds
      - upskill
      - mercedesbenzio
      - jetstack
      - jetstack-james
    V3_UPGRADE_MODE: complete
    {{% endb64encode %}}
  default-cloudfront-signing-key.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'default-cloudfront-signing-key.pem', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  extra_ca_clair.crt:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'extra_ca_clair.crt', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  quay-readonly.kid:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-readonly.kid', '{{ vault_secret_version }}') }}}{{%- endb64encode %}}
  quay-readonly.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-readonly.pem', '{{ vault_secret_version }}') }}}{{%- endb64encode %}}
  quay-readonly.jwk:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-readonly.jwk', '{{ vault_secret_version }}') }}}{{%- endb64encode %}}
  license:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'license', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  export-compliance-client.crt:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/export-compliance-config', 'client.crt', 3) }}}{{% endb64encode %}}
  export-compliance-client.key:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/export-compliance-config', 'client.key', 3) }}}{{% endb64encode %}}
  export-compliance-ca.crt:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/export-compliance-config', 'ca.crt', 3) }}}{{% endb64encode %}}
  quay-staging-enc.key:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-staging-enc.key', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  quay-staging.cert:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-staging.cert', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  rds-ssl-ca-cert.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'rds-ssl-ca-cert.pem', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  robots.txt:
    {{% b64encode %}}
    User-agent: *
    Disallow: /
    Noindex: /
    {{% endb64encode %}}
  signing-private.gpg:
    {{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'signing-private.gpg_qb64', '{{ vault_secret_version }}') }}}
  signing-public.gpg:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'signing-public.gpg', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  ssl.cert:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'ssl.cert', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  ssl.key:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'ssl.key', '{{ vault_secret_version }}') }}}{{% endb64encode %}}
  cloudflare-private-key.pem:
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/cloudflare', 'cloudflare-private-key.pem', 2) }}}{{% endb64encode %}}

