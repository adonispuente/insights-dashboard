apiVersion: v1
kind: Secret
metadata:
  name: quay-app-config
data:
  config.yml: |-
    {{% b64encode %}}
---
FEATURE_PROXY_PROTOCOL: True
AUTHENTICATION_TYPE: Database
BITTORRENT_FILENAME_PEPPER: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'BITTORRENT_FILENAME_PEPPER') }}}
ACTION_LOG_ARCHIVE_LOCATION: s3_us_east_1
ACTION_LOG_ARCHIVE_PATH: actionlogarchive/
ACTION_LOG_MAX_PAGE: 5
ACTION_LOG_ROTATION_FREQUENCY: 60
AVATAR_KIND: gravatar
BACKFILL_TAGS: false
BILLED_NAMESPACE_MAXIMUM_BUILD_COUNT: 3
BILLING_TYPE: Stripe
BITBUCKET_TRIGGER_CONFIG:
  CONSUMER_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'BITBUCKET_TRIGGER_CONFIG_CONSUMER_KEY') }}}
  CONSUMER_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'BITBUCKET_TRIGGER_CONFIG_CONSUMER_SECRET') }}}

BITTORRENT_ANNOUNCE_URL: 'https://tracker.quay.io/announce'

BRANDING:
  footer_img: /static/img/RedHat.svg
  footer_url: 'https://redhat.com'
  logo: 'https://stage.quay.io/static/img/RH_QuayIO.svg'
BUILDLOGS_REDIS:
  host: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_HOST') }}}
  password: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_PASSWORD') }}}
  ssl: true

BUILD_MANAGER:
- ephemeral
- ALLOWED_WORKER_COUNT: 5
  ORCHESTRATOR_PREFIX: buildman/staging/
  ORCHESTRATOR:
    REDIS_HOST: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_HOST') }}}
    REDIS_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_PASSWORD') }}}
    REDIS_SSL: true
    REDIS_SKIP_KEYSPACE_EVENT_SETUP: true

  EXECUTORS:
  - EXECUTOR: kubernetes
    NAME: openshift
    MINIMUM_RETRY_THRESHOLD: 1
    BUILDER_VM_CONTAINER_IMAGE: quay.io/quay/quay-builder-qemu-coreos:staging-multistage
    K8S_API_SERVER: api.c1.ocp4-builder.quay.io:6443
    QUAY_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_USERNAME') }}}
    QUAY_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_PASSWORD') }}}
    WORKER_TAG: staging-multistage
    VOLUME_SIZE: 32G
    BLOCK_DEVICE_SIZE: 58 # Not sure this makes sense here.
    SETUP_TIME: 45
    KUBERNETES_DISTRIBUTION: openshift
    CONTAINER_MEMORY_LIMITS: 5120Mi
    CONTAINER_CPU_LIMITS: 1000m
    CONTAINER_MEMORY_REQUEST: 3968Mi
    CONTAINER_CPU_REQUEST: 500m
    NODE_SELECTOR_LABEL_KEY: beta.kubernetes.io/instance-type
    NODE_SELECTOR_LABEL_VALUE: m5.metal
    SERVICE_ACCOUNT_NAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'OPENSHIFT_BUILDER_SERVICE_ACCOUNT_NAME') }}}
    SERVICE_ACCOUNT_TOKEN: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'OPENSHIFT_BUILDER_SERVICE_ACCOUNT_TOKEN') }}}

  - EXECUTOR: ec2
    EC2_REGION: us-east-1
    COREOS_AMI: ami-e582d29f
    AWS_ACCESS_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'EC2_BUILD_EXECUTOR_AWS_ACCESS_KEY') }}}
    AWS_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'EC2_BUILD_EXECUTOR_AWS_SECRET_KEY') }}}
    EC2_INSTANCE_TYPE: t2.large
    EC2_VPC_SUBNET_ID: subnet-a39f0ed4
    EC2_SECURITY_GROUP_IDS:
    - sg-e6b81982
    EC2_KEY_NAME: Joey's Mac
    QUAY_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_USERNAME') }}}
    QUAY_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_PASSWORD') }}}
    WORKER_TAG: staging-multistage
    VOLUME_SIZE: 52G # Size in truncate notation for the BTRFS volume
    BLOCK_DEVICE_SIZE: 58
    SETUP_TIME: 180

CONTACT_INFO:
  - 'https://access.redhat.com/articles/quayio-help'
DATABASE_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'DATABASE_SECRET_KEY') }}}
DB_CONNECTION_ARGS:
  autorollback: true
  threadlocals: true
DB_URI: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'DB_URI') }}}
DEFAULT_MAIL_SENDER: support@quay.io
DEFAULT_NAMESPACE_MAXIMUM_BUILD_COUNT: 1
DIFFS_QUEUE_NAME: imagediffstaging
DISABLED_FOR_PULL_LOGS:
  - coreos
  - openshift-release-dev
  - openshift
  - openshiftio
  - redhat

    {{% endb64encode %}}
