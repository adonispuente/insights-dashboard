apiVersion: v1
kind: Secret
metadata:
  name: quay-app-config
data:
  default-cloudfront-signing-key.pem: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'default-cloudfront-signing-key.pem') }}}{{% endb64encode %}}
  extra_ca_clair.crt: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'extra_ca_clair.crt') }}}{{% endb64encode %}}
  license: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'license') }}}{{% endb64encode %}}
  quay-staging-enc.key: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-staging-enc.key') }}}{{% endb64encode %}}
  quay-staging.cert: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'quay-staging.cert') }}}{{% endb64encode %}}
  rds-ssl-ca-cert.pem: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'rds-ssl-ca-cert.pem') }}}{{% endb64encode %}}
  robots.txt: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'robots.txt') }}}{{% endb64encode %}}
  signing-private.gpg: {{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'signing-private.gpg_qb64') }}}
  signing-public.gpg: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'signing-public.gpg') }}}{{% endb64encode %}}
  ssl.cert: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'ssl.cert') }}}{{% endb64encode %}}
  ssl.key: |-
    {{% b64encode %}}{{{ vault('app-interface/quayio-stage/quayio-stage/quay-config-secret', 'ssl.key') }}}{{% endb64encode %}}
  config.yaml: |-
    {{% b64encode %}}---
FEATURE_PROXY_PROTOCOL: True
AUTHENTICATION_TYPE: Database
BITTORRENT_FILENAME_PEPPER: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'BITTORRENT_FILENAME_PEPPER') }}}
ACTION_LOG_ARCHIVE_LOCATION: s3_us_east_1
ACTION_LOG_ARCHIVE_PATH: actionlogarchive/
ACTION_LOG_MAX_PAGE: 5
ACTION_LOG_ROTATION_FREQUENCY: 60
AVATAR_KIND: gravatar
BACKFILL_TAGS: false
BILLED_NAMESPACE_MAXIMUM_BUILD_COUNT: 3
BILLING_TYPE: Stripe
BITBUCKET_TRIGGER_CONFIG:
  CONSUMER_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'BITBUCKET_TRIGGER_CONFIG_CONSUMER_KEY') }}}
  CONSUMER_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'BITBUCKET_TRIGGER_CONFIG_CONSUMER_SECRET') }}}

BITTORRENT_ANNOUNCE_URL: 'https://tracker.quay.io/announce'

BRANDING:
  footer_img: /static/img/RedHat.svg
  footer_url: 'https://redhat.com'
  logo: 'https://stage.quay.io/static/img/RH_QuayIO.svg'
BUILDLOGS_REDIS:
  host: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_HOST') }}}
  password: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_PASSWORD') }}}
  ssl: true

BUILD_MANAGER:
- ephemeral
- ALLOWED_WORKER_COUNT: 5
  ORCHESTRATOR_PREFIX: buildman/staging/
  ORCHESTRATOR:
    REDIS_HOST: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_HOST') }}}
    REDIS_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_PASSWORD') }}}
    REDIS_SSL: true
    REDIS_SKIP_KEYSPACE_EVENT_SETUP: true

  EXECUTORS:
  - EXECUTOR: kubernetes
    NAME: openshift
    MINIMUM_RETRY_THRESHOLD: 1
    BUILDER_VM_CONTAINER_IMAGE: quay.io/quay/quay-builder-qemu-coreos:staging-multistage
    K8S_API_SERVER: api.c1.ocp4-builder.quay.io:6443
    QUAY_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_USERNAME') }}}
    QUAY_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_PASSWORD') }}}
    WORKER_TAG: staging-multistage
    VOLUME_SIZE: 32G
    BLOCK_DEVICE_SIZE: 58 # Not sure this makes sense here.
    SETUP_TIME: 45
    KUBERNETES_DISTRIBUTION: openshift
    CONTAINER_MEMORY_LIMITS: 5120Mi
    CONTAINER_CPU_LIMITS: 1000m
    CONTAINER_MEMORY_REQUEST: 3968Mi
    CONTAINER_CPU_REQUEST: 500m
    NODE_SELECTOR_LABEL_KEY: beta.kubernetes.io/instance-type
    NODE_SELECTOR_LABEL_VALUE: m5.metal
    SERVICE_ACCOUNT_NAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'OPENSHIFT_BUILDER_SERVICE_ACCOUNT_NAME') }}}
    SERVICE_ACCOUNT_TOKEN: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'OPENSHIFT_BUILDER_SERVICE_ACCOUNT_TOKEN') }}}

  - EXECUTOR: ec2
    EC2_REGION: us-east-1
    COREOS_AMI: ami-e582d29f
    AWS_ACCESS_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'EC2_BUILD_EXECUTOR_AWS_ACCESS_KEY') }}}
    AWS_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'EC2_BUILD_EXECUTOR_AWS_SECRET_KEY') }}}
    EC2_INSTANCE_TYPE: t2.large
    EC2_VPC_SUBNET_ID: subnet-a39f0ed4
    EC2_SECURITY_GROUP_IDS:
    - sg-e6b81982
    EC2_KEY_NAME: Joey's Mac
    QUAY_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_USERNAME') }}}
    QUAY_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'QUAY_PASSWORD') }}}
    WORKER_TAG: staging-multistage
    VOLUME_SIZE: 52G # Size in truncate notation for the BTRFS volume
    BLOCK_DEVICE_SIZE: 58
    SETUP_TIME: 180

CONTACT_INFO:
  - 'https://access.redhat.com/articles/quayio-help'
DATABASE_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'DATABASE_SECRET_KEY') }}}
DB_CONNECTION_ARGS:
  autorollback: true
  threadlocals: true
DB_URI: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'DB_URI') }}}
DEFAULT_MAIL_SENDER: support@quay.io
DEFAULT_NAMESPACE_MAXIMUM_BUILD_COUNT: 1
DIFFS_QUEUE_NAME: imagediffstaging
DISABLED_FOR_PULL_LOGS:
  - coreos
  - openshift-release-dev
  - openshift
  - openshiftio
  - redhat

DEFAULT_TAG_EXPIRATION: 2w
DISTRIBUTED_STORAGE_CONFIG:
  s3_us_east_1:
    - CloudFrontedS3Storage
    - cloudfront_distribution_domain: d3t50p05mdz6l3.cloudfront.net
      cloudfront_key_id: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'CLOUDFRONT_KEY_ID') }}}
      cloudfront_privatekey_filename: default-cloudfront-signing-key.pem
      s3_access_key: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'S3_ACCESS_KEY') }}}
      s3_bucket: quayio-stage-s3-cloudfront-bucket-139eohlbelfci
      s3_secret_key: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'S3_SECRET_KEY') }}}
      storage_path: ''
DISTRIBUTED_STORAGE_PREFERENCE:
  - s3_us_east_1

EXCEPTION_LOG_TYPE: Sentry
FEATURE_ACI_CONVERSION: true
FEATURE_ACTION_LOG_ROTATION: true
FEATURE_AGGREGATED_LOG_COUNT_RETRIEVAL: true
FEATURE_APP_REGISTRY: true
FEATURE_APP_SPECIFIC_TOKENS: false
FEATURE_BILLING: true
FEATURE_BITBUCKET_BUILD: true
FEATURE_BITTORRENT: true
FEATURE_DISABLE_PULL_LOGS_FOR_FREE_NAMESPACES: false
FEATURE_GARBAGE_COLLECTION: false
FEATURE_GITHUB_BUILD: true
FEATURE_GITHUB_LOGIN: true
FEATURE_GITLAB_BUILD: true
FEATURE_GOOGLE_LOGIN: true
FEATURE_LIBRARY_SUPPORT: false
FEATURE_LOG_EXPORT: true
FEATURE_RATE_LIMITS: false
FEATURE_RECAPTCHA: true
FEATURE_RESTRICTED_V1_PUSH: true
FEATURE_SECURITY_NOTIFICATIONS: false
FEATURE_SECURITY_SCANNER: true
FEATURE_SIGNING: true
FEATURE_SUPER_USERS: false
FEATURE_SUPPORT_CHAT: true
FEATURE_USER_LAST_ACCESSED: false
FEATURE_USER_METADATA: true
GARBAGE_COLLECTION_FREQUENCY: 4604800

GITHUB_LOGIN_CONFIG:
  API_ENDPOINT: 'https://api.github.com/'
  CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GITHUB_LOGIN_CONFIG_CLIENT_ID') }}}
  CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GITHUB_LOGIN_CONFIG_CLIENT_SECRET') }}}
  GITHUB_ENDPOINT: 'https://github.com/'
GITHUB_TRIGGER_CONFIG:
  API_ENDPOINT: 'https://api.github.com/'
  CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GITHUB_TRIGGER_CONFIG_CLIENT_ID') }}}
  CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GITHUB_TRIGGER_CONFIG_CLIENT_SECRET') }}}
  GITHUB_ENDPOINT: 'https://github.com/'
GITLAB_TRIGGER_CONFIG:
  CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GITLAB_TRIGGER_CONFIG_CLIENT_ID') }}}
  CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GITLAB_TRIGGER_CONFIG_CLIENT_SECRET') }}}
  GITLAB_ENDPOINT: 'https://gitlab.com'
GOOGLE_LOGIN_CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GOOGLE_LOGIN_CLIENT_ID') }}}
GOOGLE_LOGIN_CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GOOGLE_LOGIN_CLIENT_SECRET') }}}
GOOGLE_LOGIN_CONFIG:
  CLIENT_ID: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GOOGLE_LOGIN_CLIENT_ID') }}}
  CLIENT_SECRET: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'GOOGLE_LOGIN_CLIENT_SECRET') }}}
GPG2_PRIVATE_KEY_FILENAME: signing-private.gpg
GPG2_PRIVATE_KEY_NAME: 4632047EEEB32221
GPG2_PUBLIC_KEY_FILENAME: signing-public.gpg

LOG_ARCHIVE_LOCATION: s3_us_east_1
LOG_ARCHIVE_PATH: logarchive/
MAIL_DEFAULT_SENDER: support@quay.io
MAIL_FAIL_SILENTLY: false
MAIL_PASSWORD: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'MAIL_PASSWORD') }}}
MAIL_PORT: 587
MAIL_SERVER: email-smtp.us-east-1.amazonaws.com
MAIL_USERNAME: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'MAIL_USERNAME') }}}
MAIL_USE_TLS: true
NOTIFICATION_QUEUE_NAME: notificationstaging
OCI_NAMESPACE_PROPORTION: 1
OCI_NAMESPACE_WHITELIST:
  - redhat
  - operatorframework
  - operator-framework
  - quay
  - coreos
  - outline
PAGE_TOKEN_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'PAGE_TOKEN_KEY') }}}
PREFERRED_URL_SCHEME: https
RECAPTCHA_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'RECAPTCHA_SECRET_KEY') }}}
RECAPTCHA_SITE_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'RECAPTCHA_SITE_KEY') }}}
REGISTRY_TITLE: Quay Stage
REGISTRY_TITLE_SHORT: Quay Stage
SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'SECRET_KEY') }}}
SECURITY_SCANNER_API_BATCH_TIMEOUT_SECONDS: 480
SECURITY_SCANNER_API_TIMEOUT_SECONDS: 30
SECURITY_SCANNER_API_VERSION: v1
SECURITY_SCANNER_ENDPOINT: 'https://api.clair.quay.io:6060'
SECURITY_SCANNER_ENDPOINT_BATCH: 'https://worker.clair.quay.io:6060'
SECURITY_SCANNER_ENGINE_VERSION_TARGET: 3
SECURITY_SCANNER_INDEXING_INTERVAL: 30
SECURITY_SCANNER_INDEXING_MIN_ID: 119492130
SECURITY_SCANNER_ISSUER_NAME: clair
SENTRY_DSN: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'SENTRY_DSN') }}}
SERVER_HOSTNAME: stage.quay.io
SETUP_COMPLETE: true
SIGNING_ENGINE: gpg2
SIGNING_NAMESPACE_WHITELIST:
  - coreos
  - quay
  - mstyne
STATIC_SITE_BUCKET: 'https://s3.amazonaws.com/staging-s3.quay.io/'
STRIPE_PUBLISHABLE_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'STRIPE_PUBLISHABLE_KEY') }}}
STRIPE_SECRET_KEY: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'STRIPE_SECRET_KEY') }}}
TESTING: false
THREAT_NAMESPACE_MAXIMUM_BUILD_COUNT: 1
TUF_HOST: apostille-staging.quay.io
TUF_SERVER: 'https://apostille-staging.quay.io'
USERFILES_LOCATION: s3_us_east_1
USERFILES_PATH: userfiles/
USER_EVENTS_REDIS:
  host: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_HOST') }}}
  password: {{{ vault('app-interface/quayio-stage/quayio-stage/quayio-config', 'REDIS_PASSWORD') }}}
  ssl: true
SUPER_USERS:
  - quayadmin
TAG_EXPIRATION_OPTIONS:
  - 0s
  - 1d
  - 1w
  - 2w
  - 4w
TEAM_RESYNC_STALE_TIME: 60m
USE_CDN: false
V22_NAMESPACE_WHITELIST:
  - openshift-qe-optional-operators
  - openshift-cloud-functions
  - projectquay
  - rh-osbs
  - rh-osbs-stage
  - openshift-knative
  - kbrwn
  - eparis
  - jzelinskie
  - mkonline
  - ibazulic
  - ibazulic1
  - ohman
  - rhdevelopers
  - workspace7
  - prometheus
  - k8s
  - openshift
  - openshift-pipeline
  - openshift-release-dev
  - openshift-knative
  - sdase
  - hendrikhalkow
  - josephschorr
  - kleesinc
  - operatorframework
  - operator-framework
  - joelanford
  - cnorman
  - altissia
  - gravitational
  - solarwinds
  - upskill
  - mercedesbenzio
  - jetstack
  - jetstack-james
V3_UPGRADE_MODE: post-oci-roll-back-compat
    {{% endb64encode %}}
