apiVersion: v1
kind: Secret
metadata:
  # ACM listens on a secret named auto-import-secret for cluter registration
  # and deletes it after processing. to prevent q-r to reconcile over and over
  # again, we roll out the secret with the -original suffix and use a Job to
  # to copy it to the expected name once
  #
  # the ACM team is working on an RFE that will prevent the secret from being
  # deleted, which will make the Job approach obsolete
  #
  # todo: update with link to RFE once it is available
  name: auto-import-secret-original
stringData:
  autoImportRetry: "5"
  token: {{{ vault('app-sre/creds/kube-configs/{{cluster}}-cluster-admin', 'token') }}}
  server: {{{ vault('app-sre/creds/kube-configs/{{cluster}}-cluster-admin', 'server') }}}
type: Opaque
