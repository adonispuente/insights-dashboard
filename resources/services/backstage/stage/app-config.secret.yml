---
apiVersion: v1
kind: Secret
metadata:
  name: backstage-app-config
  annotations:
    qontract.recycle: "true"
stringData:
  app-config.yaml: |
    app:
      title: Backstage stage
      baseUrl: https://backstage.stage.devshift.net

    backend:
      listen: 0.0.0.0:7007
      baseUrl: https://backstage.stage.devshift.net:7007

      database:
        client: pg
        connection:
          host: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-db', 'db.host', 1) }}
          port: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-db', 'db.port', 1) }}
          user: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-db', 'db.user', 1) }}
          password: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-db', 'db.password', 1) }}

    organization:
      name: Red Hat

    techdocs:
      builder: 'external'
      generator:
        runIn: 'local'
      publisher:
        type: 'awsS3'
        awsS3:
          bucketName: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-storage', 'bucket', 1) }}
          endpoint: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-storage', 'endpoint', 1) }}
          s3ForcePathStyle: true
          region: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-storage', 'aws_region', 1) }}
          credentials:
            aws_access_key_id: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-storage', 'bucket', 1) }}
            aws_secret_access_key: {{ vault('app-sre/integrations-output/terraform-resources/app-sre-stage-01/backstage-stage/backstage-storage', 'bucket', 1) }}
