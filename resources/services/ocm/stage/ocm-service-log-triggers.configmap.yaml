apiVersion: v1
data:
  triggers.yaml: |
    - name: "SendGrid Service Webhook"
      criteria: "Summary like '%RHMI%' or Summary like '%Managed API%' or Summary like '%Cluster deleted%'"
      owner: "dzuccare@redhat.com"
      action:
        type: "webhook"
        webhook_parameters:
          url: "https://ocm-sendgrid-service.sendgrid-stage.svc:8000/api/ocm-sendgrid-service/v1/webhook"
          verify_ssl: true
          authentication:
            method: "none"
    - name: "Development Example Email"
      criteria: "Summary = 'Development Test Log - Email'"
      owner: "tiwillia@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "ocm-basic-log-notification"
          subject: "A new log has been created against your OpenShift cluster"
          bcc_address: "tiwillia+osl_trigger_dev@redhat.com"
          mandrill_global_merge_vars:
            - name: "TEST_TAG"
              content: "foo bar baz buzz"
    - name: "Basic Event Notification Example Email"
      criteria: "Summary like '%basic event notification%'"
      owner: "tiwillia@redhat.com"
      action:
        type: "email"
        email_parameters:
          # No template name provided results in the default 'service-log-default' template being used
          # Subjects sent to mandrill can include dynamic content - mandrill will perform the substitution
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance scheduled"
      criteria: "Summary = 'Upgrade maintenance scheduled'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-scheduled-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance reminder"
      criteria: "Summary = 'Upgrade maintenance reminder'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-scheduled-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance beginning"
      criteria: "Summary = 'Upgrade maintenance beginning'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-scheduled-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance delayed"
      criteria: "Summary = 'Upgrade maintenance delayed'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-ended-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance completed"
      criteria: "Summary = 'Upgrade maintenance completed'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-ended-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance cancelled"
      criteria: "Summary = 'Upgrade maintenance cancelled'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-ended-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Upgrade maintenance rescheduled"
      criteria: "Summary = 'Upgrade maintenance rescheduled'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "upgrade-ended-template"
          bcc_address: "sd-customer-notifications+upgrades@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Cluster incident identified"
      criteria: "Summary = 'Cluster incident identified'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "generic-sre-notification-template"
          bcc_address: "sd-customer-notifications+incident@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Cluster incident resolved"
      criteria: "Summary = 'Cluster incident resolved'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "generic-sre-notification-template"
          bcc_address: "sd-customer-notifications+incident@redhat.com"
          subject: "*|LOG_SUMMARY|*"
    - name: "Action required"
      criteria: "Summary = 'Action required: update cluster configuration'"
      owner: "wgordon@redhat.com"
      action:
        type: "email"
        email_parameters:
          mandrill_template_name: "generic-sre-notification-template"
          bcc_address: "sd-customer-notifications+config@redhat.com"
          subject: "*|LOG_SUMMARY|*"
kind: ConfigMap
metadata:
  name: ocm-service-log-triggers
  annotations:
    # This will cause updates to this configMap to cycle deployments that use it
    qontract.recycle: "true"
