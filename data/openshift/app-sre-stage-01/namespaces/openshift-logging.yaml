---
$schema: /openshift/namespace-1.yml

labels: {}

name: openshift-logging
description: app-sre-stage-01 openshift-logging namespace

cluster:
  $ref: /openshift/app-sre-stage-01/cluster.yml

app:
  $ref: /services/app-sre/app.yml

environment:
  $ref: /products/app-sre/environments/stage.yml

managedExternalResources: true

externalResources:
- provider: aws
  provisioner:
    $ref: /aws/app-sre-logs/account.yml
  resources:
  - provider: aws-iam-service-account
    identifier: log-forwarder-app-sre-stage-01
    output_resource_name: app-sre-logs-cloudwatch-access
    user_policy:
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Action": [
              "logs:CreateLogGroup",
              "logs:CreateLogStream",
              "logs:DescribeLogGroups",
              "logs:DescribeLogStreams",
              "logs:PutLogEvents",
              "logs:GetLogEvents",
              "logs:PutRetentionPolicy",
              "logs:GetLogRecord",
            ],
            "Effect": "Allow",
            "Resource": "arn:aws:logs:*:*:*"
          }
        ]
      }

managedResourceTypes:
- Subscription.operators.coreos.com
- OperatorGroup.operators.coreos.com
- ClusterLogging.logging.openshift.io
- ClusterLogForwarder.logging.openshift.io

openshiftResources:
- provider: resource
  path: /setup/cluster-logging/subscription.yaml
- provider: resource
  path: /setup/cluster-logging/operatorgroup.yaml
- provider: resource
  path: /setup/cluster-logging/clusterlogging.yaml
- provider: resource-template
  type: jinja2
  path: /setup/cluster-logging/clusterlogforwarder.yaml.j2
  variables:
    RHOBS_LOGGING: true
- provider: vault-secret
  path: app-sre/creds/observatorium-appsre-staging
  version: 1
  name: clo-token-refresher
