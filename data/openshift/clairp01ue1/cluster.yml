---
$schema: /openshift/cluster-1.yml

labels:
  service: clair

name: clairp01ue1
description: clairp01ue1 cluster
consoleUrl: ''
kibanaUrl: ''
prometheusUrl: ''
alertmanagerUrl: ''
serverUrl: ''
elbFQDN: ''

auth:
  service: github-org-team
  org: app-sre
  team: clairp01ue1-cluster

ocm:
  $ref: /dependencies/ocm/production.yml

managedGroups:
- dedicated-admins
- dedicated-readers

managedClusterRoles: true

spec:
  provider: aws
  region: us-east-1
  channel: fast
  version: 4.8.11
  initial_version: 4.8.11
  multi_az: true
  nodes: 9
  # autoscale: # optional. nodes should not be defined if autoscale is defined
  #   min_replicas: 4  # seems to be the minimal min_replicas elsewhere
  #   max_replicas: 39
  instance_type: c5.2xlarge
  storage: 1600
  load_balancers: 4
  private: false
  # provision_shard_id: b26159a7-aaef-4303-89a0-6713ad9f1090

upgradePolicy:
  workloads:
  - clair
  schedule: '0 6 * * 1-4'
  conditions:
    soakDays: 9

network:
  vpc: 10.26.0.0/16
  service: 172.30.0.0/16
  pod: 10.128.0.0/14

peering:
  connections:
  - provider: account-vpc
    name: clairp01ue1-QuayVPC
    vpc:
      $ref: /aws/quayio-prod/vpcs/QuayVPC.yml
    # manageRoutes: true
# The following is set on Quay, but does not seem needed on Clair
#   - provider: account-vpc
#     name: clairp01ue1-StatefulVPC
#     vpc:
#       $ref: /aws/quayio-prod/vpcs/StatefulVPC.yml
# #    manageRoutes: true

# to be filled in a second step
# automationToken:
#   path: app-sre/creds/kube-configs/quayp05ue1
#   field: token

addons:
- $ref: /dependencies/ocm/addons/cluster-logging-operator.yml

internal: false

awsInfrastructureAccess:
- awsGroup:  # TODO: check it's ok to keep the link to quayio-prod there
    $ref: /aws/quayio-prod/groups/App-SRE-admin.yml
  accessLevel: read-only
- awsGroup:
    $ref: /aws/quayio-prod/groups/App-SRE-admin.yml
  accessLevel: network-mgmt
