---
$schema: /openshift/openshift-cluster-manager-1.yml
labels:
  service: osd-fleet-manager
name: osd-fleet-manager-ocm-stage
description: OpenShift Cluster Manager stage - OSD Fleet Manager
url: https://api.stage.openshift.com
accessTokenClientId: osd-fleet-manager-staging
accessTokenUrl: https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token
accessTokenClientSecret:
  path: app-interface/osd-fleet-manager/stage/fleet-manager
  field: ocm-service.clientSecret
  version: 5
addonManagedUpgrades: true
addonUpgradeTests:
- addon:
    $ref: /dependencies/ocm/addons/advanced-cluster-management.yml
  instance:
    $ref: /dependencies/ci-int/ci-int.yml
  name: uhc-integration-tests-staging
blockedVersions:
- ^.*-ec\..*$
- ^.*-fc\..*$
- ^4\.11\.0-rc\.[0-5]$
upgradePolicyAllowedWorkloads:
- service-cluster
- management-cluster
upgradePolicyAllowedMutexes:
- canary
- main
- test-sectors
- perf
- perf2
- perf3
- chaos

inheritVersionData:
- $ref: /dependencies/ocm/osd-fleet-manager/integration.yml
publishVersionData:
- $ref: /dependencies/ocm/osd-fleet-manager/production.yml
sectors:
- name: canary
- name: main
  dependencies:
  - name: canary
- name: perf
  dependencies:
  - name: canary
- name: perf2
  dependencies:
  - name: canary
- name: perf3
  dependencies:
  - name: canary
- name: chaos
  dependencies:
  - name: canary
upgradePolicyDefaults:
- name: stage-canary
  matchLabels:
    ext-hypershift.openshift.io/cluster-sector: canary
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    type: jinja2
    variables:
      schedule: 0,15,30,45 * * * *
      soakDays: 0
- name: stage-main
  matchLabels:
    ext-hypershift.openshift.io/cluster-sector: main
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    variables:
      schedule: 0,15,30,45 * * * *
      soakDays: 0
- name: stage
  matchLabels:
    ext-hypershift.openshift.io/osdfm-managed-cluster: 'true'
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    variables:
      schedule: 0,15,30,45 20,21,22,23 * * *
      soakDays: 0
      mutexes:
      - test-sectors
upgradePolicyClusters:
- name: hs-sc-ccb0thlad
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 * * * *
    conditions:
      sector: main
      soakDays: 0
      mutexes:
      - main
- name: hs-mc-8c6cdr68g
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 * * * *
    conditions:
      sector: main
      soakDays: 0
      mutexes:
      - main
- name: hs-sc-suav09an0
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 * * * *
    conditions:
      sector: main
      soakDays: 0
      mutexes:
      - main
- name: hs-sc-suav09b40
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 * * * *
    conditions:
      sector: main
      soakDays: 0
      mutexes:
      - main
- name: hs-mc-jsui4ri90
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 * * * *
    conditions:
      sector: main
      soakDays: 0
      mutexes:
      - main
- name: hs-sc-mdqo7k4rg
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf
      soakDays: 0
      mutexes:
      - perf
- name: hs-sc-0vfs0cl5g
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf
      soakDays: 0
      mutexes:
      - perf
- name: hs-mc-0vfs0e6gg
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf
      soakDays: 0
      mutexes:
      - perf
- name: hs-sc-tc8i8f11g
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf2
      soakDays: 0
      mutexes:
      - perf2
- name: hs-mc-hnns8hoq0
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf2
      soakDays: 0
      mutexes:
      - perf2
- name: hs-sc-n760rgt00
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf3
      soakDays: 0
      mutexes:
      - perf3
- name: hs-mc-9b6tgtb70
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf3
      soakDays: 0
      mutexes:
      - perf3
- name: hs-sc-ac6qf8tl0
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: chaos
      soakDays: 0
      mutexes:
      - chaos
- name: hs-mc-q8t67o1sg
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: chaos
      soakDays: 0
      mutexes:
      - chaos
- name: hs-sc-vdritcp2g
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf2
      soakDays: 0
      mutexes:
      - perf2
- name: hs-mc-vdritd53g
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0,15,30,45 20,21,22,23 * * *
    conditions:
      sector: perf2
      soakDays: 0
      mutexes:
      - perf2
recommendedVersions:
- workload: service-cluster
  channel: candidate
  recommendedVersion: 4.12.4
  initialVersion: openshift-v4.12.4-candidate
- workload: management-cluster
  channel: candidate
  recommendedVersion: 4.12.4
  initialVersion: openshift-v4.12.4-candidate
- workload: service-cluster
  channel: stable
  recommendedVersion: 4.12.2
  initialVersion: openshift-v4.12.2
- workload: management-cluster
  channel: stable
  recommendedVersion: 4.12.2
  initialVersion: openshift-v4.12.2
