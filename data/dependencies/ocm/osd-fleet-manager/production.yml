---
$schema: /openshift/openshift-cluster-manager-1.yml
labels:
  service: osd-fleet-manager
name: osd-fleet-manager-ocm-production
description: OpenShift Cluster Manager PROD - OSD Fleet Manager
url: https://api.openshift.com
accessTokenClientId: osd-fleet-manager-production
accessTokenUrl: https://sso.redhat.com/auth/realms/redhat-external/protocol/openid-connect/token
accessTokenClientSecret:
  path: app-interface/osd-fleet-manager/production/fleet-manager
  field: ocm-service.clientSecret
  version: 1
addonManagedUpgrades: true
blockedVersions:
- ^.*-ec\..*$
- ^.*-fc\..*$
- ^4\.11\.0-rc\.[0-5]$
# TODO, remove this possibly, see https://web-rca.devshift.net/incident/ITN-2023-00011
# Block 4.12.2 upgrades on MCs after we saw this cause outages on the nodes
- 4.12.2*$
upgradePolicyAllowedWorkloads:
- service-cluster
- management-cluster
upgradePolicyAllowedMutexes:
- red
- green
- blue

inheritVersionData:
- $ref: /dependencies/ocm/osd-fleet-manager/stage.yml
sectors:
- name: red
- name: green
  dependencies:
  - name: red
- name: blue
  dependencies:
  - name: green
upgradePolicyDefaults:
- name: production-red
  matchLabels:
    ext-hypershift.openshift.io/cluster-sector: red
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    type: jinja2
    variables:
      schedule: 0 11 * * 1-5
      soakDays: 0
- name: production-green
  matchLabels:
    ext-hypershift.openshift.io/cluster-sector: green
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    variables:
      schedule: 0 13 * * 1-5
      soakDays: 0
- name: production-blue
  matchLabels:
    ext-hypershift.openshift.io/cluster-sector: blue
  upgradePolicyTemplate:
    path: /ocm/osd-fleet-manager/upgrade-policy.yaml.j2
    variables:
      schedule: 0 15 * * 1-5
      soakDays: 0
upgradePolicyClusters:
- name: hs-sc-1sek0vq5g
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: green
      soakDays: 0
      mutexes:
      - green
- name: hs-mc-1sek0vqe0
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: green
      soakDays: 0
      mutexes:
      - green
- name: hs-sc-qiag65950
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 15 * * 1-5
    conditions:
      sector: blue
      soakDays: 0
      mutexes:
      - blue
- name: hs-sc-7788f9bag
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: green
      soakDays: 0
      mutexes:
      - green
- name: hs-sc-mns7ke2j0
  upgradePolicy:
    workloads:
    - service-cluster
    schedule: 0 15 * * 1-5
    conditions:
      sector: blue
      soakDays: 0
      mutexes:
      - blue
- name: hs-mc-3fgn9a3qg
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 13 * * 1-5
    conditions:
      sector: green
      soakDays: 0
      mutexes:
      - green
- name: hs-mc-diqec1lc0
  upgradePolicy:
    workloads:
    - management-cluster
    schedule: 0 15 * * 1-5
    conditions:
      sector: blue
      soakDays: 0
      mutexes:
      - blue
recommendedVersions:
- workload: service-cluster
  channel: candidate
  recommendedVersion: 4.12.4
  initialVersion: openshift-v4.12.4-candidate
- workload: management-cluster
  channel: candidate
  recommendedVersion: 4.12.4
  initialVersion: openshift-v4.12.4-candidate
- workload: service-cluster
  channel: stable
  recommendedVersion: 4.12.1
  initialVersion: openshift-v4.12.1
- workload: management-cluster
  channel: stable
  recommendedVersion: 4.12.1
  initialVersion: openshift-v4.12.1
