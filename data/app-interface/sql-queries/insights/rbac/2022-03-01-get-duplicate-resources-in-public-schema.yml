---
$schema: /app-interface/app-interface-sql-query-1.yml
name: 2022-03-01-get-duplicate-resources-in-public-schema
labels: {}
namespace:
  $ref: /services/insights/rbac/namespaces/rbac-prod.yml
identifier: rbac-prod
output: stdout
queries:
  - |
    SELECT count(*)
    FROM public.management_permission
    WHERE tenant_id NOT IN
        (SELECT id
        FROM public.api_tenant
        WHERE SCHEMA_NAME = 'public');
  - |
    SELECT count(*)
    FROM public.management_role
    WHERE SYSTEM = TRUE
      AND tenant_id NOT IN
        (SELECT id
        FROM public.api_tenant
        WHERE SCHEMA_NAME = 'public');

  - |
    SELECT count(*)
    FROM public.management_group
    WHERE SYSTEM = TRUE
      AND tenant_id NOT IN
        (SELECT id
        FROM public.api_tenant
        WHERE SCHEMA_NAME = 'public');

  - |
    SELECT count(*)
    FROM public.management_policy
    WHERE group_id IN
        ( SELECT id
        FROM public.management_group
        WHERE SYSTEM = TRUE
          AND tenant_id NOT IN
            (SELECT id
              FROM public.api_tenant
              WHERE SCHEMA_NAME = 'public'));
