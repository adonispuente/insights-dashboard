---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2022-02-21-package-stats
namespace:
  $ref: /services/insights/patchman/namespaces/patchman-engine-prod.yml
identifier: patchman-prod
output: stdout
queries:
  - select pn.name, count(pn.name), ih.system_profile->'operating_system'->>'name' || ' ' || coalesce(ih.system_profile->'operating_system'->>'major' || '.' || (ih.system_profile->'operating_system'->>'minor'), '') as os from system_package sp join package p on sp.package_id = p.id join package_name pn on p.name_id = pn.id join system_platform s on sp.system_id = s.id left outer join inventory.hosts ih on s.inventory_id = ih.id join rh_account ra on sp.rh_account_id = ra.id where ra.name not in('477931', '6341559', '6257250', '6253087', '6121648', '6033792', '5555635', '6111241', '5673104', '6257936', '6238348', '5877351', '5993448', '6103983', '5686629', '6120169', '6186556', '1104094', '5556186', '6026205', '6236147', '6120179', '6204774', '6269170', '1058520', '1092491', '826893', '6181901', '6246235', '5602050', '5542693', '5655367', '6212943', '6233426', '5767462', '6243247', '5854804', '6229756', '6185940', '5861582', '6224058', '6229996', '6219681', '6197458', '6229994', '6212377', '6217410', '6225303', '6107810', '5448752', '6121459', '6183315', '6082468', '1095460', '6118268', '6193296', '6026207', '6176714', '1649857', '5512615', '5587382', '6118722', '6136023', '6087010', '6141543', '5761120', '6076664', '6111632', '5477230', '6109288', '6109002', '5510382', '6106540', '5812269', '5585704', '5858513', '1543606', '6089719', '5652428', '5220197', '5435865', '6079046', '5589348', '824399', '6022573', '6057187', '6067150', '6064010', '6038690', '5604888', '5912614', '5978543', '5703679', '5604867', '5716563', '5775904', '5673102', '1376257', '5518708', '5945730', '5378341', '1486496', '5578429', '5910538', '5753492', '5703680', '5754076', '5748194', '5886957', '5895685', '5547197', '5779551', '5235713', '5865916', '5355424', '5643865', '5674840', '5605099', '5444768', '5653890', '5591929', '1577672', '5691591', '5586766', '1070555', '5645132', '939082', '631105', '5341931', '939054', '5582724', '971738', '5301467', '5632300', '5309654', '5619554', '1650204', '5455085', '5547202', '5505446', '1191423', '5596826', '633200', '1061991', '1262852', '972614', '636204', '5453171', '1191884', '5491806', '5357088', '5594202', '720046', '1337999', '761015', '958959', '5463401', '1546454', '5526886', '1568253', '941133', '5364511', '5471870', '853019', '5385776', '901532', '5243891', '901578', '1212729', '1460290', '5361051', '940527', '5375112', '540155', '6') group by pn.name, os;
  - select count(sp.inventory_id) from system_platform sp join rh_account ra on sp.rh_account_id = ra.id where ra.name not in('477931', '6341559', '6257250', '6253087', '6121648', '6033792', '5555635', '6111241', '5673104', '6257936', '6238348', '5877351', '5993448', '6103983', '5686629', '6120169', '6186556', '1104094', '5556186', '6026205', '6236147', '6120179', '6204774', '6269170', '1058520', '1092491', '826893', '6181901', '6246235', '5602050', '5542693', '5655367', '6212943', '6233426', '5767462', '6243247', '5854804', '6229756', '6185940', '5861582', '6224058', '6229996', '6219681', '6197458', '6229994', '6212377', '6217410', '6225303', '6107810', '5448752', '6121459', '6183315', '6082468', '1095460', '6118268', '6193296', '6026207', '6176714', '1649857', '5512615', '5587382', '6118722', '6136023', '6087010', '6141543', '5761120', '6076664', '6111632', '5477230', '6109288', '6109002', '5510382', '6106540', '5812269', '5585704', '5858513', '1543606', '6089719', '5652428', '5220197', '5435865', '6079046', '5589348', '824399', '6022573', '6057187', '6067150', '6064010', '6038690', '5604888', '5912614', '5978543', '5703679', '5604867', '5716563', '5775904', '5673102', '1376257', '5518708', '5945730', '5378341', '1486496', '5578429', '5910538', '5753492', '5703680', '5754076', '5748194', '5886957', '5895685', '5547197', '5779551', '5235713', '5865916', '5355424', '5643865', '5674840', '5605099', '5444768', '5653890', '5591929', '1577672', '5691591', '5586766', '1070555', '5645132', '939082', '631105', '5341931', '939054', '5582724', '971738', '5301467', '5632300', '5309654', '5619554', '1650204', '5455085', '5547202', '5505446', '1191423', '5596826', '633200', '1061991', '1262852', '972614', '636204', '5453171', '1191884', '5491806', '5357088', '5594202', '720046', '1337999', '761015', '958959', '5463401', '1546454', '5526886', '1568253', '941133', '5364511', '5471870', '853019', '5385776', '901532', '5243891', '901578', '1212729', '1460290', '5361051', '940527', '5375112', '540155', '6');
