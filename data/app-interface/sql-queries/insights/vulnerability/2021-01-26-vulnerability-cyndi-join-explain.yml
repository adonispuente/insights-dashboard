---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2021-01-26-vulnerability-cyndi-join-explain
namespace:
  $ref: /services/insights/vulnerability/namespaces/vulnerability-engine-prod.yml
identifier: vulnerability-engine
output: stdout
queries:
    - explain analyze SELECT t1.id AS cve_id, t1.cve AS cve_name, t1.cvss3_score, t1.cvss2_score, t1.impact_id, t1.public_date, t1.description AS cve_description, COALESCE(t2.business_risk_id, 0) AS business_risk_id, t2.business_risk_text AS business_risk_text, COALESCE(t3.name, 'N') AS business_risk, COALESCE(t2.status_id, 0) AS status_id, t2.status_text AS status_text, COALESCE(t4.name, 'N') AS status, COALESCE(t5.systems_affected_, 0) AS systems_affected, COALESCE(t5.systems_status_divergent_, 0) AS systems_status_divergent FROM cve_metadata AS t1 INNER JOIN (SELECT t6.cve_id AS cve_id_, Count(t6.id) AS systems_affected_, Sum(CASE WHEN (t6.status_id != t2.status_id) THEN 1 ELSE 0 END) AS systems_status_divergent_ FROM system_vulnerabilities_active AS t6 INNER JOIN system_platform AS t7 ON (t6.system_id = t7.id) LEFT OUTER JOIN insights_rule AS t8 ON (t6.rule_id = t8.id) LEFT OUTER JOIN cve_account_data AS t2 ON ((t6.cve_id = t2.cve_id) AND (t6.rh_account_id = t2.rh_account_id)) WHERE ((((t6.rh_account_id = 3552) AND ((t6.mitigation_reason IS NULL) OR (t8.active = false))) AND ((t6.when_mitigated IS NULL) OR (t8.active = true))) AND (((t7.opt_out = false) AND (t7.stale = false)) AND (t7.when_deleted IS NULL))) GROUP BY t6.cve_id) AS t5 ON (t1.id = t5.cve_id_) LEFT OUTER JOIN cve_account_data AS t2 ON ((t1.id = t2.cve_id) AND (t2.rh_account_id = 3552)) LEFT OUTER JOIN business_risk AS t3 ON (t2.business_risk_id = t3.id) LEFT OUTER JOIN status AS t4 ON (t2.status_id = t4.id) ORDER BY t1.id ASC;
    - explain analyze SELECT t1.id AS cve_id, t1.cve AS cve_name, t1.cvss3_score, t1.cvss2_score, t1.impact_id, t1.public_date, t1.description AS cve_description, COALESCE(t2.business_risk_id, 0) AS business_risk_id, t2.business_risk_text AS business_risk_text, COALESCE(t3.name, 'N') AS business_risk, COALESCE(t2.status_id, 0) AS status_id, t2.status_text AS status_text, COALESCE(t4.name, 'N') AS status, COALESCE(t5.systems_affected_, 0) AS systems_affected, COALESCE(t5.systems_status_divergent_, 0) AS systems_status_divergent FROM cve_metadata AS t1 INNER JOIN (SELECT t6.cve_id AS cve_id_, Count(t6.id) AS systems_affected_, Sum(CASE WHEN (t6.status_id != t2.status_id) THEN 1 ELSE 0 END) AS systems_status_divergent_ FROM system_vulnerabilities_active AS t6 INNER JOIN system_platform AS t7 ON (t6.system_id = t7.id) LEFT OUTER JOIN insights_rule AS t8 ON (t6.rule_id = t8.id) LEFT OUTER JOIN cve_account_data AS t2 ON ((t6.cve_id = t2.cve_id) AND (t6.rh_account_id = t2.rh_account_id)) INNER JOIN inventory.hosts AS t9 ON (t7.inventory_id = t9.id) WHERE (((((t6.rh_account_id = 3552) AND ((t6.mitigation_reason IS NULL) OR (t8.active = false))) AND ((t6.when_mitigated IS NULL) OR (t8.active = true))) AND (((t7.opt_out = false) AND (t7.stale = false)) AND (t7.when_deleted IS NULL)))) GROUP BY t6.cve_id) AS t5 ON (t1.id = t5.cve_id_) LEFT OUTER JOIN cve_account_data AS t2 ON ((t1.id = t2.cve_id) AND (t2.rh_account_id = 3552)) LEFT OUTER JOIN business_risk AS t3 ON (t2.business_risk_id = t3.id) LEFT OUTER JOIN status AS t4 ON (t2.status_id = t4.id) ORDER BY t1.id ASC;
    - explain analyze SELECT t1.id AS cve_id, t1.cve AS cve_name, t1.cvss3_score, t1.cvss2_score, t1.impact_id, t1.public_date, t1.description AS cve_description, COALESCE(t2.business_risk_id, 0) AS business_risk_id, t2.business_risk_text AS business_risk_text, COALESCE(t3.name, 'N') AS business_risk, COALESCE(t2.status_id, 0) AS status_id, t2.status_text AS status_text, COALESCE(t4.name, 'N') AS status, COALESCE(t5.systems_affected_, 0) AS systems_affected, COALESCE(t5.systems_status_divergent_, 0) AS systems_status_divergent FROM cve_metadata AS t1 INNER JOIN (SELECT t6.cve_id AS cve_id_, Count(t6.id) AS systems_affected_, Sum(CASE WHEN (t6.status_id != t2.status_id) THEN 1 ELSE 0 END) AS systems_status_divergent_ FROM system_vulnerabilities_active AS t6 INNER JOIN system_platform AS t7 ON (t6.system_id = t7.id) LEFT OUTER JOIN insights_rule AS t8 ON (t6.rule_id = t8.id) LEFT OUTER JOIN cve_account_data AS t2 ON ((t6.cve_id = t2.cve_id) AND (t6.rh_account_id = t2.rh_account_id)) INNER JOIN inventory.hosts AS t9 ON (t7.inventory_id = t9.id AND t9.account = '6089719') WHERE (((((t6.rh_account_id = 3552) AND ((t6.mitigation_reason IS NULL) OR (t8.active = false))) AND ((t6.when_mitigated IS NULL) OR (t8.active = true))) AND (((t7.opt_out = false) AND (t7.stale = false)) AND (t7.when_deleted IS NULL)))) GROUP BY t6.cve_id) AS t5 ON (t1.id = t5.cve_id_) LEFT OUTER JOIN cve_account_data AS t2 ON ((t1.id = t2.cve_id) AND (t2.rh_account_id = 3552)) LEFT OUTER JOIN business_risk AS t3 ON (t2.business_risk_id = t3.id) LEFT OUTER JOIN status AS t4 ON (t2.status_id = t4.id) ORDER BY t1.id ASC;
