---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2023-03-21-vulnerability-floorist-explain-new 
namespace:
  $ref: /services/insights/vulnerability/namespaces/vulnerability-engine-prod.yml
identifier: vulnerability-engine
output: stdout
queries:
  - EXPLAIN ANALYZE SELECT rha.account_number AS rh_account_id, cm.cve AS cve, sp.inventory_id AS inventory_id, br.name AS business_risk, DATE(sv.first_reported) AS first_reported, DATE(sv.when_mitigated) AS when_mitigated FROM cve_account_data AS cad JOIN rh_account AS rha ON cad.rh_account_id = rha.id JOIN cve_metadata AS cm ON cad.cve_id = cm.id JOIN business_risk AS br ON cad.business_risk_id = br.id JOIN system_vulnerabilities_active AS sv ON cad.cve_id = sv.cve_id AND cad.rh_account_id = sv.rh_account_id JOIN system_platform as sp ON sv.system_id = sp.id AND sv.rh_account_id = sp.rh_account_id AND sp.opt_out = false AND sp.stale = false AND sp.when_deleted IS NULL JOIN inventory.hosts as ih ON sp.inventory_id = ih.id WHERE (sv.when_mitigated IS NULL) OR (sv.mitigation_reason IS NULL AND sv.rule_id IN (SELECT id FROM insights_rule WHERE active = TRUE AND rule_only = FALSE)) AND br.name != 'Not Defined';
