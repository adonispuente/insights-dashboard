---
$schema: /app-interface/app-interface-sql-query-1.yml
name: 2020-09-21-swatch-adoption-metrics-prod
labels: {}
namespace:
  $ref: /services/insights/rhsm/namespaces/prod-rhsm-prod.yml
identifier: rhsm-prod
output: stdout
query: >-
  select 
    (date_trunc('week', created + interval '1 day') - interval '1 day')::date as begin, -- sunday
    (date_trunc('week', created + interval '1 day') + interval '5 days')::date as end, -- saturday
    count(1)
  from account_config
    where opt_in_type='API'
    group by date_trunc('week', created + interval '1 day') -- adjust so that we're looking at weeks starting on Sunday @ midnight
    ;
