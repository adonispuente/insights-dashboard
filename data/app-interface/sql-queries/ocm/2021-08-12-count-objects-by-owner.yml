---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2021-08-12-count-objects-by-owner
namespace:
  $ref: /services/ocm/namespaces/uhc-production.yml
identifier: uhc-acct-mngr-production
output: stdout
query: |
  select 'account' as owner, 'rolebinding' as kind, rb.role_id as kind_additional, rb.deleted_at is not null as deleted, a.id as owner_id, a.username as owner_name, count(1) as count from accounts a join role_bindings rb on rb.account_id = a.id group by owner, kind, kind_additional, deleted, a.id, a.username;