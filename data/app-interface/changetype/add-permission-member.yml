---
$schema: /app-interface/change-type-1.yml

labels: {}

name: add-permission-member
description: |
  Owners of permissions can add permissions to:
  - roles
  - apps quay repo access

priority: low

contextType: datafile
contextSchema: /access/permission-1.yml

changes:
- provider: jsonPath
  changeSchema: /access/role-1.yml
  jsonPathSelectors:
  - permissions[?(@.'$ref'=='{{ ctx_file_path }}')]
  context:
    selector: permissions[*].'$ref'
    when: added
- provider: jsonPath
  changeSchema: /app-sre/app-1.yml
  jsonPathSelectors:
  - quayRepos[*].teams[*].permissions[?(@.'$ref'=='{{ ctx_file_path }}')]
  context:
    selector: quayRepos[*].teams[*].permissions[*].'$ref'
    when: added
