---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: osde2e

name: ci-ext-osde2e-jobs

description: ''

instance:
  $ref: /dependencies/ci-ext/ci-ext.yml

type: jobs

config:
- project:
    name: osd-e2e
    label: osd-e2e
    node: osd-e2e
    gh_org: openshift
    gh_repo: osde2e
    quay_org: app-sre
    build_deploy_script_path: "./ci/build_deploy.sh"
    pr_check_script_path: "./ci/pr_check.sh"
    jobs:
    - 'gh-build-master-osd-e2e':
        display_name: build master
    - 'gh-pr-check-osd-e2e':
        display_name: pr-check

- project:
    name: osd-e2e-nightly
    label: osd-e2e
    node: osd-e2e
    gh_org: openshift
    gh_repo: osde2e
    jobs:
    # Periodically test defaults across environments
    - 'gh-run-tests-osd-e2e-{environment}-{version}':
        display_name: "osde2e {environment} {version}"
        environment: "int"
        version: "4.1"
        cron_expression: 'H */4 * * *'
        ci_cmd: 'OSD_ENV={environment} TESTGRID_PREFIX=logs/osd-{environment}-{version} ./ci/run_tests.sh'
    - 'gh-run-tests-osd-e2e-{environment}-{version}':
        display_name: "osde2e {environment} {version}"
        environment: "stage"
        version: "4.1"
        cron_expression: 'H */4 * * *'
        ci_cmd: 'OSD_ENV={environment} TESTGRID_PREFIX=logs/osd-{environment}-{version} ./ci/run_tests.sh'
    - 'gh-run-tests-osd-e2e-{environment}-{version}':
        display_name: "osde2e {environment} {version}"
        environment: "prod"
        version: "4.1"
        cron_expression: 'H */4 * * *'
        ci_cmd: 'OSD_ENV={environment} TESTGRID_PREFIX=logs/osd-{environment}-{version} ./ci/run_tests.sh'

    # Test upgrades as new versions to target appear
    - 'gh-run-tests-osd-e2e-{environment}-{version}':
        display_name: "osde2e upgrade {environment} {version}"
        environment: "stage"
        version: "4.1-4.1"
        cron_expression: 'H/15 * * * *'
        ci_cmd: 'OSD_ENV={environment} UPGRADE_RELEASE_STREAM=4-stable TESTGRID_PREFIX=logs/osd-upgrade-{environment}-{version} ./ci/upgrade_events.sh'
    - 'gh-run-tests-osd-e2e-{environment}-{version}':
        display_name: "osde2e upgrade {environment} {version}"
        environment: "prod"
        version: "4.1-4.1"
        cron_expression: 'H/15 * * * *'
        ci_cmd: 'OSD_ENV={environment} UPGRADE_RELEASE_STREAM=4-stable TESTGRID_PREFIX=logs/osd-upgrade-{environment}-{version} ./ci/upgrade_events.sh'
