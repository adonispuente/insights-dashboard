---
$schema: /aws/policy-1.yml

labels: {}

account:
  $ref: /aws/osio-dev/account.yml

name: own-resources-full-access
description: |
    Allows a user to manage his own resources (<user_name>* prefix)
    ${aws:username} will be replaced with the actual user name
    ${aws:accountid} will be replaced with the actual account id

policy:
    {
        "Version": "2012-10-17",
        "Statement": [
            {
                "Action": ["dynamodb:*"],
                "Effect": "Allow",
                "Resource": [
                    "arn:aws:dynamodb:*:${aws:accountid}:table/${aws:username}*"
                ]
            },
            {
                "Action": ["rds:*"],
                "Effect": "Allow",
                "Resource": ["arn:aws:rds:*:${aws:accountid}:db:${aws:username}*"]
            },
            {
                "Action": ["rds:Describe*"],
                "Effect": "Allow",
                "Resource": ["*"]
            },
            {
                "Action": ["s3:*"],
                "Effect": "Allow",
                "Resource": "arn:aws:s3:::${aws:username}*"
            },
            {
                "Action": [
                    "s3:ListAllMyBuckets",
                    "s3:GetBucketLocation"
                ],
                "Effect": "Allow",
                "Resource": ["arn:aws:s3:::*"]
            },
            {
                "Action": ["sqs:*"],
                "Effect": "Allow",
                "Resource": "arn:aws:sqs:*:${aws:accountid}:${aws:username}*"
            },
            {
                "Action": [
                    "sns:CreateTopic",
                    "sns:DeleteTopic",
                    "sns:ListSubscriptions",
                    "sns:ListSubscriptionsByTopic",
                    "sns:ListTopics",
                    "sns:Subscribe",
                    "sns:Unsubscribe",
                    "sns:SetTopicAttributes"
                ],
                "Effect": "Allow",
                "Resource": "arn:aws:sns:us-east-1:*:dynamodb"
            },
            {
                "Action": [
                    "elasticmapreduce:RunJobFlow",
                    "elasticmapreduce:TerminateJobFlows"
                ],
                "Effect": "Allow",
                "Resource": "*"
            },
            {
                "Action": ["iam:PassRole"],
                "Effect": "Allow",
                "Resource": [
                    "arn:aws:iam::*:role/EMR_DefaultRole",
                    "arn:aws:iam::*:role/EMR_EC2_DefaultRole"
                ]
            }
        ]
    }
