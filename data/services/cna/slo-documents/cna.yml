---
$schema: /app-sre/slo-document-1.yml

labels:
  service: cna

name: cna

namespaces:
  - $ref: /services/cna/namespaces/stage.yml

slos:
  - name: CNA API Latency
    SLIType: latency
    SLISpecification: Percentage of the requests responded under 1 second.
    SLODetails: https://gitlab.cee.redhat.com/service/app-interface/docs/cna/slos/cna-latency.md
    SLOParameters:
      window: 28d
    expr: |
      (sum(rate(api_inbound_request_duration_bucket{namespace="cna-stage",job="cna-management-api-metrics",le="1",code!~"5.."}[{{window}}]))
      /
      sum(rate(api_inbound_request_duration_count{namespace="cna-stage",job="cna-management-api-metrics",code!~"5.."}[{{window}}])))
    SLOTarget: 0.99
    SLOTargetUnit: percent_0_1
    prometheusRules: /observability/prometheusrules/cna-slo-stage.prometheusrules.yaml
    prometheusRulesTests: /observability/prometheusrules/cna-slo-stage.prometheusrulestests.yaml
    dashboard: https://grafana.stage.devshift.net/d/ZV2cK1PnkFoo/cna-management?orgId=1

  - name: CNA API Availability
    SLIType: availability
    SLISpecification: Percentage of requests that are served successfully (status code != 5xx)
    SLODetails: https://gitlab.cee.redhat.com/service/app-interface/docs/cna/slos/cna-availability.md
    SLOParameters:
      window: 28d
    expr: |
      sum(rate(haproxy_backend_http_responses_total{route="cna-staging",exported_namespace="cna-stage",code!="5xx"}[{{window}}]))
      /
      sum(rate(haproxy_backend_http_responses_total{route="cna-staging",exported_namespace="cna-stage"}[{{window}}]))
    SLOTarget: 0.90
    SLOTargetUnit: percent_0_1
    prometheusRules: /observability/prometheusrules/cna-slo-stage.prometheusrules.yaml
    prometheusRulesTests: /observability/prometheusrules/cna-slo-stage.prometheusrulestests.yaml
    dashboard: https://grafana.stage.devshift.net/d/ZV2cK1PnkFoo/cna-management?orgId=1
