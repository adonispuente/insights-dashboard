---
$schema: /vault-config/policy-1.yml

labels:
  service: vault.devshift.net

name: "app-interface-datahub-policy"
instance:
  $ref: /services/vault.devshift.net/config/instances/devshift-net.yml
rules: |
  path "app-interface/metadata/" {
    capabilities = ["list"]
  }
  path "app-interface/metadata/datahub-psi/" {
    capabilities = ["list"]
  }
  path "app-interface/data/datahub-psi/dh-stage-prometheus-lts/*" {
    capabilities = ["create", "update", "read"]
  }
  path "app-interface/data/datahub-psi/dh-prod-prometheus-lts/*" {
    capabilities = ["create", "update", "read"]
  }
  # The integrations-output secrets are required for the datahub team
  # as they are running a Grafana instance (telemeter-ocp-dashboards)
  # that consume metrics from telemeter.
  # ref: https://issues.redhat.com/browse/APPSRE-3978
  path "app-sre/integrations-output/openshift-serviceaccount-tokens/app-sre-stage-01/telemeter-stage/app-sre-stage-01-telemeter-stage-datahub-prometheus-access" {
    capabilities = ["read", "list"]
  }
  path "app-sre/integrations-output/openshift-serviceaccount-tokens/telemeter-prod-01/telemeter-production/telemeter-prod-01-telemeter-production-datahub-prometheus-access" {
    capabilities = ["read", "list"]
  }

  path "app-sre/integrations-output/terraform-resources/crcp01ue1/compliance-prod/floorist-metrics-exporter-s3-reader" {
    capabilities = ["read", "list"]
  }

  path "app-sre/integrations-output/terraform-resources/crcs02ue1/rhsm-stage/rhsm-subscriptions-egress-s3-reader" {
    capabilities = ["read", "list"]
  }

  path "app-sre/integrations-output/terraform-resources/crcp01ue1/rhsm-prod/rhsm-subscriptions-egress-s3-reader" {
    capabilities = ["read", "list"]
  }
