---
$schema: /vault-config/policy-1.yml

labels:
  service: vault.devshift.net

name: "image-builder-policy"
instance:
  $ref: /services/vault.devshift.net/config/prod/devshift-net.yml
rules: |
  # image-builder crc
  path "insights/*" {
    capabilities = ["list"]
  }
  path "insights/data/secrets/insights-prod/image-builder-prod/*" {
    capabilities = ["create", "read", "update"]
  }
  path "insights/data/secrets/insights-stage/image-builder-stage/*" {
    capabilities = ["create", "read", "update"]
  }
  path "insights/data/secrets/insights-stage/osbuild-composer-stage/*" {
    capabilities = ["create", "read", "update", "delete"]
  }

  # image-builder composer
  path "app-interface/metadata/image-builder/" {
    capabilities = ["list"]
  }
  ## stage
  path "app-interface/metadata/image-builder/stage/*" {
    capabilities = ["list", "read"]
  }
  path "app-interface/data/image-builder/stage/*" {
    capabilities = ["create", "update", "read"]
  }
  ## production
  path "app-interface/metadata/image-builder/production/*" {
    capabilities = ["list", "read"]
  }
  path "app-interface/data/image-builder/production/*" {
    capabilities = ["list", "read"]
  }

  # image-builder ci v1 engine
  path "image-builder-ci/*" {
    capabilities = ["create", "read", "update", "delete", "list"]
  }
