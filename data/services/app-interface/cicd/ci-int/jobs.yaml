---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: app-interface

name: ci-int-app-interface-jobs

description: ''

app:
  $ref: /services/app-interface/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
- project:
    name: app-interface
    label: app-interface
    node: app-interface
    gl_group: service
    gl_project: app-interface
    environment: production
    jobs:
    - 'gl-build-master-app-interface':
        display_name: build master - deploy to prod only
        build_deploy_script_path: ./hack/build_deploy.sh
        job_type: ''
        slack_channel_notification: sd-app-sre-reconcile
    - 'gl-build-master-app-interface':
        node: app-interface-long-running
        display_name: build master - deploy to stage only
        build_deploy_script_path: ./hack/build_deploy.sh
        environment: stage
        job_type: -deploy-stage-only
        slack_channel_notification: sd-app-sre-reconcile-stage
    - 'gl-pr-check-app-interface':
        display_name: schema validator pr-check
        concurrent_build: true
        pr_check_script_path: ./hack/pr_check.sh
    - 'gl-periodic-job-app-interface':
        node: app-interface-long-running
        display_name: periodic integrations
        job_type: periodic-integrations
        ci_cmd: ./hack/periodic_job.sh
        cron_expression: 'H/5 * * * *'
    - 'gl-periodic-job-app-interface':
        node: app-interface-long-running
        display_name: periodic openshift-saas-deploy dry-run
        job_type: openshift-saas-deploy-dry-run
        ci_cmd: ./hack/periodic_saas_deploy_dry_run.sh
        cron_expression: 'H H * * *'
    - 'gl-periodic-job-app-interface':
        node: app-interface-long-running
        display_name: periodic e2e tests
        job_type: e2e-tests
        ci_cmd: ./hack/e2e_tests.sh
        cron_expression: 'H 10 * * *'
        timeout: 120
    - 'gl-periodic-job-app-interface':
        node: app-interface-long-running
        display_name: app-interface-reporter
        job_type: app-interface-reporter
        ci_cmd: ./hack/app-interface-reporter.sh
        cron_expression: 'H 1 1 * *'
    - 'qontract-reconcile-with-upstream':
        display_name: qontract-reconcile openshift-saas-deploy-trigger-configs
        job_type: trigger-configs
        integrations: openshift-saas-deploy-trigger-configs
        upstream: service-app-interface-gl-build-master
        concurrent_build: true
    - 'qontract-reconcile-timed':
        display_name: qontract-reconcile openshift-saas-deploy-trigger-moving-commits
        job_type: trigger-moving-commits
        integrations: openshift-saas-deploy-trigger-moving-commits
        cron_expression: '* * * * *'
    - 'qontract-reconcile-timed':
        display_name: qontract-reconcile gitlab-housekeeping
        job_type: gitlab-housekeeping
        integrations: gitlab-housekeeping
        cron_expression: '* * * * *'
        options: '--wait-for-pipeline'
    - 'qontract-reconcile-timed':
        display_name: qontract-reconcile slack-usergroups
        job_type: slack-usergroups
        integrations: slack-usergroups
        cron_expression: 'H/5 * * * *'
        qontract_reconcile_image_tag: 780b0fe
    - 'qontract-reconcile-timed':
        display_name: qontract-reconcile openshift-serviceaccount-tokens
        job_type: openshift-serviceaccount-tokens
        integrations: openshift-serviceaccount-tokens
        options: '--vault-output-path app-sre/integrations-output'
        cron_expression: 'H/5 * * * *'
    - 'qontract-reconcile-timed':
        display_name: qontract-reconcile jenkins-job-builder
        job_type: jenkins-job-builder
        integrations: jenkins-job-builder jenkins-job-cleaner
        cron_expression: 'H/5 * * * *'
    - 'qontract-reconcile-timed':
        display_name: qontract-reconcile gitlab-owners
        job_type: gitlab-owners
        integrations: gitlab-owners
        cron_expression: 'H/5 * * * *'

- project:
    name: qontract-api
    label: app-interface
    node: app-interface
    gl_group: service
    gl_project: qontract-api
    quay_org: app-sre
    jobs:
    - 'gl-build-master':
        display_name: qontract-api build master
    - 'gl-pr-check':
        display_name: qontract-api pr-check
