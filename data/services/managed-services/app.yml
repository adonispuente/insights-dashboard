---
$schema: /app-sre/app-1.yml

labels:
  service: managed-services

name: managed-services

description: |
  Allow different customer types (Tire Kicker, Value Prod and Enterprise) to create instances of a Red Hat managed service. Includes the service API and build/deployment pipelines for managed services.

onboardingStatus: InProgress

parentApp:
  $ref: /services/ocm/app.yml

serviceOwners:
  - name: Managed Services CI/CD
    email: mk-ci-cd@redhat.com
  - name: Managed Kafka - Service API Team
    email: mk-service-api@redhat.com
  - name: Managed Kafka - Consoles & DevExp
    email: mas-devexp@redhat.com

performanceParameters:
  SLO: 90

dependencies:
  - $ref: /dependencies/ci-int/service.yml
  - $ref: /dependencies/gitlab/service.yml
  - $ref: /dependencies/quay/service.yml
  - $ref: /dependencies/openshift/service.yml
  - $ref: /dependencies/aws/service.yml
  - $ref: /dependencies/github/service.yml

codeComponents:
  - name: strimzi-operator
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-operator
  - name: apache-kafka
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/apache-kafka
  - name: strimzi-operator-bundle
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-operator-bundle
  - name: kas-fleetshard
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-fleetshard
  - name: kas-fleet-manager
    resource: upstream
    url: https://gitlab.cee.redhat.com/service/managed-services-api
    gitlabRepoOwners: true
    gitlabHousekeeping:
      enabled: true
      rebase: true
  - name: mk-performance-tests
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-bin-packing/mk-performance-tests
  - name: mk-ci-tools
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/mk-ci-tools
    gitlabRepoOwners: true
    gitlabHousekeeping:
      enabled: true
      rebase: true
  - name: kafka-monitoring-stuff
    resource: upstream
    url: https://github.com/RHCloudServices/kafka-monitoring-stuff
  - name: kafka-ui
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/kafka-ui
  - name: kas-ui
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-ui
  - name: guides
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/guides
  - name: application-services-ui
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/application-services-ui
  - name: mk-e2e-test-suite
    resource: upstream
    url: https://gitlab.cee.redhat.com/mk-ci-cd/mk-e2e-test-suite

quayRepos:
  - org:
      $ref: /dependencies/quay/app-sre.yml
    teams:
    - permissions:
      - $ref: /dependencies/quay/permissions/quay-membership-app-sre-managed-services.yml
      role: read
    # TODO: move these images to the RHOAS org
    items:
      - name: managed-kafka-kafka
        description: "Kafka image for managed kafka"
        public: false
      - name: managed-kafka-jmxtrans
        description: "JMXTrans image for managed kafka"
        public: false
      - name: managed-kafka-base
        description: "Base image for managed kafka"
        public: false
      - name: managed-kafka-test-client
        description: "Test client image for managed kafka"
        public: false
      # This should be "kas-fleet-manager" but we held renaming for now to avoid loosing existing images.
      # See https://gitlab.cee.redhat.com/service/app-interface/-/merge_requests/14437#note_2097737 for more details.
      - name: managed-services-api
        description: "The Kafka Service Fleet Manager allows different customer types (Tire Kicker, Value Prod and Enterprise) to create instances of a Red Hat managed service"
        public: false
      - name: managed-kafka-strimzi-operator-bundle
        description: "Strimzi operator bundle image for managed kafka (https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-operator-bundle)"
        public: true
      - name: managed-kafka-strimzi-operator-tests
        description: "Image with system tests inside to run them inside Kube clusters"
        public: true
      - name: mk-ci-tools
        description: "CI tools image for managed kafka"
        public: true
      - name: mk-strimzi-operator
        description: "Managed services strimzi operator"
        public: false
      - name: mk-strimzi-ui
        description: Strimzi UI for managed kafka (https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-ui)
        public: false
      - name: mk-ui-frontend
        description: Control Plane UI (https://gitlab.cee.redhat.com/mk-ci-cd/mk-ui-frontend)
        public: false
  - org:
      $ref: /dependencies/quay/managedservices-bf2.yml
    teams:
    - permissions:
      - $ref: /dependencies/quay/permissions/quay-membership-bf2-managed-services.yml
      role: read
    items:
      - name: kas-fleetshard-operator
        description: "Private repo for the kas-fleetshard-operator"
        public: false

  - org:
      $ref: /dependencies/quay/managedservices-rhoas.yml
    teams:
    - permissions:
      - $ref: /dependencies/quay/permissions/quay-membership-rhoas-managed-services.yml
      role: read
    items:
      - name: service-operator
        description: "Service binding operator"
        public: true
      - name: service-operator-bundle
        description: "Operator bundle for the service binding operator"
        public: true
      - name: service-operator-registry
        description: "Operator registry for the service binding operator"
        public: true


sentryProjects:
  - team:
      $ref: /dependencies/sentry/teams/managed-services-stage.yml
    projects:
      - name: managed-services-stage
        description: Kafka Service Fleet Manager Stage
        email_prefix: mk-service-api
        platform: go
        auto_resolve_age: 168
        allowed_domains:
          - "*"

  - team:
      $ref: /dependencies/sentry/teams/managed-services-production.yml
    projects:
      - name: managed-services-prod
        description: Kafka Service Fleet Manager Production
        email_prefix: mk-service-api
        platform: go
        auto_resolve_age: 168
        allowed_domains:
          - "*"
