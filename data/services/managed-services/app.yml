---
$schema: /app-sre/app-1.yml

labels:
  service: managed-services

name: managed-services

description: |
  The Kafka Service Fleet Manager creates and manages a fleet of Kafka instances as part of the Red Hat OpenShift Streams for Apache Kakfa offering.

architectureDocument: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/managed-services
sopsUrl: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/managed-services/sop
grafanaUrls:
- title: Kas Fleet Manager Metrics
  url: https://grafana.app-sre.devshift.net/d/WLBv_KuMz/kas-fleet-manager-metrics
onboardingStatus: OnBoarded

serviceOwners:
- name: Managed Services CI/CD
  email: mk-ci-cd@redhat.com
- name: Managed Kafka - Control Plane Team
  email: mk-service-api@redhat.com
- name: Managed Kafka - Consoles & DevExp
  email: mas-devexp@redhat.com

serviceNotifications:
- name: Red Hat Outage List
  email: outage-list@redhat.com

escalationPolicy:
  $ref: /teams/managed-services/escalation-policies/kas-fleet-manager.yaml

dependencies:
- $ref: /dependencies/ci-int/service.yml
- $ref: /dependencies/gitlab/service.yml
- $ref: /dependencies/quay/service.yml
- $ref: /dependencies/openshift/service.yml
- $ref: /dependencies/aws/service.yml
- $ref: /dependencies/github/service.yml
- $ref: /dependencies/sso/service.yml

codeComponents:
# Control Plane
- name: kas-fleet-manager
  resource: upstream
  url: https://gitlab.cee.redhat.com/service/kas-fleet-manager
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true
- name: kafka-config-update
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kafka-config-update
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true
- name: kas-fleet-manager-perf-tests
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-fleet-manager-perf-tests
- name: token-refresher
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/mk-token-refresher
- name: observability-operator
  resource: upstream
  url: https://gitlab.cee.redhat.com/rhosak-midstream/observability-operator
- name: grafana-operator
  resource: upstream
  url: https://gitlab.cee.redhat.com/rhosak-midstream/grafana-operator
- name: notification-payloads
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/notification-payloads
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true
# Kafka Fleet Services
- name: strimzi-operator
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-operator
- name: strimzi-operator-bundle
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-operator-bundle
- name: kas-fleetshard
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-fleetshard
- name: strimzi-canary
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-canary
- name: kafka-admin-api
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kafka-admin-api
- name: kas-fault-tests
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-fault-tests
# Kafka Fleet Integrations
- name: strimzi-drain-cleaner
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-drain-cleaner
- name: kas-abnormal-workloads
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-abnormal-workloads
- name: apache-kafka
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/apache-kafka
- name: zookeeper
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/zookeeper
# Developer Experience and Consoles
- name: kafka-ui
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kafka-ui
- name: rhosak-ui
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/rhosak-ui
- name: kas-ui
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-ui
- name: kas-ui-gl
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-ui
- name: cli
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/cli
  gitlabHousekeeping:
    enabled: true
    rebase: true
- name: guides
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/guides
- name: application-services-ui
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/application-services-ui
#Running the Service
- name: kafka-monitoring-stuff
  resource: upstream
  url: https://github.com/RHCloudServices/kafka-monitoring-stuff
# Misc
- name: mk-dashboards
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/mk-dashboards
- name: mk-performance-tests
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-bin-packing/mk-performance-tests
- name: mk-ci-tools
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/mk-ci-tools
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true
- name: mk-e2e-test-suite
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/mk-e2e-test-suite
- name: kas-upgrade-configurations
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/kas-upgrade-configurations
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true
- name: managed-kafka-versions
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/managed-kafka-versions
# Used?
- name: mk-client-examples
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/client-examples
- name: must-gather
  resource: upstream
  url: https://gitlab.cee.redhat.com/mk-ci-cd/must-gather

quayRepos:
- org:
    $ref: /dependencies/quay/app-sre.yml
  teams:
  - permissions:
    - $ref: /dependencies/quay/permissions/quay-membership-app-sre-managed-services.yml
    role: read
    # TODO: move these images to the RHOAS org
  items:
      # This should be "kas-fleet-manager" but we held renaming for now to avoid loosing existing images.
      # See https://gitlab.cee.redhat.com/service/app-interface/-/merge_requests/14437#note_2097737 for more details.
  - name: managed-services-api
    description: The Kafka Service Fleet Manager allows different customer types (Tire
      Kicker, Value Prod and Enterprise) to create instances of a Red Hat managed
      service
    public: false
  - name: managed-kafka-strimzi-operator-bundle
    description: Strimzi operator bundle image for managed kafka (https://gitlab.cee.redhat.com/mk-ci-cd/strimzi-operator-bundle)
    public: true
  - name: managed-kafka-strimzi-operator-tests
    description: Image with system tests inside to run them inside Kube clusters
    public: true
  - name: mk-ci-tools
    description: CI tools image for managed kafka
    public: true
  - name: mk-strimzi-operator
    description: Managed services strimzi operator
    public: false
  - name: kas-abnormal-workloads-jvm
    description: JVM application to simulate kafka client workloads
    public: false
  - name: kas-abnormal-workloads-py
    description: Python kafka clients to simulate abnormal workloads
    public: false

- org:
    $ref: /dependencies/quay/managedservices-bf2.yml
  teams:
  - permissions:
    - $ref: /dependencies/quay/permissions/quay-membership-bf2-managed-services.yml
    role: read
  items:
  - name: kafka-admin-api
    description: Private repo for the Kafka Admin Server
    public: false
  - name: kas-fleetshard-operator
    description: Private repo for the kas-fleetshard-operator
    public: false
  - name: kas-fleetshard-sync
    description: Private repo for the kas-fleetshard-sync
    public: false
  - name: openmessaging-benchmark
    description: Repository Open Messaging Benchmark(omb)
    public: true
  - name: observability-operator
    description: Private repo for the observability-operator
    public: true
  - name: observability-operator-bundle
    description: OLM bundle of the observability-operator
    public: true
  - name: observability-operator-index
    description: OLM index of the observability-operator
    public: true
  - name: kas-fleet-manager
    description: The Kafka Service Fleet Manager allows different customer types (Tire
      Kicker, Value Prod and Enterprise) to create instances of a Red Hat managed
      service
    public: true

- org:
    $ref: /dependencies/quay/managedservices-rhoas.yml
  teams:
  - permissions:
    - $ref: /dependencies/quay/permissions/quay-membership-rhoas-managed-services.yml
    - $ref: /dependencies/quay/permissions/quay-membership-rhoas-app-sre.yml
    - $ref: /dependencies/quay/permissions/quay-membership-rhoas-cs-sre.yml
    - $ref: /dependencies/quay/permissions/quay-membership-rhoas-mt-sre.yml
    role: read
  items:
  - name: rhoas-quarkus-kafka-quickstart
    description: Quickstart for RHOAS Kafka including SBO
    public: true
  - name: service-operator
    description: Service binding operator
    public: true
  - name: service-operator-bundle
    description: Operator bundle for the service binding operator
    public: true
  - name: service-operator-registry
    description: Operator registry for the service binding operator
    public: true
  - name: kas-fleet-manager-locust
    description: kas-fleet-manager-locust image for the performance test
    public: true
  - name: kas-fleet-manager-token-refresh
    description: kas-fleet-manager-token-refresh image for the performance test
    public: true
  - name: kas-fleet-manager-perf-results
    description: kas-fleet-manager-perf-results image used to process perf test results
    public: true
  - name: kas-fleet-manager-perf-test-backup
    description: kas-fleet-manager-perf-test backup cronjob image
    public: true
  - name: kas-fleet-manager
    description: The Kafka Service Fleet Manager allows different customer types (Tire
      Kicker, Value Prod and Enterprise) to create instances of a Red Hat managed
      service
    public: false
  - name: envoyproxy
    description: Temporary mirror of envoyproxy. This will be deprecated in favor
      of r.r.i/openshift-service-mesh/proxyv2-rhel8
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/envoyproxy.yml
  - name: observability-operator
    description: Public repo for the observability-operator
    public: true
  - name: observability-operator-bundle
    description: OLM bundle of the observability-operator
    public: true
  - name: observability-operator-index
    description: OLM index of the observability-operator
    public: true
  - name: grafana-operator
    description: Public repo for the grafana-operator
    public: true
  - name: grafana-operator-bundle
    description: OLM bundle of the grafana-operator
    public: true
  - name: grafana-operator-index
    description: OLM index of the grafana-operator
    public: true
  - name: kafka-admin-api
    description: Private repo for the Kafka Admin Server
    public: false
  - name: kas-fleetshard-operator
    description: Private repo for the kas-fleetshard-operator
    public: false
  - name: kas-fleetshard-sync
    description: Private repo for the kas-fleetshard-sync
    public: false
  - name: strimzi-drain-cleaner
    description: Private repo for the Strimzi Drain Cleaner
    public: false
  - name: application-services-ui
    description: Private repo for the application-services-ui
    public: false
  - name: application-services-ui-frontend-container
    description: Private repo for the application-services-ui containerized frontend build
    public: true
  - name: kas-ui
    description: Private repo for the kas-ui
    public: false
  - name: kas-ui-frontend-container
    description: Repo for the kas ui frontend container
    public: true
  - name: kafka-ui
    description: Private repo for the kafka-ui
    public: false
  - name: rhosak-ui
    description: Private repo for the rhosak-ui, that supersedes kas-ui and kafka-ui
    public: false
  - name: guides
    description: Private repo for the guides
    public: false
  - name: mk-token-refresher
    description: Helper image that fetches and refreshes OAuth2 tokens via OIDC
    public: true
  - name: must-gather
    description: Must gather image for managed-kafka
    public: true
  - name: tools
    description: Image containing RHOAS CLI, kcat and other useful client tools 
    public: true
  - name: kafka-avro-schema-quickstart
    description: Avro Service Binding Quickstart
    public: true
  - name: observability-resources-mk
    description: Observability resources for Managed Kafka Service
    public: false

sentryProjects:
- team:
    $ref: /dependencies/sentry/teams/managed-services-stage.yml
  projects:
  - name: managed-services-stage
    description: Kafka Service Fleet Manager Stage
    email_prefix: mk-service-api
    platform: go
    auto_resolve_age: 168
    allowed_domains:
    - '*'

- team:
    $ref: /dependencies/sentry/teams/managed-services-production.yml
  projects:
  - name: managed-services-prod
    description: Kafka Service Fleet Manager Production
    email_prefix: mk-service-api
    platform: go
    auto_resolve_age: 168
    allowed_domains:
    - '*'
