---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: managed-services

name: ci-int-managed-services-jobs

description: ''

app:
  $ref: /services/managed-services/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
  - project:
      name: mk-strimzi-operator-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: strimzi-operator
      quay_org: app-sre
      jobs:
        - 'managed-services-security-scan':
            display_name: mk-strimzi-operator security-scan
            branch: mk-master
            ci_cmd: 'make scan_project'
            slack_channel_notification: mk-ci-cd
            cron_expression: 'H 6 * * *'

  - project:
      name: mk-apache-kafka-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: apache-kafka
      quay_org: app-sre
      jobs:
        - 'managed-services-security-scan':
            display_name: mk-apache-kafka security-scan
            branch: mk-release
            ci_cmd: 'make scan_project'
            slack_channel_notification: mk-ci-cd
            cron_expression: 'H 6 * * *'

  - project:
      name: mk-kafka-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: kafka-ui
      jobs:
        - 'gl-pr-check':
            display_name: mk-kafka-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: mk-kafka-ui build-mk-release

  - project:
      name: guides-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: guides
      jobs:
        - 'gl-pr-check':
            display_name: guides pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: guides build-mk-release

  - project:
      name: cli-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: cli
      jobs:
        - 'gl-pr-check':
            display_name: cli pr-check
            concurrent_build: true
            pr_check_script_path: './hack/pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: cli build-main
            branch: main
            build_deploy_script_path: './hack/build_deploy.sh'

  - project:
      name: kas-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: kas-ui
      jobs:
        - 'gl-pr-check':
            display_name: kas-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: kas-ui build-mk-release

  - project:
      name: srs-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: srs-ui
      jobs:
        - 'gl-pr-check':
            display_name: srs-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: srs-ui build-mk-release

  - project:
      name: sr-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: sr-ui
      jobs:
        - 'gl-pr-check':
            display_name: sr-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: sr-ui build-mk-release

  - project:
      name: application-services-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: application-services-ui
      jobs:
        - 'gl-pr-check':
            display_name: application-services-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: application-services-ui build-mk-release        
        #- 'gl-pr-check-managed-services-frontend':
        #    pr_check_script_path: './build/pr_check.sh'
        #    display_name: application-services-ui-frontend pr-check
        #    branch: mas-fe-containerization
        #- 'gl-build-master-managed-services-frontend':
        #    build_deploy_script_path: './build/publish-image.sh'
        #    display_name: application-services-ui-frontend publish-image
        #    branch: mas-fe-containerization

  - project:
      name: kas-fleet-manager
      label: kas-fleet-manager
      node: managed-services
      gl_group: service
      gl_project: kas-fleet-manager
      jobs:
        - 'gl-pr-check-kas-fleet-manager':
            display_name: kas-fleet-manager pr-check
            slack_channel_notification: mk-kas-fleet-manager
            concurrent_build: true
        - 'gl-build-main-kas-fleet-manager':
            display_name: kas-fleet-manager build main
            slack_channel_notification: mk-kas-fleet-manager
            branch: main
        - 'kas-fleet-manager-tests':
            display_name: KasFleetManager Tests periodic stage
            timeout: 360
            disable: true
            cron_expression: 'H 8 * * 1-5' # ~8am UTC Monday to Friday
            ci_cmd: './pr_check.sh'
            slack_channel_notification: mk-kas-fleet-manager
            branch: main

  - project:
      name: kas-fleet-manager-perf-tests
      label: kas-fleet-manager
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: kas-fleet-manager-perf-tests
      jobs:
        - 'kas-fleet-manager-perf-test':
            branch: main
            display_name: kas-fleet-manager API perf test
            timeout: 120
            disable: true
            slack_channel_notification: mk-kas-fleet-manager
            cron_expression: 'H 7 * * 2-5' # ~7am UTC Tuesday to Friday


  - project:
      name: kafka-config-update
      label: kas-fleet-manager
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: kafka-config-update
      jobs:
        - 'gl-pr-check-kafka-config-update':
            display_name: kafka-config-update pr-check
            pr_check_script_path: './pr_check/pr_check.sh'
        - 'gl-build-master-kafka-config-update':
            branch: main
            display_name: kafka config update
            build_deploy_script_path: './run.sh'
            slack_channel_notification: mk-kas-fleet-manager
            timeout: 300

  - project:
      name: managed-services-kafka-performance-tests
      label: managed-services
      node: managed-services
      gl_group: mk-bin-packing
      gl_project: mk-performance-tests
      jobs:
        - 'managed-kafka-performance':
            display_name: 'managed-kafka-performance'
            mk_perf_type: 'value-prod'
            mk_perf_test: 'io.kafka.performance.**'
            timeout: 360
            slack_channel_notification: mk-ci-cd

  - project:
      name: managed-service-ci-tools
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: mk-ci-tools
      jobs:
        - 'gl-pr-check':
            display_name: managed-service-ci-tools pr-check
            pr_check_script_path: './hack/pr_check.sh'
            timeout: 120
        - 'gl-build-master':
            display_name: managed-service-ci-tools build master
            build_deploy_script_path: './hack/build_deploy.sh'
            timeout: 120
        - 'gl-build-master':
            branch: kas-master
            display_name: managed-service-ci-tools build kas-master
            build_deploy_script_path: './hack/build_deploy.sh'
            timeout: 120
        - 'managed-services-pull-upstream':
            display_name: managed services pull upstream
            ci_cmd: 'make pull/upstream/all'
            slack_channel_notification: mk-ci-cd
            cron_expression: '0 */1 * * *' # Every 1h
            disable: false
        - 'managed-services-merge-pulled-upstreams':
            display_name: managed services merge pulled upstreams
            ci_cmd: 'make pull/upstream/merge'
            slack_channel_notification: mk-ci-cd
            cron_expression: '*/15 * * * *' # Every 15 minutes
            disable: false
        - 'managed-services-promote-ui':
            ui: app-services-ui
            display_name: managed-{ui} promote ui components
            repositories: 'https://github.com/RedHatInsights/rhosak-dashboard-build'
            from_branches: 'qa-beta;qa-stable'
            to_branches: 'prod-beta;prod-stable'
            reportportal_project: 'RHOSAK'
            reportportal_launch: 'consoledot-e2e-stage'
            timeout: 120
            cron_expression: '0 0 1 ? * MON-FRI *' # At 01:00 every week day
            skip_gate: false
            dry_run: false
        - 'managed-services-promote-ui':
            ui: kafka
            display_name: managed-{ui} promote ui components
            repositories: 'https://github.com/RedHatInsights/rhosak-control-plane-ui-build;https://github.com/RedHatInsights/rhosak-data-plane-ui-build'
            from_branches: 'qa-beta;qa-stable'
            to_branches: 'prod-beta;prod-stable'
            reportportal_project: 'RHOSAK'
            reportportal_launch: 'consoledot-e2e-stage'
            timeout: 120
            skip_gate: false
            dry_run: false
        - 'managed-services-promote-new-ui':
            ui: rhosak
            display_name: managed-{ui} promote ui components
            repository: 'https://github.com/RedHatInsights/rhosak-ui-build'
            reportportal_project: 'RHOSAK'
            reportportal_launch: 'consoledot-e2e-stage-test'
            timeout: 120
            skip_gate: false
            dry_run: true
        - 'managed-services-promote-ui':
            ui: kafka-guides
            display_name: managed-{ui} promote ui components
            repositories: 'https://github.com/RedHatInsights/rhoas-guides-build'
            from_branches: 'qa-beta;qa-stable'
            to_branches: 'prod-beta;prod-stable'
            reportportal_project: 'RHOSAK'
            reportportal_launch: 'consoledot-e2e-stage'
            timeout: 120
            skip_gate: true
            dry_run: false
        - 'managed-services-promote-ui':
            ui: sr
            display_name: managed-{ui} promote ui components
            repositories: 'https://github.com/RedHatInsights/sr-ui-build;https://github.com/RedHatInsights/srs-ui-build'
            from_branches: 'qa-beta;qa-stable'
            to_branches: 'prod-beta;prod-stable'
            reportportal_project: 'RHOSR'
            reportportal_launch: 'sr-ui-e2e-test-suite-stage'
            timeout: 120
            skip_gate: false
            dry_run: true
        - 'managed-services-promote-ui':
            ui: ad
            display_name: managed-{ui} promote ui components
            repositories: 'https://github.com/RedHatInsights/ads-ui-build;https://github.com/RedHatInsights/ads-editors-build'
            from_branches: 'qa-beta;qa-stable'
            to_branches: 'prod-beta;prod-stable'
            reportportal_project: 'RHOAD'
            reportportal_launch: 'ad-ui-e2e-test-suite-stage'
            timeout: 120
            skip_gate: false
            dry_run: true
        - 'managed-services-promote-ui':
            ui: cos
            display_name: managed-{ui} promote ui components
            repositories: 'https://github.com/RedHatInsights/cos-ui-build;https://github.com/RedHatInsights/dbz-ui-build'
            from_branches: 'qa-beta;qa-stable'
            to_branches: 'prod-beta;prod-stable'
            reportportal_project: 'RHOC'
            reportportal_launch: 'cos-ui-e2e-test-suite-stage'
            timeout: 120
            skip_gate: false
            dry_run: true
        - 'managed-services-pull-upstream-tag':
            display_name: managed services pull upstream tag
            ci_cmd: 'make pull/upstream/tag'
        - 'managed-services-prepare-cpaas-pipelines':
            display_name: managed services prepare cpaas pipelines
            ci_cmd: 'make prepare/cpaas/pipelines'
        - 'managed-services-patch-latest-midstream':
            display_name: managed services patch latest midstream
            ci_cmd: 'make patch/latest/midstream'

  - project:
      name: mk-e2e-test-suite
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: mk-e2e-test-suite
      jobs:
        - 'gl-pr-check':
            display_name: mk-e2e-test-suite pr-check
            pr_check_script_path: './pr_check.sh'

  - project:
      name: kas-upgrade-configurations
      label: kas-upgrade-configurations
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: kas-upgrade-configurations
      jobs:
        - 'gl-pr-check-kas-upgrade-configurations':
            display_name: kas-upgrade-configurations pr-check
            pr_check_script_path: './hack/pr_check.sh'
        - 'gl-build-main-kas-upgrade-configurations':
            display_name: kas-upgrade-configurations deploy
            build_deploy_script_path: './hack/deploy.sh'
            branch: main

  - project:
      name: mk-token-refresher
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: mk-token-refresher
      jobs:
        - 'gl-pr-check':
            display_name: mk-token-refresher pr-check
            pr_check_script_path: './ci-cd/pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: mk-token-refresher build master
            build_deploy_script_path: './ci-cd/build_deploy.sh'
            branch: master

  - project:
      name: mk-dashboards
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: mk-dashboards
      jobs:
        - 'gl-pr-check':
            display_name: mk-dashboards pr-check
            pr_check_script_path: './pr_check.sh'

  - project:
      name: mk-observability-operator
      label: managed-services
      node: managed-services
      gl_group: rhosak-midstream
      gl_project: observability-operator
      jobs:
        - 'gl-pr-check':
            display_name: mk-observability-operator pr-check
            pr_check_script_path: './pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: mk-observability-operator build master
            build_deploy_script_path: './build_deploy.sh'
            branch: main

  - project:
      name: mk-grafana-operator
      label: managed-services
      node: managed-services
      gl_group: rhosak-midstream
      gl_project: grafana-operator
      jobs:
        - 'gl-pr-check':
            display_name: mk-grafana-operator pr-check
            pr_check_script_path: './pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: mk-grafana-operator build master
            build_deploy_script_path: './build_deploy.sh'
            branch: v3-midstream

  - project:
      name: observability-resources-mk
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: observability-resources-mk
      jobs:
        - 'gl-pr-check':
            display_name: observability-resources-mk pr-check
            pr_check_script_path: './pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: observability-resources-mk build master
            build_deploy_script_path: './build_deploy.sh'
            branch: main
  - project:
      name: observability-remote-write-proxy
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: observability-remote-write-proxy
      jobs:
        - 'gl-pr-check':
            display_name: observability-remote-write-proxy pr-check
            pr_check_script_path: './pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: observability-remote-write-proxy build master
            build_deploy_script_path: './build_deploy.sh'
            branch: main

  - project:
      name: debezium-mcs
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: debezium-mcs
      jobs:
        - 'gl-build-master-managed-services':
            display_name: debezium-mcs build
            build_deploy_script_path: './build_deploy.sh'
            branch: main
  - project:
      name: mk-client-examples
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: client-examples
      jobs:
        - 'gl-pr-check':
            display_name: mk-client-examples pr-check
            pr_check_script_path: './pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: mk-client-examples build mk-release-0.23.x
            build_deploy_script_path: './build_deploy.sh'
            branch: mk-release-0.23.x
  - project:
      name: kas-abnormal-workloads
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: kas-abnormal-workloads
      quay_org: app-sre
      jobs:
        - 'gl-pr-check':
            display_name: kas-abnormal-workloads pr-check
            pr_check_script_path: './pipeline/pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: kas-abnormal-workloads build mk-main
            build_deploy_script_path: './pipeline/build.sh'
            branch: mk-main
        - 'managed-kafka-client-workloads':
            display_name: kas-abnormal-workloads deploy
            default_branch: mk-main
            timeout: 3600
            env: stage
  - project:
      name: mk-strimzi-drain-cleaner
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: strimzi-drain-cleaner
      jobs:
        - 'gl-pr-check':
            display_name: mk-strimzi-drain-cleaner pr-check
            pr_check_script_path: './cicd/pr_check.sh'
        - 'managed-services-gl-build-test-branch':
            display_name: mk-strimzi-drain-cleaner build mk-main
            branch: mk-main
            build_deploy_script_path: './cicd/build.sh'
            archive_artifacts: 'target/surefire-reports/**'
            junit_results: 'target/surefire-reports/*.xml'
            cleanup_script: './cicd/build.sh cleanup'
            release: false
        - 'managed-services-gl-build-test-branch':
            display_name: mk-strimzi-drain-cleaner build mk-release-0.2
            branch: mk-release-0.2
            build_deploy_script_path: './cicd/build.sh'
            archive_artifacts: 'target/surefire-reports/**'
            junit_results: 'target/surefire-reports/*.xml'
            cleanup_script: './cicd/build.sh cleanup'
            release: true

  - project:
      name: mk-must-gather
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: must-gather
      jobs:
        - 'gl-pr-check':
            display_name: mk-must-gather pr-check
            pr_check_script_path: './ci/pr_check.sh'
        - 'gl-build-master-managed-services':
            display_name: mk-must-gather build master
            build_deploy_script_path: './ci/build_deploy.sh'
            branch: master

  - project:
      name: cos-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: cos-ui
      jobs:
        - 'gl-pr-check':
            display_name: cos-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: cos-ui build-mk-release

  - project:
      name: zookeeper
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: zookeeper
      jobs:
        - 'gl-pr-check':
            display_name: zookeeper pr-check
            pr_check_script_path: './cicd/pr_check.sh'

  - project:
      name: debezium-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: cos-debezium-ui
      jobs:
        - 'gl-pr-check':
            display_name: cos-debezium-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: cos-debezium-ui build-mk-release

  - project:
      name: rhosak-ui-midstream
      label: managed-services
      node: managed-services
      gl_group: mk-ci-cd
      gl_project: rhosak-ui
      jobs:
        - 'gl-pr-check':
            display_name: rhosak-ui pr-check
            concurrent_build: true
        - 'gl-build-master-managed-services':
            branch: mk-release
            display_name: rhosak-ui build-mk-release
        - 'gl-build-master-managed-services-frontend':
            build_deploy_script_path: './build_deploy.sh'
            display_name: rhosak-ui build-mk-release-beta
            branch: mk-release-beta
        #- 'gl-pr-check-managed-services-frontend':
        #    pr_check_script_path: './build/pr_check.sh'
        #    display_name: rhosak-ui pr-check-new-fe-pipeline
        #    branch: new-fe-pipeline
        #- 'gl-build-master-managed-services-frontend':
        #    build_deploy_script_path: './deploy/build_deploy.sh'
        #    display_name: rhosak-ui build-new-fe-pipeline
        #    branch: new-fe-pipeline

  - project:
      name: seats-admin-midstream
      label: ciam
      node: managed-services
      gl_group: ciam
      gl_project: seats-admin
      jobs:
        - 'gl-pr-check':
            display_name: seats-admin pr-check
            concurrent_build: true
            pr_check_script_path: './build/verify_build.sh'
        - 'gl-build-master-managed-services':
            branch: release
            display_name: seats-admin build-branch-release
            build_deploy_script_path: './build/verify_build.sh'
        - 'gl-build-master-managed-services-frontend':
            branch: release-beta
            display_name: seats-admin build-branch-release-beta
            build_deploy_script_path: './build/verify_build.sh'
        - 'promote-ui':
            display_name: seats-admin promote-ui
            repository: 'https://github.com/RedHatInsights/seats-admin-ui-build'
            reportportal_project: ''
            reportportal_launch: ''
            timeout: 120
            skip_gate: false
            dry_run: true

