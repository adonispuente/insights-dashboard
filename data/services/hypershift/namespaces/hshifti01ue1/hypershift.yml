---
$schema: /openshift/namespace-1.yml

labels: {}

name: hypershift
description: integration namespace for hypershift

cluster:
  $ref: /openshift/hshifti01ue1/cluster.yml

app:
  $ref: /services/hypershift/app.yml

environment:
  $ref: /products/hypershift/environments/integration-hshifti01ue1.yml

managedResourceTypes:
- Secret

openshiftResources:
- provider: resource-template
  type: extracurlyjinja2
  path: /services/hypershift/oidc-s3-creds.yml
  variables:
    cluster: hsservicei01ue1


networkPoliciesAllow:
- $ref: /services/observability/namespaces/openshift-customer-monitoring.hshifti01ue1.yml

managedTerraformResources: true

terraformResources:
- provider: aws-iam-service-account
  account: app-sre-stage
  identifier: hypershift-hshifti01ue1-private-link
  user_policy:
    {
      "Version": "2012-10-17",
      "Statement": [{
        "Action": [
          "sts:AssumeRole"
        ],
        "Effect": "Allow",
        "Resource": "*"
      }]
    }
  output_resource_name: aws-credentials-old
  aws_infrastructure_access:
    cluster:
      $ref: /openshift/hshifti01ue1/cluster.yml
    access_level: network-mgmt
  output_format:
    provider: generic-secret
    data:
      credentials: |
        [profile source-profile]
        aws_access_key_id = {{ aws_access_key_id }}
        aws_secret_access_key = {{ aws_secret_access_key }}

        [default]
        role_arn = {{ role_arn }}
        source_profile = source-profile

managedExternalResources: true

externalResources:
- provider: aws
  provisioner:
    $ref: /aws/app-sre-stage/account.yml
  resources:
  - provider: aws-iam-service-account
    identifier: hypershift-operator-hshifti01ue1-private-link
    user_policy:
      {
        "Version": "2012-10-17",
        "Statement": [{
          "Action": [
            "sts:AssumeRole"
          ],
          "Effect": "Allow",
          "Resource": "*"
        }]
      }
    output_resource_name: aws-credentials
    aws_infrastructure_access:
      cluster:
        $ref: /openshift/hshifti01ue1/cluster.yml
      access_level: network-mgmt
    output_format:
      provider: generic-secret
      data:
        credentials: |
          [profile source-profile]
          aws_access_key_id = {{ aws_access_key_id }}
          aws_secret_access_key = {{ aws_secret_access_key }}

          [default]
          role_arn = {{ role_arn }}
          source_profile = source-profile
