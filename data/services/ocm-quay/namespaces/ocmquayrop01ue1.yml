---
$schema: /openshift/namespace-1.yml

labels:
  service: ocm-quay

name: ocm-quay
description: read-only namespace for ocm-quay

cluster:
  $ref: /openshift/ocmquayrop01ue1/cluster.yml

app:
  $ref: /services/ocm-quay/app.yml

environment:
  $ref: /products/ocm-quay/environments/read-only.yml

networkPoliciesAllow:
- $ref: /services/observability/namespaces/openshift-customer-monitoring.ocmquayrop01ue1.yml

managedRoles: true

managedResourceTypes:
- NetworkPolicy
- Secret

sharedResources:
- $ref: /services/ocm-quay/shared-resources/common.yml

openshiftResources:
- provider: resource-template
  type: extracurlyjinja2
  path: /ocm-quay/ocm-quay-config-with-kinesis.secret.yaml
  variables:
    name: quay-config-secret-readonly
    config_vault_secret_version: 7
    additional_config_vault_secret_version: 8
    ro_additional_config_vault_secret_version: 2
    rw_additional_config_vault_secret_version: 3
    version_label: v1
    readonly: true
    use_backup: false
    ro_instance: true
- provider: resource-template
  type: extracurlyjinja2
  path: /ocm-quay/ocm-quay-config-with-kinesis.secret.yaml
  variables:
    name: quay-config-secret-backup
    config_vault_secret_version: 7
    additional_config_vault_secret_version: 8
    ro_additional_config_vault_secret_version: 2
    rw_additional_config_vault_secret_version: 3
    version_label: v1
    readonly: true
    use_backup: true
    ro_instance: true

managedExternalResources: true

externalResources:
- provider: aws
  provisioner:
    $ref: /aws/ocm-quay/account.yml
  resources:
  - provider: rds
    identifier: ocmquayrop01ue1
    availability_zone: us-east-1a
    defaults: /terraform/resources/ocm-quay/rds-read-replica-us-east-1.yml
    parameter_group: /terraform/resources/ocm-quay/rds-parameter-group-read-replica-1.yml
    replica_source: ocm-quay-production
    overrides:
      apply_immediately: true
