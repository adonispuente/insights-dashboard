---
$schema: /openshift/namespace-1.yml

labels:
  service: ocm-quay

name: ocm-quay
description: read-only namespace for ocm-quay

cluster:
  $ref: /openshift/ocmquayrop01uw2/cluster.yml

app:
  $ref: /services/ocm-quay/app.yml

environment:
  $ref: /products/ocm-quay/environments/read-only.yml

networkPoliciesAllow:
  - $ref: /services/observability/namespaces/openshift-customer-monitoring.ocmquayrop01uw2.yml

managedRoles: true

managedResourceTypes:
  - NetworkPolicy
  - Secret

sharedResources:
  - $ref: /services/ocm-quay/shared-resources/common.yml

openshiftResources:
- provider: resource-template
  type: extracurlyjinja2
  path: /ocm-quay/ocm-quay-config-with-kinesis.secret.yaml
  variables:
    name: quay-config-secret-readonly
    config_vault_secret_version: 7
    additional_config_vault_secret_version: 8
    ro_additional_config_vault_secret_version: 2
    rw_additional_config_vault_secret_version: 3
    version_label: v1
    readonly: true
    use_backup: false
    ro_instance: true
- provider: resource-template
  type: extracurlyjinja2
  path: /ocm-quay/ocm-quay-config-with-kinesis.secret.yaml
  variables:
    name: quay-config-secret-backup
    config_vault_secret_version: 7
    additional_config_vault_secret_version: 8
    ro_additional_config_vault_secret_version: 2
    rw_additional_config_vault_secret_version: 3
    version_label: v1
    readonly: true
    use_backup: true
    ro_instance: true

managedExternalResources: true

externalResources:
- provider: aws
  provisioner:
    $ref: /aws/ocm-quay/account.yml
  resources:
  - provider: rds
    identifier: ocmquayrop01uw2
    availability_zone: us-west-2c
    defaults: /terraform/resources/ocm-quay/rds-read-replica-us-west-2.yml
    parameter_group: /terraform/resources/ocm-quay/rds-parameter-group-read-replica-1.yml
    overrides:
      kms_key_id: ocmquayrop01uw2
      apply_immediately: true
    replica_source: ocm-quay-production
  - provider: kms
    identifier: ocmquayrop01uw2
    region: us-west-2
    defaults: /terraform/resources/ocm-quay/kms-1.yml
    output_resource_name: ocm-quay-kms
