---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: uhc

name: ci-int-uhc-jobs

description: ''

app:
  $ref: /services/ocm/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
- project:
    name: uhc-clusters-service
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-clusters-service
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'ocm-pr-check':
        display_name: UHC clusters service check merge request
        html_publisher_dir: '.'
        concurrent_build: false
    - 'gl-build-master':
        display_name: UHC clusters service build master branch
    - 'gl-build-master':
        display_name: UHC clusters service build hotfix branch
        branch: 'hotfix'

- project:
    name: uhc-integration-tests
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-clusters-service
    jobs:
    - 'uhc-integration-tests':
        display_name: UHC integration tests
        environment: staging
        upstream: service-uhc-clusters-service-gl-build-master

- project:
    name: uhc-gateway
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-gateway
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: OCM gateway check merge request
    - 'gl-build-master':
        display_name: OCM gateway build master branch

- project:
    name: uhc-account-manager
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: uhc-account-manager
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'ocm-pr-check':
        display_name: UHC Account Manager check merge request
        concurrent_build: true
        timeout: 90
    - 'gl-build-master':
        display_name: UHC Account Manager push image
    - 'gl-build-master':
        display_name: UHC Account Manager push hotfix branch image
        branch: 'hotfix'

- project:
    name: uhc-portal
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-portal
    quay_org: app-sre
    jobs:
    - 'ocm-pr-check-selenium':
        display_name: OCM UI check merge request
        concurrent_build: true
    - 'ocm-portal-deploy':
        display_name: OCM UI deploy to qaprodauth.cloud.redhat.com
        mode: staging
        branch: "master"
    - 'ocm-portal-deploy':
        display_name: OCM UI deploy to cloud.redhat.com/beta
        mode: candidate
        branch: "candidate"
    - 'ocm-portal-deploy':
        display_name: OCM UI deploy to cloud.redhat.com (prod-stable)
        mode: stable
        branch: "stable"

- project:
    name: uhc-clusters-cleaner
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: uhc-clusters-cleaner
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: UHC clusters cleaner check merge request
    - 'gl-build-master':
        display_name: UHC clusters cleaner build master

- project:
    name: ocm-resources
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: ocm-resources
    jobs:
    - 'ocm-pr-check':
        display_name: OCM Resources check merge request
    - 'ocm-build-master':
        display_name: OCM Resources run master
        concurrent_build: false
    - 'ocm-build-master-timed-stage':
        display_name: OCM Resources run master timed against stage
        concurrent_build: false
    - 'ocm-build-master-timed-production':
        display_name: OCM Resources run master timed against production
        concurrent_build: false

- project:
    name: api-tests
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: api-tests
    jobs:
    - 'ocm-build-image':
        display_name: API Tests build image
        concurrent_build: false
    - 'ocm-pr-check':
        display_name: API Tests check merge request
        concurrent_build: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic stage
        environment: stage
        tests: 'readonly-single'
        cron_expression: '0 * * * *'
        upstream: openshift-saas-deploy-saas-uhc-account-manager-osd-stage
        ci_cmd: ./periodic_check.sh api-tests-stage https://api.stage.openshift.com 1 1
        disable: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic int
        environment: integration
        tests: 'readonly-single'
        cron_expression: '20 * * * *'
        upstream: openshift-saas-deploy-saas-uhc-account-manager-osd-integration
        ci_cmd: ./periodic_check.sh api-tests-int https://api.integration.openshift.com 1 1
        disable: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic prod
        environment: production
        tests: 'readonly-single'
        cron_expression: '40 * * * *'
        upstream: openshift-saas-deploy-saas-uhc-account-manager-osd-production
        ci_cmd: ./periodic_check.sh api-tests-prod https://api.openshift.com  1 1
        disable: false

- project:
    name: ocm-service-log
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: ocm-service-log
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'ocm-pr-check':
        display_name: OCM service log check merge request
        concurrent_build: true
    - 'gl-build-master':
        display_name: OCM service log build master

- project:
      name: job-queue-service
      label: sd-uhc
      node: sd-service-development-b
      gl_group: service
      gl_project: job-queue-service
      quay_org: app-sre
      backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
      jobs:
      - 'ocm-pr-check':
            display_name: Job Queue Service check merge request
            concurrent_build: true
      - 'gl-build-master':
            display_name: Job Queue Service build master

- project:
    name: ocm-envoy
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: ocm-envoy
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: OCM Envoy check merge request
    - 'gl-build-master':
        display_name: OCM Envoy build image

- project:
    name: ocm-addon-test-operator
    label: sd-uhc
    node: rhel8
    gl_group: service
    gl_project: ocm-addon-test-operator
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: OCM Add-On Test Operator check merge request
    - 'gl-build-master':
        display_name: OCM Add-On Test Operator build image
        concurrent_build: false
