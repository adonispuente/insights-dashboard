---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: uhc

name: ci-int-uhc-jobs

description: ''

app:
  $ref: /services/ocm/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
- project:
    name: uhc-clusters-service
    label: sd-uhc
    node: sd-service-development
    gl_group: service
    gl_project: uhc-clusters-service
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'ocm-pr-check':
        display_name: UHC clusters service check merge request
        html_publisher_dir: '.'
        concurrent_build: false
    - 'gl-build-master':
        display_name: UHC clusters service build master branch
    - 'gl-build-master':
        display_name: UHC clusters service build next branch
        branch: 'next'

- project:
    name: uhc-integration-tests
    label: sd-uhc
    node: sd-uhc
    gl_group: service
    gl_project: uhc-clusters-service
    jobs:
    - 'uhc-integration-tests':
        display_name: UHC integration tests
        environment: staging

- project:
    name: uhc-gateway
    label: sd-uhc
    node: sd-uhc
    gl_group: service
    gl_project: uhc-gateway
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: UHC API gateway check merge request
    - 'gl-build-master':
        display_name: UHC API gateway deploy to staging

- project:
    name: uhc-account-manager
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: uhc-account-manager
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'ocm-pr-check':
        display_name: UHC Account Manager check merge request
        concurrent_build: true
        timeout: 90
    - 'gl-build-master':
        display_name: UHC Account Manager deploy to staging

- project:
    name: uhc-portal
    label: sd-uhc
    node: sd-service-development
    gl_group: service
    gl_project: uhc-portal
    quay_org: app-sre
    jobs:
    - 'ocm-pr-check-selenium':
        display_name: OCM UI check merge request
        # Runs services on fixed ports and container names
        concurrent_build: false
    - 'ocm-portal-deploy':
        display_name: OCM UI deploy to qaprodauth.cloud.redhat.com
        mode: staging
        branch: "master"
    - 'ocm-portal-deploy':
        display_name: OCM UI deploy to cloud.redhat.com/beta
        mode: candidate
        branch: "candidate"
    - 'ocm-portal-deploy':
        display_name: OCM UI deploy to cloud.redhat.com (prod-stable)
        mode: stable
        branch: "stable"

- project:
    name: uhc-apache-exporter
    label: sd-uhc
    node: sd-uhc
    gl_group: service
    gl_project: uhc-apache-exporter
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: UHC apache-exporter check merge request
    - 'gl-build-master':
        display_name: UHC apache-exporter build image

- project:
    name: uhc-portal-redirector
    label: sd-uhc
    node: sd-uhc
    gl_group: service
    gl_project: uhc-portal-redirector
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-build-master':
        display_name: UHC portal redirector deploy to staging

- project:
    name: uhc-clusters-cleaner
    label: sd-uhc
    node: sd-service-development
    gl_group: service
    gl_project: uhc-clusters-cleaner
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'gl-pr-check':
        display_name: UHC clusters cleaner check merge request
    - 'gl-build-master':
        display_name: UHC clusters cleaner build master

- project:
    name: ocm-resources
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: ocm-resources
    jobs:
    - 'ocm-pr-check':
        display_name: OCM Resources check merge request
    - 'ocm-build-master':
        display_name: OCM Resources run master
        concurrent_build: false
    - 'ocm-build-master-timed-stage':
        display_name: OCM Resources run master timed against stage
        concurrent_build: false
    - 'ocm-build-master-timed-production':
        display_name: OCM Resources run master timed against production
        concurrent_build: false

- project:
    name: api-tests
    label: sd-uhc
    node: sd-uhc
    gl_group: service
    gl_project: api-tests
    jobs:
    - 'ocm-build-image':
        display_name: API Tests build image
        concurrent_build: false
    - 'ocm-pr-check':
        display_name: API Tests check merge request
        concurrent_build: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic stage
        environment: stage
        tests: 'readonly-single'
        cron_expression: '0 * * * *'
        ci_cmd: ./periodic_check.sh periodic-readonly-single https://api.stage.openshift.com 1 1
        disable: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic int
        environment: integration
        tests: 'readonly-single'
        cron_expression: '20 * * * *'
        ci_cmd: ./periodic_check.sh periodic-readonly-single https://api-integration.6943.hive-integration.openshiftapps.com  1 1
        disable: false
    - 'ocm-api-tests-timed':
        display_name: API Tests periodic prod
        environment: production
        tests: 'readonly-single'
        cron_expression: '40 * * * *'
        ci_cmd: ./periodic_check.sh periodic-readonly-single https://api.openshift.com  1 1
        disable: false

- project:
    name: ocm-service-log
    label: sd-uhc
    node: sd-service-development-b
    gl_group: service
    gl_project: ocm-service-log
    quay_org: app-sre
    backup_ecr_push_creds_account_region: "app-sre/eu-central-1"
    jobs:
    - 'ocm-pr-check':
        display_name: OCM service log check merge request
        concurrent_build: true
    - 'gl-build-master':
        display_name: OCM service log build master
