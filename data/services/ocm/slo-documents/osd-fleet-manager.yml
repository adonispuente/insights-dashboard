---
$schema: /app-sre/slo-document-1.yml

labels:
  service: osd-fleet-manager

name: osd-fleet-manager

app:
  $ref: /services/ocm/osd-fleet-manager/app.yml

namespaces:
- $ref: /services/ocm/osd-fleet-manager/namespaces/production.yml

slos:
#- name: TODO OSDFM Added Latency TODO
#  SLIType: latency
#  SLISpecification: Availability (measured as the product of errors and latency) has to be met a certain percentafe of the time
#  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/osd-fleet-manager/slos/fleet-manager-added-latency.md
#  SLOParameters:
#    window: 28d
#  expr: TODO
#  SLOTarget: 0.95
#  SLOTargetUnit: percent_0_1
#  prometheusRules: /observability/prometheusrules/osd-fleet-manager-production.prometheusrules.yaml
#  dashboard: /to/do

- name: saturation-level
  SLIType: availability
  SLISpecification: Availability (measured as the product of errors and latency) has to be met a certain percentafe of the time
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/osd-fleet-manager/slos/fleet-manager-saturation.md
  SLOParameters:
    window: 28d
  expr: 
    sum(fleet_manager_management_cluster_hosted_cluster_count{job="fleet-manager-metrics",osd-fleet-manager-production="osd-fleet-manager-production",region="$region"}[{{window}}])
    /
    (
    sum(fleet_manager_available_management_clusters_by_service_cluster_count{region="$region", job="fleet-manager-metrics",osd-fleet-manager-production="osd-fleet-manager-production"}[{{window}}]) 
    *
    sum(fleet_manager_max_desired_hosted_cluster_count{region="$region", job="fleet-manager-metrics",osd-fleet-manager-production="osd-fleet-manager-production"}[{{window}}])
    )
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /observability/prometheusrules/osd-fleet-manager-production.prometheusrules.yaml
  dashboard: /to/do




