---
$schema: /app-sre/saas-file-2.yml
labels:
  service: uhc
name: saas-uhc-clusters-service
description: SaaS tracking file for UHC Clusters service
app:
  $ref: /services/ocm/cs/app.yml
pipelinesProvider:
  $ref: /services/ocm/pipelines/tekton.ocm-pipelines.appsrep05ue1.yaml
slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-uhc-info
managedResourceTypes:
- Deployment
- Service
- Role.rbac.authorization.k8s.io
- RoleBinding.rbac.authorization.k8s.io

imagePatterns:
- quay.io/app-sre/uhc-clusters-service
- quay.io/app-sre/envoyproxy

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all
resourceTemplates:
- name: uhc-clusters-service
  url: https://gitlab.cee.redhat.com/service/uhc-clusters-service
  path: /templates/service-template.yml
  parameters:
    DEMO_MODE: false
    IMAGE_REGISTRY: quay.io
    IMAGE_REPOSITORY: app-sre/uhc-clusters-service
    REPLICAS: 3
    GATEWAY_URL: unix://localhost/sockets/egress.socket
    TELEMETER_URL: ${TELEMETER_BASE_URL}
    TOKEN_URL: ${SSO_BASE_URL}/protocol/openid-connect/token
    JWKS_URL: ${SSO_BASE_URL}/protocol/openid-connect/certs
    VERSION: latest
    DEBUG_PORT: 8081
    MEMORY_REQUEST: 500Mi
    MEMORY_LIMIT: 2Gi
    CPU_REQUEST: 200m
    CPU_LIMIT: '1'
    PROVISION_SHARD_CLUSTER_LIMIT: '700'
  targets:
  - namespace:
      $ref: /services/ocm/namespaces/uhc-integration.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    promotion:
      publish:
      - ocm-cs-deployed-int
    parameters:
      ENVIRONMENT: integration
      GATE_NAME: ocm-cs-int-main
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: ''
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'false'
      USER_DEFINED_DNS_BASE_DOMAIN: 'i1.devshift.org'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: Provision & Uninstallation
  - namespace:
      $ref: /services/ocm/namespaces/xcm-integration.yml
    ref: master
    disable: true
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    promotion:
      publish:
      - xcm-cs-deployed-int
    parameters:
      ENVIRONMENT: integration
      XCM_ID: aws.xcm.integration
      GATE_NAME: xcm-cs-int
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: '1656843667'
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'false'
      USER_DEFINED_DNS_BASE_DOMAIN: 'i1.devshift.org'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: Provision & Uninstallation
  - namespace:
      $ref: /services/ocm/namespaces/uhc-stage.yml
    ref: b0f63794e9f6a6730d646504ab2a48c3650960c1
    promotion:
      auto: true
      subscribe:
      - ocm-cs-deployed-int
      publish:
      - ocm-cs-deployed-stage
    parameters:
      ENVIRONMENT: staging
      GATE_NAME: ocm-cs-stage-main
      LOG_LEVEL: info
      GATEWAY_URL: unix://localhost/sockets/egress.socket
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: ''
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'true'
      USER_DEFINED_DNS_BASE_DOMAIN: 's1.devshift.org'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: ''
      JIRA_PRODUCT: ''
  - namespace:
      $ref: /services/ocm/namespaces/uhc-stage-appsres04ue2.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    parameters:
      ENVIRONMENT: staging
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: ''
      LEADERSHIP_ENABLED: 'false'
      JIRA_PROJECT: SDAINT
      CLUSTER_ERROR_REPORT: 'true'
      USER_DEFINED_DNS_BASE_DOMAIN: 's1.devshift.org'
      JIRA_ISSUE_TYPE: Bug
      JIRA_COMPONENTS: ''
      JIRA_PRODUCT: ''
  - namespace:
      $ref: /services/ocm/namespaces/uhc-production.yml
    ref: 2cf9d130b3d3f278f09aaa98bd9d2f5e06e4a2f1
    promotion:
      publish:
      - ocm-cs-deployed-prod
    parameters:
      ENVIRONMENT: production
      GATE_NAME: ocm-cs-prod-main
      LOG_LEVEL: info
      GODEBUG: http2server=0
      FORCE_MIGRATION: ''
      JIRA_PROJECT: OHSS
      CLUSTER_ERROR_REPORT: 'true'
      USER_DEFINED_DNS_BASE_DOMAIN: 'p1.openshiftapps.com'
      JIRA_ISSUE_TYPE: Incident
      JIRA_COMPONENTS: ''
      JIRA_PRODUCT: ''
  - namespace:
      $ref: /services/ocm/namespaces/uhc-stage-sso-test.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-clusters-service-gl-build-master
    parameters:
      ENVIRONMENT: sso-test
      LOG_LEVEL: info
      DEFAULT_EXPIRATION: 36h
      MAXIMUM_EXPIRATION: 168h
      GODEBUG: ''
      FORCE_MIGRATION: ''
