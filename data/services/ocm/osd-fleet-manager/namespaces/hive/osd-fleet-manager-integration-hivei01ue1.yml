---
$schema: /openshift/namespace-1.yml

labels: {}

name: osd-fleet-manager-integration
description: |
  osd-fleet-manager namespace on hive integration.
  Used to deploy resources on service and/or management clusters with SelectorSyncSets

cluster:
  $ref: /openshift/hivei01ue1/cluster.yml

app:
  $ref: /services/ocm/osd-fleet-manager/app.yml

environment:
  $ref: /products/osdv4/environments/integration-hivei01ue1.yml

managedExternalResources: true

externalResources:
- provider: aws
  provisioner:
    $ref: /aws/app-sre-stage/account.yml
  resources:
  - provider: aws-iam-service-account
    identifier: hypershift-cert-manager-route53-integration
    user_policy:
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "route53:GetChange",
            ],
            "Resource": "arn:aws:route53:::change/*",
          },
          {
            "Effect": "Allow",
            "Action": [
              "route53:ChangeResourceRecordSets",
              "route53:ListResourceRecordSets"
            ],
            "Resource": [
              # i3.devshift.org
              "arn:aws:route53:::hostedzone/Z0943698IMV8KDK5VDM1"
              # Add any other zone below, with proper ending commas
              # "arn:aws:route53:::hostedzone/XXXX"
            ]
          },
          {
            "Effect": "Allow",
            "Action": [
              "route53:ListHostedZonesByName"
            ],
            "Resource": "*"
          }
        ]
      }
    output_resource_name: hypershift-cert-manager-route53

- provider: aws
  provisioner:
    $ref: /aws/app-sre-logs/account.yml
  resources:
  - provider: aws-iam-service-account
    identifier: hypershift-cloudwatch-logging-integration
    output_resource_name: app-sre-logs-cloudwatch-access
    user_policy:
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Action": [
              "logs:CreateLogGroup",
              "logs:CreateLogStream",
              "logs:DescribeLogGroups",
              "logs:DescribeLogStreams",
              "logs:PutLogEvents",
              "logs:GetLogEvents",
              "logs:PutRetentionPolicy",
              "logs:GetLogRecord",
            ],
            "Effect": "Allow",
            "Resource": "arn:aws:logs:*:*:*"
          }
        ]
      }
