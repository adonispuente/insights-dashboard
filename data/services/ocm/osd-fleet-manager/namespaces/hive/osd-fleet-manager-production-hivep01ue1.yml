---
$schema: /openshift/namespace-1.yml

labels: {}

name: osd-fleet-manager-production
description: |
  osd-fleet-manager namespace on hive production.
  Used to deploy resources on service and/or management clusters with SelectorSyncSets

cluster:
  $ref: /openshift/hivep01ue1/cluster.yml

app:
  $ref: /services/ocm/osd-fleet-manager/app.yml

environment:
  $ref: /products/osdv4/environments/production-hivep01ue1.yml

managedExternalResources: true

externalResources:
- provider: aws
  provisioner:
    $ref: /aws/app-sre/account.yml
  resources:
  - provider: aws-iam-service-account
    identifier: hypershift-cert-manager-route53-production
    user_policy:
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Effect": "Allow",
            "Action": [
              "route53:GetChange",
            ],
            "Resource": "arn:aws:route53:::change/*",
          },
          {
            "Effect": "Allow",
            "Action": [
              "route53:ChangeResourceRecordSets",
              "route53:ListResourceRecordSets"
            ],
            "Resource": [
              # p3.openshiftapps.com from app-sre shard.
              "arn:aws:route53:::hostedzone/Z0993289OF2UH2YBRGNP",
              # p3.openshiftapps.com from hypershift-dns01 shard.
              "arn:aws:route53:::hostedzone/Z08413432O9KR3PTHK8ML"
            ]
          },
          {
            "Effect": "Allow",
            "Action": [
              "route53:ListHostedZonesByName"
            ],
            "Resource": "*"
          }
        ]
      }
    output_resource_name: hypershift-cert-manager-route53
- provider: aws
  provisioner:
    $ref: /aws/app-sre-logs/account.yml
  resources:
  - provider: aws-iam-service-account
    identifier: hypershift-cloudwatch-logging-production
    output_resource_name: app-sre-logs-cloudwatch-access
    user_policy:
      {
        "Version": "2012-10-17",
        "Statement": [
          {
            "Action": [
              "logs:CreateLogGroup",
              "logs:CreateLogStream",
              "logs:DescribeLogGroups",
              "logs:DescribeLogStreams",
              "logs:PutLogEvents",
              "logs:GetLogEvents",
              "logs:PutRetentionPolicy",
              "logs:GetLogRecord",
            ],
            "Effect": "Allow",
            "Resource": "arn:aws:logs:*:*:*"
          }
        ]
      }
