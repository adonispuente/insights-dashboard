---
$schema: /app-sre/saas-file-2.yml

labels:
  service: uhc

name: saas-ocm-ams-umb-consumer
description: SaaS tracking file for OCM Account Manager UMB Consumer Deployment

app:
  $ref: /services/ocm/ams/app.yml

pipelinesProvider:
  $ref: /services/ocm/pipelines/tekton.ocm-pipelines.appsrep05ue1.yaml

deployResources:
  requests:
    cpu: 600m
    memory: 1Gi
  limits:
    cpu: 600m
    memory: 1Gi

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-uhc-info

managedResourceTypes:
- Deployment
- Service
- ConfigMap

imagePatterns:
- quay.io/app-sre/uhc-account-manager
- quay.io/centos/centos

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

resourceTemplates:
- name: uhc-account-manager-umb-consumer
  url: https://gitlab.cee.redhat.com/service/uhc-account-manager
  path: /templates/consumer-template.yml
  parameters:
    AUTOMATIC_BAN: 'true'

  targets:
  - namespace:
      $ref: /services/ocm/namespaces/uhc-integration.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-uhc-account-manager-gl-build-master
    promotion:
      publish:
      - ocm-ams-umb-consumer-deployed-int
    parameters:
      DB_MAX_OPEN_CONNS: 250
      METRICS_BASE_URL: uhc-acct-mngr-metrics.uhc-integration.svc.cluster.local
      MOA_SKU: SER0579
      PPROF_SERVER_BINDADDRESS: ''
      REPLICAS: '1'
      RHIT_BASE_CANDLEPIN_URL: https://admin.rhsm.stage.redhat.com/candlepin
      SENTRY_URL: sentry.autom8.in
      SENTRY_PROJECT: '9'
      UMB_USER_QUEUE: Consumer.uhcaccountmanager.ocm-user-consumer-integration
      UMB_SUBSCRIPTION_QUEUE: Consumer.uhcaccountmanager.ocm-subscription-consumer-integration
      UMB_TIMEOUT: 5m
      UNLEASH_URL: https://ocm-integration.unleash.devshift.net/api
      UPDATE_DEPLOYMENT_CONFIG_CHANGE: update_1
      USE_CANDLEPIN_BASIC_AUTH: 'true'
