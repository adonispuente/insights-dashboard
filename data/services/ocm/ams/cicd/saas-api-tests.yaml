---
$schema: /app-sre/saas-file-2.yml
labels:
  service: uhc
name: saas-ocm-api-tests
description: SaaS tracking file for OCM API Tests
app:
  $ref: /services/ocm/ams/app.yml
pipelinesProvider:
  $ref: /services/ocm/pipelines/tekton.ocm-pipelines.appsrep05ue1.yaml
deployResources:
  requests:
    cpu: 600m
    memory: 2000Mi
  limits:
    memory: 2000Mi
slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-uhc-info
managedResourceTypes:
  - Deployment
  - Service
  - Role.rbac.authorization.k8s.io
  - RoleBinding.rbac.authorization.k8s.io
imagePatterns:
  - quay.io/app-sre/ocm-api-tests
  - quay.io/centos/centos
authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all
resourceTemplates:
  - name: api-tests
    url: https://gitlab.cee.redhat.com/service/api-tests
    path: /templates/service-template.yml
    parameters:
      DEPLOYMENT_NAME: ocm-api-tests-int
      ENVIRONMENT: production
      IMAGE_REGISTRY: quay.io
      IMAGE_REPOSITORY: app-sre/ocm-api-tests
      JWKS_URL: https://api.openshift.com/.well-known/jwks.json
      OCM_URL: https://api.integration.openshift.com
    targets:
      - namespace:
          $ref: /services/ocm/namespaces/uhc-integration.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-apitests-deployed-int
        parameters:
          UHC_TOKEN_URL: ${SSO_BASE_URL}/protocol/openid-connect/token
          ENABLE_JWT: false
  - name: api-tests-gatewatch
    url: https://gitlab.cee.redhat.com/service/api-tests
    path: /templates/gatewatch-template.yml
    parameters:
      IMAGE_REGISTRY: quay.io
      IMAGE_REPOSITORY: app-sre/ocm-api-tests
      OCM_URL: https://api.integration.openshift.com
    targets:
      - namespace:
          $ref: /services/ocm/namespaces/uhc-integration.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-gatewatch-deployed-int
        parameters:
          NAMESPACE: uhc-integration
      - namespace:
          $ref: /services/ocm/namespaces/uhc-stage.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-gatewatch-deployed-stage
        parameters:
          NAMESPACE: uhc-stage
      - namespace:
          $ref: /services/ocm/namespaces/uhc-production.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-gatewatch-deployed-prod
        parameters:
          NAMESPACE: uhc-production
      - namespace:
          $ref: /services/ocm/osd-fleet-manager/namespaces/integration.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-osdfm-gatewatch-deployed-int
        parameters:
          NAMESPACE: osd-fleet-manager-integration
          SECRET_NAME: fleet-manager
          OCM_CLIENT_ID_PATH: /secrets/service/ocm-service.clientId
          OCM_CLIENT_SECRET_PATH: /secrets/service/ocm-service.clientSecret
          SERVICE_ACCOUNT: fleet-manager
          SECRET_MOUNT: /secrets/service
      - namespace:
          $ref: /services/ocm/osd-fleet-manager/namespaces/stage.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-osdfm-gatewatch-deployed-stage
        parameters:
          NAMESPACE: osd-fleet-manager-stage
          SECRET_NAME: fleet-manager
          OCM_CLIENT_ID_PATH: /secrets/service/ocm-service.clientId
          OCM_CLIENT_SECRET_PATH: /secrets/service/ocm-service.clientSecret
          SERVICE_ACCOUNT: fleet-manager
          SECRET_MOUNT: /secrets/service
      - namespace:
          $ref: /services/ocm/osd-fleet-manager/namespaces/production.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - ocm-osdfm-gatewatch-deployed-prod
        parameters:
          NAMESPACE: osd-fleet-manager-production
          SECRET_NAME: fleet-manager
          OCM_CLIENT_ID_PATH: /secrets/service/ocm-service.clientId
          OCM_CLIENT_SECRET_PATH: /secrets/service/ocm-service.clientSecret
          SERVICE_ACCOUNT: fleet-manager
          SECRET_MOUNT: /secrets/service
      - namespace:
          $ref: /services/ocm/namespaces/xcm-integration.yml
        ref: da98a2ceea1c1f08f2914b1ad636c48f3905af50
        promotion:
          publish:
            - xcm-gatewatch-deployed-int
        parameters:
          NAMESPACE: xcm-integration
          SECRET_NAME: clusters-service
          OCM_CLIENT_ID_PATH: /secrets/service/client.id
          OCM_CLIENT_SECRET_PATH: /secrets/service/client.secret
          SERVICE_ACCOUNT: clusters-service
          SECRET_MOUNT: /secrets/service
