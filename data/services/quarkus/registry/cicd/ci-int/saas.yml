---
$schema: /app-sre/saas-file-2.yml

labels:
  service: quarkus-registry

name: saas-quarkus-registry
description: SaaS tracking file for Quarkus Registry

app:
  $ref: /services/quarkus/registry/app.yml

pipelinesProvider:
  $ref: /services/quarkus/registry/pipelines/tekton.registry-quarkus-redhat-pipelines.appsrep05ue1.yml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-quarkus-info

managedResourceTypes:
  - DeploymentConfig
  - Service

imagePatterns:
  - quay.io/app-sre/registry-quarkus-redhat-app

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

resourceTemplates:
  - name: registry-quarkus
    url: https://gitlab.cee.redhat.com/quarkus/registry.quarkus.redhat.com
    path: /openshift/template.yaml
    targets:
      - namespace:
          $ref: /services/quarkus/registry/namespaces/registry-quarkus-redhat-stage.yml
        ref: main
        upstream:
          instance:
            $ref: /dependencies/ci-int/ci-int.yml
          name: quarkus-registry.quarkus.redhat.com-gl-build-main
        parameters:
          REPLICAS: 3
          IMAGE: "quay.io/app-sre/registry-quarkus-redhat-app"
          SERVICE_ACCOUNT: "registry-quarkus-redhat"
          QUARKUS_REGISTRY_ID: "registry.quarkus.redhat.com"
          QUARKUS_REGISTRY_GROUPID: "com.redhat.preprod.quarkus.registry"
          QUARKUS_REGISTRY_MAVEN_REPO_URL: "https://registry.quarkus.preprod.redhat.com/maven"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXPRESSION: "*-redhat-*"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXCLUSIVE_PROVIDER: "false"
          QUARKUS_REGISTRY_NON_PLATFORM_EXTENSIONS_SUPPORT: "false"
          QUARKUS_REGISTRY_CACHE_CRON: "* */5 * * * ?"
          QUARKUS_DEFAULT_PLATFORM: "com.redhat.quarkus.platform"
          QUARKUS_REGISTRY_ENVIRONMENT: "stage"
          QUARKUS_LOG_SENTRY: "true"
          # This is the secret that will contain the Glitchtip DSN
          GLITCHTIP_SECRET: "registry-quarkus-redhat-stage-dsn"
        promotion:
          publish:
            - registry-quarkus-redhat-stage-deploy-success-channel
      - namespace:
          $ref: /services/quarkus/registry/namespaces/registry-quarkus-redhat-production.yml
        ref: "4934530e75a588dda0efc5a22943e4ebcd50f3a8"
        parameters:
          REPLICAS: 3
          IMAGE: "quay.io/app-sre/registry-quarkus-redhat-app"
          SERVICE_ACCOUNT: "registry-quarkus-redhat"
          QUARKUS_REGISTRY_ID: "registry.quarkus.redhat.com"
          QUARKUS_REGISTRY_GROUPID: "com.redhat.quarkus.registry"
          QUARKUS_REGISTRY_MAVEN_REPO_URL: "https://registry.quarkus.redhat.com/maven"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXPRESSION: "*-redhat-*"
          QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXCLUSIVE_PROVIDER: "false"
          QUARKUS_REGISTRY_NON_PLATFORM_EXTENSIONS_SUPPORT: "false"
          QUARKUS_REGISTRY_CACHE_CRON: "* */5 * * * ?"
          QUARKUS_DEFAULT_PLATFORM: "com.redhat.quarkus.platform"
          QUARKUS_REGISTRY_ENVIRONMENT: "production"
          QUARKUS_LOG_SENTRY: "true"
          # This is the secret that will contain the Glitchtip DSN
          GLITCHTIP_SECRET: "registry-quarkus-redhat-prod-dsn"
        promotion:
          publish:
            - registry-quarkus-redhat-deploy-success-channel
