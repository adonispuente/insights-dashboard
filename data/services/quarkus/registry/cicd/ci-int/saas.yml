---
$schema: /app-sre/saas-file-2.yml

labels:
  service: registry-quarkus-redhat

name: saas-registry-quarkus-redhat
description: "SaaS tracking file for Quarkus Registry Red Hat"

app:
  $ref: /services/quarkus/registry/app.yml

pipelinesProvider:
  $ref: /services/quarkus/registry/pipelines/tekton.registry-quarkus-pipelines.app-sre-prod-01.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: sd-app-sre-info

managedResourceTypes:
  - DeploymentConfig
  - Service

imagePatterns:
  - quay.io/quarkus/registry-app

authentication:
  code:
    path: app-sre/creds/github-app-sre-bot
    field: openshift-saas-deploy

resourceTemplates:
  - name: registry-quarkus-redhat
    url: https://github.com/quarkusio/registry.quarkus.redhat.com
    path: /openshift/template.yaml
    parameters:
      IMAGE: quay.io/quarkus/registry-app
      QUARKUS_REGISTRY_NON_PLATFORM_EXTENSIONS_SUPPORT: "false"
      QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXPRESSION: "*-redhat-*"
      QUARKUS_REGISTRY_QUARKUS_VERSIONS_EXCLUSIVE_PROVIDER: "true"
      QUARKUS_REGISTRY_CACHE_CRON: "0 */30 * ? * *"
    targets:
      - namespace:
          $ref: /services/quarkus/registry/namespaces/registry-quarkus-redhat-stage.yml
        ref: main
        upstream:
          instance:
            $ref: /dependencies/ci-ext/ci-ext.yml
          name: registry.quarkus.redhat.com-gh-build-main
        parameters:
          REPLICAS: 3
          QUARKUS_REGISTRY_ID: registry.quarkus.stage.redhat.com
          QUARKUS_REGISTRY_GROUPID: com.redhat.stage.quarkus.registry
          QUARKUS_REGISTRY_MAVEN_REPO_URL: https://registry.quarkus.stage.redhat.com/maven
      - namespace:
          $ref: /services/quarkus/registry/namespaces/registry-quarkus-redhat-production.yml
        ref: 9178abdbcb01f35c09473113afb67239d74ad85d
        parameters:
          REPLICAS: 3
          QUARKUS_REGISTRY_ID: registry.quarkus.redhat.com
          QUARKUS_REGISTRY_GROUPID: com.redhat.quarkus.registry
          QUARKUS_REGISTRY_MAVEN_REPO_URL: https://registry.quarkus.redhat.com/maven
