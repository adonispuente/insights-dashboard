---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: app-sre

name: ci-int-app-sre-jobs

description: ''

app:
  $ref: /services/app-sre/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
- project:
    name: ci-int
    label: app-sre
    node: app-sre
    jobs:
    - 'gl-job-sos-report':
        display_name: SOS Report
        gl_group: dtsd
        gl_project: housekeeping

    - 'gl-build-master-osio-scan':
        display_name: Report generator for OSIO scanner
        gl_group: dtsd
        gl_project: osio-scan

    - 'pagerditty':
        display_name: pagerditty

    - 'gl-job-workday-reminder':
        gl_group: app-sre
        gl_project: workday-reminder
        display_name: workday-reminder

    - 'jenkins-workers-cleanup':
        display_name: jenkins-workers-cleanup
        gl_group: app-sre
        gl_project: infra

    - 'jenkins-workers-subscription-manager-refresh':
        display_name: jenkins-workrs-subscription-manager-refresh
        gl_group: app-sre
        gl_project: infra

    - 'gl-build-master-ansible-playbook':
        display_name: bastion-ansible build master
        gl_group: app-sre
        gl_project: infra
        include_path: 'ansible/playbooks/bastion-accounts.yml'
        playbook: 'playbooks/bastion-accounts.yml'
        playbookname: 'bastion-accounts'

    - 'gl-build-master-ansible-playbook':
        display_name: baseline-ansible build master
        gl_group: app-sre
        gl_project: infra
        include_path: 'ansible/playbooks/node-all-baseline.yml'
        playbook: 'playbooks/node-all-baseline.yml'
        playbookname: 'baseline'

    - 'gl-build-master-ansible-playbook':
        display_name: ci-ext jenkins workers-ansible build master
        gl_group: app-sre
        gl_project: infra
        include_path: 'ansible/playbooks/node-ci-ext-jenkins-worker.yml'
        playbook: 'playbooks/node-ci-ext-jenkins-worker.yml'
        playbookname: 'ci-ext-jenkins-worker'

    - 'jenkins-node-rhel7-check':
        display_name: Jenkins nodes RHEL7 subscription test build
        node: rhel7

    - 'jenkins-node-rhel8-check':
        display_name: Jenkins nodes RHEL8 subscription test build
        node: rhel8

- project:
    name: infra
    label: app-sre
    node: app-sre
    gl_group: app-sre
    gl_project: infra
    jobs:
    - 'gl-build-master-infra':
        display_name: infra packer build
    - 'gl-pr-check-infra':
        display_name: infra packer pr-check
    - 'jenkins-worker-housekeeping':
        display_name: jenkins-worker-housekeeping-admin-user
        tagname: admin-user
    - 'jenkins-worker-housekeeping-timed':
        display_name: jenkins-worker-housekeeping-timed-cleanup
        tagname: cleanup
        cron_expression: H */3 * * *
    - 'jenkins-worker-housekeeping-timed':
        display_name: jenkins-worker-housekeeping-timed-rhel-subscription-refresh
        tagname: rhel-subscription-refresh
        cron_expression: H 2 * * *
    - 'jenkins-worker-housekeeping-timed':
        display_name: jenkins-worker-housekeeping-timed-rhel-subscription-check
        tagname: rhel-subscription-check
        cron_expression: H */2 * * *
    - 'jenkins-worker-housekeeping-update-host':
        display_name: jenkins-worker-housekeeping-update-host
        ci_cmd: ./update_host.sh

- project:
    name: clusterimagesets
    label: app-sre
    node: app-sre

    jobs:
    # generates new clusterimagesets and pushes back to staging repo
    - 'clusterimageset-run':
        display_name: clusterimageset-run
        gl_group: service
        gl_project: clusterimagesets
        timeout: 15

    - 'gl-pr-check-clusterimagesets':
        display_name: clusterimagesets prcheck
        gl_group: service
        gl_project: clusterimagesets
        timeout: 15

- project:
    name: git-keeper
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: git-keeper

    jobs:
    - 'gitkeeper-run':
        display_name: git-keeper backup

- project:
    name: prometheus-operator-catalog
    label: app-sre
    node: app-sre
    gh_org: app-sre
    gh_repo: prometheus-operator-catalog
    quay_org: app-sre
    jobs:
    - 'gh-build-master':
        display_name: prometheus-operator-catalog build master
    - 'gh-pr-check':
        display_name: prometheus-operator-catalog pr-check

- project:
    name: sd-sos-notifier
    label: app-sre
    node: app-sre
    gl_group: service
    gl_project: sd-sos
    jobs:
    - 'sd-sos-notifier':
        display_name: sd-sos-notifier
        timeout: 15
    - 'gl-pr-check':
        display_name: sd-sos validator
        timeout: 15
    - 'gl-timed-sd-sos':
        node: app-interface-long-running
        display_name: sd-sos-weekly-reporter
        job_type: app-sre-weekly-reporter
