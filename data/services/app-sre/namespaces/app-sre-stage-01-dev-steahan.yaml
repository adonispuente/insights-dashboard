---
$schema: /openshift/namespace-1.yml

labels: {}

name: dev-steahan
description: namespace for steahan@ to test RDS upgrades

cluster:
  $ref: /openshift/app-sre-stage-01/cluster.yml

app:
  $ref: /services/app-sre/app.yml

environment:
  $ref: /products/app-sre/environments/stage.yml

managedTerraformResources: true

terraformResources:
- provider: rds
  account: app-sre-stage
  identifier: dev-steahan
  defaults: /terraform/resources/app-sre-stage/staging/steahan-rds-defaults.yml
  output_resource_name: dev-steahan-rds-old
  overrides:
    engine_version: '12.8'
    name: 'postgres'

- provider: rds
  account: app-sre-stage
  identifier: dev-steahan-restore
  defaults: /terraform/resources/app-sre-stage/staging/steahan-rds-defaults.yml
  # Replace the secret with the existing name, so no code changes are required
  output_resource_name: dev-steahan-rds
  # Reset the password because restoring the database results in the password from the old database being used
  reset_password: restoring-dev-steahan
  overrides:
    engine_version: '12.8'
    restore_to_point_in_time:
      restore_time: '2022-06-01T20:43:00Z'
      source_db_instance_identifier: dev-steahan

