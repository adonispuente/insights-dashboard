---
$schema: /app-sre/app-1.yml


labels:
  service: app-sre
  deployment_validation_operator_no_liveness_probe: skip for pipelines namespaces
  deployment_validation_operator_no_readiness_probe: skip for pipelines namespaces

name: App-SRE

description: |
  A container for App SRE related resources.
  The current codeComponents will be picked up by the gitlab-permissions integration,
  and will assist in on-boarding new team members to the App SRE team.

architectureDocument: https://TODO
sopsUrl: https://gitlab.cee.redhat.com/TODO
onboardingStatus: OnBoarded

grafanaUrls:
- title: AppSre folder
  url: https://grafana.app-sre.devshift.net/dashboards/f/zskFbCuWz/appsre

escalationPolicy:
  $ref: /teams/app-sre/escalation-policies/general.yaml
serviceOwners:
- name: App-SRE Team
  email: sd-app-sre@redhat.com

dependencies:
- $ref: /dependencies/aws/service.yml
- $ref: /dependencies/ci-int/service.yml
- $ref: /dependencies/ci-ext/service.yml
- $ref: /dependencies/github/service.yml
- $ref: /dependencies/gitlab/service.yml
- $ref: /dependencies/quay/service.yml
- $ref: /dependencies/openshift/service.yml
- $ref: /dependencies/kafka/service.yml

sentryProjects:
- team:
    $ref: /dependencies/sentry/teams/app-sre-stage.yml
  projects:
  - name: app-sre-playground
    description: Playground to test sentry configurations/options
    email_prefix: '[App SRE Playground]'
    platform: python
  - name: app-sre-saas-exporter
    description: saas-exporter project
    email_prefix: '[saas-exporter]'
    platform: python

quayRepos:
- org:
    $ref: /dependencies/quay/app-sre.yml
  teams:
  - permissions:
    - $ref: /dependencies/quay/permissions/quay-membership-app-sre-assisted-installer.yml
    role: read
  items:
  - name: git-keeper
    description: 'Git backup tool: S3, gpg'
    public: true
  - name: s3-reload
    description: Simple binary to trigger a reload when an object in an S3 bucket
      is updated
    public: true
  - name: diag-container
    description: ''
    public: true
  - name: nginx-gate
    description: ''
    public: true
  - name: enforce-naming
    description: ''
    public: false
  - name: fluentd
    description: ''
    public: true
  - name: vault-exporter
    description: Vault health exporter in prom format
    public: true
  - name: saasherder
    description: saasherder image
    public: true
  - name: catalog-image
    description: catalog-image container
    public: true
  - name: push-saas-metrics
    description: push-saas-metrics
    public: true
  - name: manifest-bouncer
    description: manifest-bouncer tool
    public: true
  - name: busybox
    description: Mirror for docker.io/busybox
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/busybox.yml
  - name: nginx
    description: Mirrors docker.io/nginx
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/nginx.yml
  - name: nginx-unprivileged
    description: Mirrors docker.io/nginxinc/nginx-unprivileged
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/nginx-unprivileged.yml
  - name: saas-exporter
    description: saas-exporter
    public: true
  - name: app-sre-errbot
    description: Slack bot for app-sre
    public: true
  - name: rds-enhanced-metrics-exporter
    description: Export enhanced RDS metrics for AWS RDS instances
    public: true
  - name: prometheus-operator-catalog
    description: prometheus-operator catalog
    public: true
  - name: alpine
    description: Mirrors docker.io/alpine
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/alpine.yml
  - name: golang
    description: Mirrors docker.io/golang
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/golang.yml
  - name: fluentd-upstream
    description: Mirrors docker.io/fluent/fluentd
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/fluent-fluentd.yml
  - name: fluentd-hec
    description: Mirrors docker.io/splunk/fluentd-hec
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/splunk-fluentd-hec.yml
  - name: vegeta-k8s
    description: vegeta-k8s project
    public: true
  - name: mb-k8s
    description: mb-k8s project
    public: true
  - name: envoyproxy
    description: Temporary mirror of envoyproxy. This will be deprecated in favor
      of r.r.i/openshift-service-mesh/proxyv2-rhel8
    public: false
    mirror:
      $ref: /dependencies/image-mirrors/docker.io/envoyproxy.yml
  - name: nginx-redirector
    description: nginx redirector
    public: true
  - name: nginx-proxy-cache
    description: nginx proxy cache
    public: true
  - name: openshift-cert-manager-routes
    description: openshift-cert-manager-routes operator image.
    public: true
    mirror:
      $ref: /dependencies/image-mirrors/ghcr.io/openshift-cert-manager-routes.yml
  - name: skupper-prometheus-collector
    description: skupper-prometheus-collector project
    public: true

codeComponents:
- name: housekeeping
  resource: other
  url: https://gitlab.cee.redhat.com/dtsd/housekeeping
  gitlabHousekeeping:
    enabled: true
    rebase: false
  jira:
    $ref: /dependencies/jira/issues-redhat-com.yaml
- name: saas-crypt
  resource: other
  url: https://gitlab.cee.redhat.com/dtsd/saas-crypt
- name: devguide
  resource: other
  url: https://gitlab.cee.redhat.com/dtsd/devguide
- name: dev-guidelines
  resource: other
  url: https://gitlab.cee.redhat.com/service/dev-guidelines
  showInReviewQueue: true
  jira:
    $ref: /dependencies/jira/issues-redhat-com.yaml
- name: git-keeper
  resource: upstream
  url: https://github.com/app-sre/git-keeper
- name: manifest-bouncer
  resource: upstream
  url: https://github.com/app-sre/manifest-bouncer
- name: fluentd
  resource: upstream
  url: https://github.com/app-sre/fluentd
- name: nginx-gate
  resource: upstream
  url: https://github.com/app-sre/nginx-gate
- name: vault-exporter
  resource: upstream
  url: https://github.com/app-sre/vault-exporter
- name: clusterimagesets
  resource: upstream
  url: https://gitlab.cee.redhat.com/service/clusterimagesets
  jira:
    $ref: /dependencies/jira/issues-redhat-com.yaml
  gitlabSync:
    sourceProject:
      name: clusterimagesets
      group: service
      branch: master
    destinationProject:
      name: clusterimagesets
      group: service
      branch: master
- name: csnotify
  resource: upstream
  url: https://github.com/app-sre/csnotify
- name: s3-reload
  resource: upstream
  url: https://github.com/app-sre/s3-reload
- name: push-saas-metrics
  resource: upstream
  url: https://github.com/app-sre/push-saas-metrics
- name: saas-exporter
  resource: upstream
  url: https://github.com/app-sre/saas-exporter
- name: sretoolbox
  resource: upstream
  url: https://github.com/app-sre/sretoolbox
- name: app-sre-errbot
  resource: upstream
  url: https://github.com/app-sre/app-sre-errbot
- name: infra
  resource: other
  url: https://gitlab.cee.redhat.com/app-sre/infra
  showInReviewQueue: true
  gitlabHousekeeping:
    enabled: true
    rebase: false
  jira:
    $ref: /dependencies/jira/issues-redhat-com.yaml
- name: rds-enhanced-metrics-exporter
  resource: upstream
  url: https://github.com/app-sre/rds-enhanced-metrics-exporter
- name: logs-to-elasticsearch-lambda
  resource: upstream
  url: https://github.com/app-sre/logs-to-elasticsearch-lambda
- name: cognito-pre-signup-trigger
  resource: upstream
  url: https://github.com/app-sre/cognito-pre-signup-trigger
- name: kinesis-to-opensearch-lambda
  resource: upstream
  url: https://github.com/app-sre/kinesis-to-opensearch-lambda
- name: prometheus-operator-catalog
  resource: upstream
  url: https://github.com/app-sre/prometheus-operator-catalog
- name: workday-reminder
  resource: upstream
  url: https://gitlab.cee.redhat.com/app-sre/workday-reminder
- name: vegeta-k8s
  resource: upstream
  url: https://github.com/app-sre/vegeta-k8s
- name: mb-k8s
  resource: upstream
  url: https://github.com/app-sre/mb-k8s
- name: test-git-commit-range
  resource: upstream
  url: https://github.com/app-sre/test-git-commit-range
- name: nginx-redirector
  resource: upstream
  url: https://github.com/app-sre/nginx-redirector
- name: pod-restarter
  resource: upstream
  url: https://gitlab.cee.redhat.com/mafriedm/pod-restarter
- name: sd-sos
  resource: upstream
  url: https://gitlab.cee.redhat.com/service/sd-sos
  gitlabRepoOwners:
    enabled: false
  gitlabHousekeeping:
    enabled: true
    rebase: true
- name: nginx-proxy-cache
  resource: upstream
  url: https://github.com/app-sre/nginx-proxy-cache
- name: homeless-templates
  resource: upstream
  url: https://gitlab.cee.redhat.com/app-sre/homeless-templates
  gitlabSync:
    sourceProject:
      name: homeless-templates
      group: app-sre
      branch: main
    destinationProject:
      name: homeless-templates-sync
      group: app-sre
      branch: main
- name: test-saas-deployments
  resource: upstream
  url: https://github.com/app-sre/test-saas-deployments
- name: selectorsyncset-sector-demo
  resource: upstream
  url: https://gitlab.cee.redhat.com/service/selectorsyncset-sector-demo

- name: openshift-cert-manager-routes-templates
  resource: upstream
  url: https://github.com/app-sre/openshift-cert-manager-routes-templates

# test environment for Product Security
- name: prodsec-app-sre-test
  resource: upstream
  url: https://gitlab.cee.redhat.com/product-security/app-sre-test
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true          # always rebase Merge Requests
    days_interval: 1      # when to consider MRs stale
    enable_closing: true  # close MRs after 2 stale periods
    pipeline_timeout: 60  # cancel a pipeline taking longer than this many minutes
  jira:                   # enable automatic linking of MRs to Jira tickets they name
    $ref: /dependencies/jira/issues-redhat-com.yaml

# Product Security's Offering Registry - production
- name: prodsec-offering-registry
  resource: upstream
  url: https://gitlab.cee.redhat.com/product-security/offering-registry-reports
  gitlabRepoOwners:
    enabled: true
  gitlabHousekeeping:
    enabled: true
    rebase: true          # always rebase Merge Requests
    days_interval: 7      # when to consider MRs stale
    enable_closing: true  # close MRs after 2 stale periods
    pipeline_timeout: 60  # cancel a pipeline taking longer than this many minutes
  jira:                   # enable automatic linking of MRs to Jira tickets they name
    $ref: /dependencies/jira/issues-redhat-com.yaml

- name: diag-container
  resource: upstream
  url: https://github.com/app-sre/diag-container
