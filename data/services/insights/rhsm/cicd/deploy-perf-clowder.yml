---
$schema: /app-sre/saas-file-2.yml

labels:
  service: rhsm
  platform: insights

name: rhsm-perf-clowder
description: rhsm app on the Insights Platform via clowder

app:
  $ref: /services/insights/rhsm/app.yml

pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml 
  channel: proj-perf-insights-cluster

managedResourceTypes:
- ClowdApp
- ClowdJobInvocation
# NOTE: Service needed to transition seamlessly from old deployment/service route without taking downtime
- Service
# - HorizontalPodAutoscaler

imagePatterns:
- quay.io/cloudservices
- quay.io/app-sre

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all
    version: 3

parameters:
  CLOWDER_ENABLED: 'true'

resourceTemplates:
- name: swatch-api
  path: /swatch-api/deploy/clowdapp.yaml
  url: https://github.com/RedHatInsights/rhsm-subscriptions
  targets:
    - namespace:
        $ref: /services/insights/rhsm/namespaces/perf-rhsm-perf.yml
      ref: main
      parameters:
        SERVER_MAX_HTTP_HEADER_SIZE: '47000'
        RHSM_RBAC_HOST: ${RBAC_HOST}
        RHSM_RBAC_PORT: '8080'

- name: swatch-tally
  path: /swatch-tally/deploy/clowdapp.yaml
  url: https://github.com/RedHatInsights/rhsm-subscriptions
  targets:
    - namespace:
        $ref: /services/insights/rhsm/namespaces/perf-rhsm-perf.yml
      ref: main
      parameters:
        HAWTIO_BASE_PATH: /app/rhsm-subscriptions/hawtio
        DEVTEST_SUBSCRIPTION_EDITING_ENABLED: true
        DEVTEST_EVENT_EDITING_ENABLED: true
        ENABLE_ACCOUNT_RESET: true
        CLOUDIGRADE_ENABLED: false
        USER_HOST: user.stage.api.redhat.com
        MEMORY_REQUEST: 3072Mi
        MEMORY_LIMIT: 4096Mi
        KAFKA_MESSAGE_THREADS: 1
        INVENTORY_SECRET_KEY_NAME: host-inventory-db-readonly
        INVENTORY_SECRET_KEY_NAME_PREFIX: 'db.'
        POPULATOR_RUN_NUMBER: 2
        ORG_ID_POPULATOR_BATCH_SIZE: 500
