$schema: /app-sre/saas-file-2.yml
labels:
  service: drift
  platform: insights
name: drift-clowder
description: drift app deployed via clowder
app:
  $ref: /services/insights/drift/app.yml
pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.appsrep05ue1.yaml
slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-clouddot-info
managedResourceTypes:
  - ClowdApp
  - Frontend
imagePatterns:
  - quay.io/cloudservices
authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all
    version: 3
resourceTemplates:
  - name: drift
    path: /clowdapp.yaml
    url: https://github.com/RedHatInsights/drift-backend
    parameters:
      CLOWDER_ENABLED: "True"
      DRIFT_ENABLE_RBAC: "True"
      ENABLE_SMART_MANAGEMENT_ENTITLEMENT_CHECK: "False"
      MAX_REPLICAS: 3
      MIN_REPLICAS: 3
    targets:
      - namespace:
          $ref: /services/insights/drift/namespaces/stage-drift-stage.yml
        ref: master
        upstream:
          instance:
            $ref: /dependencies/ci-ext/ci-ext.yml
          name: RedHatInsights-drift-backend-gh-build-master
        parameters:
          SYSTEM_BASELINE_HOST: system-baseline-backend-service.system-baseline-stage.svc.cluster.local
      - namespace:
          $ref: /services/insights/drift/namespaces/drift-prod.yml
        ref: 27dbbde9e0ab9b96d862b294b0ee2388643321ac
        parameters:
          SYSTEM_BASELINE_HOST: system-baseline-backend-service.system-baseline-prod.svc.cluster.local
      - namespace:
          $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
        disable: true
        ref: internal
        parameters:
          MAX_REPLICAS: 1
          MIN_REPLICAS: 1
  - name: drift-frontend
    path: /deploy/frontend.yml
    url: https://github.com/RedHatInsights/drift-frontend
    targets:
      - namespace:
          $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
        disable: true
        ref: internal
      - namespace:
          $ref: /services/insights/ephemeral/namespaces/consoledot-frontend-stage.yml
        ref: master
        parameters:
          ENV_NAME: env-stage
