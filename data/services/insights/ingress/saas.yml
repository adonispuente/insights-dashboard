---
$schema: /app-sre/saas-file-1.yml

labels:
  service: ingress
  platform: insights

name: ingress
description: ingress app on the Insights Platform

app:
  $ref: /services/insights/ingress/app.yml

managedResourceTypes:
- DeploymentConfig
- Service
authentication:
  code:
    path: app-sre/creds/github-app-sre-bot
    field: openshift-saas-deploy
  image:
    path: insights/quay/cloudservices-push
    field: all

resourceTemplates:
- name: ingress
  path: /templates/ingress/ingress.yaml
  url: https://github.com/RedHatInsights/saas-templates
  hash_length: 7
  parameters:
    CLOUD_WATCH_LOG_GROUP: platform
    DB_REPLICAS: 0
    ENABLE_SMART_MANGEMENT_ENTITLEMENT_CHECK: true
    KAFKA_BOOTSTRAP_PORT: '9092'
    LOG_GROUP: platform
    PATH_PREFIX: api
    PLATFORM_HOSTNAME: cloud.redhat.com
    SSG_HOST: playbooks-ssg
  targets:
  - namespace:
      $ref: /services/insights/ingress/namespaces/stage-ingress-stage.yml
    hash: c8e9640a4dcf9f56e6f4fb34e87741a1765d1097
    parameters:
      ADVISOR_HOST: insights-advisor-api.advisor-stage.svc.cluster.local
      APPROVAL_HOST: approval-api.approval-stage.svc
      BACKOFFICE_HOST: backoffice-proxy-insights-services.ext.us-east.dc.stage.paas.redhat.com
      CATALOG_HOST: catalog-api.catalog-stage.svc
      COMPLIANCE_HOST: compliance-backend.compliance-stage.svc.cluster.local
      CONTENT_SERVER_HOST: content-server.advisor-stage.svc.cluster.local
      HOOKS_REGISTRATION_URL: http://hooks-backend.hooks-stage.svc.cluster.local:8080/api/hooks/apps/register
      HOST_INVENTORY_HOST: insights-inventory.platform-stage.svc
      HSP_HOST: historical-system-profiles-backend.historical-system-profiles-stage.svc
      KAFKA_BOOTSTRAP_HOST: platform-mq-stage-kafka-bootstrap.platform-mq-stage.svc
      RBAC_HOST: rbac.rbac-stage.svc
      RECEPTOR_CONTROLLER_HOST: receptor-controller.platform-stage.svc
      REMEDIATIONS_URL: http://remediations.remediations-stage:9002
      SOURCES_HOST: sources-api.sources-stage.svc
      SYSTEM_BASELINE_HOST: system-baseline-backend.system-baseline-stage.svc
      TOPOLOGICAL_INVENTORY_HOST: topological-inventory-api.topological-inventory-stage.svc
      UPLOAD_SERVICE_HOST: upload-service.platform-stage.svc
      VULNERABILITIES_HOST: vulnerability-engine-manager.vulnerability-engine-stage.svc.cluster.local
