---
$schema: /app-sre/saas-file-2.yml

labels:
  service: turnpike
  platform: insights

name: turnpike
description: Turnpike API Gateway

app:
  $ref: /services/insights/turnpike/app.yml

pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.app-sre-prod-01.yaml

deployResources:
  requests:
    cpu: 600m
    memory: 1Gi
  limits:
    cpu: 600m
    memory: 1Gi

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-clouddot-info

managedResourceTypes:
- Deployment
- Service
- ConfigMap

imagePatterns:
- quay.io/cloudservices

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all
    version: 3

resourceTemplates:
- name: nginx
  path: /templates/nginx.yml
  url: https://github.com/RedHatInsights/turnpike
  parameters:
    ALLOWED_ROUTES: '["public", "api", "app", "docs"]'
  targets:
  - namespace:
      $ref: /services/insights/turnpike/namespaces/stage-turnpike-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-ext/ci-ext.yml
      name: RedHatInsights-turnpike-gh-build-master
    parameters:
      FLASK_SERVER_NAME: internal.console.stage.redhat.com
      FLASK_SERVICE_URL: http://web.turnpike-stage.svc.cluster.local:5000
      NGINX_SERVER_NAME: internal.console.stage.redhat.com
      ALLOWED_ORIGIN_DOMAINS: '[".svc.cluster.local", "vpc-xjoin-elasticsearch-yesvit2jsbqwqtlnrsdkorfacm.us-east-1.es.amazonaws.com"]'

  - namespace:
      $ref: /services/insights/turnpike/namespaces/turnpike-fedramp-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-ext/ci-ext.yml
      name: RedHatInsights-turnpike-gh-build-master
    parameters:
      FLASK_SERVER_NAME: internal.gov.console.stage.redhat.com
      FLASK_SERVICE_URL: http://web.turnpike-stage.svc.cluster.local:5000
      NGINX_SERVER_NAME: internal.gov.console.stage.redhat.com

  - namespace:
      $ref: /services/insights/turnpike/namespaces/prod-turnpike-prod.yml
    ref: master
    parameters:
      IMAGE_TAG: bc841a0
      FLASK_SERVER_NAME: internal.console.redhat.com
      FLASK_SERVICE_URL: http://web.turnpike-prod.svc.cluster.local:5000
      NGINX_SERVER_NAME: internal.console.redhat.com

- name: web
  path: /templates/web.yml
  url: https://github.com/RedHatInsights/turnpike
  targets:
  - namespace:
      $ref: /services/insights/turnpike/namespaces/stage-turnpike-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-ext/ci-ext.yml
      name: RedHatInsights-turnpike-gh-build-master
    parameters:
      AUTH_DEBUG: "1"
      FLASK_SERVER_NAME: internal.console.stage.redhat.com
      REDIS_SERVICE_NAME: redis.turnpike-stage.svc.cluster.local
      SETTINGS_JSON: |
        {
          "strict": true,
          "debug": true,
          "sp": {
            "entityId": "https://internal.console.stage.redhat.com/saml/metadata.xml",
            "assertionConsumerService": {
              "url": "https://internal.console.stage.redhat.com/saml/acs/",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
            },
            "singleLogoutService": {
              "url": "https://internal.console.stage.redhat.com/saml/sls/",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "NameIDFormat": "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
          },
          "idp": {
            "entityId": "https://auth.stage.redhat.com/auth/realms/EmployeeIDP",
            "singleSignOnService": {
              "url": "https://auth.stage.redhat.com/auth/realms/EmployeeIDP/protocol/saml",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "singleLogoutService": {
              "url": "https://auth.stage.redhat.com/auth/realms/EmployeeIDP/protocol/saml",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "x509cert": "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"
          }
        }
      ADVANCED_SETTINGS_JSON: |
        {
          "security": {
            "nameIdEncrypted": false,
            "authnRequestsSigned": true,
            "logoutRequestSigned": false,
            "logoutResponseSigned": false,
            "signMetadata": false,
            "wantMessagesSigned": false,
            "wantAssertionsSigned": false,
            "wantNameId" : true,
            "wantNameIdEncrypted": false,
            "wantAssertionsEncrypted": false,
            "signatureAlgorithm": "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",
            "digestAlgorithm": "http://www.w3.org/2001/04/xmlenc#sha256"
          },
          "contactPerson": {
            "technical": {
              "givenName": "Cloud Services Platform Infrastructure",
                  "emailAddress": "clouddot-infrastructure@redhat.com"
              },
              "support": {
                  "givenName": "Cloud Services Platform Infrastructure",
                  "emailAddress": "clouddot-infrastructure@redhat.com"
              }
          },
          "organization": {
            "en-US": {
              "name": "Red Hat Cloud Services Platform Staging",
              "displayname": "RH CSP Stage",
              "url": "https://internal.console.stage.redhat.com/"
            }
          }
        }
      BACKEND_ROUTES: |
        - name: turnpike
          route: /api/turnpike
          origin: http://web.turnpike-stage.svc.cluster.local:5000/api/turnpike
          auth:
            saml: "True"
            x509: "True"
        - name: healthcheck
          route: /public/healthcheck/
          origin: http://web.turnpike-stage.svc.cluster.local:5000/_healthcheck/
        - name: rhsm-subscriptions
          route: /app/rhsm-subscriptions/
          origin: http://rhsm-subscriptions-worker-monitoring.rhsm-stage.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] in ['/DC=com/DC=redhat/OU=serviceaccounts/UID=nonprod-rhsmapi/Email=it-pnt@redhat.com/DC=com/DC=redhat/OU=serviceaccounts/CN=nonprod-rhsmapi', '/DC=com/DC=redhat/OU=serviceaccounts/UID=nonprod-itpntautomation/Email=it-pnt@redhat.com/DC=com/DC=redhat/OU=serviceaccounts/CN=nonprod-itpntautomation', '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike']"
        - name: rhsm-rh-marketplace
          route: /app/rhsm-rh-marketplace/
          origin: http://swatch-billing-provider-rh-marketplace.rhsm-stage.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: rhsm-metrics
          route: /app/rhsm-metrics/
          origin: http://metrics-worker-monitoring.rhsm-stage.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: rhsm-conduit-internal
          route: /app/rhsm-conduit/internal/
          origin: http://rhsm-conduit.rhsm-stage.svc.cluster.local:8000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: rhsm-conduit
          route: /app/rhsm-conduit/
          origin: http://rhsm-conduit.rhsm-stage.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: rhsm-capacity-ingress
          route: /app/rhsm-capacity-ingress/
          origin: http://rhsm-subscriptions-capacity-ingress-monitoring.rhsm-stage.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: rhsm-capacity-ingress-internal
          route: /app/rhsm-capacity-ingress/internal/
          origin: http://rhsm-subscriptions-capacity-ingress.rhsm-stage.svc.cluster.local:8000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: rhsm-worker-internal
          route: /app/rhsm-worker/internal/
          origin: http://rhsm-subscriptions-worker.rhsm-stage.svc.cluster.local:8000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: swatch-producer-aws
          route: /api/swatch-producer-aws/
          origin: http://swatch-producer-aws-service.rhsm-stage.svc.cluster.local:8000/api/swatch-producer-aws/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-swatch-turnpike/L=stage/CN=msg-swatch-turnpike'"
        - name: policies-engine-stage
          route: /api/policies-engine/
          origin: http://policies-engine-service.policies-stage.svc.cluster.local:8000/
          auth:
            saml: "'crc-policies-team' in user['Role']"
        - name: policies-ui-backend-stage
          route: /api/policies-ui-backend/
          origin: http://policies-ui-backend-service.policies-stage.svc.cluster.local:8000/
          auth:
            saml: "'crc-policies-team' in user['Role']"
        - name: notifications-backend-stage
          route: /api/notifications/
          origin: http://notifications-backend-service.notifications-stage.svc.cluster.local:8000/
          auth:
            saml: "True"
            x509: "True"
        - name: notifications-engine-stage
          route: /api/notifications-engine/
          origin: http://notifications-engine-service.notifications-stage.svc.cluster.local:8000/
          auth:
            saml: "True"
            x509: "True"
        - name: notifications-gw-stage
          route: /api/notifications-gw/
          origin: http://notifications-gw-service.notifications-stage.svc.cluster.local:8000/
          auth:
            saml: "True"
            x509: "True"
        - name: cost-management-masu
          route: /api/cost-management/v1/
          origin: http://koku-clowder-masu.hccm-stage.svc.cluster.local:10000/api/cost-management/v1/
          auth:
            saml: "'cost-management-team' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-cost-management-turnpike/L=Stage/CN=msg-cost-management-turnpike'"
        - name: cost-management-sources
          route: /api/cost-management/sources/v1/
          origin: http://koku-clowder-sources-client.hccm-stage.svc.cluster.local:10000/api/cost-management/v1/
          auth:
            saml: "'cost-management-team' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-cost-management-turnpike/L=Stage/CN=msg-cost-management-turnpike'"
        # - name: cost-management-trino-ui
        #   route: /api/cost-management/v1/trino/
        #   origin: http://presto-coordinator.hccm-stage.svc.cluster.local:8000/ui/
        #   auth:
        #     saml: "'cost-management-team' in user['Role']"
        - name: module-update-router-events
          route: /api/module-update-router/v1/event
          origin: http://module-update-router.module-update-router-stage.svc.cluster.local:8080/api/module-update-router/v1/event
          auth:
            saml: "'clouddot-data' in user['Role']"
        - name: rbac
          route: /api/rbac
          origin: http://rbac-service.rbac-stage.svc.cluster.local:8000/_private/api
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
        - name: rbac-integrations
          route: /api/rbac/v1/integrations
          origin: http://rbac-service.rbac-stage.svc.cluster.local:8000/_private/api/v1/integrations
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
            x509: "True"
        - name: vulnerability-engine-admin
          route: /api/vulnerability
          origin: http://vulnerability-engine-manager-admin-service.vulnerability-engine-stage.svc.cluster.local:8000/api/vulnerability
          auth:
            saml: "'vulnerability-admins' in user['Role']"
        - name: cloudigrade-internal
          route: /api/cloudigrade/internal/
          origin: http://cloudigrade-api.cloudigrade-stage.svc.cluster.local:8000/internal/
          auth:
            saml: "'doppler-dev' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-cloudigrade-turnpike/L=Stage/CN=msg-cloudigrade-turnpike'"
        - name: automation-analytics-oneview
          route: /api/automation-analytics/oneview
          origin: http://automation-analytics-api-oneview-v2.tower-analytics-stage.svc.cluster.local:8000/api/tower-analytics/oneview
          auth:
            saml: "'automation-analytics' in user['Role']"
        - name: vmaas-reposcan
          route: /api/vmaas
          origin: http://vmaas-reposcan-service.vmaas-stage.svc.cluster.local:8000/api/vmaas
          auth:
            saml: "'vulnerability-admins' in user['Role']"
        # - name: patchman-engine-admin
        #   route: /api/patch/
        #   origin: http://patchman-engine-vmaas-sync.patchman-engine-stage.svc.cluster.local:9999/
        #   auth:
        #     saml: "'patch-administrators' in user['Role']"
        - name: playbook-dispatcher-api
          route: /api/playbook-dispatcher/api
          origin: http://${PLAYBOOK_DISPATCHER_HOST}:8000/internal
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
            x509: "True"
        - name: playbook-dispatcher-connect
          route: /api/playbook-dispatcher/connect/
          origin: http://playbook-dispatcher-connect-connect-api.playbook-dispatcher-stage.svc.cluster.local:8083/
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
        - name: xjoin-kafka-connect
          route: /api/xjoin/connect/
          origin: http://xjoin-kafka-connect-strimzi-connect-api.xjoin-stage.svc.cluster.local:8083/
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
        - name: xjoin-elasticsearch
          route: /api/xjoin/elasticsearch/
          origin: https://vpc-xjoin-elasticsearch-yesvit2jsbqwqtlnrsdkorfacm.us-east-1.es.amazonaws.com:9000/
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
        - name: xjoin-search
          route: /api/xjoin/search/
          origin: http://xjoin-search-api.xjoin-stage.svc.cluster.local:9000/
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
        - name: ingress
          route: /api/ingress/v1/
          origin: http://ingress-service.ingress-stage.svc.cluster.local:8000/api/ingress/v1/
          auth:
            saml: "True"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=serviceaccounts/UID=insightspipelineqe/Email=$request.auth_token.mail[0]$/DC=com/DC=redhat/OU=serviceaccounts/CN=insightspipelineqe'"
        - name: drift
          route: /api/drift/admin/
          origin: http://drift-backend-service.drift-stage.svc.cluster.local:8000/api/drift/admin/
          auth:
            saml: "'crc-drift-team' in user['Role']"
        - name: advisor-rule-content-preview
          origin: http://advisor-backend-api.advisor-stage.svc.cluster.local:8000/internal/rule/
          route: /api/insights/v1/rule/
          auth:
            saml: "any(role in ['insights-rule-dev', 'clouddot-infrastructure', 'advisor-dev'] for role in user['Role'])"
        - name: apicast-tests-ping
          origin: http://apicast-tests.apicast-test-services.svc.cluster.local:9092/ping
          route: /api/apicast-tests/ping
          auth:
            saml: "True"
            x509: "True"
        - name: apicast-tests-headers
          origin: http://apicast-tests.apicast-test-services.svc.cluster.local:9092/headers
          route: /api/apicast-tests/headers
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
            x509: "x509['subject_dn'] in ['/DC=com/DC=redhat/OU=users/UID=turnpike/Email=insights-qa@redhat.com/CN=turnpike service account turnpike_qa']"
        - name: payload-tracker
          origin: http://payload-tracker-frontend.payload-tracker-stage.svc.cluster.local:8080/
          route: /app/payload-tracker/
          auth:
            saml: "True"
            x509: "True"

  - namespace:
      $ref: /services/insights/turnpike/namespaces/turnpike-fedramp-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-ext/ci-ext.yml
      name: RedHatInsights-turnpike-gh-build-master
    parameters:
      AUTH_DEBUG: "1"
      FLASK_SERVER_NAME: internal.gov.console.stage.redhat.com
      REDIS_SERVICE_NAME: redis.turnpike-stage.svc.cluster.local
      SETTINGS_JSON: |
        {
          "strict": true,
          "debug": true,
          "sp": {
            "entityId": "https://internal.gov.console.stage.redhat.com/saml/metadata.xml",
            "assertionConsumerService": {
              "url": "https://internal.gov.console.stage.redhat.com/saml/acs/",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
            },
            "singleLogoutService": {
              "url": "https://internal.gov.console.stage.redhat.com/saml/sls/",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "NameIDFormat": "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
          },
          "idp": {
            "entityId": "https://auth.stage.redhat.com/auth/realms/EmployeeIDP",
            "singleSignOnService": {
              "url": "https://auth.stage.redhat.com/auth/realms/EmployeeIDP/protocol/saml",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "singleLogoutService": {
              "url": "https://auth.stage.redhat.com/auth/realms/EmployeeIDP/protocol/saml",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "x509cert": "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"
          }
        }
      ADVANCED_SETTINGS_JSON: |
        {
          "security": {
            "nameIdEncrypted": false,
            "authnRequestsSigned": true,
            "logoutRequestSigned": false,
            "logoutResponseSigned": false,
            "signMetadata": false,
            "wantMessagesSigned": false,
            "wantAssertionsSigned": false,
            "wantNameId" : true,
            "wantNameIdEncrypted": false,
            "wantAssertionsEncrypted": false,
            "signatureAlgorithm": "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",
            "digestAlgorithm": "http://www.w3.org/2001/04/xmlenc#sha256"
          },
          "contactPerson": {
            "technical": {
              "givenName": "Cloud Services Platform Infrastructure",
                  "emailAddress": "clouddot-infrastructure@redhat.com"
              },
              "support": {
                  "givenName": "Cloud Services Platform Infrastructure",
                  "emailAddress": "clouddot-infrastructure@redhat.com"
              }
          },
          "organization": {
            "en-US": {
              "name": "Red Hat Cloud Services Platform Staging",
              "displayname": "RH CSP Stage",
              "url": "https://internal.gov.console.stage.redhat.com/"
            }
          }
        }
      BACKEND_ROUTES: |
        - name: turnpike
          route: /api/turnpike
          origin: http://web.turnpike-stage.svc.cluster.local:5000/api/turnpike
          auth:
            saml: "True"
            x509: "True"
        - name: healthcheck
          route: /public/healthcheck/
          origin: http://web.turnpike-stage.svc.cluster.local:5000/_healthcheck/
        - name: policies-engine-stage
          route: /api/policies-engine/
          origin: http://policies-engine-service.policies-stage.svc.cluster.local:8000/
          auth:
            saml: "'crc-policies-team' in user['Role']"
        - name: policies-ui-backend-stage
          route: /api/policies-ui-backend/
          origin: http://policies-ui-backend-service.policies-stage.svc.cluster.local:8000/
          auth:
            saml: "'crc-policies-team' in user['Role']"
        - name: module-update-router-events
          route: /api/module-update-router/v1/event
          origin: http://module-update-router.module-update-router-stage.svc.cluster.local:8080/api/module-update-router/v1/event
          auth:
            saml: "'clouddot-data' in user['Role']"
        - name: rbac
          route: /api/rbac
          origin: http://${RBAC_HOST}:8080/_private/api
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
        - name: vulnerability-engine-admin
          route: /api/vulnerability
          origin: http://vulnerability-engine-manager-admin-service.vulnerability-engine-stage.svc.cluster.local:8000/api/vulnerability
          auth:
            saml: "'vulnerability-admins' in user['Role']"
        - name: vmaas-reposcan
          route: /api/vmaas
          origin: http://vmaas-reposcan-service.vmaas-stage.svc.cluster.local:8000/api/vmaas
          auth:
            saml: "'vulnerability-admins' in user['Role']"
        # - name: patchman-engine-admin
        #   route: /api/patch/
        #   origin: http://patchman-engine-vmaas-sync.patchman-engine-stage.svc.cluster.local:9999/
        #   auth:
        #     saml: "'patch-administrators' in user['Role']"
        - name: ingress
          route: /api/ingress/v1/
          origin: http://ingress-service.ingress-stage.svc.cluster.local:8000/api/ingress/v1/
          auth:
            saml: "True"
        - name: payload-tracker
          origin: http://payload-tracker-frontend.payload-tracker-stage.svc.cluster.local:8080/
          route: /app/payload-tracker/
          auth:
            saml: "True"
            x509: "True"

  - namespace:
      $ref: /services/insights/turnpike/namespaces/prod-turnpike-prod.yml
    ref: master
    parameters:
      IMAGE_TAG: bc841a0
      FLASK_SERVER_NAME: internal.console.redhat.com
      REDIS_SERVICE_NAME: redis.turnpike-prod.svc.cluster.local
      SETTINGS_JSON: |
        {
          "strict": true,
          "debug": true,
          "sp": {
            "entityId": "https://internal.console.redhat.com/saml/metadata.xml",
            "assertionConsumerService": {
              "url": "https://internal.console.redhat.com/saml/acs/",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST"
            },
            "singleLogoutService": {
              "url": "https://internal.console.redhat.com/saml/sls/",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "NameIDFormat": "urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified"
          },
          "idp": {
            "entityId": "https://auth.redhat.com/auth/realms/EmployeeIDP",
            "singleSignOnService": {
              "url": "https://auth.redhat.com/auth/realms/EmployeeIDP/protocol/saml",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "singleLogoutService": {
              "url": "https://auth.redhat.com/auth/realms/EmployeeIDP/protocol/saml",
              "binding": "urn:oasis:names:tc:SAML:2.0:bindings:HTTP-Redirect"
            },
            "x509cert": "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"
          }
        }
      ADVANCED_SETTINGS_JSON: |
        {
          "security": {
            "nameIdEncrypted": false,
            "authnRequestsSigned": true,
            "logoutRequestSigned": false,
            "logoutResponseSigned": false,
            "signMetadata": false,
            "wantMessagesSigned": false,
            "wantAssertionsSigned": false,
            "wantNameId" : true,
            "wantNameIdEncrypted": false,
            "wantAssertionsEncrypted": false,
            "signatureAlgorithm": "http://www.w3.org/2001/04/xmldsig-more#rsa-sha256",
            "digestAlgorithm": "http://www.w3.org/2001/04/xmlenc#sha256"
          },
          "contactPerson": {
            "technical": {
                  "givenName": "Cloud Services Platform Infrastructure",
                  "emailAddress": "clouddot-infrastructure@redhat.com"
              },
              "support": {
                  "givenName": "Cloud Services Platform Infrastructure",
                  "emailAddress": "clouddot-infrastructure@redhat.com"
              }
          },
          "organization": {
            "en-US": {
              "name": "Red Hat Cloud Services Platform",
              "displayname": "RH CSP",
              "url": "https://internal.console.redhat.com/"
            }
          }
        }
      BACKEND_ROUTES: |
        - name: turnpike
          route: /api/turnpike
          origin: http://web.turnpike-prod.svc.cluster.local:5000/api/turnpike
          auth:
            saml: "True"
            x509: "True"
        - name: healthcheck
          route: /public/healthcheck/
          origin: http://web.turnpike-prod.svc.cluster.local:5000/_healthcheck/
        - name: rhsm-subscriptions
          route: /app/rhsm-subscriptions/
          origin: http://rhsm-subscriptions-worker-monitoring.rhsm-prod.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
            x509: "x509['subject_dn'] in ['/DC=com/DC=redhat/OU=serviceaccounts/UID=rhsmapi/Email=it-pnt@redhat.com/DC=com/DC=redhat/OU=serviceaccounts/CN=rhsmapi']"
        - name: rhsm-rh-marketplace
          route: /app/rhsm-rh-marketplace/
          origin: http://swatch-billing-provider-rh-marketplace.rhsm-prod.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
        - name: rhsm-metrics
          route: /app/rhsm-metrics/
          origin: http://metrics-worker-monitoring.rhsm-prod.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
        - name: rhsm-conduit
          route: /app/rhsm-conduit/
          origin: http://rhsm-conduit.rhsm-prod.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
        - name: rhsm-capacity-ingress
          route: /app/rhsm-capacity-ingress/
          origin: http://rhsm-subscriptions-capacity-ingress-monitoring.rhsm-prod.svc.cluster.local:9000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
        - name: rhsm-capacity-ingress-internal
          route: /app/rhsm-capacity-ingress/internal/
          origin: http://rhsm-subscriptions-capacity-ingress.rhsm-prod.svc.cluster.local:8000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
        - name: rhsm-worker-internal
          route: /app/rhsm-worker/internal/
          origin: http://rhsm-subscriptions-worker.rhsm-prod.svc.cluster.local:8000/
          auth:
            saml: "'subscription-watch-admins' in user['Role']"
        - name: rbac
          route: /api/rbac
          origin: http://rbac-service.rbac-prod.svc.cluster.local:8000/_private/api
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
        - name: rbac-integrations
          route: /api/rbac/v1/integrations
          origin: http://rbac-service.rbac-prod.svc.cluster.local:8000/_private/api/v1/integrations
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
            x509: "True"
        - name: cost-management-masu
          route: /api/cost-management/v1/
          origin: http://koku-clowder-masu.hccm-prod.svc.cluster.local:10000/api/cost-management/v1/
          auth:
            saml: "'cost-management-team' in user['Role']"
            x509: "x509['subject_dn'] == 'CN=cost-management-turnpike,OU=IT IAM,O=Red Hat\, Inc.,L=Raleigh,ST=North Carolina,C=US'"
        # - name: cost-management-trino-ui
        #   route: /api/cost-management/v1/trino/
        #   origin: http://presto-coordinator.hccm-prod.svc.cluster.local:8000/ui/
        #   auth:
        #     saml: "'cost-management-team' in user['Role']"
        - name: policies-engine-prod
          route: /api/policies-engine/
          origin: http://policies-engine-service.policies-prod.svc.cluster.local:8000/
          auth:
            saml: "'crc-policies-team' in user['Role']"
        - name: policies-ui-backend-prod
          route: /api/policies-ui-backend/
          origin: http://policies-ui-backend-service.policies-prod.svc.cluster.local:8000/
          auth:
            saml: "'crc-policies-team' in user['Role']"
        - name: notifications-prod
          route: /api/notifications/
          origin: http://notifications-backend-service.notifications-prod.svc.cluster.local:8000/
          auth:
            saml: "'crc-notifications-team' in user['Role']"
            x509: "True"
        - name: notifications-gw-prod
          route: /api/notifications-gw/
          origin: http://notifications-gw-service.notifications-prod.svc.cluster.local:8000/
          auth:
            saml: "True"
            x509: "True"
        - name: module-update-router-events
          route: /api/module-update-router/v1/event
          origin: http://module-update-router.module-update-router-prod.svc.cluster.local:8080/api/module-update-router/v1/event
          auth:
            saml: "'clouddot-data' in user['Role']"
        - name: cloudigrade-internal
          route: /api/cloudigrade/internal/
          origin: http://cloudigrade-api.cloudigrade-prod.svc.cluster.local:8000/internal/
          auth:
            saml: "'doppler-dev' in user['Role']"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=messaging/OU=serviceusers/UID=msg-cloudigrade-turnpike/L=Prod/CN=msg-cloudigrade-turnpike'"
        - name: vulnerability-engine-admin
          route: /api/vulnerability
          origin: http://vulnerability-engine-manager-admin-service.vulnerability-engine-prod.svc.cluster.local:8000/api/vulnerability
          auth:
            saml: "'vulnerability-admins' in user['Role']"
        - name: automation-analytics-oneview
          route: /api/automation-analytics/oneview
          origin: http://automation-analytics-api-oneview-v2.tower-analytics-prod.svc.cluster.local:8000/api/tower-analytics/oneview
          auth:
            saml: "'automation-analytics' in user['Role']"
        - name: vmaas-reposcan
          route: /api/vmaas
          origin: http://vmaas-reposcan-service.vmaas-prod.svc.cluster.local:8000/api/vmaas
          auth:
            saml: "'vulnerability-admins' in user['Role']"
        - name: playbook-dispatcher-api
          route: /api/playbook-dispatcher/api
          origin: http://${PLAYBOOK_DISPATCHER_HOST}:8000/internal
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
        - name: playbook-dispatcher-connect
          route: /api/playbook-dispatcher/connect/
          origin: http://playbook-dispatcher-connect-connect-api.playbook-dispatcher-prod.svc.cluster.local:8083/
          auth:
            saml: "'crc-pipeline-team' in user['Role']"
        - name: ingress
          route: /api/ingress/v1/
          origin: http://ingress-service.ingress-prod.svc.cluster.local:8000/api/ingress/v1/
          auth:
            saml: "True"
            x509: "x509['subject_dn'] == '/DC=com/DC=redhat/OU=serviceaccounts/UID=insightspipelineqe/Email=$request.auth_token.mail[0]$/DC=com/DC=redhat/OU=serviceaccounts/CN=insightspipelineqe'"
        - name: drift
          route: /api/drift/admin/
          origin: http://drift-backend-service.drift-prod.svc.cluster.local:8000/api/drift/admin/
          auth:
            saml: "'crc-drift-team' in user['Role']"
        - name: kafka-connect
          route: /api/kafka-connect/
          origin: http://platform-kafka-connect-connect-api.platform-mq-prod.svc.cluster.local:8083/
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
        - name: advisor-rule-content-preview
          origin: http://advisor-backend-api.advisor-prod.svc.cluster.local:8000/internal/rule/
          route: /api/insights/v1/rule/
          auth:
            saml: "any(role in ['insights-rule-dev', 'clouddot-infrastructure', 'advisor-dev'] for role in user['Role'])"
        - name: payload-tracker
          origin: http://payload-tracker-frontend.payload-tracker-prod.svc.cluster.local:8080/
          route: /app/payload-tracker/
          auth:
            saml: "True"
            x509: "True"
        - name: apicast-tests-ping
          origin: http://apicast-tests.apicast-test-services-prod.svc.cluster.local:9092/ping
          route: /api/apicast-tests/ping
          auth:
            saml: "True"
            x509: "True"
        - name: apicast-tests-headers
          origin: http://apicast-tests.apicast-test-services-prod.svc.cluster.local:9092/headers
          route: /api/apicast-tests/headers
          auth:
            saml: "'clouddot-infrastructure' in user['Role']"
            x509: "x509['subject_dn'] in ['/DC=com/DC=redhat/OU=users/UID=turnpike/Email=insights-qa@redhat.com/CN=turnpike service account turnpike_qa']"

- name: nginx-prometheus
  path: /templates/prometheus-nginx.yml
  url: https://github.com/RedHatInsights/turnpike
  targets:
  - namespace:
      $ref: /services/insights/turnpike/namespaces/stage-turnpike-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-ext/ci-ext.yml
      name: RedHatInsights-turnpike-gh-build-master
    parameters:
      REPLICAS: 0
  - namespace:
      $ref: /services/insights/turnpike/namespaces/prod-turnpike-prod.yml
    ref: 921dcae65b9b74b855d094f5bfa350d8fb55cbaa
    parameters:
      IMAGE_TAG: bc841a0
      REPLICAS: 0
  - namespace:
      $ref: /services/insights/turnpike/namespaces/turnpike-fedramp-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-ext/ci-ext.yml
      name: RedHatInsights-turnpike-gh-build-master
    parameters:
      REPLICAS: 0

