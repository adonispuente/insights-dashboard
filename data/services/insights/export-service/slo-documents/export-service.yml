---
$schema: /app-sre/slo-document-1.yml

labels:
  service: export-service

name: export-service

app:
  $ref: /services/insights/export-service/app.yml

namespaces:
  - namespace:
      $ref: /services/insights/export-service/namespaces/prod.yml

slos:
- name: Export Service Availability
  SLIType: availability
  SLISpecification: The proportion of successful requests, as measured from the load balancer metrics. Any HTTP status other than 500–599 is considered successful.
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/export-service/SLO.md
  SLOParameters:
    window: 28d
  expr: 1.00 - (sum(rate(api_3scale_gateway_api_status{status="5xx",exported_service="export"}[{{window}}])) / sum(rate(api_3scale_gateway_api_status{exported_service="export"}[{{window}}])))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/export-service-prod/export-service.prometheusrules.yaml
  dashboard: "https://grafana.app-sre.devshift.net/d/ir5blOCVk/exportservice-dashboard?orgId=1&viewPanel=12&var-datasource=crcp01ue1-prometheus"

- name: Export Service Latency
  SLIType: latency
  SLISpecification: The proportion of sufficiently fast requests, as measured from the load balancer metrics. "Sufficiently fast” is defined as < 500 ms. 
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/export-service/SLO.md
  SLOParameters:
    window: 28d
  expr: sum(rate(api_3scale_gateway_api_time_bucket{le="0500.0", exported_service="export"}[{{window}}])) / sum(rate(api_3scale_gateway_api_time_bucket{le="+Inf", exported_service="export"}[{{window}}]))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/export-service-prod/export-service.prometheusrules.yaml
  dashboard: "https://grafana.app-sre.devshift.net/d/ir5blOCVk/exportservice-dashboard?orgId=1&var-datasource=crcp01ue1-prometheus&editPanel=14"

- name: Export Service Error Rate
  SLIType: availability
  SLISpecification: The percentage of requests that result in an error or failure. Any HTTP status other than 500–599 is considered successful.
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/export-service/SLO.md
  SLOParameters:
    window: 28d
  expr: 1.0 - (sum(rate(export_service_http_requests_total{container="export-service-service", path="", code="5.*"}[{{window}}]) or vector(0)) / (sum(rate(export_service_http_requests_total{container="export-service-service", path=""}[{{window}}])) + 0.00001))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/export-service-prod/export-service.prometheusrules.yaml
  dashboard: "https://grafana.app-sre.devshift.net/d/ir5blOCVk/exportservice-dashboard?orgId=1&var-datasource=crcp01ue1-prometheus&viewPanel=18"
