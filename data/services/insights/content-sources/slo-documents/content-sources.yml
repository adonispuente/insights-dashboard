---
$schema: /app-sre/slo-document-1.yml

labels:
  service: content-sources

name: content-sources

app:
  $ref: /services/insights/content-sources/app.yml

namespaces:
- $ref: /services/insights/content-sources/namespaces/content-sources-prod.yml

slos:
- name: API success rate
  SLIType: availability
  SLISpecification: The proportion of non-500 HTTP requests
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/console.redhat.com/app-sops/content-sources/ApiSuccessRateSloDetails.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(content_sources_http_status_histogram_count{status!="5xx"}[{{window}}])) / sum(rate(content_sources_http_status_histogram_count[{{window}}]))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/content-sources-prod/content-sources-prod.prometheusrules.yml
  dashboard: https://grafana.app-sre.devshift.net/d/content-sources/content-sources

- name: API request latency
  SLIType: latency
  SLISpecification: The proportion of HTTP requests that return within 500ms
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/console.redhat.com/app-sops/content-sources/ApiRequestLatencySloDetails.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(content_sources_http_status_histogram_bucket{le="0.5",path!="/api/content-sources/v1.0/repository_parameters/validate|/api/content-sources/v1.0/repository_parameters/external_gpg_key"}[{{window}}]))/sum(rate(content_sources_http_status_histogram_count{path!="/api/content-sources/v1.0/repository_parameters/validate|/api/content-sources/v1.0/repository_parameters/external_gpg_key"}[{{window}}]))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/content-sources-prod/content-sources-prod.prometheusrules.yml
  dashboard: https://grafana.app-sre.devshift.net/d/content-sources/content-sources
- name: Message Latency
  SLIType: latency
  SLISpecification: The proportion of message/task requests that have not started processing in 60 minutes
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/console.redhat.com/app-sops/content-sources/MessageLatencySLODetails.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(content_sources_message_latency_bucket{le="3600"}[{{window}}]))/sum(rate(content_sources_message_latency_count[{{window}}]))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/content-sources-prod/content-sources-prod.prometheusrules.yml
  dashboard: https://grafana.app-sre.devshift.net/d/content-sources/content-sources
