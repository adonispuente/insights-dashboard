---
$schema: /app-sre/slo-document-1.yml

labels:
  service: receptor

name: receptor

namespaces:
- $ref: /services/insights/receptor/namespaces/receptor-prod.yml

app:
  $ref:  /services/insights/receptor/app.yml

slos:
- name: Websocket requests result in successful (non-5xx) response
  dashboard: https://grafana.app-sre.devshift.net/d/FRmd1NeWk1/receptor-controller?orgId=1
  SLIType: availability
  SLISpecification: Proportion of sucessful websocket requests with a non-5xx response against all requests on receptor websocket API
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  SLOParameters:
    window: 28d
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/receptor/SLO.md
  expr: |
    sum(rate(
      api_3scale_gateway_api_status{exported_service="receptor-controller", status!="5xx"}[{{window}}]
    )) / sum(rate(
      api_3scale_gateway_api_status{exported_service="receptor-controller"}[{{window}}]
    ))
  prometheusRules: /resources/insights-prod/receptor-prod/receptor.prometheusrules.yml

- name: API requests result in successful (non-5xx) response
  dashboard: https://grafana.app-sre.devshift.net/d/FRmd1NeWk1/receptor-controller?orgId=1
  SLIType: availability
  SLISpecification: Proportion of sucessful API requests with a non-5xx response against all requests on receptor internal API
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  SLOParameters:
    window: 28d
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/receptor/SLO.md
  expr: |
    sum(rate(
      receptor_contoller_http_status_code_counter{service="receptor-controller", status_code!~"5.*"}[{{window}}]
    )) / sum(rate(
      receptor_contoller_http_status_code_counter{service="receptor-controller"}[{{window}}]
    ))
  prometheusRules: /resources/insights-prod/receptor-prod/receptor.prometheusrules.yml

- name: Successful response message delivery
  dashboard: https://grafana.app-sre.devshift.net/d/FRmd1NeWk1/receptor-controller?orgId=1
  SLIType: availability
  SLISpecification: Proportion of sucessful response message delivery
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  SLOParameters:
    window: 28d
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/tree/master/docs/console.redhat.com/app-sops/receptor/SLO.md
  expr: |
    sum(rate(
      receptor_controller_kafka_response_writer_success_count[{{window}}]
    )) / sum(rate(
      sum(receptor_controller_payload_message_sizes_count)[{{window}}]
    ))
  prometheusRules: /resources/insights-prod/receptor-prod/receptor.prometheusrules.yml
