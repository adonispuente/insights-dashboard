---
$schema: /app-sre/saas-file-1.yml

labels:
  service: topological-inventory
  platform: insights

name: topological-inventory
description: topological-inventory app on the Insights Platform

app:
  $ref: /services/insights/topological-inventory/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-insights-info

managedResourceTypes:
- Deployment
- DeploymentConfig
- Service
- ServiceAccount
- RoleBinding
- HorizontalPodAutoscaler
- CronJob

imagePatterns:
- quay.io/cloudservices

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all

resourceTemplates:
- name: topological-inventory-ingress-api
  path: /templates/topological-inventory/topological-inventory-ingress-api.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 8aec443
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 0e9f5b0
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-amazon-operations
  path: /templates/topological-inventory/topological-inventory-amazon-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: a0667cd
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 327d395
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-ansible-tower-operations
  path: /templates/topological-inventory/topological-inventory-ansible-tower-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: d88941a
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9274d974fd7cbaf915ac2a47834f9d9d9c4f32b3
    parameters:
      IMAGE_TAG: 484abf0
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
      REPLICAS: "2"
- name: topological-inventory-api
  path: /templates/topological-inventory/topological-inventory-api.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
    PGSSLMODE: verify-full
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 8581108
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 9c565b2
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-azure-operations
  path: /templates/topological-inventory/topological-inventory-azure-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 33827bc
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 24ff4fe
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-openshift-operations
  path: /templates/topological-inventory/topological-inventory-openshift-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 4c95c1a
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 7fc8af1
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-orchestrator
  path: /templates/topological-inventory/topological-inventory-orchestrator.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 60b1ba7
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
      COLLECTOR_LIMIT_CPU: 200m
      COLLECTOR_LIMIT_MEM: 700Mi
      COLLECTOR_REQUEST_CPU: 50m
      COLLECTOR_REQUEST_MEM: 300Mi
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: e17f6ca5e6f4b4448f349504e0791a4c9714b1ab
    parameters:
      IMAGE_TAG: 0471eda
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
      ENABLED_SOURCE_TYPES: ansible-tower
      COLLECTOR_LIMIT_CPU: 200m
      COLLECTOR_LIMIT_MEM: 700Mi
      COLLECTOR_REQUEST_CPU: 50m
      COLLECTOR_REQUEST_MEM: 300Mi
- name: topological-inventory-persister
  path: /templates/topological-inventory/topological-inventory-persister.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PGSSLMODE: verify-full
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 23fb0fb
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
      REPLICAS: "2"
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 3692bd0d62ae0e4827eabef0c3c893da25174cec
    parameters:
      IMAGE_TAG: bf5fc1c
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
      PERSISTER_MEMORY_LIMIT: 500Mi
      PERSISTER_CPU_LIMIT: 500m
      REPLICAS: "5"
- name: topological-inventory-satellite-operations
  path: /templates/topological-inventory/topological-inventory-satellite-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 4c3a1ff
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 4c3a1ff
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-sources-sync
  path: /templates/topological-inventory/topological-inventory-sources-sync.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PGSSLMODE: verify-full
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 58f22ae
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage-cw
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 0020d3fba6eed726f5626a7acebd8d42a1161e44
    parameters:
      IMAGE_TAG: e4db79a
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-scheduler
  path: /templates/topological-inventory/topological-inventory-scheduler.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: bb56f77
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  #- namespace:
  #    $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
  #  ref: xxxxxxx
  #  parameters:
  #    IMAGE_TAG: xxxxxxx
  #    CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-ansible-tower-targeted-collector
  path: /templates/topological-inventory/topological-ansible-tower-targeted-collector.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: d88941a
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  #- namespace:
  #    $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
  #  ref: xxxxxxxx
  #  parameters:
  #    IMAGE_TAG: xxxxxxx
  #    CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-host-inventory-sync
  path: /templates/topological-inventory/topological-inventory-host-inventory-sync.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 58f22ae
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 0827e0a5359d5cf11ca8053e359d365f50981a5f
    parameters:
      IMAGE_TAG: e4db79a
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
- name: topological-inventory-metric-scaler
  path: /templates/topological-inventory/topological-inventory-metric-scaler.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: master
    parameters:
      IMAGE_TAG: 60b1ba7
      CLOUD_WATCH_LOG_GROUP: topological-inventory-stage
      REPLICAS: 0
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: c4399a3b234690a0b070b9dc75986bf3e8bf5d29
    parameters:
      IMAGE_TAG: 0471eda
      CLOUD_WATCH_LOG_GROUP: topological-inventory-prod-cw
      REPLICAS: 0
