---
$schema: /app-sre/saas-file-1.yml

labels:
  service: topological-inventory
  platform: insights

name: topological-inventory
description: topological-inventory app on the Insights Platform

app:
  $ref: /services/insights/topological-inventory/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-clouddot-info

timeout: 5

managedResourceTypes:
- Deployment
- DeploymentConfig
- Service
- ServiceAccount
- RoleBinding
- HorizontalPodAutoscaler
- CronJob

imagePatterns:
- quay.io/cloudservices

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all

resourceTemplates:
- name: topological-inventory-ingress-api
  path: /templates/topological-inventory/topological-inventory-ingress-api.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: a397e5a71ebb16430760895da4a07bb5899605c4
    parameters:
      IMAGE_TAG: d6fd107
      MIN_REPLICAS: 3
      LOG_LEVEL: WARN
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: d6fd107
      MIN_REPLICAS: 3
      LOG_LEVEL: WARN
- name: topological-inventory-amazon-operations
  path: /templates/topological-inventory/topological-inventory-amazon-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 5f169c3efa6772957019a4f8a1af29c9e4f9188f
    parameters:
      IMAGE_TAG: b67fdee
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: b67fdee
      REPLICAS: '2'
- name: topological-inventory-ansible-tower-operations
  path: /templates/topological-inventory/topological-inventory-ansible-tower-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 5f169c3efa6772957019a4f8a1af29c9e4f9188f
    parameters:
      IMAGE_TAG: e98a861
      REPLICAS: "0"
      LOG_LEVEL: WARN
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 6525802aa70d86266b0f2d0ee3dee6494242a6fd
    parameters:
      IMAGE_TAG: e98a861
      REPLICAS: "3"
      LOG_LEVEL: WARN
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
- name: topological-inventory-api
  path: /templates/topological-inventory/topological-inventory-api.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
    PGSSLMODE: verify-full
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 8812e218fbe0b61bb83dc35bb416f063608bd042
    parameters:
      IMAGE_TAG: 03d91dd
      LOG_LEVEL: WARN
      REPLICAS: "2"
      HABERDASHER_EMITTER: kafka
      HABERDASHER_KAFKA_BOOTSTRAP: ${KAFKA_BOOTSTRAP_HOST}:9092
      HABERDASHER_KAFKA_TOPIC: platform.logging.logs
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: a258ad8
      LOG_LEVEL: WARN
      REPLICAS: "2"
- name: topological-inventory-azure-operations
  path: /templates/topological-inventory/topological-inventory-azure-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 5f169c3efa6772957019a4f8a1af29c9e4f9188f
    parameters:
      IMAGE_TAG: dec72fa
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: dec72fa
      REPLICAS: '2'
- name: topological-inventory-google-operations
  path: /templates/topological-inventory/topological-inventory-google-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 5f169c3efa6772957019a4f8a1af29c9e4f9188f
    parameters:
      REPLICAS: '1'
      IMAGE_TAG: b5c021d
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 5f169c3efa6772957019a4f8a1af29c9e4f9188f
    parameters:
      IMAGE_TAG: b5c021d
      REPLICAS: '2'
- name: topological-inventory-openshift-operations
  path: /templates/topological-inventory/topological-inventory-openshift-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: e70e13a51a3a0847b34e064dd2ccfa75e1d479eb
    parameters:
      IMAGE_TAG: 02d6151
      HABERDASHER_EMITTER: kafka
      HABERDASHER_KAFKA_BOOTSTRAP: ${KAFKA_BOOTSTRAP_HOST}:9092
      HABERDASHER_KAFKA_TOPIC: platform.logging.logs
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 38604d1
- name: topological-inventory-orchestrator
  path: /templates/topological-inventory/topological-inventory-orchestrator.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: da4dba705a9b49c9586d69d0888609752d71683d
    parameters:
      IMAGE_TAG: a7d63c7
      COLLECTOR_LIMIT_CPU: 200m
      COLLECTOR_LIMIT_MEM: 700Mi
      COLLECTOR_REQUEST_CPU: 50m
      COLLECTOR_REQUEST_MEM: 300Mi
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
      REPLICAS: "1"
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 29c90535e6132bb435b2e2ffeac90f9a1cbf4877
    parameters:
      IMAGE_TAG: a7d63c7
      ENABLED_SOURCE_TYPES: ansible-tower
      COLLECTOR_LIMIT_CPU: 200m
      COLLECTOR_LIMIT_MEM: 700Mi
      COLLECTOR_REQUEST_CPU: 50m
      COLLECTOR_REQUEST_MEM: 300Mi
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
- name: topological-inventory-persister
  path: /templates/topological-inventory/topological-inventory-persister.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PGSSLMODE: verify-full
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: c5397ce
      REPLICAS: "5"
      LOG_LEVEL: WARN
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: c5397ce
      PERSISTER_MEMORY_LIMIT: 500Mi
      PERSISTER_CPU_LIMIT: 500m
      REPLICAS: "10"
      LOG_LEVEL: WARN
- name: topological-inventory-satellite-operations
  path: /templates/topological-inventory/topological-inventory-satellite-operations.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
#  - namespace:
#      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
#    ref: 6525802aa70d86266b0f2d0ee3dee6494242a6fd
#    parameters:
#      IMAGE_TAG: 3f9be0b
#      REPLICAS: 1
#      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
#      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 6525802aa70d86266b0f2d0ee3dee6494242a6fd
    parameters:
      IMAGE_TAG: 3f9be0b
      MEMORY_LIMIT: 600Mi
      REPLICAS: 1
      UPDATE_SOURCES_VIA_API: '1'
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
- name: topological-inventory-sources-sync
  path: /templates/topological-inventory/topological-inventory-sources-sync.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PGSSLMODE: verify-full
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: a5d3888
      REPLICAS: "1"
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 735aced
- name: topological-inventory-db-cleaner
  path: /templates/topological-inventory/topological-inventory-db-cleaner.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 3f7a1e8
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 3f7a1e8
- name: topological-inventory-scheduler
  path: /templates/topological-inventory/topological-inventory-scheduler.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 3f7a1e8
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 3f7a1e8
- name: topological-ansible-tower-targeted-collector
  path: /templates/topological-inventory/topological-ansible-tower-targeted-collector.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 7a8ed5f597db30fa0275ebe77812e9ee7d195b0b
    parameters:
      IMAGE_TAG: e98a861
      REPLICAS: "0"
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 363368f181647e17fd38f0a4b3165b65b924ee5a
    parameters:
      IMAGE_TAG: e98a861
      REPLICAS: "3"
      MEMORY_REQUEST: 500Mi
      MEMORY_LIMIT: 2Gi
      RECEPTOR_CONTROLLER_SECRET_NAME: topological-inventory-psk
      RECEPTOR_CONTROLLER_SECRET_KEY_PSK: client-psk
- name: topological-inventory-full-sources-sync
  path: /templates/topological-inventory/topological-inventory-full-sources-sync.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: da4dba705a9b49c9586d69d0888609752d71683d
    parameters:
      IMAGE_TAG: a5d3888
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 735aced
- name: topological-inventory-host-inventory-sync
  path: /templates/topological-inventory/topological-inventory-host-inventory-sync.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  parameters:
    PATH_PREFIX: api
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 7a8ed5f597db30fa0275ebe77812e9ee7d195b0b
    parameters:
      IMAGE_TAG: a5d3888
      REPLICAS: "1"
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: 735aced
- name: topological-inventory-metric-scaler
  path: /templates/topological-inventory/topological-inventory-metric-scaler.yaml
  url: https://gitlab.cee.redhat.com/insights-platform/saas-templates
  targets:
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/stage-topological-inventory-stage.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: df3d275
      REPLICAS: 0
  - namespace:
      $ref: /services/insights/topological-inventory/namespaces/topological-inventory-prod.yml
    ref: 9a60891b1bb246a0d3d07eec635c1981278e4654
    parameters:
      IMAGE_TAG: df3d275
      REPLICAS: 0
