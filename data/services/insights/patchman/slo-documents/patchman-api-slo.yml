---
$schema: /app-sre/slo-document-1.yml

labels:
  service: patchman

name: patchman

app:
  $ref: /services/insights/patchman/app.yml

namespaces:
  - namespace:
      $ref: /services/insights/patchman/namespaces/patchman-engine-prod.yml

slos:
- name: patchman availability
  SLIType: availability
  SLISpecification: ratio of HTTP response codes that are not 5xx
  SLODetails: https://github.com/RedHatInsights/patchman-engine
  SLOParameters:
    window: 28d
  expr: 1.00 - (sum(rate(api_3scale_gateway_api_status{exported_service="patch", status="5xx"}[{{window}}])) / sum(rate(api_3scale_gateway_api_status{exported_service="patch"}[{{window}}])))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: resources/insights-prod/patchman-engine-prod/patchman-engine-prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/d/patch/patchman-engine?orgId=1

- name: patchman latency
  SLIType: latency
  SLISpecification: ratio of services request durations under 2 seconds 
  SLODetails: https://github.com/RedHatInsights/patchman-engine
  SLOParameters:
    window: 28d
  expr: avg_over_time(service:sli:latency_gt_2000:pctl10rate5m{exported_service="patch"}[{{window}}])
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: resources/insights-prod/patchman-engine-prod/patchman-engine-prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/d/patch/patchman-engine?orgId=1
