---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2020-09-02-001-select-users-groups
namespace:
  $ref: /services/insights/automation-hub/namespaces/stage-automation-hub-stage.yml
identifier: automation-hub-stage
output: stdout
query: |
  SELECT users.id, users.username, groups.id, groups.name
  FROM galaxy_user users
          INNER JOIN galaxy_user_groups gug ON users.id = gug.user_id
          INNER JOIN auth_group groups ON groups.id = gug.group_id
  UNION ALL
  SELECT users.id, users.username, NULL, NULL
  FROM galaxy_user users
          LEFT JOIN galaxy_user_groups gug ON users.id = gug.user_id
  WHERE gug.user_id IS NULL
  UNION ALL
  SELECT NULL, NULL, groups.id, groups.name
  FROM auth_group groups
          LEFT JOIN galaxy_user_groups gug ON groups.id = gug.group_id
  WHERE gug.group_id IS NULL;
