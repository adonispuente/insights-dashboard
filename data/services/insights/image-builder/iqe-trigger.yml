---
$schema: /app-sre/saas-file-2.yml
labels:
  service: image-builder
name: image-builder-iqe-trigger
description: Trigger for IQE pipelines
app:
  $ref: /services/image-builder/app.yml
pipelinesProvider:
  $ref: /services/image-builder/pipelines/tekton.image-builder-pipelines.app-sre-prod-01.yml
managedResourceTypes:
- Job

publishJobLogs: true
imagePatterns:
- quay.io/app-sre

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all
resourceTemplates:
- name: IQE-trigger
  url: https://github.com/osbuild/image-builder
  path: /templates/iqe-trigger.yml
  targets:
  - namespace:
      $ref: /services/insights/image-builder/namespaces/stage-image-builder-stage.yml
    ref: a841f01d531c7dc9ffa68b833fa8f4962e99e08c
    promotion:
      auto: true
      subscribe:
      - image-builder-stage-deploy-success-channel
      promotion_data:
      - channel: image-builder-stage-deploy-success-channel
        data:
        - parent_saas: image-builder
          target_config_hash: 61939c94dda0b8af
          type: parent_saas_config
    secretParameters:
    - name: WEBHOOK_URL
      secret:
        path: insights/secrets/qe/stage/image-builder
        field: webhook_url
        version: 2
  - namespace:
      $ref: /services/insights/image-builder/namespaces/prod-image-builder-prod.yml
    ref: 7fbbd569f7b9da49fd0aa888c97dfde6e378d003
    promotion:
      auto: true
      subscribe:
      - image-builder-prod-deploy-success-channel
      promotion_data:
      - channel: image-builder-prod-deploy-success-channel
        data:
        - parent_saas: image-builder
          target_config_hash: bc1e204ec2c9b122
          type: parent_saas_config
    secretParameters:
    - name: WEBHOOK_URL
      secret:
        path: insights/secrets/qe/prod/image-builder
        field: webhook_url
        version: 3
