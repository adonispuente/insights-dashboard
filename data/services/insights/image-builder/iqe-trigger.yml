---
$schema: /app-sre/saas-file-2.yml
labels:
  service: image-builder
name: image-builder-iqe-trigger
description: Trigger for IQE pipelines
app:
  $ref: /services/image-builder/app.yml
pipelinesProvider:
  $ref: /services/image-builder/pipelines/tekton.image-builder-pipelines.appsrep05ue1.yml
managedResourceTypes:
- Job

publishJobLogs: true
imagePatterns:
- quay.io/app-sre

allowedSecretParameterPaths:
- insights/secrets/qe

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all
resourceTemplates:
- name: IQE-trigger
  url: https://github.com/osbuild/image-builder
  path: /templates/iqe-trigger.yml
  targets:
  - namespace:
      $ref: /services/insights/image-builder/namespaces/stage-image-builder-stage.yml
    ref: 00a28a72ffb7936e302974e75831a4373b6dd1e7
    promotion:
      auto: true
      subscribe:
      - image-builder-stage-deploy-success-channel
      promotion_data:
      - channel: image-builder-stage-deploy-success-channel
        data:
        - parent_saas: image-builder
          target_config_hash: 3e4d89134f996d29
          type: parent_saas_config
    secretParameters:
    - name: WEBHOOK_URL
      secret:
        path: insights/secrets/qe/stage/image-builder
        field: webhook_url
        version: 2
  - namespace:
      $ref: /services/insights/image-builder/namespaces/prod-image-builder-prod.yml
    ref: 00a28a72ffb7936e302974e75831a4373b6dd1e7
    promotion:
      auto: true
      subscribe:
      - image-builder-prod-deploy-success-channel
      promotion_data:
      - channel: image-builder-prod-deploy-success-channel
        data:
        - parent_saas: image-builder
          target_config_hash: a52274f1e23448ba
          type: parent_saas_config
    secretParameters:
    - name: WEBHOOK_URL
      secret:
        path: insights/secrets/qe/prod/image-builder
        field: webhook_url
        version: 3
