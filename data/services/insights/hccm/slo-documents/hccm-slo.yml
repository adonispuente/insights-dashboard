---
$schema: /app-sre/slo-document-1.yml

labels:
  service: app-interface

name: app-interface

app:
  $ref: /services/insights/hccm/app.yml

namespaces:
- $ref: /services/insights/hccm/namespaces/hccm-prod.yml

slos:
- name: Cost Management API Availability
  SLIType: availability
  SLISpecification: ratio of HTTP response codes that are not 5xx
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/console.redhat.com/app-sops/hccm/App-koku-5xx-In-hccm.rst
  SLOParameters:
    window: 28d
  expr: 1.00 - (sum(rate(api_3scale_gateway_api_status{exported_service="cost-management", status="5xx"}[{{window}}])) / sum(rate(api_3scale_gateway_api_status{exported_service="cost-management"}[{{window}}])))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/hccm-prod/hccm.prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/d/slo-dashboard/slo-dashboard?orgId=1&var-datasource=crcp01ue1-prometheus&var-label=cost-management&viewPanel=36

- name: Cost Management API Latency
  SLIType: latency
  SLISpecification: ratio of services request durations under 2 seconds
  SLODetails: https://gitlab.cee.redhat.com/service/app-interface/-/blob/master/docs/console.redhat.com/app-sops/hccm/App-koku-api-latency.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(api_3scale_gateway_api_time_bucket{le="2000.0", exported_service="cost-management"}[{{window}}]))
    /
    sum(rate(api_3scale_gateway_api_time_count{exported_service="cost-management"}[{{window}}]))
  SLOTarget: 0.90
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/hccm-prod/hccm.prometheusrules.yaml
  dashboard: https://grafana.app-sre.devshift.net/d/slo-dashboard/slo-dashboard?var-datasource=crcp01ue1-prometheus&var-label=cost-management&viewPanel=32
