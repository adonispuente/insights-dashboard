---
$schema: /app-sre/saas-file-2.yml

labels:
  service: xjoin-operator
  platform: insights

name: xjoin-operator
description: xjoin operator on the Insights Platform

app:
  $ref: /services/insights/xjoin/app.yml

pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.app-sre-prod-01.yaml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-clouddot-info

managedResourceTypes:
- ConfigMap
- OperatorGroup
- CatalogSource
- Subscription
- Service
- XJoinPipeline

imagePatterns:
- quay.io/cloudservices

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all
  code:
    path: app-sre/creds/github-app-sre-bot
    field: openshift-saas-deploy

resourceTemplates:
- name: xjoin-operator
  path: /deploy/operator.yml
  url: https://github.com/RedHatInsights/xjoin-operator
  parameters:
    RECONCILE_INTERVAL: "120"
    ES_CONNECTOR_TASKS_MAX: "50"
    KAFKA_TOPIC_PARTITIONS: "500"
    KAFKA_TOPIC_REPLICAS: "2"
  targets:
  - namespace:
      $ref: /services/insights/xjoin/namespaces/stage-xjoin-operator-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: RedHatInsights-xjoin-operator-gh-build-catalog-master-upstream-RedHatInsights-xjoin-operator-gh-build-master
    parameters:
      TARGET_NAMESPACE: xjoin-operator-stage
      LOG_LEVEL: "info"
      VALIDATION_INTERVAL: "1800"
      VALIDATION_ATTEMPTS_THRESHOLD: "2"
      VALIDATION_ATTEMPTS_THRESHOLD_INIT: "30"
      MANAGER_POD_MEM_LIMIT: "8Gi"
      MANAGER_POD_CPU_LIMIT: "4"
      MANAGER_POD_MEM_REQUESTS: "512Mi"
      MANAGER_POD_CPU_REQUESTS: "250m"
      FULL_VALIDATION_ENABLED: "true"
  - namespace:
      $ref: /services/insights/xjoin/namespaces/xjoin-operator-prod.yml
    ref: 35c1f37beabf19035d0ae3a2d0543fdd224322d2
    parameters:
      TARGET_NAMESPACE: xjoin-operator-prod
      VALIDATION_PERIOD_MINUTES: "90"
      VALIDATION_LAG_COMPENSATION_SECONDS: "600"
      VALIDATION_ATTEMPTS_THRESHOLD: "2"
      VALIDATION_INTERVAL: "600"
      VALIDATION_INTERVAL_INIT: "60"
      VALIDATION_ATTEMPTS_THRESHOLD_INIT: "30"
      LOG_LEVEL: "info"
      MANAGER_POD_MEM_LIMIT: "16Gi"
      MANAGER_POD_CPU_LIMIT: "4"
      MANAGER_POD_MEM_REQUESTS: "2Gi"
      MANAGER_POD_CPU_REQUESTS: "1"
      FULL_VALIDATION_ENABLED: "true"
- name: xjoin-pipeline
  path: /deploy/pipeline.yml
  url: https://github.com/RedHatInsights/xjoin-operator
  targets:
  - namespace:
      $ref: /services/insights/xjoin/namespaces/stage-xjoin-operator-stage.yml
    ref: master
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: RedHatInsights-xjoin-operator-gh-build-master
  - namespace:
      $ref: /services/insights/xjoin/namespaces/xjoin-operator-prod.yml
    ref: 685ea35d121f9da4e36cb41ca7d75362d96d48bd
    parameters:
      KAFKA_CLUSTER_NAMESPACE: "platform-mq-prod"
      CONNECT_CLUSTER_NAMESPACE: "xjoin-prod"
