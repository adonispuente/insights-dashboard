---
$schema: /app-sre/slo-document-1.yml

labels:
  service: ephemeral-namespace-operator

name: ephemeral-namespace-operator

app:
  $ref: /services/insights/ephemeral-namespace-operator/app.yml

namespaces:
  - namespace:
      $ref: /services/insights/ephemeral-namespace-operator/namespaces/prod.yml

slos:
- name: ephemeral-namespace controller reconciliation time for ephemeral-namespace Operator
  SLIType: correctness
  SLISpecification: Percentage of ephemeral-namespace controller Reconciliations that complete within 4 seconds 
  SLODetails: https://github.com/RedHatInsights/ephemeral-namespace-operator/blob/main/docs/slos/ephemeral-namespace-operator-reconciliation-time.md
  SLOParameters:
    window: 28d
  expr: sum(avg_over_time(controller_runtime_reconcile_time_seconds_bucket{controller=~"namespacepool|namespacereservation|clowdenvironment", le="4"}[{{window}}])) / sum(avg_over_time(controller_runtime_reconcile_time_seconds_bucket{controller=~"namespacepool|namespacereservation|clowdenvironment", le="+Inf"}[{{window}}]))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: resources/insights-prod/ephemeral-namespace-operator/ephemeral-namespace-operator.prometheusrules.yaml
  dashboard: https://grafana.stage.devshift.net/d/GSX6u0bnz/ephemeral-namespace-operator-metrics?orgId=1&var-datasource=crcp01ue1-prometheus&from=now-1h&to=now
