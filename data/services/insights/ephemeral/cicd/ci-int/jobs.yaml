---
$schema: /dependencies/jenkins-config-1.yml

labels:
  service: insights-ephemeral

name: ci-int-insights-ephemeral-jobs

description: 'Build pipeline for ephemeral env components'

app:
  $ref: /services/insights/ephemeral/app.yml

instance:
  $ref: /dependencies/ci-int/ci-int.yml

type: jobs

config:
- project:
    name: mbop
    label: insights
    node: insights
    gh_org: RedHatInsights
    gh_repo: mbop
    quay_org: cloudservices
    jobs:
    - "insights-gh-pr-check":
        display_name: insights-mbop pr-check
    - "insights-gh-build-master":
        display_name: insights-mbop build-master
    - "insights-gh-build-master":
        display_name: insights-mbop build-security-compliance
        branch: security-compliance
    - "insights-gh-scheduled-rebuild":
        display_name: insights-mbop build-security-compliance-weekly
        branch: security-compliance
        cron_expression: "H H(0-3) * * 6"
        ci_cmd: './build_deploy.sh'
- project:
    name: insights-ephemeral-namespace-reconciler
    label: insights-ephemeral
    node: insights
    gh_org: RedHatInsights
    gh_repo: bonfire
    jobs:
    # ---- run the sync metrics script
    - 'insights-ephemeral-namespace-reconciler':
        branch: v2.9.1
        display_name: "insights-ephemeral-namespace-reconciler"
        cron_expression: '*/2 * * * *'
        ci_cmd: './utils/namespace_reservation_reconciler.sh'
- project:
    name: postgresql-rds
    label: insights
    node: insights
    gl_group: insights-platform
    gl_project: postgresql-rds
    quay_org: cloudservices
    jobs:
    - 'insights-gl-build-master':
        display_name: postgresql-rds build-master
- project:
    name: insights-front-end-aggregator
    label: insights
    node: insights
    gl_group: insights-platform
    gl_project: front-end-aggregator
    quay_org: cloudservices
    jobs:
    - insights-gl-pr-check:
        display_name: insights-front-end-aggregator pr-check
    - insights-gl-build-master:
        display_name: insights-front-end-aggregator build-master
- project:
    name: insights-mocks
    label: insights
    node: insights
    gh_org: RedHatInsights
    gh_repo: mocks
    quay_org: cloudservices
    jobs:
    - "insights-gh-pr-check":
        display_name: insights-mocks pr-check
    - "insights-gh-build-master":
        display_name: insights-mocks build-master
