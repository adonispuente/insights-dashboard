---
$schema: /app-interface/app-interface-sql-query-1.yml
labels: {}
name: 2023-09-06-notification-db-blocking-processes-and-locks
namespace:
  $ref: /services/insights/ccx-data-pipeline/namespaces/stage-ccx-data-pipeline-stage.yml
identifier: ccx-notification-db-stage
output: stdout
queries:
  - |
    SELECT
        activity.pid,
        activity.usename,
        activity.query,
        blocking.pid AS blocking_id,
        blocking.query AS blocking_query
    FROM pg_stat_activity AS activity
    JOIN pg_stat_activity AS blocking ON blocking.pid = ANY(pg_blocking_pids(activity.pid));
