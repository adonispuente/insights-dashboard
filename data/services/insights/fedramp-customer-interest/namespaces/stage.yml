$schema: /openshift/namespace-1.yml

labels:
  service: fedramp-customer-interest

name: fedramp-customer-interest-stage
description: Stage namespace for fedramp-customer-interest service
cluster:
  $ref: /openshift/crcs02ue1/cluster.yml
app:
  $ref: /services/insights/fedramp-customer-interest/app.yml
environment:
  $ref: /products/insights/environments/stage.yml
managedRoles: true
managedExternalResources: true
managedResourceTypes:
- Role
- RoleBinding
externalResources:
- provider: aws
  provisioner:
    $ref: /aws/insights-stage/account.yml
  resources:
    - provider: s3
      identifier: fedramp-customer-interest-rob-stage
      defaults: /terraform/resources/s3-public-read-1.yml
      output_resource_name: fedramp-customer-interest-rob-s3
      bucket_policy:
        {
          "Version": "2012-10-17",
          "Statement": [
            {
              "Sid": "PublicRead",
              "Effect": "Allow",
              "Principal": "*",
              "Action": "s3:GetObject",
              "Resource": "arn:aws:s3:::fedramp-customer-interest-rob-stage/*"
            }
          ]
        }
openshiftResources:
- provider: vault-secret
  path: insights/quay/quay.io
  version: 3
  type: kubernetes.io/dockerconfigjson
  name: quay-cloudservices-pull
- provider: vault-secret
  path: insights/secrets/insights-stage/fedramp-customer-interest-stage/servicenow
  version: 2
  annotations:
    qontract.recycle: "true"
# Port forwarding for debugging
- provider: resource
  path: /insights-stage/fedramp-customer-interest-stage/allow-port-forwarding.role.yml
- provider: resource
  path: /insights-stage/fedramp-customer-interest-stage/allow-port-forwarding.rolebinding.yml
- provider: route
  path: /insights-stage/fedramp-customer-interest-stage/stage-route.yml

# network policies 
networkPoliciesAllow:
- $ref: /services/observability/namespaces/openshift-customer-monitoring.crcs02ue1.yml
