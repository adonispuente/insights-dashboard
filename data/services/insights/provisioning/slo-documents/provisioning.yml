---
$schema: /app-sre/slo-document-1.yml

labels:
  service: provisioning

name: provisioning

app:
  $ref: /services/insights/provisioning/app.yml

namespaces:
- $ref: /services/insights/provisioning/namespaces/provisioning-prod.yml

slos:
- name: API Reservation Success Rate
  SLIType: availability
  SLISpecification: The proportion of successful image launches and total launches
  SLODetails: https://gitlab.cee.redhat.com/satellite-services/satellite-services.pages.redhat.com/-/blob/main/observability/slos/provisioning/reservation_success_rate.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(provisioning_reservation_count{result="success"}[{{window}}]))
    /
    sum(rate(provisioning_reservation_count[{{window}}]))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/provisioning-prod/provisioning.prometheusrules.yml
  dashboard: https://grafana.app-sre.devshift.net/d/211/provisioning?orgId=1&viewPanel=54

- name: API Success Rate
  SLIType: availability
  SLISpecification: The proportion of 2xx HTTP requests
  SLODetails: https://gitlab.cee.redhat.com/satellite-services/satellite-services.pages.redhat.com/-/blob/main/observability/slos/provisioning/success_rate.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(api_3scale_gateway_api_status{exported_service="provisioning",status!="5xx"}[{{window}}]))/sum(rate(api_3scale_gateway_api_status{exported_service="provisioning"}[{{window}}]))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/provisioning-prod/provisioning.prometheusrules.yml
  dashboard: https://grafana.app-sre.devshift.net/d/211/provisioning?orgId=1&viewPanel=32

- name: API request latency
  SLIType: latency
  SLISpecification: The proportion of HTTP requests that return within 200ms
  SLODetails: https://gitlab.cee.redhat.com/satellite-services/satellite-services.pages.redhat.com/-/blob/main/observability/slos/provisioning/request_latency.md
  SLOParameters:
    window: 28d
  expr: |
    sum(rate(provisioning_http_request_duration_ms_bucket{code=~"2\\d\\d", le="200"}[{{window}}])) / sum(rate(provisioning_http_request_duration_ms_count[{{window}}]))
  SLOTarget: 0.95
  SLOTargetUnit: percent_0_1
  prometheusRules: /insights-prod/provisioning-prod/provisioning.prometheusrules.yml
  dashboard: https://grafana.app-sre.devshift.net/d/211/provisioning?orgId=1&viewPanel=33

