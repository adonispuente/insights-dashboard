---
$schema: /app-sre/saas-file-2.yml

labels:
  service: rhsm
  platform: insights

name: rhsm-clowder
description: rhsm app on the Insights Platform via clowder

app:
  $ref: /services/insights/rhsm/app.yml

pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-clouddot-info

managedResourceTypes:
- ClowdApp
- ClowdJobInvocation
- ConfigMap
# NOTE: Service needed to transition seamlessly from old deployment/service route without taking downtime
- Service
- Frontend
# - HorizontalPodAutoscaler

imagePatterns:
- quay.io/cloudservices
- quay.io/app-sre

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all
    version: 3

parameters:
  CLOWDER_ENABLED: 'true'

resourceTemplates:
- name: auto-registration-listener
  path: /deploy/clowdapp.yml
  url: https://gitlab.cee.redhat.com/rhsm/automatic-registration
  targets:
  - namespace:
      $ref: /services/insights/rhsm/namespaces/stage-rhsm-stage.yml
    ref: 78df117606a415b6f025a8562c2556a84802c2f3
    parameters:
      RHSM_SERVICE_URL: https://api.rhsm.stage.redhat.com/v1/cloud_access_providers/
      USER_SERVICE_URL: https://user.stage.api.redhat.com/
      SOURCES_PORT: '8000'
      ALLOWED_APPLICATION_TYPE_IDS: '3'
  - namespace:
      $ref: /services/insights/rhsm/namespaces/rhsm-prod.yml
    ref: 78df117606a415b6f025a8562c2556a84802c2f3
    parameters:
      RHSM_SERVICE_URL: https://api.rhsm.redhat.com/v1/cloud_access_providers/
      USER_SERVICE_URL: https://user.api.redhat.com/

