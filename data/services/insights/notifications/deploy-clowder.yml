---
$schema: /app-sre/saas-file-2.yml

labels:
  service: notifications
  platform: insights

name: notifications-clowder
description: notifications app on the Insights Platform deployed with Clowder

app:
  $ref: /services/insights/notifications/app.yml

pipelinesProvider:
  $ref: /services/insights/pipelines/tekton.crc-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-clouddot-info

managedResourceTypes:
- ClowdApp
- ClowdJobInvocation
- ConfigMap
- CronJob
- FloorPlan
- Frontend

imagePatterns:
- quay.io/cloudservices
- quay.io/app-sre

authentication:
  image:
    path: insights/quay/cloudservices-push
    field: all
    version: 3

resourceTemplates:

# notifications-backend
- name: notifications-backend
  path: /.rhcicd/clowdapp-backend.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal
    parameters:
      DB_NAME: notifications-backend
      DB_SECRET_HOSTNAME_KEY: hostname
      DB_SECRET_PASSWORD_KEY: password
      DB_SECRET_USERNAME_KEY: username
      FLOORIST_SUSPEND: 'true'
      NOTIFICATIONS_EMAILS_ONLY_MODE_ENABLED: false
      NOTIFICATIONS_INSTANT_EMAILS_ENABLED: true
      NOTIFICATIONS_USE_EVENT_TYPE_FOR_SUBSCRIPTION_ENABLED: false
      RBAC_AUTHENTICATION_READ_TIMEOUT: 30000

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-backend.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      CLOUDWATCH_ENABLED: true
      CPU_LIMIT: 300m
      CPU_REQUEST: 150m
      FLOORIST_BUCKET_SECRET_NAME: insights-metrics-export-stage
      FLOORIST_SUSPEND: 'false'
      INTERNAL_RBAC_ENABLED: true
      MIN_REPLICAS: 3
      NOTIFICATIONS_DRAWER_ENABLED: true
      NOTIFICATIONS_EMAILS_ONLY_MODE_ENABLED: false
      NOTIFICATIONS_INSTANT_EMAILS_ENABLED: true
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      NOTIFICATIONS_USE_DEFAULT_TEMPLATE: true
      NOTIFICATIONS_USE_EVENT_TYPE_FOR_SUBSCRIPTION_ENABLED: true
      SENTRY_DSN: 
        https://3ff0dbd8017a4750a1d92055a1685263@o490301.ingest.sentry.io/5440905?environment=
      SENTRY_ENABLED: true
      SOURCES_ENABLED: false
    # upstream:
    #   instance:
    #     $ref: /dependencies/ci-ext/ci-ext.yml
    #   name: RedHatInsights-notifications-backend-gh-build-master
    promotion:
      publish:
      - notifications-backend-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-backend.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      CLOUDWATCH_ENABLED: true
      FLOORIST_BUCKET_SECRET_NAME: insights-metrics-export-prod
      FLOORIST_SUSPEND: 'false'
      MEMORY_LIMIT: 1Gi
      MIN_REPLICAS: 3
      NOTIFICATIONS_EMAILS_ONLY_MODE_ENABLED: false
      NOTIFICATIONS_INSTANT_EMAILS_ENABLED: true
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      NOTIFICATIONS_USE_EVENT_TYPE_FOR_SUBSCRIPTION_ENABLED: true
      SENTRY_DSN: 
        https://3ff0dbd8017a4750a1d92055a1685263@o490301.ingest.sentry.io/5440905?environment=
      SENTRY_ENABLED: true
      SOURCES_ENABLED: true
    promotion:
      publish:
      - notifications-backend-prod-deploy-success-channel

# notifications-connector-email
- name: notifications-connector-email
  path: /.rhcicd/clowdapp-connector-email.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal
    parameters:
      NOTIFICATIONS_CONNECTOR_USER_PROVIDER_IT_KEY_STORE_LOCATION: file:/mnt/secrets/clientkeystore.jks

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-email.yaml version.
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      NOTIFICATIONS_CONNECTOR_FETCH_USERS_RBAC_ENABLED: true
      NOTIFICATIONS_CONNECTOR_SINGLE_EMAIL_PER_USER_ENABLED: true
      NOTIFICATIONS_CONNECTOR_USER_PROVIDER_BOP_ENV: stage
      NOTIFICATIONS_CONNECTOR_USER_PROVIDER_IT_KEY_STORE_LOCATION: file:/mnt/secrets/clientkeystore.jks
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-email.yaml version.
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      MIN_REPLICAS: 0
      NOTIFICATIONS_CONNECTOR_FETCH_USERS_RBAC_ENABLED: true
      NOTIFICATIONS_CONNECTOR_SINGLE_EMAIL_PER_USER_ENABLED: true
      NOTIFICATIONS_CONNECTOR_USER_PROVIDER_BOP_ENV: prod
      NOTIFICATIONS_CONNECTOR_USER_PROVIDER_IT_KEY_STORE_LOCATION: file:/mnt/secrets/clientkeystore.jks
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-connector-google-chat
- name: notifications-connector-google-chat
  path: /.rhcicd/clowdapp-connector-google-chat.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-google-chat.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-google-chat.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-connector-microsoft-teams
- name: notifications-connector-microsoft-teams
  path: /.rhcicd/clowdapp-connector-microsoft-teams.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-microsoft-teams.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-microsoft-teams.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      KAFKA_MAX_POLL_INTERVAL_MS: 1200000
      KAFKA_MAX_POLL_RECORDS: 100
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-connector-servicenow
- name: notifications-connector-servicenow
  path: /.rhcicd/clowdapp-connector-servicenow.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-servicenow.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true
    promotion:
      publish:
      - notifications-servicenow-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-servicenow.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-connector-slack
- name: notifications-connector-slack
  path: /.rhcicd/clowdapp-connector-slack.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-slack.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-slack.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-connector-splunk
- name: notifications-connector-splunk
  path: /.rhcicd/clowdapp-connector-splunk.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-splunk.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      KAFKA_MAX_POLL_INTERVAL_MS: 1200000
      KAFKA_MAX_POLL_RECORDS: 100
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true
    promotion:
      publish:
      - notifications-splunk-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-splunk.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-connector-webhook
- name: notifications-connector-webhook
  path: /.rhcicd/clowdapp-connector-webhook.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-connector-webhook.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      KAFKA_MAX_POLL_INTERVAL_MS: 1200000
      KAFKA_MAX_POLL_RECORDS: 100
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true
    promotion:
      publish:
      - notifications-webhook-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-connector-webhook.yaml version
    ref: 2ba4d8c1961796baf4bbfadb8eaba5f17959b94d
    parameters:
      QUARKUS_LOG_CLOUDWATCH_ENABLED: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true

# notifications-engine
- name: notifications-engine
  path: /.rhcicd/clowdapp-engine.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal
    parameters:
      IT_SERVICE_TO_SERVICE_KEY_STORE: file:/mnt/secrets/clientkeystore.jks
      NOTIFICATIONS_EMAILS_ONLY_MODE_ENABLED: false
      NOTIFICATIONS_SEND_SINGLE_EMAIL_FOR_MULTIPLE_RECIPIENTS_ENABLED: true
      NOTIFICATIONS_USE_EVENT_TYPE_FOR_SUBSCRIPTION_ENABLED: true
      NOTIFICATIONS_USE_RBAC_FOR_FETCHING_USERS: false
      NOTIFICATIONS_USE_SECURED_EMAIL_TEMPLATES_ENABLED: false
      NOTIFICATIONS_WEBHOOK_CONNECTOR_ENABLED: true

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-engine.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      CLOUDWATCH_ENABLED: true
      CPU_LIMIT: 300m
      CPU_REQUEST: 150m
      ENV_BASE_URL: https://console.stage.redhat.com
      EXPORT_EVENT_LISTENER_LOG_LEVEL: DEBUG
      IT_SERVICE_TO_SERVICE_KEY_STORE: file:/mnt/secrets/clientkeystore.jks
      KAFKA_CLIENT_LOG_LEVEL: WARN
      MIN_REPLICAS: 3
      MP_MESSAGING_INCOMING_AGGREGATION_THROTTLED_UNPROCESSED_RECORD_MAX_AGE_MS: 180000
      MP_MESSAGING_INCOMING_INGRESS_ENABLED: true
      MP_MESSAGING_INCOMING_INGRESS_MAX_POLL_INTERVAL_MS: 1200000
      MP_MESSAGING_INCOMING_INGRESS_MAX_POLL_RECORDS: 100
      MP_MESSAGING_INCOMING_INGRESS_THROTTLED_UNPROCESSED_RECORD_MAX_AGE_MS: 180000
      MP_MESSAGING_OUTGOING_DRAWER_ENABLED: true
      NOTIFICATIONS_DISABLE_WEBHOOK_ENDPOINTS_ON_FAILURE: true
      NOTIFICATIONS_DRAWER_ENABLED: true
      NOTIFICATIONS_EMAIL_CONNECTOR_ENABLED: false
      NOTIFICATIONS_EMAILS_ONLY_MODE_ENABLED: false
      NOTIFICATIONS_EXPORT_SERVICE_ENABLED: true
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      NOTIFICATIONS_SEND_SINGLE_EMAIL_FOR_MULTIPLE_RECIPIENTS_ENABLED: true
      NOTIFICATIONS_SINGLE_EMAIL_TEST_USER: gduval-stage
      NOTIFICATIONS_USE_DEFAULT_TEMPLATE: true
      NOTIFICATIONS_USE_EVENT_TYPE_FOR_SUBSCRIPTION_ENABLED: true
      NOTIFICATIONS_USE_RBAC_FOR_FETCHING_USERS: false
      NOTIFICATIONS_USE_SECURED_EMAIL_TEMPLATES_ENABLED: false
      PROCESSOR_EMAIL_NO_REPLY: no-reply-stage@redhat.com
      QUARKUS_CAMEL_ROUTES_DISCOVERY_ENABLED: false
      QUARKUS_LOG_CATEGORY__COM_REDHAT_CLOUD_NOTIFICATIONS_EXPORTS_EXPORTEVENTLISTENER__LEVEL: DEBUG
      RBAC_S2S_READ_TIMEOUT: 120000
      RECIPIENT_PROVIDER_USE_IT_IMPL: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true
      SOURCES_ENABLED: false
      NOTIFICATIONS_SPLUNK_CONNECTOR_KAFKA_PROCESSING_ENABLED: true
      NOTIFICATIONS_SERVICENOW_CONNECTOR_KAFKA_PROCESSING_ENABLED: true
      NOTIFICATIONS_WEBHOOK_CONNECTOR_ENABLED: true
      QUARKUS_REST_CLIENT_LOGGING_SCOPE: request-response
      QUARKUS_LOG_CATEGORY__ORG_JBOSS_RESTEASY_REACTIVE_CLIENT_LOGGING__LEVEL: DEBUG
    # upstream:
    #   instance:
    #     $ref: /dependencies/ci-ext/ci-ext.yml
    #   name: RedHatInsights-notifications-backend-gh-build-master
    promotion:
      publish:
      - notifications-engine-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-engine.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      CLOUDWATCH_ENABLED: true
      IT_SERVICE_TO_SERVICE_KEY_STORE: file:/mnt/secrets/clientkeystore.jks
      MEMORY_LIMIT: 2Gi
      MIN_REPLICAS: 3
      MP_MESSAGING_INCOMING_AGGREGATION_THROTTLED_UNPROCESSED_RECORD_MAX_AGE_MS: 180000
      MP_MESSAGING_INCOMING_INGRESS_ENABLED: true
      MP_MESSAGING_INCOMING_INGRESS_MAX_POLL_INTERVAL_MS: 1200000
      MP_MESSAGING_INCOMING_INGRESS_MAX_POLL_RECORDS: 100
      MP_MESSAGING_INCOMING_INGRESS_THROTTLED_UNPROCESSED_RECORD_MAX_AGE_MS: 180000
      NOTIFICATIONS_DISABLE_WEBHOOK_ENDPOINTS_ON_FAILURE: true
      NOTIFICATIONS_EMAIL_CONNECTOR_ENABLED: false
      NOTIFICATIONS_EMAILS_ONLY_MODE_ENABLED: false
      NOTIFICATIONS_EXPORT_SERVICE_ENABLED: true
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      NOTIFICATIONS_SEND_SINGLE_EMAIL_FOR_MULTIPLE_RECIPIENTS_ENABLED: false
      NOTIFICATIONS_SINGLE_EMAIL_TEST_USER: gduval-prod0
      NOTIFICATIONS_USE_EVENT_TYPE_FOR_SUBSCRIPTION_ENABLED: true
      NOTIFICATIONS_USE_RBAC_FOR_FETCHING_USERS: false
      NOTIFICATIONS_USE_SECURED_EMAIL_TEMPLATES_ENABLED: false
      PROCESSOR_EMAIL_NO_REPLY: no-reply@redhat.com
      QUARKUS_LOG_CLOUDWATCH_BATCH_SIZE: 9000
      RBAC_S2S_READ_TIMEOUT: 120000
      RECIPIENT_PROVIDER_USE_IT_IMPL: true
      SENTRY_DSN: 
        https://fbb2970a5a3c454fa6543707138145c1@o490301.ingest.sentry.io/6193703?environment=
      SENTRY_ENABLED: true
      SOURCES_ENABLED: true
      NOTIFICATIONS_SPLUNK_CONNECTOR_KAFKA_PROCESSING_ENABLED: true
      NOTIFICATIONS_SERVICENOW_CONNECTOR_KAFKA_PROCESSING_ENABLED: true
      NOTIFICATIONS_WEBHOOK_CONNECTOR_ENABLED: true
    promotion:
      publish:
      - notifications-engine-prod-deploy-success-channel

# notifications-aggregator
- name: notifications-aggregator
  path: /.rhcicd/clowdapp-aggregator.yaml
  url: https://github.com/RedHatInsights/notifications-backend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-backend commit hash that determines the clowdapp-aggregator.yaml version
    ref: 4ce8a238d83d23447ae2a93d530d78656c09ae13
    parameters:
      CLOUDWATCH_ENABLED: true
      CPU_REQUEST: 200m
      CRONTAB_AGGREGATION_JOB: 0/15 * * * *
      NOTIFICATIONS_AGGREGATOR_ORG_PREF_ENABLED: true
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      SENTRY_DSN: 
        https://39032857c8214cedaf226c4a26709b5b@o490301.ingest.sentry.io/5987783?environment=
      SENTRY_ENABLED: true
    # upstream:
    #   instance:
    #     $ref: /dependencies/ci-ext/ci-ext.yml
    #   name: RedHatInsights-notifications-backend-gh-build-master
    promotion:
      publish:
      - notifications-aggregator-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-backend commit hash that determines the clowdapp-aggregator.yaml version
    ref: 883b7169294557815726b1d15412237a0acaddb7
    parameters:
      CLOUDWATCH_ENABLED: true
      CRONTAB_AGGREGATION_JOB: 0/15 * * * *
      NOTIFICATIONS_AGGREGATOR_ORG_PREF_ENABLED: true
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      SENTRY_DSN: 
        https://39032857c8214cedaf226c4a26709b5b@o490301.ingest.sentry.io/5987783?environment=
      SENTRY_ENABLED: true
    promotion:
      publish:
      - notifications-aggregator-prod-deploy-success-channel

# notifications-gw
- name: notifications-gw
  path: /.rhcicd/clowdapp.yaml
  url: https://github.com/RedHatInsights/notifications-gw
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    # app-sre will not deploy this target
    disable: true
    # populated by bonfire
    ref: internal

  # stage
  - namespace:
      $ref: /services/insights/notifications/namespaces/stage-notifications-stage.yml
    # notifications-gw commit hash that determines the clowdapp.yaml version
    ref: e301338a70944718e15595db9f4328be4bc6f3b1
    parameters:
      CLOUDWATCH_ENABLED: true
      CPU_LIMIT: 250m
      CPU_REQUEST: 200m
      MIN_REPLICAS: 3
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      SENTRY_DSN: 
        https://04a2375b90274bf6a4bcb1d81f8d0e16@o490301.ingest.sentry.io/5826611?environment=
      SENTRY_ENABLED: true
    # upstream:
    #   instance:
    #     $ref: /dependencies/ci-ext/ci-ext.yml
    #   name: RedHatInsights-notifications-gw-gh-build-main
    promotion:
      publish:
      - notifications-gw-stage-deploy-success-channel

  # prod
  - namespace:
      $ref: /services/insights/notifications/namespaces/notifications-prod.yml
    # notifications-gw commit hash that determines the clowdapp.yaml version
    ref: e301338a70944718e15595db9f4328be4bc6f3b1
    parameters:
      CLOUDWATCH_ENABLED: true
      CPU_LIMIT: 250m
      CPU_REQUEST: 200m
      MIN_REPLICAS: 3
      NOTIFICATIONS_LOG_LEVEL: DEBUG
      SENTRY_DSN: 
        https://04a2375b90274bf6a4bcb1d81f8d0e16@o490301.ingest.sentry.io/5826611?environment=
      SENTRY_ENABLED: true
    promotion:
      publish:
      - notifications-gw-prod-deploy-success-channel

# notifications-frontend
- name: notifications-frontend
  path: /.rhcicd/frontend.yaml
  url: https://github.com/RedHatInsights/notifications-frontend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    disable: true  # do not create an app-sre deploy job for ephemeral namespace
    ref: internal  # populated by bonfire
  # Stage Stable Deployment
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/stage-frontends.yml
    ref: fd6891991fc416ae5837599ad51ee1ee56770453
    parameters:
      ENV_NAME: frontends
      IMAGE: quay.io/cloudservices/notifications-frontend
  # Stage Beta Deployment
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/stage-beta-frontends.yml
    ref: master
    image:
      org:
        $ref: /dependencies/quay/cloudservices.yml
      name: notifications-frontend
    parameters:
      ENV_NAME: frontends-beta
      IMAGE: quay.io/cloudservices/notifications-frontend
  # Prod Stable Deployment
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/prod-frontends.yml
    ref: fd6891991fc416ae5837599ad51ee1ee56770453
    parameters:
      ENV_NAME: frontends
      IMAGE: quay.io/cloudservices/notifications-frontend
  # Prod Beta Deployment
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/prod-beta-frontends.yml
    ref: fd6891991fc416ae5837599ad51ee1ee56770453
    parameters:
      ENV_NAME: frontends-beta
      IMAGE: quay.io/cloudservices/notifications-frontend

# user preferences frontend
- name: user-preferences
  path: /.rhcicd/frontend.yml
  url: https://github.com/RedHatInsights/user-preferences-frontend
  targets:

  # ephemeral
  - namespace:
      $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
    disable: true  # do not create an app-sre deploy job for ephemeral namespace
    ref: internal  # populated by bonfire
  # Stage Stable
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/stage-frontends.yml
    ref: 97da9b48a09b7f0da5f1fd1dd4a8f3bd2a136737
    parameters:
      ENV_NAME: frontends
      IMAGE: quay.io/cloudservices/user-preferences-frontend
  # Stage Beta Deployment
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/stage-beta-frontends.yml
    ref: master
    image:
      org:
        $ref: /dependencies/quay/cloudservices.yml
      name: user-preferences-frontend
    parameters:
      ENV_NAME: frontends-beta
      IMAGE: quay.io/cloudservices/user-preferences-frontend
  # Prod Stable
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/prod-frontends.yml
    ref: 97da9b48a09b7f0da5f1fd1dd4a8f3bd2a136737
    parameters:
      ENV_NAME: frontends
      IMAGE: quay.io/cloudservices/user-preferences-frontend
  # Prod Beta Deployment
  - namespace:
      $ref: /services/insights/frontend-operator/namespaces/prod-beta-frontends.yml
    ref: 97da9b48a09b7f0da5f1fd1dd4a8f3bd2a136737
    parameters:
      ENV_NAME: frontends-beta
      IMAGE: quay.io/cloudservices/user-preferences-frontend
