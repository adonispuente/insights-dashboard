---
  $schema: /app-sre/saas-file-2.yml
  
  labels:
    service: remediations
    platform: insights
  
  name: remediations-clowder
  description: remediations app deployed via clowder
  
  app:
    $ref: /services/insights/remediations/app.yml
  
  pipelinesProvider:
    $ref: /services/insights/pipelines/tekton.crc-pipelines.app-sre-prod-01.yaml
  
  slack:
    workspace:
      $ref: /dependencies/slack/coreos.yml
    channel: team-clouddot-remediations
  
  managedResourceTypes:
  - ClowdApp
  
  imagePatterns:
  - quay.io/cloudservices
  
  authentication:
    image:
      path: insights/quay/cloudservices-push
      field: all
  
  resourceTemplates:
  # - name: remediations-cleaner
  #   path: /deployment/remediations-cleaner.yaml
  #   url: https://github.com/RedHatInsights/remediations-consumer
  #   parameters:
  #     CLEANER_SUSPEND: false
  #     DB_SSL_ENABLED: true
  #     LOG_CW_ENABLED: true
  #     LOG_LEVEL: trace
  #   targets:
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/stage-remediations-stage.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: f40a632
  #   - namespace:
  #       $ref:  /services/insights/remediations/namespaces/remediations-prod.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: f40a632
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/dev-remediations-ci.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: 93b1a01
  #       DB_SSL_ENABLED: false
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/dev-remediations-qa.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: 93b1a01
  #       DB_SSL_ENABLED: false
  # - name: remediations-consumer
  #   path: /deployment/remediations-consumer.yaml
  #   url: https://github.com/RedHatInsights/remediations-consumer
  #   parameters:
  #     DB_SSL_ENABLED: true
  #     LOG_CW_ENABLED: true
  #     LOG_LEVEL: info
  #     NUM_REPLICAS: 2
  #   targets:
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/stage-remediations-stage.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: f40a632
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/remediations-prod.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: f40a632
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/dev-remediations-ci.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: 93b1a01
  #       DB_SSL_ENABLED: false
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/dev-remediations-qa.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: 93b1a01
  #       DB_SSL_ENABLED: false
  # - name: remediations-update-consumer
  #   path: /deployment/remediations-update-consumer.yaml
  #   url: https://github.com/RedHatInsights/remediations-consumer
  #   parameters:
  #     DB_SSL_ENABLED: true
  #     LOG_CW_ENABLED: true
  #     LOG_LEVEL: info
  #     NUM_REPLICAS: 12
  #   targets:
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/stage-remediations-stage.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: f40a632
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/remediations-prod.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: f40a632
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/dev-remediations-ci.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: 93b1a01
  #       NUM_REPLICAS: 1
  #       DB_SSL_ENABLED: false
  #   - namespace:
  #       $ref: /services/insights/remediations/namespaces/dev-remediations-qa.yml
  #     ref: f40a63289dedff07c0776ca03bee6d3deef8798f
  #     parameters:
  #       IMAGE_TAG: 93b1a01
  #       NUM_REPLICAS: 2
  #       DB_SSL_ENABLED: false
  - name: remediations
    path: /deployment/clowdapp.yml
    url: https://github.com/RedHatInsights/insights-remediations
    parameters:
      ADVISOR_IMPL: impl
      COMPLIANCE_IMPL: impl
      DB_SSL_ENABLED: true
      IMAGE_CHANGE_TRIGGER: true
      INVENTORY_IMPL: impl
      LOG_CW_ENABLED: true
      LOG_LEVEL: info
      MAX_REPLICAS: 5
      MIGRATION_COMMAND: npm run db:create; npm run db:migrate
      MIN_REPLICAS: 2
      PATCHMAN_IMPL: impl
      PATH_PREFIX: /api
      RBAC_IMPL: impl
      RECEPTOR_IMPL: impl
      REMEDIATIONS_REPLICAS: 2
      SOURCES_IMPL: impl
      SSG_IMPL: impl
      SSG_HOST: http://playbooks-ssg:8080
      STRATEGY: Rolling
      TARGET_CPU_UTILIZATION: 80
      USERS_IMPL: impl
      VULNERABILITIES_IMPL: impl
    targets:
    - namespace:
        $ref: /services/insights/ephemeral/namespaces/ephemeral-base.yml
      disable: true
      ref: internal
      parameters:
        REMEDIATIONS_REPLICAS: 2
