---
$schema: /app-sre/saas-file-2.yml

labels:
  service: osd-operators

name: saas-dynatrace-operator
description: SaaS tracking file for dynatrace-operator

app:
  $ref: /services/osd-operators/dynatrace/app.yml

pipelinesProvider:
  $ref: /services/osd-operators/pipelines/tekton.osd-operators-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-srep-info

managedResourceTypes:
- SelectorSyncSet

imagePatterns: []

resourceTemplates:
- name: dynatrace-operator
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-operator/template-raw.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hives02ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hive-stage-01/cluster-scope.yml
    ref: main
- name: dynatrace-token-hs-management-clusters
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  parameters:
    HYPERSHIFT_CLUSTER_TYPE: management-cluster
    SECRET_NAME: hs-management-clusters
- name: dynatrace-token-hs-service-clusters
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  parameters:
    HYPERSHIFT_CLUSTER_TYPE: service-cluster
    SECRET_NAME: hs-service-clusters
- name: dynatrace-dynakube-hs-clusters
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-dynakube/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
    parameters:
      ENVIRONMENT: integration
  - namespace:
      $ref: /services/osd-operators/namespaces/hives02ue1/cluster-scope.yml
    ref: main
    parameters:
      ENVIRONMENT: staging
  - namespace:
      $ref: /services/osd-operators/namespaces/hive-stage-01/cluster-scope.yml
    ref: main
    parameters:
      ENVIRONMENT: staging
  parameters:
    TOKEN_SECRET_NAME: dynatrace-token
    ACTIVEGATE_CPU_REQUEST: 500m
    ACTIVEGATE_MEM_REQUEST: 512Mi
    ACTIVEGATE_CPU_LIMIT: 2000m
    ACTIVEGATE_MEM_LIMIT: 4Gi

- name: dynatrace-cluster-bootstrap-job
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-cluster-bootstrap/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hives02ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hive-stage-01/cluster-scope.yml
    ref: main

- name: dynatrace-token-stage
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/cluster-bootstrap.yaml
  targets:
  - name: dynatrace-token-stage-us-east-virginia-hrm15629
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*stage.*" & @.name=="cluster-scope")]
    ref: main
    parameters:
      DT_REGION: us-east-virginia
      DT_TENANT_ID: hrm15629
      REGIONS:
      - us-east-1
      - us-east-2
      - us-west-2
  - name: dynatrace-token-stage-eu-west-ireland-wmb10400
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*stage.*" & @.name=="cluster-scope")]
    ref: main
    parameters:
      DT_REGION: eu-west-ireland
      DT_TENANT_ID: wmb10400
      REGIONS:
      - eu-west-1
      - eu-central-1
