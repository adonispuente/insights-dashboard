---
$schema: /app-sre/saas-file-2.yml

labels:
  service: osd-operators

name: saas-dynatrace-operator
description: SaaS tracking file for dynatrace-operator

app:
  $ref: /services/osd-operators/dynatrace/app.yml

pipelinesProvider:
  $ref: /services/osd-operators/pipelines/tekton.osd-operators-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-srep-info

managedResourceTypes:
- SelectorSyncSet

imagePatterns: []

validateTargetsInApp: true
resourceTemplates:
- name: dynatrace-operator
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-operator/template-raw.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hives02ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hive-stage-01/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep01ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep02ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep03uw1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep04ew2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep05ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep06uw2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep07ue2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    
- name: dynatrace-token-hs-management-clusters
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  parameters:
    HYPERSHIFT_CLUSTER_TYPE: management-cluster
    SECRET_NAME: hs-management-clusters
- name: dynatrace-token-hs-service-clusters
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  parameters:
    HYPERSHIFT_CLUSTER_TYPE: service-cluster
    SECRET_NAME: hs-service-clusters
- name: dynatrace-dynakube-hs-clusters
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-dynakube/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
    parameters:
      ENVIRONMENT: integration
  - namespace:
      $ref: /services/osd-operators/namespaces/hives02ue1/cluster-scope.yml
    ref: main
    parameters:
      ENVIRONMENT: staging
  - namespace:
      $ref: /services/osd-operators/namespaces/hive-stage-01/cluster-scope.yml
    ref: main
    parameters:
      ENVIRONMENT: staging
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep01ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep02ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep03uw1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep04ew2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep05ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep06uw2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep07ue2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
    parameters:
      ENVIRONMENT: production
  parameters:
    TOKEN_SECRET_NAME: dynatrace-token
    ACTIVEGATE_CPU_REQUEST: 500m
    ACTIVEGATE_MEM_REQUEST: 512Mi
    ACTIVEGATE_CPU_LIMIT: 2000m
    # Note: Gi is not supported
    ACTIVEGATE_MEM_LIMIT: 4096Mi
    # These values were observed in app-sre-stage-01
    ONEAGENT_CPU_REQUEST: 200m
    ONEAGENT_MEM_REQUEST: 768Mi
    # https://github.com/Dynatrace/dynatrace-operator/blob/e81873106c48035f824ec8259e1c46c2d32a150d/assets/samples/classicFullStack.yaml#L95
    ONEAGENT_CPU_LIMIT: 300m
    # Note: Gi is not supported
    ONEAGENT_MEM_LIMIT: 1536Mi

- name: dynatrace-cluster-bootstrap-job
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-cluster-bootstrap/template.yaml
  targets:
  - namespace:
      $ref: /services/osd-operators/namespaces/hivei01ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hives02ue1/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hive-stage-01/cluster-scope.yml
    ref: main
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep01ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep02ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep03uw1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep04ew2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep05ue1/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep06uw2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065
  - namespace:
      $ref: /services/osd-operators/namespaces/hivep07ue2/cluster-scope.yml
    ref: 3414e1b3f457e3e35ce78b68a35220a1b3f2f065

- name: dynatrace-token-stage
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/cluster-bootstrap.yaml
  targets:
  - name: dynatrace-token-stage-us-east-virginia-hrm15629
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*stage.*" & @.name=="cluster-scope")]
    ref: main
    parameters:
      DT_REGION: us-east-virginia
      DT_TENANT_ID: hrm15629
      REGIONS:
      - us-east-1
      - us-east-2
      - us-west-2
  - name: dynatrace-token-stage-eu-west-ireland-wmb10400
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*stage.*" & @.name=="cluster-scope")]
    ref: main
    parameters:
      DT_REGION: eu-west-ireland
      DT_TENANT_ID: wmb10400
      REGIONS:
      - eu-west-1
      - eu-central-1
- name: dynatrace-token-production
  url: https://gitlab.cee.redhat.com/service/dynatrace-config
  path: /resources/dynatrace-token/cluster-bootstrap.yaml
  targets:
  - name: dynatrace-token-production-ap-southeast-singapore-uva53433
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*production.*" & @.name=="cluster-scope")]
    ref: 78b90c7043b906dff7ce9a3f0da58ed471e869f3
    parameters:
      DT_REGION: ap-southeast-singapore
      DT_TENANT_ID: uva53433
      REGIONS:
      - ap-southeast-3
      - ap-southeast-4
      - ap-southeast-2
      - ap-northeast-1
      - ap-northeast-2
  - name: dynatrace-token-production-eu-west-ireland-vap62935
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*production.*" & @.name=="cluster-scope")]
    ref: 78b90c7043b906dff7ce9a3f0da58ed471e869f3
    parameters:
      DT_REGION: eu-west-ireland
      DT_TENANT_ID: vap62935
      REGIONS:
      - eu-west-1
      - eu-central-1
  - name: dynatrace-token-production-us-east-virginia-jgn20300
    provider: dynamic
    namespaceSelector:
      jsonPathSelectors:
        include:
        - namespace[?(@.cluster.name=~"hive.*" & @.environment.name=~".*production.*" & @.name=="cluster-scope")]
    ref: 78b90c7043b906dff7ce9a3f0da58ed471e869f3
    parameters:
      DT_REGION: us-east-virginia
      DT_TENANT_ID: jgn20300
      REGIONS:
      - us-east-1
      - us-east-2
      - us-west-2
