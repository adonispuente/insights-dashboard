$schema: /app-sre/saas-file-2.yml

labels:
  service: assisted-installer

name: assisted-installer
description: 'SaaS tracking file for assisted-installer'

app:
  $ref: /services/assisted-installer/app.yml

pipelinesProvider:
  $ref: /services/assisted-installer/pipelines/tekton.assisted-installer-pipelines.appsrep05ue1.yaml

deployResources:
  requests:
    cpu: 200m
    memory: 700Mi
  limits:
    cpu: 200m
    memory: 700Mi

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: assisted-app-sre-ci

managedResourceTypes:
- Deployment
- Service
- ConfigMap
- PodDisruptionBudget
- StatefulSet
- ServiceAccount

imagePatterns:
- quay.io/app-sre/bm-inventory
- quay.io/app-sre/assisted-service
- quay.io/app-sre/assisted-image-service
- quay.io/app-sre/envoyproxy

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

resourceTemplates:
- name: assisted-installer-dashboards
  url: https://github.com/openshift-assisted/assisted-grafana
  path: /dashboards/assisted-service
  provider: directory
  targets:
  - namespace:
      $ref: /services/observability/namespaces/app-sre-observability-stage.yml
    ref: master
    delete: true
  - namespace:
      $ref: /services/observability/namespaces/app-sre-observability-production.yml
    ref: 628736030860f9998b625f55bbe56516873fe0d5
    delete: true
  - namespace:
      $ref: /services/observability/namespaces/app-sre-observability-stage-int.yml
    ref: master
  - namespace:
      $ref: /services/observability/namespaces/app-sre-observability-production-int.yml
    ref: 628736030860f9998b625f55bbe56516873fe0d5
- name: assisted-image-service
  url: https://github.com/openshift/assisted-image-service
  path: /deploy/template.yaml
  provider: openshift-template
  parameters:
    IMAGE_SERVICE_BASE_URL: ${OCM_BASE_URL}/api/assisted-images
  targets:
  - $ref: /services/assisted-installer/cicd/target/integration/assisted-image-service.yaml
  - $ref: /services/assisted-installer/cicd/target/stage/assisted-image-service.yaml
  - $ref: /services/assisted-installer/cicd/target/production/assisted-image-service.yaml

- name: assisted-service
  url: https://github.com/openshift/assisted-service
  path: /openshift/template.yaml
  parameters:
    BASE_DNS_DOMAINS: assistedinstaller.sysdeseng.com:Z0705901344NMKJYA5RNZ/route53
    # OCM_BASE_URL is defined at the environment parameters level
    SERVICE_BASE_URL: ${OCM_BASE_URL}
    # SSO_BASE_URL is defined at the environment parameters level
    JWKS_URL: ${SSO_BASE_URL}/protocol/openid-connect/certs
    # CONSOLE_BASE_URL is defined at the environment parameters level
    ALLOWED_DOMAINS: ${CONSOLE_BASE_URL},https://qaprodauth.cloud.redhat.com,https://prod.foo.redhat.com:1337,https://console.stage.redhat.com,https://console.redhat.com
    AUTH_TYPE: rhsso
    SUPPORT_L2: true
    CHECK_CLUSTER_VERSION: true
    MUST_GATHER_IMAGES: '{"4.8":{"cnv":"registry.redhat.io/container-native-virtualization/cnv-must-gather-rhel8:v2.6.5","ocs":"registry.redhat.io/ocs4/ocs-must-gather-rhel8","lso":"registry.redhat.io/openshift4/ose-local-storage-mustgather-rhel8"}}'
    HW_VALIDATOR_REQUIREMENTS: |
      [{
          "version": "default",
          "master": {
            "cpu_cores": 4,
            "ram_mib": 16384,
            "disk_size_gb": 20,
            "installation_disk_speed_threshold_ms": 10,
            "network_latency_threshold_ms": 100,
            "packet_loss_percentage": 0
          },
          "worker": {
            "cpu_cores": 2,
            "ram_mib": 8192,
            "disk_size_gb": 20,
            "installation_disk_speed_threshold_ms": 10,
            "network_latency_threshold_ms": 1000,
            "packet_loss_percentage": 10
          },
          "sno": {
            "cpu_cores": 8,
            "ram_mib": 15360,
            "disk_size_gb": 20,
            "installation_disk_speed_threshold_ms": 10
          },
          "edge-worker": {
            "cpu_cores": 2,
            "ram_mib": 8192,
            "disk_size_gb": 15,
            "installation_disk_speed_threshold_ms": 10
          }
        }]
    IPV6_SUPPORT: false
  targets:
  - $ref: /services/assisted-installer/cicd/target/integration/assisted-service.yaml
  - $ref: /services/assisted-installer/cicd/target/stage/assisted-service.yaml
  - $ref: /services/assisted-installer/cicd/target/production/assisted-service.yaml
