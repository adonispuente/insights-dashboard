---
$schema: /app-sre/saas-file-1.yml

labels:
  service: assisted-installer

name: assisted-installer
description: 'SaaS tracking file for assisted-installer'

app:
  $ref: /services/assisted-installer/app.yml

instance:
  $ref: /dependencies/ci-ext/ci-ext.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: assisted-app-sre-ci

managedResourceTypes:
- Deployment
- Service
- ConfigMap

imagePatterns:
- quay.io/app-sre/bm-inventory
- quay.io/app-sre/assisted-service

resourceTemplates:
- name: assisted-service
  url: https://github.com/openshift/assisted-service
  path: /openshift/template.yaml
  parameters:
    BASE_DNS_DOMAINS: assistedinstaller.sysdeseng.com:Z0705901344NMKJYA5RNZ/route53
    # OCM_BASE_URL is defined at the environment parameters level
    SERVICE_BASE_URL: ${OCM_BASE_URL}
    JWKS_URL: https://api.openshift.com/.well-known/jwks.json #FIXME: remove?
    ALLOWED_DOMAINS: https://qaprodauth.cloud.redhat.com
    ENABLE_AUTH: true
    HW_VALIDATOR_MIN_RAM_GIB_MASTER: 8
    HW_VALIDATOR_MIN_CPU_CORES_MASTER: 4
    HW_VALIDATOR_MIN_CPU_CORES_WORKER: 2
    HW_VALIDATOR_MIN_RAM_GIB_WORKER: 3
    HW_VALIDATOR_MIN_CPU_CORES: 2
    HW_VALIDATOR_MIN_RAM_GIB: 3
    HW_VALIDATOR_MIN_DISK_SIZE_GIB: 10
    OPENSHIFT_INSTALL_RELEASE_IMAGE: quay.io/ocpmetal/ocp-release:v1.0.9.1
    IGNITION_GENERATE_IMAGE: quay.io/ocpmetal/assisted-ignition-generator:v1.0.9.1
    INSTALLER_IMAGE: quay.io/ocpmetal/assisted-installer:v1.0.9.1
    CONTROLLER_IMAGE: quay.io/ocpmetal/assisted-installer-controller:v1.0.9.1
    AGENT_DOCKER_IMAGE: quay.io/ocpmetal/assisted-installer-agent:v1.0.9.1
    CONNECTIVITY_CHECK_IMAGE: quay.io/ocpmetal/assisted-installer-agent:v1.0.9.1
    IMAGE_BUILDER: quay.io/app-sre/assisted-iso-create
    INVENTORY_IMAGE: quay.io/ocpmetal/assisted-installer-agent:v1.0.9.1
    FREE_ADDRESSES_IMAGE: quay.io/ocpmetal/assisted-installer-agent:v1.0.9.1
    DHCP_LEASE_ALLOCATOR_IMAGE: quay.io/ocpmetal/assisted-installer-agent:v1.0.9.1
  targets:
  - namespace:
      $ref: /services/assisted-installer/namespaces/hive-integration.yml
    ref: master
    upstream: openshift-assisted-service-gh-build-master
    parameters:
      INSTALLER_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-rhel8:v4.6.0-12
      CONTROLLER_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-reporter-rhel8:v4.6.0-8
      AGENT_DOCKER_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-agent-rhel8:v4.6.0-12
      CONNECTIVITY_CHECK_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-agent-rhel8:v4.6.0-12
      INVENTORY_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-agent-rhel8:v4.6.0-12
      FREE_ADDRESSES_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-agent-rhel8:v4.6.0-12
      DHCP_LEASE_ALLOCATOR_IMAGE: registry-proxy.engineering.redhat.com/rh-osbs/openshift4-assisted-installer-agent-rhel8:v4.6.0-12
  - namespace:
      $ref: /services/assisted-installer/namespaces/app-sre-stage-01.yml
    ref: f0172a8c509c97bc4b9ab738b6ca1a3a657ef863
    upstream: openshift-assisted-service-gh-build-master
    parameters:
      RELEASE_TAG: v1.0.9.1
# Commented until we can deploy 3 replicas on PROD
#  - namespace:
#      $ref: /services/assisted-installer/namespaces/app-sre-prod-04.yml
#    ref: f0172a8c509c97bc4b9ab738b6ca1a3a657ef863
#    upstream: openshift-assisted-service-gh-build-master
