---
$schema: /openshift/namespace-1.yml

labels: {}

name: assisted-installer-integration
description: namespace for assisted-installer

cluster:
  $ref: /openshift/app-sre-stage-01/cluster.yml

app:
  $ref: /services/assisted-installer/app.yml

environment:
  $ref: /products/osdv4/environments/integration-hivei01ue1.yml

networkPoliciesAllow:
- $ref: /services/ocm/namespaces/uhc-integration.yml
- $ref: /services/observability/namespaces/openshift-customer-monitoring.app-sre-stage-01.yml

managedResourceTypes:
- ServiceAccount
- Role
- RoleBinding

openshiftResources:
- provider: route
  path: /services/assisted-installer/kibana-integration.route.yaml
- provider: resource
  path: /services/assisted-installer/assisted-service.serviceaccount.yaml
- provider: resource
  path: /services/assisted-installer/assisted-service-job-creator.rolebinding.yaml
- provider: resource
  path: /services/assisted-installer/job-creator.role.yaml
- provider: resource
  path: /services/assisted-installer/assisted-service-leader-election.rolebinding.yaml
- provider: resource
  path: /services/assisted-installer/leader-election.role.yaml
- provider: vault-secret
  name: route53-creds
  path: app-interface/hive-integration/assisted-installer/route53-creds
  version: 7
  annotations:
    qontract.recycle: "true"
- provider: vault-secret
  name: assisted-installer-sso
  path: app-interface/assisted-installer/sso/integration
  version: 3
  annotations:
    qontract.recycle: "true"
- provider: vault-secret
  name: jenkins
  path: app-interface/assisted-installer/jenkins/integration
  version: 5
- provider: vault-secret
  name: events-scrape
  path: app-interface/assisted-installer/events-scrape/integration
  version: 2
- provider: vault-secret
  name: kibana-oauth-application
  path: app-interface/assisted-installer/kibana/integration
  version: 4
- provider: vault-secret
  name: elastic-master-credentials
  path: app-interface/assisted-installer/elastic-credentials/integration
  version: 2

managedRoles: true

managedTerraformResources: true

terraformResources:
- provider: s3
  account: app-sre
  identifier: assisted-installer-integration-v4
  defaults: /terraform/resources/assisted-installer/s3-backup-1.yml
  output_resource_name: assisted-installer-s3
- provider: s3
  account: app-sre
  identifier: assisted-installer-elastic-migration-integration
  defaults: /terraform/resources/s3-private-1.yml
  output_resource_name: assisted-installer-s3-migration
- provider: s3
  account: app-sre-stage
  identifier: ai-ccx-integration-integration
  defaults: /terraform/resources/s3-private-1.yml
  output_resource_name: ai-ccx-integration
- provider: aws-iam-role
  account: app-sre-stage
  identifier: service-account-ai-ccx-integration
  assume_role:
    AWS:
    - arn:aws:iam::192448198553:user/ccx-reporting-pipeline
  inline_policy:
    {
      "Version": "2012-10-17",
      "Statement": [{
        "Effect": "Allow",
        "Action": [
          "s3:ListBucket",
          "s3:GetObject"
        ],
        "Resource": [
          "arn:aws:s3:::ai-ccx-integration-integration",
          "arn:aws:s3:::ai-ccx-integration-integration/*"
        ]
      }]
    }
  output_resource_name: service-account-ai-ccx
- provider: s3
  account: app-sre
  identifier: assisted-installer-integration-v4-public
  defaults: /terraform/resources/s3-public-read-1.yml
  bucket_policy:
    {
      "Version": "2012-10-17",
      "Statement": [
        {
          "Sid": "PublicRead",
          "Effect": "Allow",
          "Principal": "*",
          "Action": "s3:GetObject",
          "Resource": "arn:aws:s3:::assisted-installer-integration-v4-public/*"
        }
      ]
    }
  output_resource_name: assisted-installer-public-s3
- provider: rds
  account: app-sre
  identifier: assisted-installer-integration-v4
  defaults: /terraform/resources/assisted-installer/rds-1.yml
  output_resource_name: assisted-installer-rds
  reset_password: APPSRE-4733
- provider: elasticsearch
  account: app-sre
  identifier: ai-integration-es
  defaults: /terraform/resources/assisted-installer/elasticsearch-1.yml
  output_resource_name: assisted-installer-elasticsearch

managedExternalResources: true

externalResources: []
