---
$schema: /app-sre/performance-parameters-1.yml

# Labels for this file in app-interface
# Not related to generated manifests
labels:
  service: cincinnati

name: cincinnati

app:
  $ref: /services/cincinnati/app.yml

component: cincinnati-policy-engine

# Labels that Prometheus uses to select this rules file
# These labels are added to the generated Manifest's metadata.labels
prometheusLabels:
  prometheus: app-sre
  role: alert-rules
  type: slo-rules

# Namespaces that this app lives in
namespace:
  $ref: /services/cincinnati/namespaces/cincinnati-stage.yml

SLIRecordingRules:
- name: http_rates_from_router
  kind: http_rate
  metric: haproxy_server_http_responses_total
  selectors:
  - route="cincinnati-route-stage"
- name: policy_engine_latency_p90
  kind: latency_rate
  percentile: 90
  metric: cincinnati_pe_v1_graph_serve_duration_seconds_bucket
  selectors:
  - job="cincinnati-policy-engine"

volume:
- name: volume_slo
  kind: SLO
  rules: http_rates_from_router
  target: 5000

latency:
- name: policy_engine_latency_slo
  kind: SLO
  rules: policy_engine_latency_p90
  threshold: 3
  target: 95

errors:
- name: errors_slo
  kind: SLO
  rules: http_rates_from_router
  target: 5

availability:
- name: availability_slo
  kind: SLO
  rules:
    latency:
    - policy_engine_latency_slo
    errors:
    - errors_slo
  target: 95

