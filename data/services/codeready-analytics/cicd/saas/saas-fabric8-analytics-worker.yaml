---
$schema: /app-sre/saas-file-1.yml

labels:
  service: codeready-analytics
  component: fabric8-analytics-worker

name: saas-codeready-analytics-fabric8-analytics-worker
description: SaaS tracking file for codeready-analytics fabric8-analytics-worker

app:
  $ref: /services/codeready-analytics/app.yml

instance:
  $ref: /dependencies/ci-ext/ci-ext.yml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-codeready-analytics-info

managedResourceTypes:
- ServiceAccount
- DeploymentConfig

imagePatterns:
- quay.io/app-sre/rhel-bayesian-cucos-worker

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

parameters:
  WORKER_RUN_DB_MIGRATIONS: 1
  DOCKER_REGISTRY: quay.io
  DOCKER_IMAGE: app-sre/rhel-bayesian-cucos-worker

resourceTemplates:
# -----------------------------------------------------------------------------
# INGESTION WORKERS
- name: bayesian-worker-ingestion
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: ingestion
    WORKER_EXCLUDE_QUEUES: GraphImporterTask,bayesianAnalysisFlow,bayesianApiFlow,bayesianApiPackageFlow,bayesianFlow,bayesianPackageAnalysisFlow,bayesianPackageFlow,bayesianPackageTaggingFlow,bayesianPriorityFlow,bayesianPriorityPackageFlow
    WORKER_NAME_SUFFIX: ''
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 512Mi
      MEMORY_LIMIT: 1536Mi
      CPU_REQUEST: 250m
      CPU_LIMIT: 500m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 512Mi
  #     MEMORY_LIMIT: 768Mi
  #     CPU_REQUEST: 250m
  #     CPU_LIMIT: 500m
  #     REPLICAS: 8
## GRAPH IMPORT
- name: bayesian-worker-ingestion-graph-import
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: ingestion
    WORKER_INCLUDE_QUEUES: GraphImporterTask
    WORKER_NAME_SUFFIX: '-graph-import'
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 128Mi
      MEMORY_LIMIT: 256Mi
      CPU_REQUEST: 100m
      CPU_LIMIT: 200m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 128Mi
  #     MEMORY_LIMIT: 256Mi
  #     CPU_REQUEST: 100m
  #     CPU_LIMIT: 200m
  #     REPLICAS: 8
## INGESTION DISPATCHER
- name: bayesian-worker-ingestion-dispatcher
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: ingestion
    WORKER_INCLUDE_QUEUES: GraphImporterTask
    WORKER_NAME_SUFFIX: '-dispatcher'
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 256Mi
      MEMORY_LIMIT: 320Mi
      CPU_REQUEST: 200m
      CPU_LIMIT: 350m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 256Mi
  #     MEMORY_LIMIT: 320Mi
  #     CPU_REQUEST: 200m
  #     CPU_LIMIT: 350m
  #     REPLICAS: 8
# -----------------------------------------------------------------------------
# PRIORITY WORKERS
- name: bayesian-worker-priority
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: priority
    WORKER_EXCLUDE_QUEUES: GraphImporterTask,bayesianAnalysisFlow,bayesianApiFlow,bayesianApiPackageFlow,bayesianFlow,bayesianPackageAnalysisFlow,bayesianPackageFlow,bayesianPackageTaggingFlow,bayesianPriorityFlow,bayesianPriorityPackageFlow
    WORKER_NAME_SUFFIX: ''
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 512Mi
      MEMORY_LIMIT: 1536Mi
      CPU_REQUEST: 250m
      CPU_LIMIT: 500m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 512Mi
  #     MEMORY_LIMIT: 1536Mi
  #     CPU_REQUEST: 250m
  #     CPU_LIMIT: 500m
  #     REPLICAS: 1
## GRAPH IMPORT
- name: bayesian-worker-priority-graph-import
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: priority
    WORKER_INCLUDE_QUEUES: GraphImporterTask
    WORKER_NAME_SUFFIX: '-graph-import'
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 128Mi
      MEMORY_LIMIT: 256Mi
      CPU_REQUEST: 100m
      CPU_LIMIT: 200m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 128Mi
  #     MEMORY_LIMIT: 256Mi
  #     CPU_REQUEST: 100m
  #     CPU_LIMIT: 200m
  #     REPLICAS: 1
## PRIORITY DISPATCHER
- name: bayesian-worker-priority-dispatcher
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: priority
    WORKER_INCLUDE_QUEUES: bayesianAnalysisFlow,bayesianApiFlow,bayesianApiPackageFlow,bayesianFlow,bayesianPackageAnalysisFlow,bayesianPackageFlow,bayesianPackageTaggingFlow,bayesianPriorityFlow,bayesianPriorityPackageFlow
    WORKER_NAME_SUFFIX: '-dispatcher'
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 256Mi
      MEMORY_LIMIT: 320Mi
      CPU_REQUEST: 200m
      CPU_LIMIT: 350m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 256Mi
  #     MEMORY_LIMIT: 320Mi
  #     CPU_REQUEST: 200m
  #     CPU_LIMIT: 350m
  #     REPLICAS: 1
# -----------------------------------------------------------------------------
# API WORKERS
- name: bayesian-worker-api
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: api
    WORKER_EXCLUDE_QUEUES: GraphImporterTask,bayesianAnalysisFlow,bayesianApiFlow,bayesianApiPackageFlow,bayesianFlow,bayesianPackageAnalysisFlow,bayesianPackageFlow,bayesianPackageTaggingFlow,bayesianPriorityFlow,bayesianPriorityPackageFlow,golangCVEPredictionsFlow
    WORKER_NAME_SUFFIX: ''
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 256Mi
      MEMORY_LIMIT: 1024Mi
      CPU_REQUEST: 200m
      CPU_LIMIT: 500m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 256Mi
  #     MEMORY_LIMIT: 1536Mi
  #     CPU_REQUEST: 200m
  #     CPU_LIMIT: 500m
  #     REPLICAS: 6
## GRAPH IMPORT
- name: bayesian-worker-api-graph-import
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: api
    WORKER_INCLUDE_QUEUES: GraphImporterTask
    WORKER_NAME_SUFFIX: '-graph-import'
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 128Mi
      MEMORY_LIMIT: 256Mi
      CPU_REQUEST: 100m
      CPU_LIMIT: 200m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 128Mi
  #     MEMORY_LIMIT: 256Mi
  #     CPU_REQUEST: 100m
  #     CPU_LIMIT: 200m
  #     REPLICAS: 4
## API DISPATCHER
- name: bayesian-worker-api-dispatcher
  url: https://github.com/fabric8-analytics/fabric8-analytics-worker
  path: /openshift/template.yaml
  parameters:
    WORKER_ADMINISTRATION_REGION: api
    WORKER_INCLUDE_QUEUES: bayesianAnalysisFlow,bayesianApiFlow,bayesianApiPackageFlow,bayesianFlow,bayesianPackageAnalysisFlow,bayesianPackageFlow,bayesianPackageTaggingFlow,bayesianPriorityFlow,bayesianPriorityPackageFlow
    WORKER_NAME_SUFFIX: '-dispatcher'
  targets:
  - namespace:
      $ref: /services/codeready-analytics/namespaces/bayesian-preview.yml
    ref: master
    upstream: fabric8-analytics-fabric8-analytics-worker-gh-build-master-rhel
    parameters:
      MEMORY_REQUEST: 256Mi
      MEMORY_LIMIT: 320Mi
      CPU_REQUEST: 200m
      CPU_LIMIT: 350m
      REPLICAS: 1
  # - namespace:
  #     $ref: /services/codeready-analytics/namespaces/bayesian-production.yml
  #   ref: TBD
  #   parameters:
  #     MEMORY_REQUEST: 256Mi
  #     MEMORY_LIMIT: 320Mi
  #     CPU_REQUEST: 200m
  #     CPU_LIMIT: 350m
  #     REPLICAS: 4
