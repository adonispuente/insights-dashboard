---
$schema: /app-sre/slo-document-1.yml

labels:
  service: web-rca

name: web-rca

namespaces:
  - $ref: /services/web-rca/namespaces/production.yml

slos:
  - name: Web-RCA API Latency
    SLIType: latency
    SLISpecification: Percentage of the requests responded under 1 second.
    SLODetails: https://gitlab.cee.redhat.com/service/app-interface/docs/web-rca/slos/web-rca-latency.md
    SLOParameters:
      window: 28d
    expr: |
      (sum(rate(api_inbound_request_duration_bucket{namespace="web-rca-production",job="web-rca-metrics",le="1",code!~"5.."}[{{window}}]))
      /
      sum(rate(api_inbound_request_duration_count{namespace="web-rca-production",job="web-rca-metrics",code!~"5.."}[{{window}}])))
    SLOTarget: 0.99
    SLOTargetUnit: percent_0_1
    prometheusRules: /observability/prometheusrules/web-rca-slo-production.prometheusrules.yaml
    prometheusRulesTests: /to/do
    dashboard: https://grafana.app-sre.devshift.net/d/_7_Ul_07k/web-rca?orgId=1&var-datasource=app-sre-stage-01-prometheus

  - name: Web-RCA API Availability
    SLIType: availability
    SLISpecification: Percentage of requests that are served successfully (status code != 5xx)
    SLODetails: https://gitlab.cee.redhat.com/service/app-interface/docs/web-rca/slos/web-rca-availability.md
    SLOParameters:
      window: 28d
    expr: |
      sum(rate(haproxy_backend_http_responses_total{route="web-rca-production",exported_namespace="web-rca-production",code!="5xx"}[{{window}}]))
      /
      sum(rate(haproxy_backend_http_responses_total{route="web-rca-production",exported_namespace="web-rca-production"}[{{window}}]))
    SLOTarget: 0.90
    SLOTargetUnit: percent_0_1
    prometheusRules: /observability/prometheusrules/web-rca-slo-production.prometheusrules.yaml
    prometheusRulesTests: /to/do
    dashboard: https://grafana.app-sre.devshift.net/d/_7_Ul_07k/web-rca?orgId=1&var-datasource=app-sre-stage-01-prometheus
