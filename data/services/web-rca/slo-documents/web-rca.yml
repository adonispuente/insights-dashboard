---
$schema: /app-sre/slo-document-1.yml

labels:
  service: web-rca

name: web-rca

namespaces:
  - $ref: /services/web-rca/namespaces/production.yml

slos:
  - name: Web-RCA API Latency
    SLIType: latency
    SLISpecification: Percentage of the requests responded under 1 second.
    SLODetails: /to/do
    SLOParameters:
      window: 28d
    expr: |
      (sum(rate(api_inbound_request_duration_bucket{container="service",endpoint="metrics",job="web-rca-metrics",service="web-rca-metrics",namespace="web-rca-production",le="1",code!~"5.."}[{{window}}]))
      /
      sum(rate(api_inbound_request_duration_count{container="service",endpoint="metrics",job="web-rca-metrics",service="web-rca-metrics",namespace="web-rca-production",code!~"5.."}[{{window}}])))
    SLOTarget: 0.95
    SLOTargetUnit: percent_0_1
    prometheusRules: /to/do
    prometheusRulesTests: /to/do
    dashboard: /to/do

  - name: Web-RCA API Availability
    SLIType: availability
    SLISpecification: Percentage of requests that are served successfully (status code != 5xx)
    SLODetails: /to/do
    SLOParameters:
      window: 28d
    expr: |
      sum(rate(haproxy_backend_http_responses_total{namespace="web-rca-production",code!="5xx"}[{{window}}]))
      /
      sum(rate(haproxy_backend_http_responses_total{namespace="web-rca-production"}[{{window}}]))
    SLOTarget: 0.95
    SLOTargetUnit: percent_0_1
    prometheusRules: /to/do
    prometheusRulesTests: /to/do
    dashboard: /to/do
