---
$schema: /app-sre/saas-file-2.yml

labels:
  service: acs-fleet-manager

name: acs-fleet-manager
description: "SaaS tracking file for acs-fleet-manager"

app:
  $ref: /services/acs-fleet-manager/app.yml

pipelinesProvider:
  $ref: /services/acs-fleet-manager/pipelines/tekton.acs-fleet-manager-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: acs-fleet-manager

managedResourceTypes:
  - Deployment
  - Service
  - ServiceAccount
  - PodDisruptionBudget
  - ConfigMap

imagePatterns:
  - quay.io/app-sre/acs-fleet-manager
  - quay.io/app-sre/envoyproxy

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

resourceTemplates:
  - name: acs-fleet-manager
    url: https://github.com/stackrox/acs-fleet-manager
    path: /templates/service-template.yml
    parameters:
      REGISTRY_IMG: quay.io/app-sre/acs-fleet-manager
      IMAGE_REGISTRY: quay.io
      IMAGE_REPOSITORY: app-sre/acs-fleet-manager
      ENVOY_IMAGE: quay.io/app-sre/envoyproxy:v1.20.2
    targets:
      - namespace:
          $ref: /services/acs-fleet-manager/namespaces/acs-fleet-manager-stage.yml
        ref: main
        parameters:
          ENVIRONMENT: stage
          CENTRAL_IDP_CLIENT_ID: rhacs-ms-qaprod
          CENTRAL_IDP_ISSUER: https://sso.redhat.com/auth/realms/redhat-external
          DATAPLANE_CLUSTER_CONFIG_FILE: /config/dataplane-cluster-configuration-staging.yaml
          PROVIDERS_CONFIG_FILE: /config/provider-configuration.yaml
          QUOTA_TYPE: ams
          OCM_URL: https://api.stage.openshift.com
          AMS_URL: https://api.stage.openshift.com
          CLUSTER_LIST:
            - name: default/api-acs-stage-dp-01-blbk-p1-openshiftapps-com:6443/acsms-admin
              cluster_id: 1ujvmrppj7au6cvjps6dj6mlechenrl1
              cloud_provider: aws
              region: us-east-1
              schedulable: true
              status: ready
              central_instance_limit: 1000
              provider_type: standalone
              supported_instance_type: "eval,standard"
              cluster_dns: apps.acs-stage-dp-01.blbk.p1.openshiftapps.com
              available_central_operator_versions:
                - version: "3.72.0"
                  ready: true
                  central_versions:
                    - version: "3.72.0"
        upstream:
          instance:
            $ref: /dependencies/ci-ext/ci-ext.yml
          name: stackrox-acs-fleet-manager-gh-build-main
      - namespace:
          $ref: /services/acs-fleet-manager/namespaces/acs-fleet-manager-production-app-sre-prod-04.yml
        ref: 5602823241f9e98b9f8d3ac6a982022e55703f91
        parameters:
          ENVIRONMENT: production
          CENTRAL_IDP_CLIENT_ID: rhacs-ms-qaprod
          CENTRAL_IDP_ISSUER: https://sso.redhat.com/auth/realms/redhat-external
          DATAPLANE_CLUSTER_CONFIG_FILE: /config/dataplane-cluster-configuration.yaml
          PROVIDERS_CONFIG_FILE: /config/provider-configuration.yaml
          OCM_URL: https://api.openshift.com
          AMS_URL: https://api.openshift.com
          REGISTERED_USERS_PER_ORGANISATION: >-
            [{id: 11009103, max_allowed_instances: 100, any_user: true, registered_users: []},
            {id: 16238026, max_allowed_instances: 25, any_user: true, registered_users: []}]
          CENTRAL_DOMAIN_NAME: acs.rhcloud.com
          CLUSTER_LIST:
            - name: /api-acs-prod-dp-01-pnz3-p1-openshiftapps-com:6443/acsms-prod-admin
              cluster_id: 1u4i1u6p38ho2fpgfq0p8iejfdkpvqin
              cloud_provider: aws
              region: us-east-1
              schedulable: true
              status: ready
              central_instance_limit: 42
              provider_type: standalone
              supported_instance_type: "standard"
              cluster_dns: apps.acs-prod-dp-01.pnz3.p1.openshiftapps.com
              available_central_operator_versions:
                - version: "3.72.0"
                  ready: true
                  central_versions:
                    - version: "3.72.0"
  - name: grafana-dashboard-acs-fleet-manager
    url: https://github.com/stackrox/acs-fleet-manager
    path: /dashboards
    provider: directory
    targets:
      - namespace:
          $ref: /services/observability/namespaces/app-sre-observability-stage.yml
        ref: main
      - namespace:
          $ref: /services/observability/namespaces/app-sre-observability-production.yml
        ref: 59142fe807ca20cb2284cd7c99822f58f56a73e0

