---
$schema: /app-sre/saas-file-2.yml

labels:
  service: acs-fleet-manager
  dora: acs-fleet-manager-production

name: acs-fleet-manager
description: "SaaS tracking file for acs-fleet-manager"

app:
  $ref: /services/acs-fleet-manager/app.yml

pipelinesProvider:
  $ref: /services/acs-fleet-manager/pipelines/tekton.acs-fleet-manager-pipelines.appsrep05ue1.yaml

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: acs-fleet-manager-notifications

managedResourceTypes:
  - Deployment
  - Service
  - ServiceAccount
  - PodDisruptionBudget
  - ConfigMap

imagePatterns:
  - quay.io/app-sre/acs-fleet-manager
  - quay.io/app-sre/envoyproxy

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

resourceTemplates:
  - name: acs-fleet-manager
    url: https://github.com/stackrox/acs-fleet-manager
    path: /templates/service-template.yml
    parameters:
      REGISTRY_IMG: quay.io/app-sre/acs-fleet-manager
      IMAGE_REGISTRY: quay.io
      IMAGE_REPOSITORY: app-sre/acs-fleet-manager
      ENVOY_IMAGE: quay.io/app-sre/envoyproxy:v1.20.2
    targets:
      - namespace:
          $ref: /services/acs-fleet-manager/namespaces/acs-fleet-manager-integration.yml
        ref: main
        parameters:
          ENVIRONMENT: integration
          DATABASE_SECRET_NAME: acs-fleet-manager-integration-rds
          DATAPLANE_CLUSTER_CONFIG_FILE: /config/dataplane-cluster-configuration.yaml
          PROVIDERS_CONFIG_FILE: /config/provider-configuration.yaml
          QUOTA_TYPE: ams
          OCM_URL: https://api.integration.openshift.com
          AMS_URL: https://api.integration.openshift.com
          CENTRAL_DOMAIN_NAME: acs-integration.rhcloud.com
          CENTRAL_CPU_REQUEST: "250m"
          CENTRAL_CPU_LIMIT: "2000m"
          CENTRAL_MEMORY_REQUEST: "250Mi"
          CENTRAL_MEMORY_LIMIT: "2Gi"
          SCANNER_ANALYZER_CPU_REQUEST: "500m"
          SCANNER_ANALYZER_CPU_LIMIT: "1000m"
          SCANNER_ANALYZER_MEMORY_REQUEST: "500Mi"
          SCANNER_ANALYZER_MEMORY_LIMIT: "2500Mi"
          SCANNER_DB_CPU_REQUEST: "100m"
          SCANNER_DB_CPU_LIMIT: "750m"
          SCANNER_DB_MEMORY_REQUEST: "500Mi"
          SCANNER_DB_MEMORY_LIMIT: "1500Mi"
          SUPPORTED_CLOUD_PROVIDERS:
            - name: aws
              default: true
              regions:
                - name: us-east-1
                  default: true
                  supported_instance_type:
                    standard: {}
          CLUSTER_LIST:
            # To update: maintain ordering, get information (e.g. `cluster_id`) from `$ ocm list clusters`
            # Remember to add the cluster to the `kubeconfig` secret and bump version in
            # namespaces/acs-fleet-manager-integration.yml
            # Important: The `name` field must match a context name in the `kubeconfig` secret
            - name: default/api-acs-int-us-01-isbr-p1-openshiftapps-com:6443/notarealuser
              cluster_id: 256ji3d7e3cs77vv8jdb3f70q5e2co61
              cloud_provider: aws
              region: us-east-1
              multi_az: true
              schedulable: true
              status: ready
              central_instance_limit: 20
              provider_type: standalone
              supported_instance_type: "standard"
              cluster_dns: apps.acs-int-us-01.isbr.p1.openshiftapps.com
              available_central_operator_versions:
              # This functionality is currently unused, so no need to update the version in this section,
              # but there must be exactly one entry here.
                - version: "3.74.0"
                  ready: true
                  central_versions:
                    - version: "3.74.0"

        upstream:
          instance:
            $ref: /dependencies/ci-ext/ci-ext.yml
          name: stackrox-acs-fleet-manager-build-and-push-main
      - namespace:
          $ref: /services/acs-fleet-manager/namespaces/acs-fleet-manager-stage.yml
        ref: 0498c814f1aeac9472fce47f836abadc58d8d80f
        promotion:
          publish:
            - acs-fleet-manager
        parameters:
          ENVIRONMENT: stage
          DATAPLANE_CLUSTER_CONFIG_FILE: /config/dataplane-cluster-configuration-staging.yaml
          PROVIDERS_CONFIG_FILE: /config/provider-configuration.yaml
          QUOTA_TYPE: ams
          OCM_URL: https://api.stage.openshift.com
          AMS_URL: https://api.stage.openshift.com
          CENTRAL_DOMAIN_NAME: acs-stage.rhcloud.com
          CENTRAL_CPU_REQUEST: "250m"
          CENTRAL_CPU_LIMIT: "2000m"
          CENTRAL_MEMORY_REQUEST: "250Mi"
          CENTRAL_MEMORY_LIMIT: "2Gi"
          SCANNER_ANALYZER_CPU_REQUEST: "500m"
          SCANNER_ANALYZER_CPU_LIMIT: "1000m"
          SCANNER_ANALYZER_MEMORY_REQUEST: "500Mi"
          SCANNER_ANALYZER_MEMORY_LIMIT: "2500Mi"
          SCANNER_DB_CPU_REQUEST: "100m"
          SCANNER_DB_CPU_LIMIT: "750m"
          SCANNER_DB_MEMORY_REQUEST: "500Mi"
          SCANNER_DB_MEMORY_LIMIT: "1500Mi"
          SUPPORTED_CLOUD_PROVIDERS:
            - name: aws
              default: true
              regions:
                - name: us-east-1
                  default: true
                  supported_instance_type:
                    standard: {}
                - name: eu-west-1
                  supported_instance_type:
                    standard: {}
          CLUSTER_LIST:
            # To update: maintain ordering, get information (e.g. `cluster_id`) from `$ ocm list clusters`
            # Remember to add the cluster to the `kubeconfig` secret and bump version in
            # namespaces/acs-fleet-manager-stage.yml
            # Important: The `name` field must match a context name in the `kubeconfig` secret
            - name: default/api-acs-stage-dp-02-8csb-p1-openshiftapps-com:6443/notarealuser
              cluster_id: 201t7gancnqq4t82rmnjm2239stvdj6r
              cloud_provider: aws
              region: us-east-1
              multi_az: true
              schedulable: true
              status: ready
              central_instance_limit: 20
              provider_type: standalone
              supported_instance_type: "standard"
              cluster_dns: apps.acs-stage-dp-02.8csb.p1.openshiftapps.com
              available_central_operator_versions:
              # This functionality is currently unused, so no need to update the version in this section,
              # but there must be exactly one entry here.
                - version: "3.74.0"
                  ready: true
                  central_versions:
                    - version: "3.74.0"
            - name: default/api-acs-stage-eu-02-blbk-p1-openshiftapps-com:6443/notarealuser
              cluster_id: 22u9u8qmm9t8hoc40iqm7rc6s8he5sv9
              cloud_provider: aws
              region: eu-west-1
              multi_az: true
              schedulable: true
              status: ready
              central_instance_limit: 20
              provider_type: standalone
              supported_instance_type: "standard"
              cluster_dns: apps.acs-stage-eu-02.blbk.p1.openshiftapps.com
              available_central_operator_versions:
              # This functionality is currently unused, so no need to update the version in this section,
              # but there must be exactly one entry here.
                - version: "3.74.0"
                  ready: true
                  central_versions:
                    - version: "3.74.0"

      - namespace:
          $ref: /services/acs-fleet-manager/namespaces/acs-fleet-manager-production-app-sre-prod-04.yml
        ref: f6d113eed354b98617b7ffe528ed15518fa2ecab
        parameters:
          ENVIRONMENT: production
          DATAPLANE_CLUSTER_CONFIG_FILE: /config/dataplane-cluster-configuration.yaml
          PROVIDERS_CONFIG_FILE: /config/provider-configuration.yaml
          QUOTA_TYPE: ams
          OCM_URL: https://api.openshift.com
          AMS_URL: https://api.openshift.com
          CENTRAL_DOMAIN_NAME: acs.rhcloud.com
          CENTRAL_CPU_REQUEST: "2000m"
          CENTRAL_CPU_LIMIT: "4000m"
          CENTRAL_MEMORY_REQUEST: "4Gi"
          CENTRAL_MEMORY_LIMIT: "8Gi"
          SCANNER_ANALYZER_CPU_REQUEST: "1500m"
          SCANNER_ANALYZER_CPU_LIMIT: "3000m"
          SCANNER_ANALYZER_MEMORY_REQUEST: "4Gi"
          SCANNER_ANALYZER_MEMORY_LIMIT: "8Gi"
          SCANNER_DB_CPU_REQUEST: "1250m"
          SCANNER_DB_CPU_LIMIT: "2500m"
          SCANNER_DB_MEMORY_REQUEST: "2Gi"
          SCANNER_DB_MEMORY_LIMIT: "4Gi"
          SUPPORTED_CLOUD_PROVIDERS:
            - name: aws
              default: true
              regions:
                - name: us-east-1
                  default: true
                  supported_instance_type:
                    standard: {}
                - name: eu-west-1
                  supported_instance_type:
                    standard: {}
          CLUSTER_LIST:
            # To update: maintain ordering, get information (e.g. `cluster_id`) from `$ ocm list clusters`
            - name: default/api-acs-prod-dp-01-pnz3-p1-openshiftapps-com:6443/notarealuser
              cluster_id: 1u4i1u6p38ho2fpgfq0p8iejfdkpvqin
              cloud_provider: aws
              region: us-east-1
              multi_az: true
              schedulable: true
              status: ready
              central_instance_limit: 150
              provider_type: standalone
              supported_instance_type: "standard"
              cluster_dns: apps.acs-prod-dp-01.pnz3.p1.openshiftapps.com
              available_central_operator_versions:
              # This functionality is currently unused, so no need to update the version in this section,
              # but there must be exactly one entry here.
                - version: "3.74.0"
                  ready: true
                  central_versions:
                    - version: "3.74.0"
            - name: default/api-acs-prod-eu-01-jbni-p1-openshiftapps-com:6443/notarealuser
              cluster_id: 22svsc7lhu6ss23vofmag84fut3fg6ne
              cloud_provider: aws
              region: eu-west-1
              multi_az: true
              schedulable: true
              status: ready
              central_instance_limit: 40
              provider_type: standalone
              supported_instance_type: "standard"
              cluster_dns: apps.acs-prod-eu-01.jbni.p1.openshiftapps.com
              available_central_operator_versions:
              # This functionality is currently unused, so no need to update the version in this section,
              # but there must be exactly one entry here.
                - version: "3.74.0"
                  ready: true
                  central_versions:
                    - version: "3.74.0"
  - name: grafana-dashboard-acs-fleet-manager
    url: https://github.com/stackrox/acs-fleet-manager
    path: /dashboards
    provider: directory
    targets:
      - namespace:
          $ref: /services/observability/namespaces/app-sre-observability-stage-int.yml
        ref: main
      - namespace:
          $ref: /services/observability/namespaces/app-sre-observability-production-int.yml
        ref: 2a8e8b0a999fcc70e2e0d6d340224c577cb5c07a

