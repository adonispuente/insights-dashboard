---
$schema: /app-sre/saas-file-2.yml

labels:
  service: mas-sso

name: saas-deployment-mas-sso
description: 'MAS SSO'

app:
  $ref: /services/mas-sso/app.yml

pipelinesProvider:
  $ref: /services/mas-sso/pipelines/tekton.mas-sso-pipelines.appsrep05ue1.yaml

configurableResources: true

deployResources:
  requests:
    cpu: 300m
    memory: 600Mi
  limits:
    cpu: 300m
    memory: 600Mi

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: mas-sso

managedResourceTypes:
- CatalogSource
- OperatorGroup
- Subscription
- Keycloak

authentication:
  image:
    path: managed-services/quay-org-accounts/rhoas/robots/rhoas-pull
    field: all

imagePatterns:
- quay.io/rhoas/mas-sso-operator-catalog

resourceTemplates:
- name: mas-sso-operator
  url: https://gitlab.cee.redhat.com/service/saas-mas-sso
  path: /deploy/openshift/mas-sso-olm-template.yaml
  parameters:
    IMAGE: quay.io/rhoas/mas-sso-operator-catalog
    OPERATOR_NAME: mas-sso-operator
    # IMAGE_TAG is SHA Based tag.
    RHSSO_OPERATOR_IMAGE_TAG: $(IMAGE_TAG)
    RELATED_IMAGE_RHSSO_TAG: $(IMAGE_TAG)
    RELATED_IMAGE_RHSSO_INIT_CONTAINER_TAG: $(IMAGE_TAG)
    CHANNEL: alpha
    #CR Related
    CR_REQUESTS_MEMORY: 4Gi 
    CR_REQUESTS_CPU: 2 
    CR_LIMITS_MEMORY: 4Gi
    CR_LIMITS_CPU: 4
    CR_INSTANCES: 3

  targets:
  - namespace:
      $ref: /services/mas-sso/namespaces/mas-sso-stage.yml
    ref: master
    parameters:
      NAMESPACE: mas-sso-stage
    upstream:
      instance:
        $ref: /dependencies/ci-int/ci-int.yml
      name: service-saas-mas-sso-gl-build-master
    promotion:
      publish:
      - saas-deployment-mas-sso-osd-stage-success-channel
  - namespace:
      $ref: /services/mas-sso/namespaces/mas-sso-production.yml
    ref: 9e26d2e045785be738323babbd4d8a3f89f0216f
    parameters:
      NAMESPACE: mas-sso-production
      CR_INSTANCES: 3
      
