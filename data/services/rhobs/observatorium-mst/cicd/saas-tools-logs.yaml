---
$schema: /app-sre/saas-file-2.yml

labels:
  service: observatorium

name: saas-observatorium-tools-logs
description: SaaS tracking file for Observatorium MST logging tools

app:
  $ref: /services/rhobs/observatorium-mst/app.yml

pipelinesProvider:
  $ref: /services/rhobs/observatorium/pipelines/observatorium-pipeline.appsrep05ue1.yaml

deployResources:
  requests:
    cpu: 800m
    memory: 1800Mi
  limits:
    memory: 1800Mi

slack:
  workspace:
    $ref: /dependencies/slack/redhat-internal.yml
  channel: team-monitoring-info

authentication:
  image:
    path: app-sre/quay/app-sre-pull
    field: all

managedResourceTypes:
- ClusterRole.rbac.authorization.k8s.io
- ClusterRoleBinding.rbac.authorization.k8s.io
- Deployment
- LokiStack
- Secret
- ServiceAccount

clusterAdmin: true

imagePatterns:
- quay.io/observatorium
- quay.io/app-sre


allowedSecretParameterPaths:
  - app-sre/integrations-output/terraform-resources/app-sre-stage-01/observatorium-tools
  - app-sre/integrations-output/terraform-resources/telemeter-prod-01/observatorium-tools
  - app-sre/integrations-output/terraform-resources/rhobsp02ue1/observatorium-tools

resourceTemplates:
- name: observatorium-meta-monitoring-logs
  path: /resources/services/meta-monitoring/logging-template.yaml
  url: https://github.com/rhobs/configuration
  targets:
    - namespace:
        $ref: /services/rhobs/observatorium-mst/namespaces/app-sre-stage-01/observatorium-tools.yml
      ref: fa8ef6643a2881d5a81887ceb1536554ceddcdea
      parameters:
        LOKI_STORAGE_SECRET_NAME: observatorium-loki-s3
        LOKI_SIZE: 1x.extra-small
      secretParameters:
        - name: ACCESS_KEY_ID
          secret:
            path: app-sre/integrations-output/terraform-resources/app-sre-stage-01/observatorium-tools/observatorium-loki
            field: aws_access_key_id
        - name: SECRET_ACCESS_KEY
          secret:
            path: app-sre/integrations-output/terraform-resources/app-sre-stage-01/observatorium-tools/observatorium-loki
            field: aws_secret_access_key
        - name: S3_BUCKET_NAME
          secret:
            path: app-sre/integrations-output/terraform-resources/app-sre-stage-01/observatorium-tools/observatorium-loki
            field: bucket
        - name: S3_BUCKET_REGION
          secret:
            path: app-sre/integrations-output/terraform-resources/app-sre-stage-01/observatorium-tools/observatorium-loki
            field: aws_region
        - name: S3_BUCKET_ENDPOINT
          secret:
            path: app-sre/integrations-output/terraform-resources/app-sre-stage-01/observatorium-tools/observatorium-loki
            field: endpoint
    - namespace:
        $ref: /services/rhobs/observatorium-mst/namespaces/telemeter-prod-01/observatorium-tools.yml
      ref: fa8ef6643a2881d5a81887ceb1536554ceddcdea
      parameters:
        LOKI_STORAGE_SECRET_NAME: observatorium-loki-s3
        LOKI_SIZE: 1x.small
      secretParameters:
        - name: ACCESS_KEY_ID
          secret:
            path: app-sre/integrations-output/terraform-resources/telemeter-prod-01/observatorium-tools/observatorium-loki
            field: aws_access_key_id
        - name: SECRET_ACCESS_KEY
          secret:
            path: app-sre/integrations-output/terraform-resources/telemeter-prod-01/observatorium-tools/observatorium-loki
            field: aws_secret_access_key
        - name: S3_BUCKET_NAME
          secret:
            path: app-sre/integrations-output/terraform-resources/telemeter-prod-01/observatorium-tools/observatorium-loki
            field: bucket
        - name: S3_BUCKET_REGION
          secret:
            path: app-sre/integrations-output/terraform-resources/telemeter-prod-01/observatorium-tools/observatorium-loki
            field: aws_region
        - name: S3_BUCKET_ENDPOINT
          secret:
            path: app-sre/integrations-output/terraform-resources/telemeter-prod-01/observatorium-tools/observatorium-loki
            field: endpoint
    - namespace:
        $ref: /services/rhobs/observatorium-mst/namespaces/rhobsp02ue1/observatorium-tools.yml
      ref: fa8ef6643a2881d5a81887ceb1536554ceddcdea
      parameters:
        LOKI_STORAGE_SECRET_NAME: observatorium-loki-s3
        LOKI_SIZE: 1x.extra-small
      secretParameters:
        - name: ACCESS_KEY_ID
          secret:
            path: app-sre/integrations-output/terraform-resources/rhobsp02ue1/observatorium-tools/observatorium-loki
            field: aws_access_key_id
        - name: SECRET_ACCESS_KEY
          secret:
            path: app-sre/integrations-output/terraform-resources/rhobsp02ue1/observatorium-tools/observatorium-loki
            field: aws_secret_access_key
        - name: S3_BUCKET_NAME
          secret:
            path: app-sre/integrations-output/terraform-resources/rhobsp02ue1/observatorium-tools/observatorium-loki
            field: bucket
        - name: S3_BUCKET_REGION
          secret:
            path: app-sre/integrations-output/terraform-resources/rhobsp02ue1/observatorium-tools/observatorium-loki
            field: aws_region
        - name: S3_BUCKET_ENDPOINT
          secret:
            path: app-sre/integrations-output/terraform-resources/rhobsp02ue1/observatorium-tools/observatorium-loki
            field: endpoint
