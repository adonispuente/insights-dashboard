---
$schema: /app-sre/saas-file-2.yml

labels:
  service: observatorium

name: saas-observatorium-tenants
description: SaaS file that deploys tenants in Observatorium

app:
  $ref: /services/rhobs/observatorium/app.yml

pipelinesProvider:
  $ref: /services/rhobs/observatorium/pipelines/observatorium-pipeline.app-sre-prod-01.yaml

slack:
  workspace:
    $ref: /dependencies/slack/coreos.yml
  channel: team-monitoring-info

imagePatterns: []

managedResourceTypes:
- Secret

resourceTemplates:
- name: tenants
  path: /resources/services/observatorium-tenants-template.yaml
  url: https://github.com/rhobs/configuration
  targets:
    - namespace:
        $ref: /services/rhobs/observatorium/namespaces/observatorium-testing.yml
      ref: main
      parameters:
        SECRET_NAME: observatorium-observatorium-api
        TENANTS:
          tenants:
            - id: 0fc2b00e-201b-4c17-b9f2-19d91adc4fd2
              name: rhobs
              oidc:
                clientID: ${CLIENT_ID}
                clientSecret: ${CLIENT_SECRET}
                issuerURL: https://sso.redhat.com/auth/realms/redhat-external
                redirectURL: https://observatorium-mst.api.stage.openshift.com/oidc/rhobs/callback
                usernameClaim: preferred_username
                groupClaim: email
      secretParameters:
        - name: CLIENT_ID
          secret:
            path: rhobs/testing/observatorium-testing/observatorium-observatorium-api
            field: client-id
            version: 2
        - name: CLIENT_SECRET
          secret:
            path: rhobs/testing/observatorium-testing/observatorium-observatorium-api
            field: client-secret
            version: 2
